USE [master]
GO
/****** Object:  Database [KARPDKS]    Script Date: 20.12.2023 17:26:31 ******/
CREATE DATABASE [KARPDKS]
 CONTAINMENT = NONE
 ON  PRIMARY 
( NAME = N'PDKS', FILENAME = N'C:\Program Files\Microsoft SQL Server\MSSQL12.MSSQLSERVER\MSSQL\DATA\KARPDKS_PROD.mdf' , SIZE = 1749440KB , MAXSIZE = UNLIMITED, FILEGROWTH = 1024KB )
 LOG ON 
( NAME = N'PDKS_log', FILENAME = N'C:\Program Files\Microsoft SQL Server\MSSQL12.MSSQLSERVER\MSSQL\DATA\KARPDKS_PROD_log.ldf' , SIZE = 916352KB , MAXSIZE = 102400000KB , FILEGROWTH = 10%)
GO
ALTER DATABASE [KARPDKS] SET COMPATIBILITY_LEVEL = 120
GO
IF (1 = FULLTEXTSERVICEPROPERTY('IsFullTextInstalled'))
begin
EXEC [KARPDKS].[dbo].[sp_fulltext_database] @action = 'enable'
end
GO
ALTER DATABASE [KARPDKS] SET ANSI_NULL_DEFAULT OFF 
GO
ALTER DATABASE [KARPDKS] SET ANSI_NULLS OFF 
GO
ALTER DATABASE [KARPDKS] SET ANSI_PADDING OFF 
GO
ALTER DATABASE [KARPDKS] SET ANSI_WARNINGS OFF 
GO
ALTER DATABASE [KARPDKS] SET ARITHABORT OFF 
GO
ALTER DATABASE [KARPDKS] SET AUTO_CLOSE OFF 
GO
ALTER DATABASE [KARPDKS] SET AUTO_SHRINK OFF 
GO
ALTER DATABASE [KARPDKS] SET AUTO_UPDATE_STATISTICS ON 
GO
ALTER DATABASE [KARPDKS] SET CURSOR_CLOSE_ON_COMMIT OFF 
GO
ALTER DATABASE [KARPDKS] SET CURSOR_DEFAULT  GLOBAL 
GO
ALTER DATABASE [KARPDKS] SET CONCAT_NULL_YIELDS_NULL OFF 
GO
ALTER DATABASE [KARPDKS] SET NUMERIC_ROUNDABORT OFF 
GO
ALTER DATABASE [KARPDKS] SET QUOTED_IDENTIFIER OFF 
GO
ALTER DATABASE [KARPDKS] SET RECURSIVE_TRIGGERS OFF 
GO
ALTER DATABASE [KARPDKS] SET  DISABLE_BROKER 
GO
ALTER DATABASE [KARPDKS] SET AUTO_UPDATE_STATISTICS_ASYNC OFF 
GO
ALTER DATABASE [KARPDKS] SET DATE_CORRELATION_OPTIMIZATION OFF 
GO
ALTER DATABASE [KARPDKS] SET TRUSTWORTHY OFF 
GO
ALTER DATABASE [KARPDKS] SET ALLOW_SNAPSHOT_ISOLATION OFF 
GO
ALTER DATABASE [KARPDKS] SET PARAMETERIZATION SIMPLE 
GO
ALTER DATABASE [KARPDKS] SET READ_COMMITTED_SNAPSHOT OFF 
GO
ALTER DATABASE [KARPDKS] SET HONOR_BROKER_PRIORITY OFF 
GO
ALTER DATABASE [KARPDKS] SET RECOVERY SIMPLE 
GO
ALTER DATABASE [KARPDKS] SET  MULTI_USER 
GO
ALTER DATABASE [KARPDKS] SET PAGE_VERIFY CHECKSUM  
GO
ALTER DATABASE [KARPDKS] SET DB_CHAINING OFF 
GO
ALTER DATABASE [KARPDKS] SET FILESTREAM( NON_TRANSACTED_ACCESS = OFF ) 
GO
ALTER DATABASE [KARPDKS] SET TARGET_RECOVERY_TIME = 60 SECONDS 
GO
ALTER DATABASE [KARPDKS] SET DELAYED_DURABILITY = DISABLED 
GO
USE [KARPDKS]
GO
/****** Object:  User [KarAgent]    Script Date: 20.12.2023 17:26:31 ******/
CREATE USER [KarAgent] FOR LOGIN [KarAgent] WITH DEFAULT_SCHEMA=[dbo]
GO
ALTER ROLE [db_datareader] ADD MEMBER [KarAgent]
GO
/****** Object:  UserDefinedFunction [dbo].[FN_CONVERT_TR]    Script Date: 20.12.2023 17:26:31 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
 

CREATE FUNCTION [dbo].[FN_CONVERT_TR](@ACIKLAMA  nvarchar(max)  )
RETURNS  nvarchar(max)   WITH EXECUTE AS CALLER
AS 
BEGIN  
	DECLARE @EN_ACIKLAMA  nvarchar(max)  
	IF (@ACIKLAMA IS NOT NULL) BEGIN
		 DECLARE @TR_CHAR nvarchar(1) 
		 DECLARE @EN_CHAR nvarchar(1)
		 DECLARE @cnt INT = 0;
		 DECLARE @pos INT = 0;
		 SET @EN_ACIKLAMA=RTRIM(@ACIKLAMA) COLLATE Turkish_CI_AS 
		 WHILE @cnt < 10 BEGIN
				SET @cnt = @cnt + 1;
				SELECT @TR_CHAR=CASE @cnt 
				   WHEN 1  THEN N'ı' COLLATE Turkish_CI_AS 
				   WHEN 2  THEN N'İ' COLLATE Turkish_CI_AS 
				   WHEN 3  THEN N'ü' COLLATE Turkish_CI_AS 
				   WHEN 4  THEN N'Ü' COLLATE Turkish_CI_AS 
				   WHEN 5  THEN N'ö' COLLATE Turkish_CI_AS 
				   WHEN 6  THEN N'Ö' COLLATE Turkish_CI_AS 
				   WHEN 7  THEN N'ğ' COLLATE Turkish_CI_AS  
				   WHEN 8  THEN N'Ğ' COLLATE Turkish_CI_AS 
				   WHEN 9  THEN N'ç' COLLATE Turkish_CI_AS 
				   WHEN 10 THEN N'Ç' COLLATE Turkish_CI_AS  END,
        		   @EN_CHAR=CASE @cnt WHEN 1 THEN N'i'  WHEN 2 THEN N'I' WHEN 3 THEN N'u' WHEN 4 THEN N'U' WHEN 5 THEN N'o'  
				   WHEN 6 THEN N'O'  WHEN 7 THEN N'g'  WHEN 8 THEN N'G' WHEN 9 THEN N'c' WHEN 10 THEN N'C' END
                SET @pos=CHARINDEX(@TR_CHAR, @EN_ACIKLAMA)
 				if (@pos>0)  
					SET @EN_ACIKLAMA=REPLACE(@EN_ACIKLAMA, @TR_CHAR, @EN_CHAR) COLLATE Turkish_CI_AS 
			 
		   END;
		
			WHILE CHARINDEX('  ', @EN_ACIKLAMA)>0 BEGIN
				SET @EN_ACIKLAMA=REPLACE(@EN_ACIKLAMA,'  ',' ') COLLATE Turkish_CI_AS 
			END
			WHILE CHARINDEX(' ', @EN_ACIKLAMA)=1 BEGIN
				SET @EN_ACIKLAMA=SUBSTRING(@EN_ACIKLAMA,2,LEN(@EN_ACIKLAMA)-1) COLLATE Turkish_CI_AS 
			END
		 
	   END
    RETURN @EN_ACIKLAMA  
END
GO
/****** Object:  UserDefinedFunction [dbo].[FN_DONEM_KODU]    Script Date: 20.12.2023 17:26:31 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO

CREATE FUNCTION [dbo].[FN_DONEM_KODU](@DONEM_ID [bigint])
RETURNS  nvarchar(6)  WITH EXECUTE AS CALLER
AS 
BEGIN  
    RETURN (SELECT CAST((YIL*100)+AY AS  nvarchar(6) ) FROM DENKLESTIRMEAY  WITH(nolock)   WHERE ID=@DONEM_ID )  
END
GO
/****** Object:  UserDefinedFunction [dbo].[FN_GECEN_AY_DEVREDEN_SURE]    Script Date: 20.12.2023 17:26:31 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
 
 
 

CREATE FUNCTION [dbo].[FN_GECEN_AY_DEVREDEN_SURE](@GECEN_AY_ID [bigint])
RETURNS [float] WITH EXECUTE AS CALLER
AS 
BEGIN  
    RETURN (SELECT CASE WHEN DURUM=1 THEN [DEVREDEN_SURE] ELSE NULL END FROM PERSONELDENKLESTIRME  WITH(nolock)   WHERE ID=@GECEN_AY_ID )  
END
GO
/****** Object:  UserDefinedFunction [dbo].[FN_GECEN_AY_DURUM]    Script Date: 20.12.2023 17:26:31 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO


CREATE FUNCTION [dbo].[FN_GECEN_AY_DURUM](@GECEN_AY_ID [bigint])
RETURNS [tinyint] WITH EXECUTE AS CALLER
AS 
BEGIN  
    RETURN (SELECT [DURUM] FROM PERSONELDENKLESTIRME  WITH(nolock)   WHERE ID=@GECEN_AY_ID )  
END
GO
/****** Object:  UserDefinedFunction [dbo].[FN_GET_KGS_KAPI_ID]    Script Date: 20.12.2023 17:26:31 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO




CREATE FUNCTION [dbo].[FN_GET_KGS_KAPI_ID](@KGS_ID [bigint])
RETURNS  [numeric](19, 0) WITH EXECUTE AS CALLER
AS 
BEGIN  
    DECLARE @KAPI_ID  [numeric](19, 0) 
	  SELECT @KAPI_ID=ID		FROM KAPI  WITH(nolock)   WHERE KGS_ID=@KGS_ID  
    RETURN  @KAPI_ID
END
GO
/****** Object:  UserDefinedFunction [dbo].[FN_GET_KGS_KULLANICI_ID]    Script Date: 20.12.2023 17:26:31 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
 CREATE FUNCTION [dbo].[FN_GET_KGS_KULLANICI_ID](@KGS_ID [bigint])
RETURNS  [numeric](19, 0) WITH EXECUTE AS CALLER
AS 
BEGIN  
    DECLARE @KULLANICI_ID  [numeric](19, 0) 
	  SELECT @KULLANICI_ID=U.ID		FROM PERSONEL P WITH(nolock)   
	  INNER JOIN PDKSUSER U ON U.PERSONEL_ID=P.ID
	    WHERE KGS_PERSONEL_ID=@KGS_ID  
    RETURN  @KULLANICI_ID
END
GO
/****** Object:  UserDefinedFunction [dbo].[FN_GET_KGS_PERSONEL_ID]    Script Date: 20.12.2023 17:26:31 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
 CREATE FUNCTION [dbo].[FN_GET_KGS_PERSONEL_ID](@KGS_ID [bigint])
RETURNS  [numeric](19, 0) WITH EXECUTE AS CALLER
AS 
BEGIN  
    DECLARE @PERSONEL_ID  [numeric](19, 0) 
	  SELECT @PERSONEL_ID=ID		FROM PERSONEL  WITH(nolock)   WHERE KGS_PERSONEL_ID=@KGS_ID  
    RETURN  @PERSONEL_ID
END
GO
/****** Object:  UserDefinedFunction [dbo].[FN_GET_SSK_CIKIS_TARIHI]    Script Date: 20.12.2023 17:26:31 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO

CREATE FUNCTION [dbo].[FN_GET_SSK_CIKIS_TARIHI](@TARIH [datetime], @SIRKET_ID [numeric](19, 0))
RETURNS [datetime] WITH EXECUTE AS CALLER
AS 
BEGIN  
    DECLARE @SSK_CIKIS_TARIHI  datetime
	SET @SSK_CIKIS_TARIHI = @TARIH
	IF (@TARIH IS NOT NULL AND @SIRKET_ID IS NOT NULL)
			SELECT @SSK_CIKIS_TARIHI=DATEADD(day,CASE WHEN S.ERP_DURUM=0 OR S.ISTEN_AYR_TAR_CALISIYOR=1 THEN 0 ELSE -1 END ,@TARIH) FROM SIRKET S WITH(nolock)  
				WHERE S.ID=@SIRKET_ID
 
    RETURN @SSK_CIKIS_TARIHI
END
GO
/****** Object:  UserDefinedFunction [dbo].[FN_KGS_ID]    Script Date: 20.12.2023 17:26:31 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
 CREATE FUNCTION [dbo].[FN_KGS_ID](@ID [numeric](19, 0))
RETURNS  [numeric](19, 0)  WITH EXECUTE AS CALLER
AS 
BEGIN  
    RETURN (SELECT @ID AS KGS_ID )  
END
GO
/****** Object:  UserDefinedFunction [dbo].[FN_KGS_PERSONEL_NO]    Script Date: 20.12.2023 17:26:31 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE FUNCTION [dbo].[FN_KGS_PERSONEL_NO](@KGS_ID [bigint])
RETURNS  nvarchar(32)  WITH EXECUTE AS CALLER
AS 
BEGIN  
	  DECLARE @PER_NO nvarchar(32) 
	  SELECT @PER_NO =MAX(RTRIM(COALESCE(PDKS_SICIL_NO,'')) )		FROM PERSONEL  WITH(nolock)   WHERE KGS_PERSONEL_ID=@KGS_ID  
    RETURN  @PER_NO
END
GO
/****** Object:  UserDefinedFunction [dbo].[FN_KGS_SIRKET_PERSONEL_NO]    Script Date: 20.12.2023 17:26:31 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE FUNCTION [dbo].[FN_KGS_SIRKET_PERSONEL_NO](@KGS_ID [bigint],@KGS_SIRKET_ID [bigint])
RETURNS  nvarchar(32)  WITH EXECUTE AS CALLER
AS 
BEGIN  
	  DECLARE @PER_NO nvarchar(32) 
	  SELECT @PER_NO =MAX(RTRIM(COALESCE(KS.PERSONEL_NO,'')) )		FROM PERSONEL_SIRKET_KGS KS   WITH(nolock)
	  WHERE KS.KGS_ID=@KGS_ID AND KS.KGS_SIRKET_ID=@KGS_SIRKET_ID
	 
    RETURN  @PER_NO
END

GO
/****** Object:  UserDefinedFunction [dbo].[FN_KGS_TC_KIMLIK_NO]    Script Date: 20.12.2023 17:26:31 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
 

CREATE FUNCTION [dbo].[FN_KGS_TC_KIMLIK_NO](@KGS_ID [bigint])
RETURNS  nvarchar(32)  WITH EXECUTE AS CALLER
AS 
BEGIN  
	  DECLARE @TC_KIMLIK_NO nvarchar(32) 
	  SELECT @TC_KIMLIK_NO =RTRIM(COALESCE(TC_KIMLIK_NO,'')) FROM PERSONEL_SIRKET_KGS  WITH(nolock)   WHERE ID=@KGS_ID  
    RETURN  @TC_KIMLIK_NO
END
GO
/****** Object:  UserDefinedFunction [dbo].[FN_MENU_ACIKLAMA]    Script Date: 20.12.2023 17:26:31 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO



CREATE FUNCTION [dbo].[FN_MENU_ACIKLAMA](@MENU_ADI nvarchar(255))
RETURNS  nvarchar(255)  WITH EXECUTE AS CALLER
AS 
BEGIN  
	  DECLARE @ACIKLAMA nvarchar(255) 
	  SELECT @ACIKLAMA =RTRIM(COALESCE(T.ACIKLAMATR,'')) 		FROM MENUITEM M WITH(nolock)  
	  INNER JOIN TANIM T ON T.ID=M.DESCRIPTION_ID
	  WHERE M.NAME=@MENU_ADI 
    RETURN  @ACIKLAMA
END
GO
/****** Object:  UserDefinedFunction [dbo].[FN_MERGE_DOUBLE_CHAR]    Script Date: 20.12.2023 17:26:31 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO


CREATE FUNCTION [dbo].[FN_MERGE_DOUBLE_CHAR](@STR1 nvarchar(510),@STR2 nvarchar(510))
RETURNS   nvarchar(1024) WITH EXECUTE AS CALLER
AS 
BEGIN  
    DECLARE @STR_MERGE  nvarchar(1024)
	SET @STR_MERGE=''
	IF (@STR1 IS NOT NULL) BEGIN
		SET @STR_MERGE=RTRIM(@STR1)+' '
	END
	IF (@STR1 IS NOT NULL) BEGIN
		SET @STR_MERGE=@STR_MERGE+RTRIM(@STR2) 
	END
    RETURN RTRIM(@STR_MERGE)
END
GO
/****** Object:  UserDefinedFunction [dbo].[FN_PDKS_HELP_DESK_DURUM]    Script Date: 20.12.2023 17:26:31 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
 
 

CREATE FUNCTION [dbo].[FN_PDKS_HELP_DESK_DURUM]()
RETURNS [tinyint] WITH EXECUTE AS CALLER
AS 
BEGIN  
 
	 DECLARE @durum [tinyint]
	 DECLARE @DEGER nvarchar(128)
	 SET @DEGER=''
	 SELECT @DEGER=DEGER	FROM PARAMETRE   WITH(nolock)    WHERE ADI= 'helpDeskStatus'  AND DURUM=1
 
    IF (@DEGER='1') 
		SET @durum=1
		ELSE
		SET @durum=0
    RETURN  @durum

    
END
GO
/****** Object:  UserDefinedFunction [dbo].[FN_PDKS_TABLE_UPDATE_DURUM]    Script Date: 20.12.2023 17:26:31 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO

 
 
CREATE FUNCTION [dbo].[FN_PDKS_TABLE_UPDATE_DURUM](@tableName nvarchar(128))
RETURNS [tinyint] WITH EXECUTE AS CALLER
AS 
BEGIN  
     DECLARE @tarih datetime
	 DECLARE @durum [tinyint]
	 DECLARE @DEGER nvarchar(128)
	 DECLARE @ADI nvarchar(128)
	 DECLARE @bugun datetime
	 set @ADI = CASE WHEN COALESCE(@tableName,'')<>'' THEN  'update' + @tableName ELSE 'KGSVeriUpdate' END
	
	 SET @bugun=GETDATE()
	 SELECT   @DEGER=DEGER	FROM PARAMETRE   WITH(nolock)   WHERE ADI= @ADI  AND DURUM=1
	 if (@DEGER IS NOT NULL)   
		set @tarih=TRY_CONVERT(datetime,@DEGER,102)
	 
    IF (@tarih IS NULL)  
	  SET @tarih =DATEADD(day,-1,@bugun)
    IF (@bugun<@tarih) 
		SET @durum=1
		ELSE
		SET @durum=0
    RETURN  @durum

    
END

GO
/****** Object:  UserDefinedFunction [dbo].[FN_PDKS_UPDATE_DURUM]    Script Date: 20.12.2023 17:26:31 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
 

CREATE FUNCTION [dbo].[FN_PDKS_UPDATE_DURUM]()
RETURNS [tinyint] WITH EXECUTE AS CALLER
AS 
BEGIN  
     DECLARE @tarih datetime
	 DECLARE @durum [tinyint]
	 DECLARE @DEGER nvarchar(128)
	 DECLARE @bugun datetime
	 SET @bugun=GETDATE()
	 SELECT   @DEGER=DEGER	FROM PARAMETRE     WHERE ADI='KGSVeriUpdate' AND DURUM=1
	 if (@DEGER IS NOT NULL)   
		set @tarih=TRY_CONVERT(datetime,@DEGER,102)
	 
    IF (@tarih IS NULL)  
	  SET @tarih =DATEADD(day,-1,@bugun)
    IF (@bugun<@tarih) 
		SET @durum=1
		ELSE
		SET @durum=0
    RETURN  @durum

    
END
GO
/****** Object:  UserDefinedFunction [dbo].[FN_PERSONEL_NO]    Script Date: 20.12.2023 17:26:31 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE FUNCTION [dbo].[FN_PERSONEL_NO](@ID [bigint])
RETURNS  nvarchar(32)  WITH EXECUTE AS CALLER
AS 
BEGIN  
	  DECLARE @PER_NO nvarchar(32) 
	  SELECT @PER_NO =RTRIM(COALESCE(PDKS_SICIL_NO,'')) 		FROM PERSONEL  WITH(nolock)   WHERE ID=@ID  
    RETURN  @PER_NO
END
GO
/****** Object:  UserDefinedFunction [dbo].[FN_ROL_ACIKLAMA]    Script Date: 20.12.2023 17:26:31 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
 

 

CREATE FUNCTION [dbo].[FN_ROL_ACIKLAMA](@ROL_ADI nvarchar(255))
RETURNS  nvarchar(255)  WITH EXECUTE AS CALLER
AS 
BEGIN  
	  DECLARE @ACIKLAMA nvarchar(255) 
	  SELECT @ACIKLAMA =RTRIM(COALESCE(ACIKLAMA,'')) 		FROM ROLE  WITH(nolock)   WHERE ROLENAME=@ROL_ADI 
    RETURN  @ACIKLAMA
END
GO
/****** Object:  UserDefinedFunction [dbo].[FN_SISTEM_ADMIN_ID]    Script Date: 20.12.2023 17:26:31 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO

 
CREATE FUNCTION [dbo].[FN_SISTEM_ADMIN_ID](@TIP[nvarchar](1))
RETURNS [numeric](19, 0) WITH EXECUTE AS CALLER
AS 
BEGIN  

	  DECLARE @ADMIN_ID [numeric](19, 0)
	  SET @ADMIN_ID = 1

	  SELECT @ADMIN_ID = CASE WHEN COALESCE(@TIP,'U') = 'U' THEN  U.ID ELSE P.ID END FROM PARAMETRE PA   WITH(nolock) 
		INNER JOIN PDKSUSER U ON U.KULLANICI_ADI = PA.DEGER AND U.DURUM = 1
		INNER JOIN PERSONEL P ON P.ID = U.PERSONEL_ID AND P.DURUM = 1
		AND (CONVERT(DATE,GETDATE()) BETWEEN P.ISE_BASLAMA_TARIHI AND P.SSK_CIKIS_TARIHI)
	  WHERE PA.ADI = 'sistemAdminUserName' AND PA.DURUM = 1
  	   
    RETURN  @ADMIN_ID
END

GO
/****** Object:  UserDefinedFunction [dbo].[FN_TANIM_ACIKLAMA]    Script Date: 20.12.2023 17:26:31 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
 
CREATE FUNCTION [dbo].[FN_TANIM_ACIKLAMA](@ID [bigint], @DIL_KODU [nvarchar](4))
RETURNS [nvarchar](128) WITH EXECUTE AS CALLER
AS 
BEGIN  
	  DECLARE @ACIKLAMA nvarchar(128) 
	  SELECT @ACIKLAMA =CASE WHEN @DIL_KODU IS NOT NULL AND UPPER(@DIL_KODU)='E' THEN ACIKLAMAEN ELSE ACIKLAMATR END
		FROM TANIM  WITH(nolock)   WHERE ID=@ID  
    RETURN  @ACIKLAMA
END
GO
/****** Object:  UserDefinedFunction [dbo].[FN_TANIM_ERP_KODU]    Script Date: 20.12.2023 17:26:31 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
 

CREATE FUNCTION [dbo].[FN_TANIM_ERP_KODU](@ID [bigint])
RETURNS [nvarchar](16) WITH EXECUTE AS CALLER
AS 
BEGIN  
    DECLARE @ERP_KODU nvarchar(16) 
	  SELECT @ERP_KODU=ERP_KODU		FROM TANIM  WITH(nolock)   WHERE ID=@ID  
    RETURN  @ERP_KODU
END
GO
/****** Object:  UserDefinedFunction [dbo].[FN_VARDIYA_ACIKLAMA]    Script Date: 20.12.2023 17:26:31 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO

CREATE FUNCTION [dbo].[FN_VARDIYA_ACIKLAMA](@RVARDIYA_ID [numeric](19, 0))
RETURNS  nvarchar(255)  WITH EXECUTE AS CALLER
AS 
BEGIN  
	  DECLARE @ACIKLAMA nvarchar(255) 
	  SELECT @ACIKLAMA =RTRIM(COALESCE(KISA_ADI,'')) +
	   CASE WHEN COALESCE(VARDIYATIPI,'')='' THEN ' [ ' + RTRIM(COALESCE(ADI,''))  + ' ] '  ELSE '' END		FROM VARDIYA  WITH(nolock)   WHERE ID=@RVARDIYA_ID 
    RETURN  @ACIKLAMA
END
GO
/****** Object:  Table [dbo].[ACCOUNTPERMISSION]    Script Date: 20.12.2023 17:26:31 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[ACCOUNTPERMISSION](
	[ID] [numeric](19, 0) IDENTITY(1,1) NOT NULL,
	[ACTION] [varchar](255) NULL,
	[DISCRIMINATOR] [varchar](255) NULL,
	[RECIPIENT] [varchar](255) NULL,
	[STATUS] [tinyint] NULL,
	[TARGET] [varchar](255) NULL,
	[RECIPIENTDESCRIPTION]  AS ([dbo].[FN_ROL_ACIKLAMA]([RECIPIENT])),
	[TARGETDESCRIPTION]  AS ([dbo].[FN_MENU_ACIKLAMA]([TARGET])),
PRIMARY KEY CLUSTERED 
(
	[ID] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
) ON [PRIMARY]
GO
/****** Object:  Table [dbo].[ARIFE_VARDIYA_DONEM]    Script Date: 20.12.2023 17:26:31 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[ARIFE_VARDIYA_DONEM](
	[ID] [numeric](19, 0) IDENTITY(1,1) NOT NULL,
	[BAS_TARIHI] [datetime] NOT NULL,
	[BIT_TARIHI] [datetime] NOT NULL,
	[TATIL_BAS_TIME] [nvarchar](8) NOT NULL,
	[VARDIYA_ID] [numeric](19, 0) NULL,
	[ARIFE_VARDIYA_HESAPLA] [tinyint] NULL,
	[DURUM] [tinyint] NULL,
	[VERSION] [int] NULL,
	[OLUSTURANUSER_ID] [numeric](19, 0) NULL,
	[OLUSTURMATARIHI] [datetime] NULL,
	[GUNCELLEYENUSER_ID] [numeric](19, 0) NULL,
	[GUNCELLEMETARIHI] [datetime] NULL,
	[ARIFE_SONRA_CAL_VAR_DENK_YOK] [tinyint] NULL,
	[VARDIYA_ACIKLAMA]  AS ([dbo].[FN_VARDIYA_ACIKLAMA]([VARDIYA_ID])),
PRIMARY KEY CLUSTERED 
(
	[ID] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
) ON [PRIMARY]
GO
/****** Object:  Table [dbo].[BOLUM_KAT]    Script Date: 20.12.2023 17:26:31 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[BOLUM_KAT](
	[ID] [numeric](19, 0) IDENTITY(1,1) NOT NULL,
	[DURUM] [tinyint] NULL,
	[GUNCELLEMETARIHI] [datetime] NULL,
	[OLUSTURMATARIHI] [datetime] NULL,
	[ACIKLAMA] [varchar](128) NULL,
	[KODU] [varchar](24) NULL,
	[VERSION] [int] NULL,
	[GUNCELLEYENUSER_ID] [numeric](19, 0) NULL,
	[OLUSTURANUSER_ID] [numeric](19, 0) NULL,
	[KAT_ID] [numeric](19, 0) NOT NULL,
PRIMARY KEY CLUSTERED 
(
	[ID] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
) ON [PRIMARY]
GO
/****** Object:  Table [dbo].[CALISMA_MODELI]    Script Date: 20.12.2023 17:26:31 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[CALISMA_MODELI](
	[ID] [numeric](19, 0) IDENTITY(1,1) NOT NULL,
	[ACIKLAMA] [varchar](255) NULL,
	[HAFTA_ICI_SAAT] [float] NULL,
	[CUMARTESI_SAAT] [float] NULL,
	[IZIN_SAAT] [float] NULL,
	[DURUM] [tinyint] NULL,
	[BAGLI_VARDIYA_SABLON_ID] [numeric](19, 0) NULL,
	[DEPARTMAN_ID] [numeric](19, 0) NULL,
	[GUNCELLEMETARIHI] [datetime] NULL,
	[GUNCELLEYENUSER_ID] [numeric](19, 0) NULL,
	[OLUSTURMATARIHI] [datetime] NULL,
	[OLUSTURANUSER_ID] [numeric](19, 0) NULL,
	[ARIFE_SAAT] [float] NULL,
	[TOPLAM_GUN_GUNCELLE] [tinyint] NULL,
	[GENEL_VARDIYA] [tinyint] NULL,
	[IZIN_CUMARTESI_SAAT] [float] NULL,
	[HAFTA_TATIL_MESAI_ODE] [tinyint] NULL,
	[GECE_HAFTA_TATIL_MESAI_PARCALA] [tinyint] NULL,
	[GECE_CALISMA_ODEME_VAR] [tinyint] NULL,
	[NEGATIF_BAKIYE_SAAT] [float] NULL,
	[HAREKET_KAYDI_VARDIYA_BUL] [tinyint] NULL,
	[MAAS_ODEME_TIPI] [tinyint] NOT NULL,
	[FAZLA_MESAI_VAR] [tinyint] NOT NULL,
	[ORTAK_VARDIYA] [tinyint] NULL,
	[OTOMATIK_FAZLA_CALISMA_ONAYLANSIN] [tinyint] NULL,
	[FAZLA_CALISMA_GORUNTULENSIN] [tinyint] NULL,
	[ILK_PLAN_ONAYLI] [tinyint] NULL,
PRIMARY KEY CLUSTERED 
(
	[ID] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
) ON [PRIMARY]
GO
/****** Object:  Table [dbo].[CALISMA_MODELI_AY]    Script Date: 20.12.2023 17:26:31 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[CALISMA_MODELI_AY](
	[ID] [numeric](19, 0) IDENTITY(1,1) NOT NULL,
	[DONEM_ID] [numeric](19, 0) NULL,
	[CALISMA_MODELI_ID] [numeric](19, 0) NULL,
	[SURE] [float] NOT NULL,
	[SUT_IZNI_SURE] [float] NULL,
	[NEGATIF_BAKIYE_SAAT] [float] NULL,
	[HAREKET_KAYDI_VARDIYA_BUL] [tinyint] NULL,
	[OTOMATIK_FAZLA_CALISMA_ONAYLANSIN] [tinyint] NULL,
PRIMARY KEY CLUSTERED 
(
	[ID] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
) ON [PRIMARY]
GO
/****** Object:  Table [dbo].[CALISMA_MODELI_VARDIYA]    Script Date: 20.12.2023 17:26:31 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[CALISMA_MODELI_VARDIYA](
	[ID] [numeric](19, 0) IDENTITY(1,1) NOT NULL,
	[CALISMA_MODELI_ID] [numeric](19, 0) NULL,
	[VARDIYA_ID] [numeric](19, 0) NULL,
PRIMARY KEY CLUSTERED 
(
	[ID] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY],
UNIQUE NONCLUSTERED 
(
	[CALISMA_MODELI_ID] ASC,
	[VARDIYA_ID] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
) ON [PRIMARY]
GO
/****** Object:  Table [dbo].[CALISMA_SEKLI]    Script Date: 20.12.2023 17:26:31 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[CALISMA_SEKLI](
	[ID] [numeric](19, 0) IDENTITY(1,1) NOT NULL,
	[DURUM] [tinyint] NULL,
	[ADI] [varchar](255) NULL,
	[ARIFE_NORMAL_CALISMA_DAKIKA] [numeric](19, 2) NOT NULL,
	[GUNCELLEMETARIHI] [datetime] NULL,
	[OLUSTURMATARIHI] [datetime] NULL,
	[GUNCELLEYENUSER_ID] [numeric](19, 0) NULL,
	[OLUSTURANUSER_ID] [numeric](19, 0) NULL,
 CONSTRAINT [PK_CALISMA_SEKLI] PRIMARY KEY CLUSTERED 
(
	[ID] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
) ON [PRIMARY]
GO
/****** Object:  Table [dbo].[DENKLESTIRMEAY]    Script Date: 20.12.2023 17:26:31 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[DENKLESTIRMEAY](
	[ID] [numeric](19, 0) IDENTITY(1,1) NOT NULL,
	[DURUM] [tinyint] NULL,
	[GUNCELLEMETARIHI] [datetime] NULL,
	[OLUSTURMATARIHI] [datetime] NULL,
	[AY] [int] NOT NULL,
	[YIL] [int] NOT NULL,
	[GUNCELLEYENUSER_ID] [numeric](19, 0) NULL,
	[OLUSTURANUSER_ID] [numeric](19, 0) NULL,
	[SURE] [float] NULL,
	[SUT_IZNI_SURE] [float] NULL,
	[GUNCELLE_IK] [tinyint] NULL,
	[IK_OTOMATIK_ONAY_TARIHI] [date] NULL,
	[FAZLA_MESAI_ONAY_DURUM] [tinyint] NULL,
	[YEMEK_MOLASI_CALISMA_YUZDESI] [float] NULL,
	[GUN_MAX_CALISMA_SURESI] [float] NULL,
	[DENKLESTIRME_KESINTI_YAP] [tinyint] NULL,
 CONSTRAINT [PK__DenklestirmeA__2E2C589B] PRIMARY KEY CLUSTERED 
(
	[ID] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY],
 CONSTRAINT [UQ__DenklestirmeA__2F207CD4] UNIQUE NONCLUSTERED 
(
	[YIL] ASC,
	[AY] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
) ON [PRIMARY]
GO
/****** Object:  Table [dbo].[DEPARTMAN]    Script Date: 20.12.2023 17:26:31 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[DEPARTMAN](
	[ID] [numeric](19, 0) IDENTITY(1,1) NOT NULL,
	[DURUM] [tinyint] NULL,
	[GUNCELLEMETARIHI] [datetime] NULL,
	[OLUSTURMATARIHI] [datetime] NULL,
	[ADMIN_DURUM] [tinyint] NOT NULL,
	[COCUK_YAS_UST_SINIRI] [int] NULL,
	[ICAP_OLABILIR] [tinyint] NOT NULL,
	[VERSION] [int] NULL,
	[YASLI_YAS_ALT_SINIRI] [int] NULL,
	[GUNCELLEYENUSER_ID] [numeric](19, 0) NULL,
	[OLUSTURANUSER_ID] [numeric](19, 0) NULL,
	[DEPARTMAN_ID] [numeric](19, 0) NOT NULL,
	[MAIL_BOX] [varchar](255) NULL,
	[GIRIS_TIPI_ID] [numeric](19, 0) NULL,
	[FAZLA_MESAI_ODE] [tinyint] NULL,
	[SUA_OLABILIR] [tinyint] NULL,
	[IZIN_GIRILEBILIR] [tinyint] NULL,
	[FAZLA_MESAI_TALEP_GIRILEBILIR] [tinyint] NULL,
	[SIRKET_EKLENEBILIR] [tinyint] NULL,
PRIMARY KEY CLUSTERED 
(
	[ID] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
) ON [PRIMARY]
GO
/****** Object:  Table [dbo].[DEPARTMANMAILGRUBU]    Script Date: 20.12.2023 17:26:31 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[DEPARTMANMAILGRUBU](
	[ID] [numeric](19, 0) IDENTITY(1,1) NOT NULL,
	[DURUM] [tinyint] NULL,
	[GUNCELLEMETARIHI] [datetime] NULL,
	[OLUSTURMATARIHI] [datetime] NULL,
	[MAIL_ADRESS] [varchar](255) NULL,
	[GUNCELLEYENUSER_ID] [numeric](19, 0) NULL,
	[OLUSTURANUSER_ID] [numeric](19, 0) NULL,
	[DEPARTMAN_ID] [numeric](19, 0) NULL,
PRIMARY KEY CLUSTERED 
(
	[ID] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
) ON [PRIMARY]
GO
/****** Object:  Table [dbo].[DOSYA]    Script Date: 20.12.2023 17:26:31 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[DOSYA](
	[ID] [numeric](19, 0) IDENTITY(1,1) NOT NULL,
	[ACIKLAMA] [varchar](128) NULL,
	[DOSYA_ADI] [varchar](128) NULL,
	[DOSYA_ICERIK] [image] NULL,
	[ICERIK_TIPI] [varchar](128) NULL,
	[VERSION] [int] NULL,
PRIMARY KEY CLUSTERED 
(
	[ID] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
) ON [PRIMARY] TEXTIMAGE_ON [PRIMARY]
GO
/****** Object:  Table [dbo].[FAZLA_MESAI_TALEP]    Script Date: 20.12.2023 17:26:31 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[FAZLA_MESAI_TALEP](
	[ID] [numeric](19, 0) IDENTITY(1,1) NOT NULL,
	[DURUM] [tinyint] NULL,
	[VARDIYA_GUN_ID] [numeric](19, 0) NOT NULL,
	[BASLANGIC_ZAMANI] [datetime] NULL,
	[BITIS_ZAMANI] [datetime] NULL,
	[ONAY_DURUMU] [int] NULL,
	[MESAI_SURESI] [float] NOT NULL,
	[MESAI_NEDEN_ID] [numeric](19, 0) NOT NULL,
	[ACIKLAMA] [varchar](256) NULL,
	[IPTAL_NEDEN_ID] [numeric](19, 0) NULL,
	[IPTAL_ACIKLAMA] [varchar](256) NULL,
	[OLUSTURMATARIHI] [datetime] NULL,
	[GUNCELLEMETARIHI] [datetime] NULL,
	[OLUSTURANUSER_ID] [numeric](19, 0) NULL,
	[GUNCELLEYENUSER_ID] [numeric](19, 0) NULL,
 CONSTRAINT [PK_FAZLA_MESAI_TALEP] PRIMARY KEY CLUSTERED 
(
	[ID] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
) ON [PRIMARY]
GO
/****** Object:  Table [dbo].[ISKUR_VARDIYA_GUN]    Script Date: 20.12.2023 17:26:31 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[ISKUR_VARDIYA_GUN](
	[ID] [numeric](19, 0) IDENTITY(1,1) NOT NULL,
	[VARDIYA_TARIHI] [datetime] NOT NULL,
	[PERSONEL_ID] [numeric](19, 0) NOT NULL,
	[VARDIYA_ID] [numeric](19, 0) NOT NULL,
	[DURUM] [tinyint] NULL,
	[GUNCELLEMETARIHI] [datetime] NULL,
	[OLUSTURMATARIHI] [datetime] NULL,
	[GUNCELLEYENUSER_ID] [numeric](19, 0) NULL,
	[OLUSTURANUSER_ID] [numeric](19, 0) NULL,
	[VERSION] [int] NULL,
	[PERSONEL_NO]  AS ([dbo].[FN_PERSONEL_NO]([PERSONEL_ID])),
PRIMARY KEY CLUSTERED 
(
	[ID] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY],
UNIQUE NONCLUSTERED 
(
	[VARDIYA_TARIHI] ASC,
	[PERSONEL_ID] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
) ON [PRIMARY]
GO
/****** Object:  Table [dbo].[IZIN_REFERANS_ERP]    Script Date: 20.12.2023 17:26:31 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[IZIN_REFERANS_ERP](
	[REFERANS_ID] [varchar](32) NOT NULL,
	[IZIN_ID] [numeric](19, 0) NOT NULL,
PRIMARY KEY CLUSTERED 
(
	[REFERANS_ID] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
) ON [PRIMARY]
GO
/****** Object:  Table [dbo].[IZIN_TIPI_MAIL_ADRES]    Script Date: 20.12.2023 17:26:31 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[IZIN_TIPI_MAIL_ADRES](
	[ID] [numeric](19, 0) IDENTITY(1,1) NOT NULL,
	[IZIN_TIPI_ID] [numeric](19, 0) NOT NULL,
	[MAIL_TIPI] [varchar](2) NULL,
	[VERSION] [int] NULL,
	[MAIL_ADRES] [varchar](128) NULL,
PRIMARY KEY CLUSTERED 
(
	[ID] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY],
UNIQUE NONCLUSTERED 
(
	[IZIN_TIPI_ID] ASC,
	[MAIL_ADRES] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
) ON [PRIMARY]
GO
/****** Object:  Table [dbo].[IZINHAKEDISHAKKI]    Script Date: 20.12.2023 17:26:31 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[IZINHAKEDISHAKKI](
	[ID] [numeric](19, 0) IDENTITY(1,1) NOT NULL,
	[DURUM] [tinyint] NULL,
	[GUNCELLEMETARIHI] [datetime] NULL,
	[OLUSTURMATARIHI] [datetime] NULL,
	[IZIN_SURESI] [int] NOT NULL,
	[KIDEMYILI] [int] NOT NULL,
	[VERSION] [int] NULL,
	[YAS_TIPI] [int] NOT NULL,
	[GUNCELLEYENUSER_ID] [numeric](19, 0) NULL,
	[OLUSTURANUSER_ID] [numeric](19, 0) NULL,
	[DEPARTMAN] [numeric](19, 0) NOT NULL,
	[SUA_DURUM] [tinyint] NULL,
PRIMARY KEY CLUSTERED 
(
	[ID] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
) ON [PRIMARY]
GO
/****** Object:  Table [dbo].[IZINISTIRAHAT]    Script Date: 20.12.2023 17:26:31 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[IZINISTIRAHAT](
	[ID] [numeric](19, 0) IDENTITY(1,1) NOT NULL,
	[DURUM] [tinyint] NULL,
	[GUNCELLEMETARIHI] [datetime] NULL,
	[OLUSTURMATARIHI] [datetime] NULL,
	[ACIKLAMA] [varchar](255) NULL,
	[RAPOR_KAYNAGI] [varchar](1) NOT NULL,
	[TESHIS] [varchar](255) NULL,
	[VERSION] [int] NULL,
	[GUNCELLEYENUSER_ID] [numeric](19, 0) NULL,
	[OLUSTURANUSER_ID] [numeric](19, 0) NULL,
	[PERSONEL_IZIN_ID] [numeric](19, 0) NOT NULL,
PRIMARY KEY CLUSTERED 
(
	[ID] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY],
UNIQUE NONCLUSTERED 
(
	[PERSONEL_IZIN_ID] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
) ON [PRIMARY]
GO
/****** Object:  Table [dbo].[IZINTIPI]    Script Date: 20.12.2023 17:26:31 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[IZINTIPI](
	[ID] [numeric](19, 0) IDENTITY(1,1) NOT NULL,
	[DURUM] [tinyint] NULL,
	[GUNCELLEMETARIHI] [datetime] NULL,
	[OLUSTURMATARIHI] [datetime] NULL,
	[BAKIYE_DEVIR_TIPI] [varchar](1) NULL,
	[DOKUM_ALMA_DURUM] [tinyint] NULL,
	[GUN_GOSTERILECEK] [tinyint] NULL,
	[IZIN_KAGIDI_GELDI] [tinyint] NULL,
	[MAX_GUN] [float] NULL,
	[MAX_SAAT] [float] NULL,
	[MESAJ] [varchar](256) NOT NULL,
	[MIN_GUN] [float] NULL,
	[MIN_SAAT] [float] NULL,
	[ONAYLAYAN_TIPI] [varchar](1) NULL,
	[GIRIS_TIPI] [varchar](1) NULL,
	[SAAT_GOSTERILECEK] [tinyint] NULL,
	[ERP_AKTARIM] [tinyint] NULL,
	[TAKVIM_GUNUMU] [tinyint] NULL,
	[VERSION] [int] NULL,
	[GUNCELLEYENUSER_ID] [numeric](19, 0) NULL,
	[OLUSTURANUSER_ID] [numeric](19, 0) NULL,
	[BAKIYE_IZIN_TIPI_ID] [numeric](19, 0) NULL,
	[DEPARTMAN_ID] [numeric](19, 0) NOT NULL,
	[IZIN_TIPI_ID] [numeric](19, 0) NOT NULL,
	[DENKLESTIRME_DAHIL] [tinyint] NULL,
	[LISTE_SIRA] [int] NULL,
	[KOTA_BAKIYE] [float] NULL,
	[OFF_DAHIL] [tinyint] NULL,
	[HESAP_TIPI] [int] NULL,
	[DOSYA_EKLE] [tinyint] NULL,
	[KISA_ACIKLAMA] [varchar](8) NULL,
	[ARTIK_IZIN_GUN] [float] NULL,
	[MAIL_GONDERIM_DURUMU] [tinyint] NULL,
	[CGS_DURUMU] [tinyint] NULL,
	[GUN_SIGORTA_DAHIL] [tinyint] NULL,
	[HT_DAHIL] [tinyint] NULL,
	[IZIN_TIPI_ERP_KODU]  AS ([dbo].[FN_TANIM_ERP_KODU]([IZIN_TIPI_ID])),
	[IZIN_TIPI_TANIM_ACIKLAMA]  AS ([dbo].[FN_TANIM_ACIKLAMA]([IZIN_TIPI_ID],NULL)),
	[UCRETLI] [tinyint] NOT NULL,
	[CUMA_CUMARTESI_TEK_IZIN_SAY] [tinyint] NULL,
 CONSTRAINT [PK__IZINTIPI__56E9B302] PRIMARY KEY CLUSTERED 
(
	[ID] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
) ON [PRIMARY]
GO
/****** Object:  Table [dbo].[IZINTIPI_OLD]    Script Date: 20.12.2023 17:26:31 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[IZINTIPI_OLD](
	[ID] [numeric](19, 0) NOT NULL,
	[DURUM] [tinyint] NULL,
	[GUNCELLEMETARIHI] [datetime] NULL,
	[OLUSTURMATARIHI] [datetime] NULL,
	[BAKIYE_DEVIR_TIPI] [varchar](1) NULL,
	[DOKUM_ALMA_DURUM] [tinyint] NULL,
	[GUN_GOSTERILECEK] [tinyint] NULL,
	[IZIN_KAGIDI_GELDI] [tinyint] NULL,
	[MAX_GUN] [float] NULL,
	[MAX_SAAT] [float] NULL,
	[MESAJ] [varchar](256) NOT NULL,
	[MIN_GUN] [float] NULL,
	[MIN_SAAT] [float] NULL,
	[ONAYLAYAN_TIPI] [varchar](1) NULL,
	[GIRIS_TIPI] [varchar](1) NULL,
	[SAAT_GOSTERILECEK] [tinyint] NULL,
	[ERP_AKTARIM] [tinyint] NULL,
	[TAKVIM_GUNUMU] [tinyint] NULL,
	[VERSION] [int] NULL,
	[GUNCELLEYENUSER_ID] [numeric](19, 0) NULL,
	[OLUSTURANUSER_ID] [numeric](19, 0) NULL,
	[BAKIYE_IZIN_TIPI_ID] [numeric](19, 0) NULL,
	[DEPARTMAN_ID] [numeric](19, 0) NOT NULL,
	[IZIN_TIPI_ID] [numeric](19, 0) NOT NULL,
	[DENKLESTIRME_DAHIL] [tinyint] NULL,
	[LISTE_SIRA] [int] NULL,
	[KOTA_BAKIYE] [float] NULL,
	[OFF_DAHIL] [tinyint] NULL,
	[HESAP_TIPI] [int] NULL,
	[DOSYA_EKLE] [tinyint] NULL,
	[KISA_ACIKLAMA] [varchar](8) NULL,
	[ARTIK_IZIN_GUN] [float] NULL,
	[MAIL_GONDERIM_DURUMU] [tinyint] NULL,
 CONSTRAINT [PK__IZINTIPI__1] PRIMARY KEY CLUSTERED 
(
	[ID] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
) ON [PRIMARY]
GO
/****** Object:  Table [dbo].[IZINTIPIBIRLESIKHARIC]    Script Date: 20.12.2023 17:26:31 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[IZINTIPIBIRLESIKHARIC](
	[ID] [numeric](19, 0) IDENTITY(1,1) NOT NULL,
	[DURUM] [tinyint] NULL,
	[GUNCELLEMETARIHI] [datetime] NULL,
	[OLUSTURMATARIHI] [datetime] NULL,
	[IZIN_ARALIK_SAAT] [float] NULL,
	[VERSION] [int] NULL,
	[GUNCELLEYENUSER_ID] [numeric](19, 0) NULL,
	[OLUSTURANUSER_ID] [numeric](19, 0) NULL,
	[BIRLESIK_IZIN_TIPI_ID] [numeric](19, 0) NOT NULL,
	[IZIN_TIPI_ID] [numeric](19, 0) NOT NULL,
PRIMARY KEY CLUSTERED 
(
	[ID] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
) ON [PRIMARY]
GO
/****** Object:  Table [dbo].[KAPI]    Script Date: 20.12.2023 17:26:31 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[KAPI](
	[ID] [numeric](19, 0) IDENTITY(1,1) NOT NULL,
	[ACIKLAMA] [varchar](255) NULL,
	[DURUM] [tinyint] NULL,
	[PDKS] [tinyint] NULL,
	[VERSION] [int] NULL,
	[KGS_ID] [numeric](19, 0) NULL,
	[KAPI_TIPI_ID] [numeric](19, 0) NULL,
	[GUNCELLEMETARIHI] [datetime] NULL,
	[OLUSTURMATARIHI] [datetime] NULL,
	[GUNCELLEYENUSER_ID] [numeric](19, 0) NULL,
	[OLUSTURANUSER_ID] [numeric](19, 0) NULL,
PRIMARY KEY CLUSTERED 
(
	[ID] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
) ON [PRIMARY]
GO
/****** Object:  Table [dbo].[KAPI_SIRKET]    Script Date: 20.12.2023 17:26:31 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[KAPI_SIRKET](
	[ID] [numeric](19, 0) NOT NULL,
	[ACIKLAMA] [varchar](255) NULL,
	[BASLANGIC_TARIHI] [date] NULL,
	[BITIS_TARIHI] [date] NULL,
	[DURUM] [tinyint] NULL,
 CONSTRAINT [PK_KAPI_SIRKET] PRIMARY KEY CLUSTERED 
(
	[ID] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
) ON [PRIMARY]
GO
/****** Object:  Table [dbo].[KAPI_SIRKET_KGS]    Script Date: 20.12.2023 17:26:31 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[KAPI_SIRKET_KGS](
	[ID] [numeric](19, 0) IDENTITY(1,1) NOT NULL,
	[KGS_ID] [numeric](19, 0) NOT NULL,
	[KGS_SIRKET_ID] [numeric](19, 0) NOT NULL,
	[ACIKLAMA] [varchar](255) NULL,
	[KART_YONU] [tinyint] NULL,
	[DURUM] [tinyint] NULL,
	[ISLEM_ZAMAN] [datetime] NULL,
	[TERMINAL_NO] [int] NULL,
	[MANUEL] [tinyint] NULL,
	[KAPI_ID]  AS ([dbo].[FN_GET_KGS_KAPI_ID]([ID])),
	[KAPI_DEGISTIR] [tinyint] NULL,
 CONSTRAINT [PK_KAPI_SIRKET_KGS] PRIMARY KEY CLUSTERED 
(
	[ID] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
) ON [PRIMARY]
GO
/****** Object:  Table [dbo].[KAT_SAYI]    Script Date: 20.12.2023 17:26:31 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[KAT_SAYI](
	[ID] [numeric](19, 0) IDENTITY(1,1) NOT NULL,
	[TIPI] [int] NOT NULL,
	[BAS_TARIH] [datetime] NOT NULL,
	[BIT_TARIH] [datetime] NOT NULL,
	[DEGER] [float] NOT NULL,
	[DURUM] [tinyint] NULL,
PRIMARY KEY CLUSTERED 
(
	[ID] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
) ON [PRIMARY]
GO
/****** Object:  Table [dbo].[KGS_ISLEM]    Script Date: 20.12.2023 17:26:31 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[KGS_ISLEM](
	[ID] [bigint] IDENTITY(1,1) NOT NULL,
	[SP_ADI] [nchar](80) NOT NULL,
	[TABLE_ID] [bigint] NULL,
	[VALID] [int] NOT NULL,
	[OLUSTURMA_ZAMANI] [datetime] NULL,
PRIMARY KEY CLUSTERED 
(
	[ID] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
) ON [PRIMARY]
GO
/****** Object:  Table [dbo].[LDAP_DOMAIN]    Script Date: 20.12.2023 17:26:31 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[LDAP_DOMAIN](
	[ID] [int] IDENTITY(1,1) NOT NULL,
	[HOST] [varchar](64) NULL,
	[DC] [varchar](128) NULL,
	[PORT] [varchar](8) NULL,
	[ADMIN_USER_NAME] [varchar](128) NULL,
	[ADMIN_PASSWORD] [varchar](32) NULL,
	[SIRA] [int] NULL,
	[DURUM] [tinyint] NULL,
PRIMARY KEY CLUSTERED 
(
	[ID] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY],
UNIQUE NONCLUSTERED 
(
	[HOST] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
) ON [PRIMARY]
GO
/****** Object:  Table [dbo].[MAIL_GRUBU]    Script Date: 20.12.2023 17:26:31 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[MAIL_GRUBU](
	[ID] [numeric](19, 0) IDENTITY(1,1) NOT NULL,
	[TIPI] [varchar](5) NULL,
	[EMAIL ] [varchar](1024) NOT NULL,
PRIMARY KEY CLUSTERED 
(
	[ID] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
) ON [PRIMARY]
GO
/****** Object:  Table [dbo].[MAILUSER]    Script Date: 20.12.2023 17:26:31 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[MAILUSER](
	[ID] [numeric](19, 0) NOT NULL,
	[EMAIL] [varchar](255) NULL,
	[FIRSTNAME] [varchar](255) NULL,
	[LASTNAME] [varchar](255) NULL,
	[STAFFID] [varchar](255) NULL,
	[USERNAME] [varchar](255) NULL,
	[VERSION] [int] NULL,
PRIMARY KEY CLUSTERED 
(
	[ID] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
) ON [PRIMARY]
GO
/****** Object:  Table [dbo].[MENUITEM]    Script Date: 20.12.2023 17:26:31 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[MENUITEM](
	[ID] [numeric](19, 0) IDENTITY(1,1) NOT NULL,
	[NAME] [varchar](255) NULL,
	[ORDERNO] [int] NOT NULL,
	[STATUS] [tinyint] NULL,
	[TOPMENU] [tinyint] NULL,
	[VERSION] [int] NULL,
	[DESCRIPTION_ID] [numeric](19, 0) NULL,
PRIMARY KEY CLUSTERED 
(
	[ID] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
) ON [PRIMARY]
GO
/****** Object:  Table [dbo].[MENUITEM_MENUITEM]    Script Date: 20.12.2023 17:26:31 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[MENUITEM_MENUITEM](
	[ID] [numeric](19, 0) IDENTITY(1,1) NOT NULL,
	[MENUITEM_ID] [numeric](19, 0) NOT NULL,
	[CHILDMENUITEMLIST_ID] [numeric](19, 0) NOT NULL
) ON [PRIMARY]
GO
/****** Object:  Table [dbo].[NOTICE]    Script Date: 20.12.2023 17:26:31 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[NOTICE](
	[ID] [numeric](19, 0) IDENTITY(1,1) NOT NULL,
	[ACTIVE] [tinyint] NULL,
	[CHANGEDATE] [datetime] NULL,
	[DESCRIPTION] [text] NULL,
	[NAME] [varchar](20) NULL,
	[VALUE] [nvarchar](max) NULL,
	[VERSION] [int] NULL,
	[CHANGEUSER_ID] [numeric](19, 0) NULL,
PRIMARY KEY CLUSTERED 
(
	[ID] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
) ON [PRIMARY] TEXTIMAGE_ON [PRIMARY]
GO
/****** Object:  Table [dbo].[PARAMETRE]    Script Date: 20.12.2023 17:26:31 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[PARAMETRE](
	[ID] [numeric](19, 0) IDENTITY(1,1) NOT NULL,
	[DURUM] [tinyint] NULL,
	[CHANGEDATE] [datetime] NULL,
	[ACIKLAMA] [varchar](255) NULL,
	[GUNCELLE] [tinyint] NULL,
	[ADI] [varchar](128) NULL,
	[DEGER] [varchar](1024) NULL,
	[VERSION] [int] NULL,
	[CHANGEUSER_ID] [numeric](19, 0) NULL,
	[HDSK] [tinyint] NULL,
 CONSTRAINT [PK__Parameter__5ABA43E6] PRIMARY KEY CLUSTERED 
(
	[ID] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
) ON [PRIMARY]
GO
/****** Object:  Table [dbo].[PDKS_HAREKET]    Script Date: 20.12.2023 17:26:31 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[PDKS_HAREKET](
	[ID] [numeric](19, 0) IDENTITY(1,1) NOT NULL,
	[KGS_ID] [numeric](19, 0) NULL,
	[ZAMAN] [datetime] NOT NULL,
	[ISLEM_ID] [numeric](19, 0) NOT NULL,
	[KAPI] [numeric](19, 0) NOT NULL,
	[PERSONEL] [numeric](19, 0) NOT NULL,
	[DURUM] [int] NULL,
	[PER_NO]  AS ([dbo].[FN_KGS_PERSONEL_NO]([PERSONEL])),
PRIMARY KEY CLUSTERED 
(
	[ID] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
) ON [PRIMARY]
GO
/****** Object:  Table [dbo].[PDKS_ISLEM]    Script Date: 20.12.2023 17:26:31 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[PDKS_ISLEM](
	[ID] [bigint] IDENTITY(1,1) NOT NULL,
	[ZAMAN] [datetime] NULL,
	[ACIKLAMA] [nvarchar](80) NOT NULL,
	[ONAY_DURUM] [smallint] NULL,
	[ISLEM_TIPI] [nchar](1) NOT NULL,
	[OLUSTURMA_ZAMANI] [datetime] NULL,
	[GUNCELLEYEN_PERSONEL_ID] [numeric](19, 0) NULL,
	[NEDEN_ID] [numeric](19, 0) NULL,
	[ONAYLAYAN_ID] [numeric](19, 0) NULL,
PRIMARY KEY CLUSTERED 
(
	[ID] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
) ON [PRIMARY]
GO
/****** Object:  Table [dbo].[PDKS_LOG]    Script Date: 20.12.2023 17:26:31 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[PDKS_LOG](
	[ID] [numeric](19, 0) IDENTITY(1,1) NOT NULL,
	[HAREKET_ZAMANI] [smalldatetime] NULL,
	[USERID] [numeric](19, 0) NOT NULL,
	[KAPIID] [numeric](19, 0) NOT NULL,
	[KGS_ID] [bigint] NULL,
	[OLUSTURMA_ZAMANI] [datetime] NULL,
	[DURUM] [int] NULL,
	[ISLEM_ID] [bigint] NULL,
	[GUNCELLEME_ZAMANI] [datetime] NULL,
	[KGS_SIRKET_ID] [int] NOT NULL,
	[PER_NO]  AS ([dbo].[FN_KGS_SIRKET_PERSONEL_NO]([USERID],[KGS_SIRKET_ID])),
 CONSTRAINT [ABH_LOG_PK] PRIMARY KEY CLUSTERED 
(
	[ID] DESC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
) ON [PRIMARY]
GO
/****** Object:  Table [dbo].[PDKS_SP_ISLEM]    Script Date: 20.12.2023 17:26:31 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[PDKS_SP_ISLEM](
	[ID] [bigint] IDENTITY(1,1) NOT NULL,
	[SP_ADI] [nchar](80) NOT NULL,
	[KGS_SIRKET_ID] [numeric](19, 0) NOT NULL,
	[TABLE_ID] [bigint] NULL,
	[VALID] [int] NOT NULL,
	[OLUSTURMA_ZAMANI] [datetime] NULL,
PRIMARY KEY CLUSTERED 
(
	[ID] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
) ON [PRIMARY]
GO
/****** Object:  Table [dbo].[PDKSUSER]    Script Date: 20.12.2023 17:26:31 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[PDKSUSER](
	[ID] [numeric](19, 0) IDENTITY(1,1) NOT NULL,
	[EMAIL] [varchar](255) NULL,
	[SIFRE] [varchar](255) NULL,
	[KULLANICI_ADI] [varchar](255) NULL,
	[PERSONEL_ID] [numeric](19, 0) NULL,
	[DEPARTMAN_ID] [numeric](19, 0) NULL,
	[DURUM] [tinyint] NULL,
	[VARDIYA_DUZELT_YEKI] [tinyint] NULL,
	[SHORT_USER_NAME] [varchar](12) NULL,
	[LAST_LOGIN] [datetime] NULL,
	[PER_NO]  AS ([dbo].[FN_PERSONEL_NO]([PERSONEL_ID])),
 CONSTRAINT [PK__AbhUser__42E2BA55] PRIMARY KEY CLUSTERED 
(
	[ID] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
) ON [PRIMARY]
GO
/****** Object:  Table [dbo].[PERS_DENK_BORDRO]    Script Date: 20.12.2023 17:26:31 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[PERS_DENK_BORDRO](
	[ID] [numeric](19, 0) IDENTITY(1,1) NOT NULL,
	[PERS_DENK_ID] [numeric](19, 0) NOT NULL,
	[NORMAL_GUN_ADET] [float] NULL,
	[HAFTA_TATIL_ADET] [float] NULL,
	[TATIL_ADET] [float] NULL,
	[RESMI_TATIL_ADET] [float] NULL,
PRIMARY KEY CLUSTERED 
(
	[ID] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY],
UNIQUE NONCLUSTERED 
(
	[PERS_DENK_ID] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
) ON [PRIMARY]
GO
/****** Object:  Table [dbo].[PERS_DENK_BORDRO_DETAY]    Script Date: 20.12.2023 17:26:31 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[PERS_DENK_BORDRO_DETAY](
	[ID] [numeric](19, 0) IDENTITY(1,1) NOT NULL,
	[PERS_DENK_BORDRO_ID] [numeric](19, 0) NOT NULL,
	[TIPI] [varchar](255) NOT NULL,
	[MIKTAR] [float] NULL,
PRIMARY KEY CLUSTERED 
(
	[ID] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY],
UNIQUE NONCLUSTERED 
(
	[PERS_DENK_BORDRO_ID] ASC,
	[TIPI] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
) ON [PRIMARY]
GO
/****** Object:  Table [dbo].[PERS_DENK_DINAMIK_ALAN]    Script Date: 20.12.2023 17:26:31 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[PERS_DENK_DINAMIK_ALAN](
	[ID] [numeric](19, 0) IDENTITY(1,1) NOT NULL,
	[PERS_DENK_ID] [numeric](19, 0) NOT NULL,
	[ALAN_ID] [numeric](19, 0) NOT NULL,
	[VERSION] [int] NULL,
	[ALAN_DURUM] [tinyint] NULL,
	[ISLEM_DURUM] [tinyint] NULL,
PRIMARY KEY CLUSTERED 
(
	[ID] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY],
UNIQUE NONCLUSTERED 
(
	[PERS_DENK_ID] ASC,
	[ALAN_DURUM] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
) ON [PRIMARY]
GO
/****** Object:  Table [dbo].[PERSONEL]    Script Date: 20.12.2023 17:26:31 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[PERSONEL](
	[ID] [numeric](19, 0) IDENTITY(1,1) NOT NULL,
	[AD] [varchar](255) NULL,
	[DURUM] [tinyint] NULL,
	[MAIL_TAKIP] [tinyint] NOT NULL,
	[PDKS] [tinyint] NULL,
	[SOYAD] [varchar](255) NULL,
	[SIRKET_ID] [numeric](19, 0) NULL,
	[KGS_PERSONEL_ID] [numeric](19, 0) NULL,
	[YONETICI_ID] [numeric](19, 0) NULL,
	[GUNCELLEMETARIHI] [datetime] NULL,
	[OLUSTURMATARIHI] [datetime] NULL,
	[GUNCELLEYENUSER_ID] [numeric](19, 0) NULL,
	[OLUSTURANUSER_ID] [numeric](19, 0) NULL,
	[SABLON_ID] [numeric](19, 0) NULL,
	[GOREV_TIPI_ID] [numeric](19, 0) NULL,
	[TESIS_ID] [numeric](19, 0) NULL,
	[VERSION] [int] NULL,
	[IZIN_HAKEDIS_TARIHI] [datetime] NULL,
	[ICAP_OLABILIR] [tinyint] NULL,
	[ISE_BASLAMA_TARIHI] [datetime] NULL,
	[DOGUM_TARIHI] [datetime] NULL,
	[ISTEN_AYRILIS_TARIHI] [datetime] NULL,
	[UST_YONETICIMI] [tinyint] NULL,
	[SUA_OLABILIR] [tinyint] NULL,
	[ONAYSIZ_IZIN_KULLANIR] [tinyint] NULL,
	[ASIL_YONETICI1_ID] [numeric](19, 0) NULL,
	[ASIL_YONETICI2_ID] [numeric](19, 0) NULL,
	[EK_SAHA1_ID] [numeric](19, 0) NULL,
	[EK_SAHA2_ID] [numeric](19, 0) NULL,
	[EK_SAHA3_ID] [numeric](19, 0) NULL,
	[EK_SAHA4_ID] [numeric](19, 0) NULL,
	[PDKS_SICIL_NO] [varchar](15) NULL,
	[PART_TIME] [tinyint] NULL,
	[MASRAF_YERI_ID] [numeric](19, 0) NULL,
	[IKINCI_YONETICI_IZIN_ONAYLA] [tinyint] NULL,
	[YONETICI_VARDIYA_TIPI_ID] [numeric](19, 0) NULL,
	[GRUBA_GIRIS_TARIHI] [datetime] NULL,
	[VARDIYA_GIRIS_TIPI_ID] [numeric](19, 0) NULL,
	[BORDRO_ALT_BIRIMI] [numeric](19, 0) NULL,
	[FAZLA_MESAI_ODE] [tinyint] NULL,
	[SUT_IZNI] [tinyint] NULL,
	[GEBE_MI] [tinyint] NULL,
	[EGITIM_DONEMI] [tinyint] NULL,
	[CINSIYET_ID] [numeric](19, 0) NULL,
	[SANAL_PERSONEL] [tinyint] NULL,
	[CALISMA_MODELI_ID] [numeric](19, 0) NULL,
	[MAIL_HAREKET_ID] [numeric](19, 0) NULL,
	[MAIL_BCC_ID] [numeric](19, 0) NULL,
	[MAIL_CC_ID] [numeric](19, 0) NULL,
	[FAZLA_MESAI_IZIN_KULLAN] [tinyint] NULL,
	[AD_SOYAD]  AS ([dbo].[FN_MERGE_DOUBLE_CHAR]([AD],[SOYAD])),
	[SSK_CIKIS_TARIHI]  AS ([dbo].[FN_GET_SSK_CIKIS_TARIHI]([ISTEN_AYRILIS_TARIHI],[SIRKET_ID])),
	[ISKUR_SABLON_ID] [numeric](19, 0) NULL,
	[BOLUM_ADI]  AS ([dbo].[FN_TANIM_ACIKLAMA]([EK_SAHA3_ID],NULL)),
	[TESIS_ADI]  AS ([dbo].[FN_TANIM_ACIKLAMA]([TESIS_ID],NULL)),
	[TC_KIMLIK_NO]  AS ([dbo].[FN_KGS_TC_KIMLIK_NO]([KGS_PERSONEL_ID])),
 CONSTRAINT [PK__PERSONEL__4A83DC1D] PRIMARY KEY CLUSTERED 
(
	[ID] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
) ON [PRIMARY]
GO
/****** Object:  Table [dbo].[PERSONEL_DINAMIK_ALAN]    Script Date: 20.12.2023 17:26:31 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[PERSONEL_DINAMIK_ALAN](
	[ID] [numeric](19, 0) IDENTITY(1,1) NOT NULL,
	[PERSONEL_ID] [numeric](19, 0) NOT NULL,
	[ALAN_ID] [numeric](19, 0) NOT NULL,
	[VERSION] [int] NULL,
	[TANIM_DEGER_ID] [numeric](19, 0) NULL,
	[SAYISAL_DEGER] [float] NULL,
	[DURUM_SECIM] [tinyint] NULL,
PRIMARY KEY CLUSTERED 
(
	[ID] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY],
UNIQUE NONCLUSTERED 
(
	[PERSONEL_ID] ASC,
	[ALAN_ID] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
) ON [PRIMARY]
GO
/****** Object:  Table [dbo].[PERSONEL_ERP]    Script Date: 20.12.2023 17:26:31 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[PERSONEL_ERP](
	[PERSONEL_NO] [varchar](32) NOT NULL,
	[AD] [varchar](255) NULL,
	[SOYAD] [varchar](255) NULL,
	[DURUM] [tinyint] NULL,
	[ISLEM_ZAMANI] [datetime] NULL,
 CONSTRAINT [PK_PERSONEL_ERP] PRIMARY KEY CLUSTERED 
(
	[PERSONEL_NO] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
) ON [PRIMARY]
GO
/****** Object:  Table [dbo].[PERSONEL_EXTRA]    Script Date: 20.12.2023 17:26:31 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[PERSONEL_EXTRA](
	[ID] [numeric](19, 0) IDENTITY(1,1) NOT NULL,
	[CEP_TELEFON] [varchar](15) NULL,
	[ILCE] [varchar](50) NULL,
	[OZEL_NOT] [varchar](100) NULL,
	[VERSION] [int] NULL,
	[PERSONEL_ID] [numeric](19, 0) NOT NULL,
PRIMARY KEY CLUSTERED 
(
	[ID] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY],
UNIQUE NONCLUSTERED 
(
	[PERSONEL_ID] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
) ON [PRIMARY]
GO
/****** Object:  Table [dbo].[PERSONEL_GECICI_YONETICI]    Script Date: 20.12.2023 17:26:31 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[PERSONEL_GECICI_YONETICI](
	[ID] [numeric](19, 0) IDENTITY(1,1) NOT NULL,
	[DURUM] [tinyint] NULL,
	[GUNCELLEMETARIHI] [datetime] NULL,
	[OLUSTURMATARIHI] [datetime] NULL,
	[BASLANGIC_TARIHI] [datetime] NOT NULL,
	[BITIS_TARIHI] [datetime] NOT NULL,
	[VERSION] [int] NULL,
	[CALENDARPOPUP] [tinyint] NOT NULL,
	[GUNCELLEYENUSER_ID] [numeric](19, 0) NULL,
	[OLUSTURANUSER_ID] [numeric](19, 0) NULL,
	[YENI_YONETICI] [numeric](19, 0) NOT NULL,
	[VEKALET_VEREN] [numeric](19, 0) NOT NULL,
	[PERSONEL_GECICI] [numeric](19, 0) NOT NULL,
PRIMARY KEY CLUSTERED 
(
	[ID] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
) ON [PRIMARY]
GO
/****** Object:  Table [dbo].[PERSONEL_IZIN_DOSYA]    Script Date: 20.12.2023 17:26:31 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[PERSONEL_IZIN_DOSYA](
	[ID] [numeric](19, 0) IDENTITY(1,1) NOT NULL,
	[DOSYA_ID] [numeric](19, 0) NULL,
	[PERSONEL_IZIN_ID] [numeric](19, 0) NOT NULL,
PRIMARY KEY CLUSTERED 
(
	[ID] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY],
UNIQUE NONCLUSTERED 
(
	[PERSONEL_IZIN_ID] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
) ON [PRIMARY]
GO
/****** Object:  Table [dbo].[PERSONEL_SIRKET_KGS]    Script Date: 20.12.2023 17:26:31 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[PERSONEL_SIRKET_KGS](
	[ID] [numeric](19, 0) IDENTITY(1,1) NOT NULL,
	[KGS_ID] [numeric](19, 0) NOT NULL,
	[KGS_SIRKET_ID] [numeric](19, 0) NOT NULL,
	[AD] [varchar](255) NULL,
	[SOYAD] [varchar](255) NULL,
	[PERSONEL_NO] [varchar](32) NULL,
	[KART_NO] [varchar](64) NULL,
	[DURUM] [tinyint] NULL,
	[ISLEM_ZAMAN] [datetime] NULL,
	[TC_KIMLIK_NO] [varchar](20) NULL,
	[KULLANICI_ID]  AS ([dbo].[FN_GET_KGS_KULLANICI_ID]([ID])),
	[PERSONEL_ID]  AS ([dbo].[FN_GET_KGS_PERSONEL_ID]([ID])),
	[AD_SOYAD]  AS ([dbo].[FN_MERGE_DOUBLE_CHAR]([AD],[SOYAD])),
	[ISE_BASLAMA_TARIHI] [date] NULL,
	[DOGUM_TARIHI] [date] NULL,
 CONSTRAINT [PK_PERSONEL_SIRKET_KGS] PRIMARY KEY CLUSTERED 
(
	[ID] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
) ON [PRIMARY]
GO
/****** Object:  Table [dbo].[PERSONELDENKLESTIRME]    Script Date: 20.12.2023 17:26:31 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[PERSONELDENKLESTIRME](
	[ID] [numeric](19, 0) IDENTITY(1,1) NOT NULL,
	[DURUM] [tinyint] NULL,
	[GUNCELLEMETARIHI] [datetime] NULL,
	[OLUSTURMATARIHI] [datetime] NULL,
	[ERP_AKTARILDI] [tinyint] NULL,
	[SURE] [float] NULL,
	[VERSION] [int] NULL,
	[GUNCELLEYENUSER_ID] [numeric](19, 0) NULL,
	[OLUSTURANUSER_ID] [numeric](19, 0) NULL,
	[DONEM_ID] [numeric](19, 0) NOT NULL,
	[PERSONEL_ID] [numeric](19, 0) NOT NULL,
	[FAZLA_MESAI_SURE] [float] NULL,
	[HAFTA_TATIL_SURE] [float] NULL,
	[RESMI_TATIL_SURE] [float] NULL,
	[ODENEN_SURE] [float] NULL,
	[GECEN_AY_DENKLESTIRME_ID] [numeric](19, 0) NULL,
	[DENKLESTIRME_DURUM] [tinyint] NULL,
	[ONAYLANDI] [tinyint] NULL,
	[PLANLANAN_SURE] [float] NULL,
	[SUA_DURUM] [tinyint] NULL,
	[DEVREDEN_SURE] [float] NULL,
	[AKSAM_VARDIYA_ADET] [numeric](19, 0) NULL,
	[FAZLA_MESAI_ODE] [tinyint] NULL,
	[AKSAM_VARDIYA_SAAT] [numeric](19, 2) NULL,
	[SUT_IZNI_DURUM] [tinyint] NULL,
	[SUT_IZNI_SAAT] [float] NULL,
	[EGITIM_SURESI_AKSAM_GUN] [int] NULL,
	[PART_TIME] [tinyint] NULL,
	[CALISMA_MODELI_AY_ID] [numeric](19, 0) NULL,
	[FAZLA_MESAI_IZIN_KULLAN] [tinyint] NULL,
	[GECEN_AY_DEVREDEN_SURE]  AS ([dbo].[FN_GECEN_AY_DEVREDEN_SURE]([GECEN_AY_DENKLESTIRME_ID])),
	[GECEN_AY_DURUM]  AS ([dbo].[FN_GECEN_AY_DURUM]([GECEN_AY_DENKLESTIRME_ID])),
	[DONEM_KODU]  AS ([dbo].[FN_DONEM_KODU]([DONEM_ID])),
	[PERSONEL_NO]  AS ([dbo].[FN_PERSONEL_NO]([PERSONEL_ID])),
	[KESILEN_SURE] [float] NULL,
	[KISMI_ODEME_SAAT] [numeric](19, 2) NULL,
	[EKSIK_CALISMA_SURE] [float] NOT NULL,
PRIMARY KEY CLUSTERED 
(
	[ID] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY],
UNIQUE NONCLUSTERED 
(
	[DONEM_ID] ASC,
	[PERSONEL_ID] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
) ON [PRIMARY]
GO
/****** Object:  Table [dbo].[PERSONELFAZLAMESAI]    Script Date: 20.12.2023 17:26:31 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[PERSONELFAZLAMESAI](
	[ID] [numeric](19, 0) IDENTITY(1,1) NOT NULL,
	[DURUM] [tinyint] NULL,
	[GUNCELLEMETARIHI] [datetime] NULL,
	[OLUSTURMATARIHI] [datetime] NULL,
	[BAS_ZAMAN] [datetime] NULL,
	[BIT_ZAMAN] [datetime] NULL,
	[FAZLA_MESAI_SAATI] [float] NULL,
	[ONAY_DURUM] [int] NULL,
	[TATIL_DURUM] [int] NULL,
	[GUNCELLEYENUSER_ID] [numeric](19, 0) NULL,
	[OLUSTURANUSER_ID] [numeric](19, 0) NULL,
	[VARDIYA_GUN] [numeric](19, 0) NOT NULL,
	[ONAY_ID] [numeric](19, 0) NULL,
	[HAREKET_ID] [varchar](255) NOT NULL,
	[FAZLA_MESAI_TALEP_ID] [numeric](19, 0) NULL,
PRIMARY KEY CLUSTERED 
(
	[ID] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
) ON [PRIMARY]
GO
/****** Object:  Table [dbo].[PERSONELIZIN]    Script Date: 20.12.2023 17:26:31 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[PERSONELIZIN](
	[ID] [numeric](19, 0) IDENTITY(1,1) NOT NULL,
	[DURUM] [tinyint] NULL,
	[GUNCELLEMETARIHI] [datetime] NULL,
	[OLUSTURMATARIHI] [datetime] NULL,
	[ACIKLAMA] [varchar](256) NULL,
	[BASLANGIC_ZAMANI] [datetime] NOT NULL,
	[BITIS_ZAMANI] [datetime] NOT NULL,
	[IZIN_DURUMU] [int] NULL,
	[IZIN_KAGIDI_GELDI] [tinyint] NULL,
	[IZIN_SURESI] [float] NOT NULL,
	[VERSION] [int] NULL,
	[GUNCELLEYENUSER_ID] [numeric](19, 0) NULL,
	[OLUSTURANUSER_ID] [numeric](19, 0) NULL,
	[PERSONEL_ID] [numeric](19, 0) NOT NULL,
	[IZIN_TIPI_ID] [numeric](19, 0) NOT NULL,
	[KULLANILAN_IZIN_SURESI] [float] NULL,
	[GOREV_TIPI_ID] [numeric](19, 0) NULL,
	[HESAP_TIPI] [int] NULL,
	[PERSONEL_NO]  AS ([dbo].[FN_PERSONEL_NO]([PERSONEL_ID])),
 CONSTRAINT [PK__PERSONELIZIN__1F2E9E6D] PRIMARY KEY CLUSTERED 
(
	[ID] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
) ON [PRIMARY]
GO
/****** Object:  Table [dbo].[PERSONELIZINDETAY]    Script Date: 20.12.2023 17:26:31 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[PERSONELIZINDETAY](
	[ID] [numeric](19, 0) IDENTITY(1,1) NOT NULL,
	[IZIN_MIKTARI] [float] NULL,
	[HAKEDIS_IZIN_ID] [numeric](19, 0) NOT NULL,
	[IZIN_ID] [numeric](19, 0) NOT NULL,
PRIMARY KEY CLUSTERED 
(
	[ID] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY],
UNIQUE NONCLUSTERED 
(
	[IZIN_ID] ASC,
	[HAKEDIS_IZIN_ID] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
) ON [PRIMARY]
GO
/****** Object:  Table [dbo].[PERSONELIZINONAY]    Script Date: 20.12.2023 17:26:31 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[PERSONELIZINONAY](
	[ID] [numeric](19, 0) IDENTITY(1,1) NOT NULL,
	[DURUM] [tinyint] NULL,
	[GUNCELLEMETARIHI] [datetime] NULL,
	[OLUSTURMATARIHI] [datetime] NULL,
	[ONAY_DURUM] [int] NULL,
	[ONAYLAYAN_NEDEN_ACIKLAMA] [varchar](256) NULL,
	[ONAYLAYAN_TIPI] [varchar](1) NOT NULL,
	[VERSION] [int] NULL,
	[GUNCELLEYENUSER_ID] [numeric](19, 0) NULL,
	[OLUSTURANUSER_ID] [numeric](19, 0) NULL,
	[ONAYLAMAMA_NEDEN_ID] [numeric](19, 0) NULL,
	[PERSONEL_IZIN_ID] [numeric](19, 0) NOT NULL,
PRIMARY KEY CLUSTERED 
(
	[ID] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY],
UNIQUE NONCLUSTERED 
(
	[PERSONEL_IZIN_ID] ASC,
	[ONAYLAYAN_TIPI] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
) ON [PRIMARY]
GO
/****** Object:  Table [dbo].[ROLE]    Script Date: 20.12.2023 17:26:31 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[ROLE](
	[ID] [int] IDENTITY(1,1) NOT NULL,
	[ACIKLAMA] [varchar](255) NULL,
	[ROLENAME] [varchar](255) NULL,
	[STATUS] [tinyint] NULL,
	[DEPARTMAN_ID] [numeric](19, 0) NULL,
	[ADMIN_ROLE] [tinyint] NULL
) ON [PRIMARY]
GO
/****** Object:  Table [dbo].[ROLEGROUPS]    Script Date: 20.12.2023 17:26:31 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[ROLEGROUPS](
	[ROLEID] [int] NOT NULL,
	[GROUPID] [int] NOT NULL
) ON [PRIMARY]
GO
/****** Object:  Table [dbo].[SAP_SERVER]    Script Date: 20.12.2023 17:26:31 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[SAP_SERVER](
	[ID] [int] IDENTITY(1,1) NOT NULL,
	[CLIENT] [varchar](255) NULL,
	[DESTINATIONNAME] [varchar](255) NULL,
	[DURUM] [int] NULL,
	[HOSTNAME] [varchar](255) NULL,
	[MESSAGESERVER] [varchar](255) NULL,
	[SUNUCUTIPI] [int] NULL,
	[SYSNUMBER] [varchar](255) NULL,
	[SYSTEM_DIL] [nvarchar](3) NULL,
PRIMARY KEY CLUSTERED 
(
	[ID] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
) ON [PRIMARY]
GO
/****** Object:  Table [dbo].[SERVICE_DATA]    Script Date: 20.12.2023 17:26:31 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[SERVICE_DATA](
	[ID] [numeric](19, 0) IDENTITY(1,1) NOT NULL,
	[FONKSIYON_ADI] [varchar](128) NOT NULL,
	[TARIH] [datetime] NULL,
	[ICERIK_IN] [nvarchar](max) NOT NULL,
	[ICERIK_OUT] [nvarchar](max) NULL,
PRIMARY KEY CLUSTERED 
(
	[ID] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
) ON [PRIMARY] TEXTIMAGE_ON [PRIMARY]
GO
/****** Object:  Table [dbo].[SIRKET]    Script Date: 20.12.2023 17:26:31 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[SIRKET](
	[ID] [numeric](19, 0) IDENTITY(1,1) NOT NULL,
	[DURUM] [tinyint] NULL,
	[GUNCELLEMETARIHI] [datetime] NULL,
	[OLUSTURMATARIHI] [datetime] NULL,
	[ACIKLAMA] [varchar](255) NOT NULL,
	[AD] [varchar](255) NOT NULL,
	[LDAP_DURUM] [tinyint] NOT NULL,
	[LDAP_ON_EK] [varchar](255) NULL,
	[ERP_DURUM] [tinyint] NOT NULL,
	[ERP_KODU] [varchar](255) NULL,
	[VERSION] [int] NULL,
	[GUNCELLEYENUSER_ID] [numeric](19, 0) NULL,
	[OLUSTURANUSER_ID] [numeric](19, 0) NULL,
	[DEPARTMAN_ID] [numeric](19, 0) NOT NULL,
	[PDKS_DURUM] [tinyint] NULL,
	[FAZLA_MESAI_ODE] [tinyint] NULL,
	[SUA_OLABILIR] [tinyint] NULL,
	[FAZLA_MESAI] [tinyint] NULL,
	[ISTEN_AYR_TAR_CALISIYOR] [tinyint] NULL,
	[DEPARTMAN_BOLUM_AYNI] [tinyint] NULL,
	[FAZLA_MESAI_IZIN_KULLAN] [tinyint] NULL,
	[FAZLA_MESAI_TALEP_GIRILEBILIR] [tinyint] NULL,
	[SIRKET_GRUP_ID] [numeric](19, 0) NULL,
	[TESIS_DURUM] [tinyint] NULL,
PRIMARY KEY CLUSTERED 
(
	[ID] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
) ON [PRIMARY]
GO
/****** Object:  Table [dbo].[TANIM]    Script Date: 20.12.2023 17:26:31 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[TANIM](
	[ID] [numeric](19, 0) IDENTITY(1,1) NOT NULL,
	[ACIKLAMAEN] [varchar](128) NULL,
	[ACIKLAMATR] [varchar](128) NULL,
	[DURUM] [tinyint] NULL,
	[GUNCELLE] [tinyint] NOT NULL,
	[ISLEM_TARIHI] [datetime] NULL,
	[KODU] [varchar](64) NULL,
	[TIPI] [varchar](32) NULL,
	[ISLEM_YAPAN] [numeric](19, 0) NULL,
	[PARENTTANIM_ID] [numeric](19, 0) NULL,
	[ERP_KODU] [varchar](16) NULL,
 CONSTRAINT [PK__TANIM__625B65AE] PRIMARY KEY CLUSTERED 
(
	[ID] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
) ON [PRIMARY]
GO
/****** Object:  Table [dbo].[TATIL]    Script Date: 20.12.2023 17:26:31 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[TATIL](
	[ID] [numeric](19, 0) IDENTITY(1,1) NOT NULL,
	[DURUM] [tinyint] NULL,
	[GUNCELLEMETARIHI] [datetime] NULL,
	[OLUSTURMATARIHI] [datetime] NULL,
	[ACIKLAMA] [varchar](255) NOT NULL,
	[AD] [varchar](255) NOT NULL,
	[BAS_TARIH] [datetime] NULL,
	[BIT_TARIH] [datetime] NOT NULL,
	[VERSION] [int] NULL,
	[YARIM_GUN] [tinyint] NOT NULL,
	[GUNCELLEYENUSER_ID] [numeric](19, 0) NULL,
	[OLUSTURANUSER_ID] [numeric](19, 0) NULL,
	[TATIL_TIPI_ID] [numeric](19, 0) NOT NULL,
	[YARIM_GUN_VARDIYA_YARIM_HESAPLA] [tinyint] NULL,
PRIMARY KEY CLUSTERED 
(
	[ID] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
) ON [PRIMARY]
GO
/****** Object:  Table [dbo].[USER_MENUITEM_TIME]    Script Date: 20.12.2023 17:26:31 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[USER_MENUITEM_TIME](
	[ID] [numeric](19, 0) IDENTITY(1,1) NOT NULL,
	[USER_ID] [numeric](19, 0) NOT NULL,
	[MENU_ID] [numeric](19, 0) NOT NULL,
	[FIRST_TIME] [datetime] NULL,
	[LAST_TIME] [datetime] NULL,
	[USE_COUNT] [numeric](21, 0) NULL,
	[SESSION_ID] [varchar](255) NULL,
	[LAST_PARAMETRE] [varchar](max) NULL,
PRIMARY KEY CLUSTERED 
(
	[ID] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY],
UNIQUE NONCLUSTERED 
(
	[USER_ID] ASC,
	[MENU_ID] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
) ON [PRIMARY] TEXTIMAGE_ON [PRIMARY]
GO
/****** Object:  Table [dbo].[USER_TESIS]    Script Date: 20.12.2023 17:26:31 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[USER_TESIS](
	[ID] [numeric](19, 0) IDENTITY(1,1) NOT NULL,
	[USER_ID] [numeric](19, 0) NOT NULL,
	[TESIS_ID] [numeric](19, 0) NOT NULL,
PRIMARY KEY CLUSTERED 
(
	[ID] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY],
UNIQUE NONCLUSTERED 
(
	[USER_ID] ASC,
	[TESIS_ID] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
) ON [PRIMARY]
GO
/****** Object:  Table [dbo].[USERROLES]    Script Date: 20.12.2023 17:26:31 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[USERROLES](
	[ID] [numeric](19, 0) IDENTITY(1,1) NOT NULL,
	[ROLEID] [int] NOT NULL,
	[USERID] [numeric](19, 0) NOT NULL,
 CONSTRAINT [PK__UserRoles__6443AE20] PRIMARY KEY CLUSTERED 
(
	[ID] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
) ON [PRIMARY]
GO
/****** Object:  Table [dbo].[VARDIYA]    Script Date: 20.12.2023 17:26:31 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[VARDIYA](
	[ID] [numeric](19, 0) IDENTITY(1,1) NOT NULL,
	[DURUM] [tinyint] NULL,
	[GUNCELLEMETARIHI] [datetime] NULL,
	[OLUSTURMATARIHI] [datetime] NULL,
	[ADI] [varchar](255) NULL,
	[BASDAKIKA] [smallint] NOT NULL,
	[BASSAAT] [smallint] NOT NULL,
	[BITDAKIKA] [smallint] NOT NULL,
	[BITSAAT] [smallint] NOT NULL,
	[CALISMAGUN] [int] NOT NULL,
	[CALISMASAATI] [float] NOT NULL,
	[CIKISERKENTOLERANSDAKIKA] [smallint] NOT NULL,
	[GIRISERKENTOLERANSDAKIKA] [smallint] NOT NULL,
	[GIRISGECIKMETOLERANSDAKIKA] [smallint] NOT NULL,
	[VARDIYATIPI] [char](1) NOT NULL,
	[VERSION] [int] NULL,
	[YEMEK_SURESI] [int] NULL,
	[GUNCELLEYENUSER_ID] [numeric](19, 0) NULL,
	[OLUSTURANUSER_ID] [numeric](19, 0) NULL,
	[CIKISGECIKMETOLERANSDAKIKA] [smallint] NULL,
	[DEPARTMAN_ID] [numeric](19, 0) NULL,
	[KISA_ADI] [varchar](16) NULL,
	[CLASS_ADI] [varchar](64) NULL,
	[AKSAM_VARDIYA] [tinyint] NULL,
	[ICAP_VARDIYA] [tinyint] NULL,
	[MESAI_ODE] [tinyint] NULL,
	[GEBELIK] [tinyint] NULL,
	[CIKIS_MOLA_DAKIKA] [tinyint] NULL,
	[SUA] [tinyint] NULL,
	[GENEL] [tinyint] NULL,
	[EKRAN_SIRA] [int] NULL,
	[CALISMA_SEKLI] [numeric](19, 0) NULL,
	[ARIFE_CALISMA_DAKIKA] [numeric](19, 0) NULL,
	[FAZLA_MESAI_BAS_SURE] [tinyint] NULL,
	[ISKUR] [tinyint] NULL,
 CONSTRAINT [PK__Vardiya__3E0A8D4D] PRIMARY KEY CLUSTERED 
(
	[ID] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
) ON [PRIMARY]
GO
/****** Object:  Table [dbo].[VARDIYA_GOREV]    Script Date: 20.12.2023 17:26:31 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[VARDIYA_GOREV](
	[ID] [numeric](19, 0) IDENTITY(1,1) NOT NULL,
	[VERSION] [int] NULL,
	[VARDIYA_GUN_ID] [numeric](19, 0) NOT NULL,
	[YENI_GOREV_YERI_ID] [numeric](19, 0) NULL,
	[OZEL_ISTEK] [tinyint] NULL,
	[BOLUM_KAT_ID] [numeric](19, 0) NULL,
	[GOREVLI_DURUM] [tinyint] NULL,
PRIMARY KEY CLUSTERED 
(
	[ID] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY],
UNIQUE NONCLUSTERED 
(
	[VARDIYA_GUN_ID] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
) ON [PRIMARY]
GO
/****** Object:  Table [dbo].[VARDIYA_GUN]    Script Date: 20.12.2023 17:26:31 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[VARDIYA_GUN](
	[ID] [numeric](19, 0) IDENTITY(1,1) NOT NULL,
	[DURUM] [tinyint] NULL,
	[GUNCELLEMETARIHI] [datetime] NULL,
	[OLUSTURMATARIHI] [datetime] NULL,
	[VARDIYA_TARIHI] [datetime] NOT NULL,
	[VERSION] [int] NULL,
	[GUNCELLEYENUSER_ID] [numeric](19, 0) NULL,
	[OLUSTURANUSER_ID] [numeric](19, 0) NULL,
	[PERSONEL_ID] [numeric](19, 0) NOT NULL,
	[VARDIYA_ID] [numeric](19, 0) NOT NULL,
	[VARDIYA_SAAT_ID] [numeric](19, 0) NULL,
	[PERSONEL_NO]  AS ([dbo].[FN_PERSONEL_NO]([PERSONEL_ID])),
	[VARDIYA_ACIKLAMA]  AS ([dbo].[FN_VARDIYA_ACIKLAMA]([VARDIYA_ID])),
PRIMARY KEY CLUSTERED 
(
	[ID] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
) ON [PRIMARY]
GO
/****** Object:  Table [dbo].[VARDIYA_IZIN]    Script Date: 20.12.2023 17:26:31 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[VARDIYA_IZIN](
	[ID] [numeric](19, 0) IDENTITY(1,1) NOT NULL,
	[IZIN_VARDIYA_ID] [numeric](19, 0) NOT NULL,
	[CALISMA_VARDIYA_ID] [numeric](19, 0) NULL,
PRIMARY KEY CLUSTERED 
(
	[ID] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY],
UNIQUE NONCLUSTERED 
(
	[IZIN_VARDIYA_ID] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
) ON [PRIMARY]
GO
/****** Object:  Table [dbo].[VARDIYA_SAAT]    Script Date: 20.12.2023 17:26:31 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[VARDIYA_SAAT](
	[ID] [numeric](19, 0) IDENTITY(1,1) NOT NULL,
	[NORMAL_SURE] [float] NULL,
	[CALISMA_SURESI] [float] NULL,
	[AKSAM_VARDIYA_SURESI] [float] NULL,
	[RESMI_TATIL_SURESI] [float] NULL,
	[GUNCELLEME_TARIHI] [datetime] NULL,
PRIMARY KEY CLUSTERED 
(
	[ID] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
) ON [PRIMARY]
GO
/****** Object:  Table [dbo].[VARDIYA_YEMEK_IZIN]    Script Date: 20.12.2023 17:26:31 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[VARDIYA_YEMEK_IZIN](
	[ID] [numeric](19, 0) IDENTITY(1,1) NOT NULL,
	[VARDIYA_ID] [numeric](19, 0) NULL,
	[YEMEK_IZIN_ID] [numeric](19, 0) NULL,
PRIMARY KEY CLUSTERED 
(
	[ID] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY],
UNIQUE NONCLUSTERED 
(
	[VARDIYA_ID] ASC,
	[YEMEK_IZIN_ID] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
) ON [PRIMARY]
GO
/****** Object:  Table [dbo].[VARDIYAHAFTA]    Script Date: 20.12.2023 17:26:31 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[VARDIYAHAFTA](
	[ID] [numeric](19, 0) IDENTITY(1,1) NOT NULL,
	[DURUM] [tinyint] NULL,
	[GUNCELLEMETARIHI] [datetime] NULL,
	[OLUSTURMATARIHI] [datetime] NULL,
	[BAS_TARIH] [datetime] NOT NULL,
	[BIT_TARIH] [datetime] NOT NULL,
	[VERSION] [int] NULL,
	[GUNCELLEYENUSER_ID] [numeric](19, 0) NULL,
	[OLUSTURANUSER_ID] [numeric](19, 0) NULL,
	[PERSONEL_ID] [numeric](19, 0) NOT NULL,
	[SABLON_ID] [numeric](19, 0) NOT NULL,
PRIMARY KEY CLUSTERED 
(
	[ID] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
) ON [PRIMARY]
GO
/****** Object:  Table [dbo].[VARDIYASABLONU]    Script Date: 20.12.2023 17:26:31 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[VARDIYASABLONU](
	[ID] [numeric](19, 0) IDENTITY(1,1) NOT NULL,
	[DURUM] [tinyint] NULL,
	[GUNCELLEMETARIHI] [datetime] NULL,
	[OLUSTURMATARIHI] [datetime] NULL,
	[ADI] [varchar](255) NOT NULL,
	[VERSION] [int] NULL,
	[GUNCELLEYENUSER_ID] [numeric](19, 0) NULL,
	[OLUSTURANUSER_ID] [numeric](19, 0) NULL,
	[VARDIYA1_ID] [numeric](19, 0) NULL,
	[VARDIYA2_ID] [numeric](19, 0) NULL,
	[VARDIYA3_ID] [numeric](19, 0) NULL,
	[VARDIYA4_ID] [numeric](19, 0) NULL,
	[VARDIYA5_ID] [numeric](19, 0) NULL,
	[VARDIYA6_ID] [numeric](19, 0) NULL,
	[VARDIYA7_ID] [numeric](19, 0) NULL,
	[DEPARTMAN_ID] [numeric](19, 0) NULL,
	[BEYAZ_YAKA] [tinyint] NULL,
	[CALISMA_MODELI_ID] [numeric](19, 0) NULL,
	[ISKUR] [tinyint] NULL,
PRIMARY KEY CLUSTERED 
(
	[ID] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
) ON [PRIMARY]
GO
/****** Object:  Table [dbo].[VELAKET_YONETICI]    Script Date: 20.12.2023 17:26:31 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[VELAKET_YONETICI](
	[ID] [numeric](19, 0) IDENTITY(1,1) NOT NULL,
	[DURUM] [tinyint] NULL,
	[GUNCELLEMETARIHI] [datetime] NULL,
	[OLUSTURMATARIHI] [datetime] NULL,
	[BASLANGIC_TARIHI] [datetime] NOT NULL,
	[BITIS_TARIHI] [datetime] NOT NULL,
	[VERSION] [int] NULL,
	[GUNCELLEYENUSER_ID] [numeric](19, 0) NULL,
	[OLUSTURANUSER_ID] [numeric](19, 0) NULL,
	[YENI_YONETICI] [numeric](19, 0) NOT NULL,
	[VEKALET_VEREN] [numeric](19, 0) NOT NULL,
PRIMARY KEY CLUSTERED 
(
	[ID] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
) ON [PRIMARY]
GO
/****** Object:  Table [dbo].[YEMEK_KARTSIZ]    Script Date: 20.12.2023 17:26:31 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[YEMEK_KARTSIZ](
	[ID] [numeric](19, 0) IDENTITY(1,1) NOT NULL,
	[DURUM] [tinyint] NULL,
	[GUNCELLEMETARIHI] [datetime] NULL,
	[OLUSTURMATARIHI] [datetime] NULL,
	[ADET] [int] NULL,
	[TARIH] [datetime] NULL,
	[GUNCELLEYENUSER_ID] [numeric](19, 0) NULL,
	[OLUSTURANUSER_ID] [numeric](19, 0) NULL,
	[KAPI_ID] [numeric](19, 0) NULL,
	[OGUN_ID] [numeric](19, 0) NULL,
	[SIRKET_ID] [numeric](19, 0) NULL,
PRIMARY KEY CLUSTERED 
(
	[ID] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY],
UNIQUE NONCLUSTERED 
(
	[TARIH] ASC,
	[SIRKET_ID] ASC,
	[KAPI_ID] ASC,
	[OGUN_ID] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
) ON [PRIMARY]
GO
/****** Object:  Table [dbo].[YEMEKIZIN]    Script Date: 20.12.2023 17:26:31 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[YEMEKIZIN](
	[ID] [numeric](19, 0) IDENTITY(1,1) NOT NULL,
	[DURUM] [tinyint] NULL,
	[GUNCELLEMETARIHI] [datetime] NULL,
	[OLUSTURMATARIHI] [datetime] NULL,
	[BAS_DAKIKA] [int] NULL,
	[BAS_SAAT] [int] NULL,
	[BIT_DAKIKA] [int] NULL,
	[BIT_SAAT] [int] NULL,
	[VERSION] [int] NULL,
	[ACIKLAMA] [varchar](255) NULL,
	[GUNCELLEYENUSER_ID] [numeric](19, 0) NULL,
	[OLUSTURANUSER_ID] [numeric](19, 0) NULL,
	[MAX_SURE] [int] NULL,
	[OZEL_MOLA] [tinyint] NULL,
	[BAS_TARIHI] [datetime] NULL,
	[BIT_TARIHI] [datetime] NULL,
PRIMARY KEY CLUSTERED 
(
	[ID] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
) ON [PRIMARY]
GO
/****** Object:  Table [dbo].[YEMEKOGUN]    Script Date: 20.12.2023 17:26:31 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[YEMEKOGUN](
	[ID] [numeric](19, 0) IDENTITY(1,1) NOT NULL,
	[DURUM] [tinyint] NULL,
	[GUNCELLEMETARIHI] [datetime] NULL,
	[OLUSTURMATARIHI] [datetime] NULL,
	[BAS_DAKIKA] [int] NULL,
	[BAS_SAAT] [int] NULL,
	[BIT_DAKIKA] [int] NULL,
	[BIT_SAAT] [int] NULL,
	[VERSION] [int] NULL,
	[ACIKLAMA] [varchar](255) NULL,
	[GUNCELLEYENUSER_ID] [numeric](19, 0) NULL,
	[OLUSTURANUSER_ID] [numeric](19, 0) NULL,
	[BASLANGIC_TARIH] [datetime] NULL,
	[BITIS_TARIH] [datetime] NULL,
PRIMARY KEY CLUSTERED 
(
	[ID] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
) ON [PRIMARY]
GO
/****** Object:  View [dbo].[VIEW_KAPI_SIRKET_KGS_LIST]    Script Date: 20.12.2023 17:26:31 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
		  
 
CREATE VIEW [dbo].[VIEW_KAPI_SIRKET_KGS_LIST] AS
 
	SELECT  K.* 	FROM  KAPI_SIRKET_KGS AS K WITH (nolock) 
	INNER JOIN KAPI_SIRKET S ON S.ID=K.KGS_SIRKET_ID 
	where  K.KAPI_ID IS NOT NULL OR ( K.DURUM=1 and K.KART_YONU IN (1,2))


GO
/****** Object:  UserDefinedFunction [dbo].[FN_KAPI_SIRKET_KGS_LIST]    Script Date: 20.12.2023 17:26:31 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
 
CREATE FUNCTION [dbo].[FN_KAPI_SIRKET_KGS_LIST]()  
RETURNS TABLE  
AS  
RETURN  
	SELECT  K.* 	FROM VIEW_KAPI_SIRKET_KGS_LIST K WITH (nolock) 
	 
GO
/****** Object:  UserDefinedFunction [dbo].[FN_GET_ONCEKI_GUN_FAZLA_MESAI_TALEP]    Script Date: 20.12.2023 17:26:31 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE FUNCTION  [dbo].[FN_GET_ONCEKI_GUN_FAZLA_MESAI_TALEP](@tarih date)
 
RETURNS TABLE 
AS
RETURN 
(
	-- Add the SELECT statement with parameter references here
	SELECT * from FAZLA_MESAI_TALEP  WITH(nolock) 
	WHERE BITIS_ZAMANI>DATEADD(DAY, -1, @tarih)   AND BASLANGIC_ZAMANI<DATEADD(DAY, 1, @tarih) 
	AND ONAY_DURUMU<>3 AND DURUM=1
)
GO
/****** Object:  UserDefinedFunction [dbo].[FN_USER_MENUITEM_LIST]    Script Date: 20.12.2023 17:26:31 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
 
 
CREATE FUNCTION [dbo].[FN_USER_MENUITEM_LIST]()  
RETURNS TABLE  
AS  
RETURN  
	 
	 
	  
SELECT I.[ID],P.AD+' '+P.SOYAD AS 'ADI SOYADI',K.KULLANICI_ADI, V.ACIKLAMATR AS 'MENU ADI'
           ,[LAST_TIME]      ,LAST_PARAMETRE ,[USE_COUNT]   ,[FIRST_TIME],G.NAME MENU_NAME
  FROM [dbo].[USER_MENUITEM_TIME] I WITH(nolock)
  INNER JOIN PDKSUSER K ON K.ID=I.[USER_ID]
  INNER JOIN PERSONEL P ON P.ID=K.PERSONEL_ID

  INNER JOIN MENUITEM G ON G.ID=I.MENU_ID
  INNER JOIN TANIM V ON V.ID=G.DESCRIPTION_ID



GO
/****** Object:  View [dbo].[AKSAM_CALISMA_ADET]    Script Date: 20.12.2023 17:26:31 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE VIEW [dbo].[AKSAM_CALISMA_ADET] AS
WITH DONEM AS (
SELECT ID AS DONEM_ID,YIL,AY,DURUM AS DONEM_DURUM FROM DENKLESTIRMEAY WITH(nolock) 
 
), AKSAM_VARDIYA AS (
SELECT V.ID AS VARDIYA_ID,V.KISA_ADI,V.ADI,V.VARDIYATIPI FROM VARDIYA V WITH(nolock) 
WHERE AKSAM_VARDIYA=1 AND DURUM=1
), AYLIK_TOPLAM AS (
SELECT PERSONEL_ID,YEAR(V.VARDIYA_TARIHI) AS YIL,MONTH(V.VARDIYA_TARIHI) AS AY,COUNT(S.ID) AS AKSAM_FIILI_ADET  FROM VARDIYA_GUN V WITH(nolock) 
INNER JOIN AKSAM_VARDIYA A ON V.VARDIYA_ID=A.VARDIYA_ID AND A.VARDIYATIPI=''
INNER JOIN VARDIYA_SAAT S ON S.ID=V.VARDIYA_SAAT_ID AND S.CALISMA_SURESI>=4 
GROUP BY PERSONEL_ID,YEAR(V.VARDIYA_TARIHI) ,MONTH(V.VARDIYA_TARIHI)
UNION ALL
SELECT PERSONEL_ID,YEAR(V.VARDIYA_TARIHI) AS YIL,MONTH(V.VARDIYA_TARIHI) AS AY,COUNT(S.ID) AS AKSAM_FIILI_ADET  FROM VARDIYA_GUN V WITH(nolock) 
INNER JOIN PERSONELFAZLAMESAI S ON S.VARDIYA_GUN=V.ID AND S.DURUM=1 AND S.ONAY_DURUM=1 AND S.FAZLA_MESAI_SAATI>=4
AND DATEPART(HOUR,S.BIT_ZAMAN)>=4 AND DATEPART(HOUR,S.BIT_ZAMAN)<=9
WHERE V.VARDIYA_ID=1
GROUP BY PERSONEL_ID,YEAR(V.VARDIYA_TARIHI) ,MONTH(V.VARDIYA_TARIHI)

),
 AKSAM_AYLIK_TOPLAM AS (
 SELECT PERSONEL_ID,YIL,AY,SUM(AKSAM_FIILI_ADET) AS AKSAM_FIILI_ADET FROM AYLIK_TOPLAM
 GROUP BY PERSONEL_ID,YIL,AY
 )
SELECT PD.ID AS PERSONEL_DENK_ID,PD.AKSAM_VARDIYA_ADET,P.PDKS_SICIL_NO,P.AD,P.SOYAD,
P.SIRKET_ID, S.AD AS SIRKET_ADI,P.TESIS_ID, COALESCE(T.ACIKLAMATR,'') AS TESIS,P.EK_SAHA3_ID AS BOLUM_ID, COALESCE(B.ACIKLAMATR,'') AS BOLUM, PD.DONEM_ID,A.*,
CASE WHEN PD.ONAYLANDI=1 AND PD.DURUM=1 THEN A.AKSAM_FIILI_ADET ELSE 0 END AKSAM_ADET,DONEM_DURUM FROM PERSONELDENKLESTIRME PD WITH(nolock) 
INNER JOIN DONEM D ON D.DONEM_ID=PD.DONEM_ID
INNER JOIN AKSAM_AYLIK_TOPLAM A ON A.PERSONEL_ID=PD.PERSONEL_ID AND A.YIL=D.YIL AND A.AY=D.AY
INNER JOIN PERSONEL P ON P.ID=PD.PERSONEL_ID
INNER JOIN SIRKET S ON S.ID=P.SIRKET_ID
LEFT JOIN TANIM T ON T.ID=P.TESIS_ID
LEFT JOIN TANIM B ON B.ID=P.EK_SAHA3_ID
GO
/****** Object:  View [dbo].[AKTIF_BAKIYE_SENELIK_SUA_IZIN_VIEW]    Script Date: 20.12.2023 17:26:31 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO

/****** Script for SelectTopNRows command from SSMS  ******/
CREATE VIEW [dbo].[AKTIF_BAKIYE_SENELIK_SUA_IZIN_VIEW] AS
WITH DETAY AS (
SELECT  T.kodu AS IZIN_TIPI,I. *
  FROM  PERSONELIZIN I
  INNER JOIN IZINTIPI IT ON  IT.ID=I.IZIN_TIPI_ID AND IT.durum=1
  INNER JOIN TANIM  T ON T.ID=IT.IZIN_TIPI_ID AND T.kodu in ('ŞUA','90') AND IT.BAKIYE_IZIN_TIPI_ID IS NOT NULL
  WHERE I.IZIN_DURUMU NOT IN (8,9) AND I.IZIN_SURESI>0
  ),
SONUC AS (
 
SELECT PERSONEL_ID,YEAR(BASLANGIC_ZAMANI) AS YIL, SUM(CASE WHEN IZIN_TIPI='90' THEN IZIN_SURESI ELSE 0 END) SENELIK,
SUM(CASE WHEN IZIN_TIPI<>'90' THEN IZIN_SURESI ELSE 0 END) SUA   FROM  DETAY
  
 GROUP BY PERSONEL_ID,YEAR(BASLANGIC_ZAMANI)
 )
 SELECT P.PDKS_SICIL_NO, S.* FROM SONUC S
 INNER JOIN PERSONEL P ON P.ID=S.PERSONEL_ID
GO
/****** Object:  View [dbo].[BAKIYE_IZIN_HATALI_VIEW]    Script Date: 20.12.2023 17:26:31 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE VIEW [dbo].[BAKIYE_IZIN_HATALI_VIEW] AS

SELECT DISTINCT P.IZIN_HAKEDIS_TARIHI,P.ISE_BASLAMA_TARIHI,P.AD + ' '+P.SOYAD AS PERSONEL,P.PDKS_SICIL_NO,
CASE WHEN D.ID is NULL THEN 0 ELSE 1 END  HARCANDI,I.*   FROM  PERSONELIZIN I WITH(nolock)
INNER JOIN PERSONEL P ON P.ID=I.PERSONEL_ID   AND YEAR([BASLANGIC_ZAMANI])<=YEAR(P.IZIN_HAKEDIS_TARIHI)
AND P.ISTEN_AYRILIS_TARIHI>GETDATE() AND P.DURUM=1
 LEFT JOIN PERSONELIZINDETAY D ON D.HAKEDIS_IZIN_ID=I.ID
   where [IZIN_TIPI_ID] IN (2,4,57) AND [IZIN_DURUMU] NOT IN (8,9) AND [IZIN_SURESI]>0 AND YEAR([BASLANGIC_ZAMANI])>1900
GO
/****** Object:  View [dbo].[BAKIYE_IZIN_MUKERRRER_VIEW]    Script Date: 20.12.2023 17:26:31 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE VIEW [dbo].[BAKIYE_IZIN_MUKERRRER_VIEW] AS
WITH CIFT AS (
SELECT [PERSONEL_ID],YEAR([BASLANGIC_ZAMANI]) AS IZIN_DONEMI   FROM  PERSONELIZIN I WITH(nolock)
   where [IZIN_TIPI_ID] IN (2,4,57) AND [IZIN_DURUMU] NOT IN (8,9) AND [IZIN_SURESI]>0
   GROUP BY [PERSONEL_ID],YEAR([BASLANGIC_ZAMANI])
   HAVING COUNT(*)>1
   )
   SELECT DISTINCT C.IZIN_DONEMI,CASE WHEN D.ID is NULL THEN 0 ELSE 1 END  HARCANDI,I.* FROM    PERSONELIZIN I WITH(nolock)
   INNER JOIN CIFT C ON C.PERSONEL_ID=I.PERSONEL_ID AND YEAR(I.BASLANGIC_ZAMANI)=C.IZIN_DONEMI
   LEFT JOIN PERSONELIZINDETAY D ON D.HAKEDIS_IZIN_ID=I.ID
   where I.IZIN_TIPI_ID  IN (2,4,57) AND I.IZIN_DURUMU  NOT IN (8,9) AND I.IZIN_SURESI>0
GO
/****** Object:  View [dbo].[BAKIYE_UCRETLI_IZIN]    Script Date: 20.12.2023 17:26:31 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE VIEW [dbo].[BAKIYE_UCRETLI_IZIN]  AS
WITH BAKIYE_UCRETLI_IZIN AS (
SELECT BI.ID AS IZIN_TIPI_ID   FROM IZINTIPI BI WITH(nolock)
  INNER JOIN IZINTIPI I ON I.ID=BI.BAKIYE_IZIN_TIPI_ID
  INNER JOIN TANIM T ON T.ID=I.IZIN_TIPI_ID AND T.KODU='90'
  )
   SELECT P.IZIN_HAKEDIS_TARIHI,IP.* FROM PERSONELIZIN IP WITH(nolock)
   INNER JOIN PERSONEL P ON P.ID=IP.PERSONEL_ID AND P.ISTEN_AYRILIS_TARIHI>GETDATE() AND P.DURUM=1
    INNER JOIN SIRKET S ON S.ID=P.SIRKET_ID AND S.DURUM=1 AND S.PDKS_DURUM=1
  INNER JOIN BAKIYE_UCRETLI_IZIN I ON IP.IZIN_TIPI_ID=I.IZIN_TIPI_ID
  WHERE YEAR(IP.BASLANGIC_ZAMANI)>=YEAR(GETDATE())-1 AND YEAR(IP.BASLANGIC_ZAMANI)<YEAR(GETDATE()) AND IP.IZIN_SURESI>0 AND IP.IZIN_KAGIDI_GELDI IS NULL AND IP.IZIN_SURESI<14 
 AND IP.IZIN_DURUMU NOT IN (8, 9) AND dateadd(year, 1, P.IZIN_HAKEDIS_TARIHI)<=IP.BITIS_ZAMANI
GO
/****** Object:  View [dbo].[CIFT_SENELIK_SUA_IZIN_VIEW]    Script Date: 20.12.2023 17:26:31 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE VIEW [dbo].[CIFT_SENELIK_SUA_IZIN_VIEW] AS
WITH IZIN_BAKIYELER AS (
SELECT   YEAR(I.BASLANGIC_ZAMANI) AS YIL,I.PERSONEL_ID,I.IZIN_TIPI_ID,MAX(I.ID) AS IZIN_ID FROM PERSONELIZIN I WITH(nolock)
INNER JOIN PERSONEL P on P.ID=I.PERSONEL_ID AND P.DURUM=1 AND P.ISTEN_AYRILIS_TARIHI >GETDATE()
INNER JOIN IZINTIPI IT ON IT.ID=I.IZIN_TIPI_ID and IT.DEPARTMAN_ID=1 AND IT.BAKIYE_IZIN_TIPI_ID IS NOT NULL
INNER JOIN TANIM T ON T.ID=IT.IZIN_TIPI_ID AND T.KODU IN ('90','ŞUA')
where   I.IZIN_SURESI>0 and I.IZIN_DURUMU NOT IN (8,9)
GROUP BY YEAR(I.BASLANGIC_ZAMANI)  ,I.PERSONEL_ID,I.IZIN_TIPI_ID
),
CIFT_IZIN AS (
SELECT PERSONEL_ID,YIL,MIN(IZIN_ID) AS IZIN_1,Max(IZIN_ID) AS IZIN_2  FROM IZIN_BAKIYELER
GROUP BY PERSONEL_ID,YIL
HAVING COUNT(*)=2
)
SELECT P.PDKS_SICIL_NO,P.AD + ' '+ P.SOYAD AS PERSONEL,V.* FROM  CIFT_IZIN V WITH(nolock)
INNER JOIN  PERSONEL P on P.ID=V.PERSONEL_ID
GO
/****** Object:  View [dbo].[FOREIGN_KEYS_DETAIL_VIEW]    Script Date: 20.12.2023 17:26:31 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
 

CREATE VIEW [dbo].[FOREIGN_KEYS_DETAIL_VIEW] AS

WITH VERI AS (
 SELECT DISTINCT obj.name AS FK_NAME,
    sch.name AS SCHEMA_NAME,
    tab1.name AS TABLE_NAME,
    col1.name AS COLUMNN_NAME,
    tab2.name AS REFERANS_TABLE_NAME,
    col2.name AS REFERANS_COLUMNN_NAME
FROM sys.foreign_key_columns fkc
INNER JOIN sys.objects obj
    ON obj.object_id = fkc.constraint_object_id
INNER JOIN sys.tables tab1
    ON tab1.object_id = fkc.parent_object_id
INNER JOIN sys.schemas sch
    ON tab1.schema_id = sch.schema_id
INNER JOIN sys.columns col1
    ON col1.column_id = parent_column_id AND col1.object_id = tab1.object_id
INNER JOIN sys.tables tab2
    ON tab2.object_id = fkc.referenced_object_id
INNER JOIN sys.columns col2
    ON col2.column_id = referenced_column_id AND col2.object_id = tab2.object_id
	)
SELECT V.*,'ALTER TABLE ' +TABLE_NAME+' DROP  CONSTRAINT ['+FK_NAME+'] ;' DROP_SQL FROM VERI V
 
GO
/****** Object:  View [dbo].[FOREIGN_KEYS_VIEW]    Script Date: 20.12.2023 17:26:31 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO



CREATE VIEW [dbo].[FOREIGN_KEYS_VIEW] AS
  

WITH VERI AS (
SELECT
  object_name(parent_object_id) ANA_TABLE,
  object_name(referenced_object_id) REF_TABLE,
  name  AS FOREIGN_KEYS_NAME

FROM sys.foreign_keys
 
)
SELECT V.*,'ALTER TABLE ' +ANA_TABLE+' DROP  CONSTRAINT ['+FOREIGN_KEYS_NAME+'] ;' DROP_SQL FROM VERI V
 
GO
/****** Object:  View [dbo].[HATALI_PERSONEL_VIEW]    Script Date: 20.12.2023 17:26:31 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
 
 






/****** Script for SelectTopNRows command from SSMS  ******/
CREATE VIEW [dbo].[HATALI_PERSONEL_VIEW] AS

WITH CIFT_SICIL AS (
SELECT SicilNo FROM WebPDKS.dbo.Personel P
INNER JOIN PERSONEL_SIRKET_KGS K ON K.KGS_SIRKET_ID=P.[PersonelId] AND K.DURUM=1 AND K.KGS_SIRKET_ID=2
WHERE RTRIM( SicilNo)<>'' and P.Gecerli=1 AND P.Ayrilmis=0
GROUP BY SicilNo
HAVING COUNT(*)>1
),
 TEK_KISI AS (
SELECT   P.SicilNo,P.[Adi] ADI ,P.[Soyadi] SOYADI FROM WebPDKS.dbo.Personel P
WHERE SicilNo IN (SELECT SicilNo FROM CIFT_SICIL)  and P.Gecerli=1 AND P.Ayrilmis=0
GROUP BY  P.SicilNo,P.[Adi]   ,P.[Soyadi]  
HAVING COUNT(*)>1
),
SONUC AS (
SELECT 'E' AS TIP, P.[PersonelId] ID  ,P.[Adi] ADI,P.[Soyadi] SOYADI,P.[KartId] KART_ID ,P.[SicilNo] PERSONEL_NO ,P.[Gecerli] GECERLI ,
P.[IsGirisTarihi] ISE_GIRIS_TARIHI,   S.KisaUnvan AS SIRKET_ADI,P.IsCikisTarihi ISTEN_CIKIS_TARIHI     FROM WebPDKS.dbo.Personel P
INNER JOIN CIFT_SICIL C ON C.SicilNo=P.SicilNo
INNER JOIN WebPDKS.dbo.Company S ON S.[CompanyId]=P.[CompanyId]
WHERE P.SicilNo NOT IN (SELECT  SicilNo FROM TEK_KISI ) 
UNION ALL
SELECT 'M' AS TIP, P.[PersonelId] ID  ,P.[Adi] ADI,P.[Soyadi] SOYADI,P.[KartId] KART_ID ,P.[SicilNo] PERSONEL_NO ,P.[Gecerli] GECERLI ,
P.[IsGirisTarihi] ISE_GIRIS_TARIHI, S.KisaUnvan AS SIRKET_ADI ,P.IsCikisTarihi ISTEN_CIKIS_TARIHI    FROM WebPDKS.dbo.Personel P
INNER JOIN TEK_KISI T ON T.SicilNo=P.SicilNo
INNER JOIN WebPDKS.dbo.Company S ON S.[CompanyId]=P.[CompanyId]
 
UNION ALL
SELECT 'B' AS TIP, P.[PersonelId] ID  ,P.[Adi] ADI,P.[Soyadi] SOYADI,P.[KartId] KART_ID ,P.[SicilNo] PERSONEL_NO ,P.[Gecerli] GECERLI ,
P.[IsGirisTarihi] ISE_GIRIS_TARIHI,  S.KisaUnvan AS SIRKET_ADI,P.IsCikisTarihi ISTEN_CIKIS_TARIHI     FROM WebPDKS.dbo.Personel P
 
INNER JOIN WebPDKS.dbo.Company S ON S.[CompanyId]=P.[CompanyId]
WHERE RTRIM( SicilNo)='' AND P.[Soyadi]<>''
)
select * from SONUC where PERSONEL_NO IN (
select PERSONEL_NO COLLATE Turkish_CI_AS from PERSONEL_SIRKET_KGS
WHERE ID IN  (select ID from SONUC) AND PERSONEL_ID IS NOT NULL
)

GO
/****** Object:  View [dbo].[HOLDING_IZIN_BAKIYE_VIEW]    Script Date: 20.12.2023 17:26:31 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO

CREATE VIEW [dbo].[HOLDING_IZIN_BAKIYE_VIEW] AS
WITH ZAMAN AS (
SELECT  CAST(CAST( GETDATE() AS date) AS datetime) AS TARIH
), 

PERSONELLER AS (
SELECT P.* FROM PERSONEL P,ZAMAN Z 
WHERE P.SIRKET_ID=2 AND P.DURUM=1 and P.ISTEN_AYRILIS_TARIHI>Z.TARIH AND P.ISE_BASLAMA_TARIHI<= Z.TARIH 
AND P.PDKS_SICIL_NO<>'' AND DATEADD(month, 6, P.IZIN_HAKEDIS_TARIHI)<=Z.TARIH
), 
IZINLER AS (
SELECT I.* FROM PERSONELIZIN I
INNER JOIN ZAMAN Z ON 1=1
INNER JOIN PERSONELLER P ON P.ID=I.PERSONEL_ID
WHERE I.IZIN_DURUMU NOT IN (8,9) AND I.IZIN_TIPI_ID IN  (1,2,49,57) AND IZIN_SURESI>0
and YEAR(I.BITIS_ZAMANI)<=YEAR(Z.TARIH )
), 
YILLIK_OZET AS (
SELECT I.PERSONEL_ID,I.BASLANGIC_ZAMANI,CAST(I.IZIN_SURESI  AS DECIMAL(19,2)) AS IZIN_SURESI,
	CAST (  SUM(CASE WHEN I.BASLANGIC_ZAMANI<Z.TARIH THEN COALESCE(H.IZIN_SURESI,0) ELSE 0 END ) AS DECIMAL(19,2))    HARCANAN_SURE FROM IZINLER I
	INNER JOIN ZAMAN Z ON 1=1
	LEFT JOIN PERSONELIZINDETAY D ON D.HAKEDIS_IZIN_ID=I.ID
	LEFT JOIN IZINLER H ON D.IZIN_ID=H.ID
	WHERE I.IZIN_TIPI_ID IN (2,57) AND I.BITIS_ZAMANI<=Z.TARIH
	GROUP BY I.PERSONEL_ID,I.BASLANGIC_ZAMANI,I.IZIN_SURESI
 ),
 SONUC_DATA AS (
 SELECT I.PERSONEL_ID,SUM(CASE WHEN YEAR(BASLANGIC_ZAMANI)<YEAR(Z.TARIH)  THEN  IZIN_SURESI - HARCANAN_SURE ELSE 0 END) AS GECEN_YIL_BAKIYE,
CAST( SUM(CASE WHEN YEAR(BASLANGIC_ZAMANI)<YEAR(Z.TARIH)  THEN  0 ELSE IZIN_SURESI END) as int) BU_YIL_HAKKEDILEN,
 SUM(CASE WHEN YEAR(BASLANGIC_ZAMANI)<YEAR(Z.TARIH) THEN  0 ELSE HARCANAN_SURE END) HARCANAN_SURE
  FROM YILLIK_OZET I
  INNER JOIN ZAMAN Z ON 1=1
 GROUP BY I.PERSONEL_ID,Z.TARIH
 ), 
 HAKETMEYEN_IZINLER AS (
 SELECT I.* FROM IZINLER I
  INNER JOIN ZAMAN Z ON 1=1
	WHERE I.IZIN_TIPI_ID IN (2,57) AND I.BITIS_ZAMANI>Z.TARIH
	 
 )
 SELECT P.PDKS_SICIL_NO,P.AD+' '+P.SOYAD AS AD_SOYAD,P.DOGUM_TARIHI,P.IZIN_HAKEDIS_TARIHI, S.*,S.GECEN_YIL_BAKIYE+S.BU_YIL_HAKKEDILEN-S.HARCANAN_SURE AS BAKIYE FROM SONUC_DATA S
  INNER JOIN PERSONELLER P ON P.ID=S.PERSONEL_ID
GO
/****** Object:  View [dbo].[IPTAL_BAKIYE_IZIN_VIEW]    Script Date: 20.12.2023 17:26:31 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE VIEW [dbo].[IPTAL_BAKIYE_IZIN_VIEW] AS
SELECT DISTINCT  I.* FROM PERSONEL P WITH(nolock)
INNER JOIN PERSONELIZIN I ON I.PERSONEL_ID=P.ID AND I.IZIN_DURUMU NOT IN (8,9) AND YEAR(I.BASLANGIC_ZAMANI)>=YEAR(P.ISTEN_AYRILIS_TARIHI)
INNER JOIN IZINTIPI T ON T.ID=I.IZIN_TIPI_ID AND T.BAKIYE_IZIN_TIPI_ID IS NOT NULL
LEFT JOIN PERSONELIZINDETAY D ON D.HAKEDIS_IZIN_ID=I.ID
WHERE P.ISTEN_AYRILIS_TARIHI<GETDATE() and D.ID IS NULL
GO
/****** Object:  View [dbo].[IZIN_KARTI_VIEW]    Script Date: 20.12.2023 17:26:31 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE VIEW [dbo].[IZIN_KARTI_VIEW] AS
SELECT P.AD,P.SOYAD,P.PDKS_SICIL_NO,P.DOGUM_TARIHI,P.GRUBA_GIRIS_TARIHI,H.ACIKLAMA AS KIDEM,H.BASLANGIC_ZAMANI AS DONEM,
H.BITIS_ZAMANI AS HAKEDIS_TARIHI,H.IZIN_SURESI AS BAKIYE_GUN,I.BASLANGIC_ZAMANI,I.BITIS_ZAMANI,I.IZIN_SURESI  FROM PERSONELIZIN H WITH(nolock)
INNER JOIN PERSONEL P on P.ID=H.PERSONEL_ID AND (GETDATE() BETWEEN P.ISE_BASLAMA_TARIHI AND P.ISTEN_AYRILIS_TARIHI) AND P.KGS_PERSONEL_ID>0
LEFT JOIN PERSONELIZINDETAY D ON D.HAKEDIS_IZIN_ID=H.ID
LEFT JOIN PERSONELIZIN I ON I.ID=D.IZIN_ID AND I.IZIN_DURUMU NOT IN (8,9) AND I.BITIS_ZAMANI<GETDATE()
WHERE H.IZIN_TIPI_ID=2 AND H.IZIN_DURUMU NOT IN (8,9) AND H.BITIS_ZAMANI<GETDATE()
GO
/****** Object:  View [dbo].[KGS_HAREKET_SIRKET_VIEW]    Script Date: 20.12.2023 17:26:31 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
 

CREATE VIEW [dbo].[KGS_HAREKET_SIRKET_VIEW] AS

WITH HAREKETLER AS (

SELECT 'K' + CAST(Z.KGS_ID AS VARCHAR(12)) AS ID, 'K' AS SIRKET, Z.ID AS TABLE_ID, Z.USERID AS PERSONEL, Z.KGS_SIRKET_ID,
 Z.KAPIID AS KAPI, Z.HAREKET_ZAMANI AS ZAMAN, Z.DURUM, Z.ISLEM_ID, NULL AS ORJ_ZAMAN, Z.OLUSTURMA_ZAMANI FROM dbo.PDKS_LOG AS Z WITH (nolock) 
	 INNER JOIN dbo.PERSONEL_SIRKET_KGS AS P ON P.KGS_ID = Z.USERID AND P.KGS_SIRKET_ID=Z.KGS_SIRKET_ID

 UNION ALL

 SELECT 'A' + CAST(Z.ID AS VARCHAR(12)) AS ID, 'A' AS SIRKET, Z.ID AS TABLE_ID, Z.PERSONEL,0 KGS_SIRKET_ID, Z.KAPI, 
 Z.ZAMAN, Z.DURUM, Z.ISLEM_ID, A.HAREKET_ZAMANI AS ORJ_ZAMAN, I.OLUSTURMA_ZAMANI FROM dbo.PDKS_HAREKET AS Z WITH (nolock)
	 LEFT OUTER JOIN dbo.PDKS_LOG AS A ON Z.KGS_ID = A.KGS_ID
 INNER JOIN PDKS_ISLEM I ON I.ID=Z.ISLEM_ID 
 WHERE (Z.DURUM <> 0) 
)

SELECT DISTINCT H.ID, H.SIRKET, H.TABLE_ID, H.PERSONEL AS USERID, H.KAPI AS KAPIID, H.ZAMAN AS HAREKET_ZAMANI, A.ID AS ISLEM_ID, 
	CASE WHEN SIRKET = 'K' AND A.ONAYLAYAN_ID IS NULL THEN 1 WHEN A.ID IS NOT NULL AND A.ONAYLAYAN_ID IS NULL THEN 0 ELSE H.DURUM END AS DURUM, 
					 H.ORJ_ZAMAN, H.OLUSTURMA_ZAMANI,H.KGS_SIRKET_ID FROM HAREKETLER H
		LEFT OUTER JOIN dbo.PDKS_ISLEM AS A ON A.ID = H.ISLEM_ID
WHERE (A.ID IS NULL) OR (H.SIRKET = 'A') OR (A.ISLEM_TIPI <> 'U')

GO
/****** Object:  View [dbo].[KULLANICI_IK_VIEW]    Script Date: 20.12.2023 17:26:31 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE VIEW [dbo].[KULLANICI_IK_VIEW] AS 
SELECT  U.* FROM ROLE R WITH(nolock)
INNER JOIN USERROLES UR ON UR.ROLEID=R.ID
INNER JOIN PDKSUSER U ON U.ID=UR.USERID AND  U.DURUM=1
INNER JOIN DEPARTMAN D ON D.ID=U.DEPARTMAN_ID AND D.ADMIN_DURUM=1 AND D.DURUM=1
INNER JOIN PERSONEL P ON P.ID=U.PERSONEL_ID AND P.DURUM=1 AND P.ISTEN_AYRILIS_TARIHI>GETDATE()
WHERE ROLENAME='IK'
GO
/****** Object:  View [dbo].[MANUEL_KAPI_UPDATE_VIEW]    Script Date: 20.12.2023 17:26:31 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
 




CREATE VIEW [dbo].[MANUEL_KAPI_UPDATE_VIEW] AS
SELECT S.ID,M.KGS_ID AS KAPI, O.ACIKLAMA ORJ_KAPI,M.ACIKLAMA MANUEL_KAPI,
REPLACE('UPDATE PDKS_HAREKET SET KAPI='+CAST(M.KGS_ID AS nvarchar(4)) +' WHERE ID='+ CAST(S.ID AS nvarchar(24))+';','  ',' ')  SQL_UPDATE
FROM [dbo].[PDKS_HAREKET] S
	INNER JOIN PARAMETRE P ON P.ADI = 'manuelKapiEkleme' AND P.DURUM=1  
  INNER JOIN KAPI O ON O.KGS_ID=S.KAPI
   INNER JOIN KAPI M ON M.KGS_ID IN (1,2) AND O.KAPI_TIPI_ID=M.KAPI_TIPI_ID
  where S.[KAPI] NOT IN (1,2) 

 
GO
/****** Object:  View [dbo].[ONAY_BEKLEYEN_IZIN_VIEW]    Script Date: 20.12.2023 17:26:31 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO

 CREATE VIEW [dbo].[ONAY_BEKLEYEN_IZIN_VIEW] AS
WITH PERSONEL_VERI AS (
	SELECT P.ID,P.AD,P.SOYAD,P.PDKS_SICIL_NO,P.SIRKET_ID,P.YONETICI_ID,P.ASIL_YONETICI2_ID,
		case when P.DURUM=1 AND P.ISE_BASLAMA_TARIHI<=GETDATE() AND P.ISTEN_AYRILIS_TARIHI>=GETDATE() THEN 1 ELSE 0 END DURUM,P.ISE_BASLAMA_TARIHI,
				P.ISTEN_AYRILIS_TARIHI   FROM PERSONEL P   
     INNER JOIN SIRKET S ON S.ID=P.SIRKET_ID AND S.DURUM=1

	WHERE P.YONETICI_ID IS NOT NULL   
),

IKINCI_YONETICI AS (
	SELECT DISTINCT D.*,P.YONETICI_ID AS YONETICI2_ID FROM PERSONEL_VERI D
	INNER JOIN PERSONEL_VERI P ON D.YONETICI_ID=P.ID AND P.YONETICI_ID IS NOT NULL

),
 
PER_DATALAR AS (
	SELECT DISTINCT P.*,COALESCE(P.ASIL_YONETICI2_ID,I.YONETICI2_ID) AS YONETICI2_ID,S.DEPARTMAN_ID  FROM PERSONEL_VERI P
	INNER JOIN SIRKET S ON S.ID=P.SIRKET_ID
	LEFT JOIN IKINCI_YONETICI I ON I.ID=P.ID
--	WHERE P.DURUM=1
)
 ,
VEKALET AS (
	SELECT DISTINCT  Y.PERSONEL_ID YENI_YONETICI,E.PERSONEL_ID  VEKALET_VEREN FROM VELAKET_YONETICI V
	INNER JOIN PDKSUSER Y ON Y.ID=V.YENI_YONETICI AND Y.DURUM=1
	INNER JOIN PDKSUSER E ON E.ID=V.VEKALET_VEREN AND E.DURUM=1
	 
	WHERE  CAST(CAST(GETDATE() AS DATE) AS DATETIME) BETWEEN V.BASLANGIC_TARIHI AND V.BITIS_TARIHI AND V.DURUM=1

),
ONAYLANACAK_IZINLER AS (
	SELECT D.YONETICI_ID, I.ID AS PERSONEL_IZIN_ID,I.PERSONEL_ID,D.PDKS_SICIL_NO,D.AD+' '+D.SOYAD AS PERSONEL,I.IZIN_DURUMU,
			I.BASLANGIC_ZAMANI,I.BITIS_ZAMANI,I.IZIN_SURESI,D.DEPARTMAN_ID,I.OLUSTURANUSER_ID,
			I.GUNCELLEMETARIHI,I.OLUSTURMATARIHI,I.GUNCELLEYENUSER_ID FROM PERSONELIZIN I
	INNER JOIN PER_DATALAR D ON D.ID=I.PERSONEL_ID
	INNER JOIN IZINTIPI T ON T.ID=I.IZIN_TIPI_ID AND T.BAKIYE_IZIN_TIPI_ID IS NULL
	WHERE IZIN_DURUMU IN (1,2,3) and I.BITIS_ZAMANI>=I.BASLANGIC_ZAMANI
 
)

 
,
IK_KULLANICI AS (
	SELECT U.*,D.ADMIN_DURUM 	  FROM USERROLES R
	  INNER JOIN PDKSUSER U ON U.ID=R.userId AND U.DURUM=1
	   INNER JOIN Departman D ON D.ID=U.DEPARTMAN_ID
	  INNER JOIN PER_DATALAR P ON P.ID=U.PERSONEL_ID and P.DURUM=1
	  WHERE R.roleId=2
)

 
,
IZINLER AS (
	SELECT I.YONETICI_ID AS ONAY_YONETICI_ID, I.* FROM ONAYLANACAK_IZINLER I
	WHERE IZIN_DURUMU=1
	 
 	UNION ALL

	SELECT V.YENI_YONETICI AS ONAY_YONETICI_ID, I.* FROM ONAYLANACAK_IZINLER I
	INNER JOIN VEKALET V ON V.VEKALET_VEREN=I.YONETICI_ID
	WHERE IZIN_DURUMU=1
	 
 	UNION ALL

	SELECT D.YONETICI2_ID AS ONAY_YONETICI_ID ,I.* FROM ONAYLANACAK_IZINLER I
	INNER JOIN PER_DATALAR D ON D.ID=I.PERSONEL_ID
	WHERE IZIN_DURUMU=2
 	UNION ALL

	SELECT V.YENI_YONETICI AS ONAY_YONETICI_ID ,I.* FROM ONAYLANACAK_IZINLER I
	INNER JOIN PER_DATALAR D ON D.ID=I.PERSONEL_ID
	INNER JOIN VEKALET V ON V.VEKALET_VEREN=D.YONETICI2_ID
	WHERE IZIN_DURUMU=2
	UNION ALL

	SELECT D.PERSONEL_ID AS ONAY_YONETICI_ID ,I.* FROM ONAYLANACAK_IZINLER I
	INNER JOIN IK_KULLANICI D ON (D.DEPARTMAN_ID=I.DEPARTMAN_ID OR D.ADMIN_DURUM=1)

	WHERE IZIN_DURUMU NOT IN (1,2)
)
 
SELECT DISTINCT U.ID AS KULLANICI_ID,U.KULLANICI_ADI,COALESCE(P.DURUM,0)  * COALESCE(U.DURUM,0) AS KULLANICI_DURUM,  I.*,O.ID AS ONAY_ID FROM IZINLER I
	LEFT JOIN PERSONELIZINONAY O ON O.PERSONEL_IZIN_ID=I.PERSONEL_IZIN_ID AND  CAST(O.ONAYLAYAN_TIPI AS int)=I.IZIN_DURUMU
	LEFT JOIN PDKSUSER U ON U.PERSONEL_ID=I.ONAY_YONETICI_ID  
	LEFT JOIN PER_DATALAR P ON P.ID=I.ONAY_YONETICI_ID  
	WHERE O.ONAY_DURUM IS NULL OR O.ONAY_DURUM=1
GO
/****** Object:  View [dbo].[ONAYLANMAYAN_PERSONEL_DENKLESTIRME]    Script Date: 20.12.2023 17:26:31 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO

CREATE VIEW [dbo].[ONAYLANMAYAN_PERSONEL_DENKLESTIRME] AS

WITH VERILER AS (
SELECT  ID  AS DONEM_ID      ,[DURUM] AS DURUM ,[AY]      ,[YIL]
      ,CAST(rtrim(YIL *10000+ AY *100+ 1)  AS DATETIME) AS BAS_TAR
      ,DATEADD(DAY,-1, DATEADD(month,1 ,CAST(rtrim(YIL *10000+ AY *100+ 1)  AS DATETIME))) AS BIT_TAR
     ,[SURE]
      ,[SUT_IZNI_SURE]
  FROM  DENKLESTIRMEAY WITH (nolock)
 WHERE  (YIL*100+AY)<=(YEAR(GETDATE())*100+MONTH(GETDATE())) AND YIL>2015
)
select   V.YIL,V.AY,P.PDKS_SICIL_NO,P.AD+' '+P.SOYAD AS PERSONEL,
 P.ID    PERSONEL_ID, P.YONETICI_ID   , P.EK_SAHA3_ID AS BOLUM_ID,  V.DONEM_ID , 
 
PD.ID AS DENKLESTIRME_ID,COALESCE(PD.ID,-(CAST(P.PDKS_SICIL_NO AS NUMERIC(19,0))*V.DONEM_ID)) AS ID 

 FROM VERILER  V 
 INNER JOIN PERSONEL P ON p.ISE_BASLAMA_TARIHI<=v.BIT_TAR AND P.ISTEN_AYRILIS_TARIHI>=V.BAS_TAR AND P.DURUM=1
 LEFT JOIN PERSONELDENKLESTIRME PD ON PD.PERSONEL_ID=P.ID AND PD.DONEM_ID=V.DONEM_ID
 AND PD.DENKLESTIRME_DURUM=1  AND ( PD.ONAYLANDI=0 OR PD.DURUM=0)
 WHERE P.PDKS_SICIL_NO<>'' AND P.YONETICI_ID IS NOT NULL AND ( PD.ID is NOT NULL  OR (V.DURUM=0 AND P.PDKS=1) )
GO
/****** Object:  View [dbo].[PDKS_LOG_EKSIK_VIEW]    Script Date: 20.12.2023 17:26:31 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO

CREATE VIEW [dbo].[PDKS_LOG_EKSIK_VIEW] AS
SELECT  [TransactionId] ,[Tarih] ,[PersonelId]    ,[TerminalId]*10+[Yon] [TerminalId] FROM [WebPDKS].[dbo].[PersonelTransaction] T
LEFT JOIN  [dbo].[PDKS_LOG] L ON L.KGS_ID=T.TransactionId
	WHERE [TerminalId]>0 AND PersonelId>0 AND Aktif=0 AND L.ID IS NULL
GO
/****** Object:  View [dbo].[PERSONEL_EK_SAHA_BOSTA_VIEW]    Script Date: 20.12.2023 17:26:31 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
 

CREATE VIEW [dbo].[PERSONEL_EK_SAHA_BOSTA_VIEW] AS
select T.* from TANIM H WITH(nolock)
INNER JOIN TANIM T ON T.TIPI='PERSONEL_EK_SAHA_ACIKLAMA' AND T.PARENTTANIM_ID=H.ID   
WHERE H.TIPI='PERSONEL_EK_SAHA' AND H.KODU='ekSaha4'  AND T.ID NOT IN ( select  EK_SAHA4_ID from PERSONEL WHERE EK_SAHA4_ID>0 )   
UNION ALL
select T.* from TANIM H WITH(nolock)
INNER JOIN TANIM T ON T.TIPI='PERSONEL_EK_SAHA_ACIKLAMA' AND T.PARENTTANIM_ID=H.ID   
WHERE H.TIPI='PERSONEL_EK_SAHA' AND H.KODU='ekSaha3'  AND T.ID NOT IN ( select  EK_SAHA3_ID from PERSONEL WHERE EK_SAHA3_ID>0 )   
UNION ALL
select T.* from TANIM H WITH(nolock)
INNER JOIN TANIM T ON T.TIPI='PERSONEL_EK_SAHA_ACIKLAMA' AND T.PARENTTANIM_ID=H.ID   
WHERE H.TIPI='PERSONEL_EK_SAHA' AND H.KODU='ekSaha2'  AND T.ID NOT IN ( select  EK_SAHA2_ID from PERSONEL WHERE EK_SAHA2_ID>0 )   
UNION ALL
select T.* from TANIM H WITH(nolock)
INNER JOIN TANIM T ON T.TIPI='PERSONEL_EK_SAHA_ACIKLAMA' AND T.PARENTTANIM_ID=H.ID   
WHERE H.TIPI='PERSONEL_EK_SAHA' AND H.KODU='ekSaha1'  AND T.ID NOT IN ( select  EK_SAHA1_ID from PERSONEL WHERE EK_SAHA1_ID>0 )   
UNION ALL
SELECT * FROM TANIM WITH(nolock) 
WHERE TIPI='GOREV_TIPI' AND ID NOT IN (SELECT GOREV_TIPI_ID FROM PERSONEL WHERE GOREV_TIPI_ID IS NOT NULL)
GO
/****** Object:  View [dbo].[PERSONEL_IZIN_IK_ONAYLANMAMIS_VIEW]    Script Date: 20.12.2023 17:26:31 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
 CREATE VIEW [dbo].[PERSONEL_IZIN_IK_ONAYLANMAMIS_VIEW] AS
SELECT O.ID AS ONAY_ID, S.DEPARTMAN_ID,I.BASLANGIC_ZAMANI,I.BITIS_ZAMANI,I.ID AS ID,
CASE WHEN O.ID IS NULL THEN I.ID ELSE NULL END AS PERSONEL_IZIN_ID from   PERSONELIZIN  I  WITH(nolock)
INNER JOIN dbo.PERSONEL P ON P.ID=I.PERSONEL_ID
INNER JOIN dbo.SIRKET S ON S.ID=p.SIRKET_ID 
LEFT JOIN dbo.PERSONELIZINONAY O ON O.PERSONEL_IZIN_ID=I.ID AND O.ONAYLAYAN_TIPI='3'
WHERE I.IZIN_DURUMU=3 AND (O.ID IS NULL OR O.ONAY_DURUM=1)
GO
/****** Object:  View [dbo].[PERSONEL_OZET_VIEW]    Script Date: 20.12.2023 17:26:31 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE VIEW [dbo].[PERSONEL_OZET_VIEW] AS
SELECT PDKS_SICIL_NO,ID AS PERSONE_ID,  AD + ' '+ SOYAD AS AD_SOYAD, DURUM,ISTEN_AYRILIS_TARIHI FROM PERSONEL
GO
/****** Object:  View [dbo].[PERSONEL_VIEW]    Script Date: 20.12.2023 17:26:31 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE VIEW [dbo].[PERSONEL_VIEW] AS
SELECT   A.ID as ID,  A.ID  as PERSONEL ,A.AD,A.SOYAD
      ,A.PDKS_SICIL_NO
      ,U.ID AS KULLANICI
        ,A.DURUM as DURUM
      
  FROM  PERSONEL A
  LEFT JOIN PDKSUSER U on U.PERSONEL_ID=A.ID
GO
/****** Object:  View [dbo].[PERSONELIZIN_BOZUK]    Script Date: 20.12.2023 17:26:31 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
 

CREATE VIEW [dbo].[PERSONELIZIN_BOZUK] AS
SELECT I.* FROM PERSONELIZIN I WITH(nolock)
INNER JOIN  IZINTIPI T ON T.BAKIYE_IZIN_TIPI_ID=I.IZIN_TIPI_ID  
LEFT JOIN PERSONELIZINDETAY D ON D.IZIN_ID=I.ID
WHERE I.IZIN_DURUMU NOT IN (8,9) AND I.IZIN_SURESI<>0 and D.HAKEDIS_IZIN_ID is NULL AND I.HESAP_TIPI IS NOT NULL
GO
/****** Object:  View [dbo].[TABLE_COLUMNS_VIEW]    Script Date: 20.12.2023 17:26:31 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
 

  
CREATE VIEW [dbo].[TABLE_COLUMNS_VIEW] AS
WITH COLUMS AS (
select schema_name(tab.schema_id) as SCHEMA_ADI,
    tab.name  TABLE_ADI, 
    col.column_id AS ID,
    col.name as COLUMN_ADI, 
    t.name as TYPE,    
    col.max_length UZUNLUK,
    col.precision DECIMAL_UZUNLUK
from sys.tables   tab
    inner join sys.columns as col
        on tab.object_id = col.object_id
    left join sys.types as t
    on col.user_type_id = t.user_type_id
 )
 SELECT * FROM COLUMS
GO
/****** Object:  View [dbo].[TABLE_CONSTRAINT_VIEW]    Script Date: 20.12.2023 17:26:31 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO

CREATE VIEW [dbo].[TABLE_CONSTRAINT_VIEW] AS
select	t.name TABLE_NAME, c.name COLUMN_NAME, d.name CONSTRAINT_NAME
from	sys.default_constraints d join	sys.tables t
on	t.object_id = d.parent_object_id
join	sys.columns c on	c.object_id = t.object_id  and	c.column_id = d.parent_column_id
GO
/****** Object:  View [dbo].[TABLE_DEFINITION_VIEW]    Script Date: 20.12.2023 17:26:31 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE VIEW [dbo].[TABLE_DEFINITION_VIEW] AS
SELECT  o.name VIEW_NAME,    referenced_entity_name AS TABLE_NAME, SV.VIEW_DEFINITION 
FROM sys.sql_expression_dependencies sed 
INNER JOIN sys.views o ON sed.referencing_id = o.object_id AND  o.type_desc='VIEW'
INNER JOIN INFORMATION_SCHEMA.VIEWS SV ON SV.TABLE_NAME=O.name
LEFT OUTER JOIN sys.views so1 ON sed.referenced_id =so1.object_id 
   
GO
/****** Object:  View [dbo].[TERMINAL_SIRKET_VIEW]    Script Date: 20.12.2023 17:26:31 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
 
CREATE VIEW [dbo].[TERMINAL_SIRKET_VIEW] AS

WITH  KAPILAR AS (
SELECT V.*,UPPER(CASE WHEN V.Yon<>0 THEN [Aciklama]  ELSE REPLACE(REPLACE(Aciklama,'GIRIS',''),'CIKIS','') END) TERMINAL_ADI,1 KGS_SIRKET_ID FROM   [WebPDKS].[dbo].[Terminal] V  WITH(nolock)
WHERE Tip=0 AND Gecerli=1

),
VERI AS (
  SELECT [TerminalId] as TERMINAL_ID,[TerminalId] as TERMINAL_NO,  [TerminalId]*10+1 AS ID     ,TERMINAL_ADI + ' GİRİŞ' ACIKLAMA,1 YON,Gecerli AS DURUM,KGS_SIRKET_ID  FROM KAPILAR
  WHERE Yon=0
  UNION ALL
    SELECT [TerminalId] as TERMINAL_ID, [TerminalId] as TERMINAL_NO, [TerminalId]*10+2 AS ID     ,TERMINAL_ADI + ' ÇIKIŞ' ACIKLAMA,2 YON,Gecerli AS DURUM,KGS_SIRKET_ID  FROM KAPILAR
  WHERE Yon=0
 UNION ALL
      SELECT [TerminalId] as TERMINAL_ID,NULL TERMINAL_NO, [TerminalId]*10+Yon AS ID     ,TERMINAL_ADI  ACIKLAMA,Yon YON,Gecerli AS DURUM,T.KGS_SIRKET_ID  FROM KAPILAR t
	 
	  LEFT JOIN KAPI_SIRKET_KGS K ON K.KGS_ID=[TerminalId]*10+Yon  AND K.KGS_SIRKET_ID=T.KGS_SIRKET_ID
	  WHERE Yon<>0
  )
  SELECT V.* ,0 KAPI_DEGISTIR FROM VERI AS V  WITH(nolock)
GO
/****** Object:  View [dbo].[VARDIYA_GUN_SAAT_VIEW]    Script Date: 20.12.2023 17:26:31 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO

CREATE VIEW [dbo].[VARDIYA_GUN_SAAT_VIEW] AS

SELECT G.ID AS VARDIYA_GUN_ID ,CASE WHEN VARDIYA_SAAT_ID IS NOT  NULL THEN G.DURUM ELSE 0 END DURUM ,VARDIYA_TARIHI ,PERSONEL_ID ,P.PDKS_SICIL_NO ,P.AD+' '+P.SOYAD AS PER_AD_SOYAD ,
	VARDIYA_ID ,V.ADI ,V.KISA_ADI ,VARDIYA_SAAT_ID ,COALESCE( NORMAL_SURE,0) NORMAL_SURE,
	COALESCE(CALISMA_SURESI,0) CALISMA_SURESI ,COALESCE(AKSAM_VARDIYA_SURESI,0) AKSAM_VARDIYA_SURESI,
	COALESCE(RESMI_TATIL_SURESI,0) RESMI_TATIL_SURESI ,
	GUNCELLEME_TARIHI FROM VARDIYA_GUN G
  INNER JOIN PERSONEL P ON  P.ID=G.PERSONEL_ID AND P.GRUBA_GIRIS_TARIHI<=VARDIYA_TARIHI AND P.ISTEN_AYRILIS_TARIHI>=VARDIYA_TARIHI
  INNER JOIN VARDIYA V ON V.ID=G.VARDIYA_ID
  LEFT JOIN VARDIYA_SAAT S ON S.ID=G.VARDIYA_SAAT_ID
GO
/****** Object:  View [dbo].[VARDIYA_GUN_VIEW]    Script Date: 20.12.2023 17:26:31 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE VIEW [dbo].[VARDIYA_GUN_VIEW] AS
SELECT V.ID AS ID, V.ID AS VARDIYA_GUN_ID,[VARDIYA_TARIHI]  ,[PERSONEL_ID]     ,G.ID as VARDIYA_GOREV_ID
  FROM VARDIYA_GUN v WITH (nolock)
  LEFT JOIN VARDIYA_GOREV G ON G.VARDIYA_GUN_ID=V.ID
GO
/****** Object:  View [dbo].[VIEW_CIKIS_YAPILMAYAN_PERSONELLER]    Script Date: 20.12.2023 17:26:31 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
 
  CREATE VIEW [dbo].[VIEW_CIKIS_YAPILMAYAN_PERSONELLER] AS
    WITH DATA_PER AS (
select P.ID AS PERSONEL_ID, S.AD AS SIRKET,T.ACIKLAMATR AS TESIS, P.AD_SOYAD,P.PDKS_SICIL_NO AS SICIL_NO,P.ISE_BASLAMA_TARIHI, K.ID from PERSONEL P  WITH(nolock)
INNER JOIN SIRKET S ON S.ID=P.SIRKET_ID
INNER JOIN TANIM T ON T.ID=P.TESIS_ID
INNER JOIN PERSONEL_SIRKET_KGS K ON K.ID=P.KGS_PERSONEL_ID AND K.DURUM=0
WHERE P.SSK_CIKIS_TARIHI>GETDATE() AND P.DURUM=1
), KART AS (
SELECT P.ID AS USERID,MAX(L.HAREKET_ZAMANI) ZAMAN FROM DATA_PER P
LEFT JOIN PDKS_LOG L ON L.USERID=P.ID AND L.DURUM=1
 GROUP BY P.ID
 ),
 SONUC AS (
 SELECT PERSONEL_ID,SIRKET,TESIS,AD_SOYAD,SICIL_NO,ISE_BASLAMA_TARIHI, CAST( COALESCE(ZAMAN,ISE_BASLAMA_TARIHI) AS date) AS CIKIS,  COALESCE(ZAMAN,ISE_BASLAMA_TARIHI)   AS SON_KART_ZAMANI FROM DATA_PER D
 INNER JOIN KART K ON K.USERID=D.ID
 )
 SELECT * FROM SONUC
 WHERE CIKIS<GETDATE()
 
GO
/****** Object:  View [dbo].[VIEW_GET_YONETICI_KONTRATLI_LIST]    Script Date: 20.12.2023 17:26:31 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
 
CREATE VIEW [dbo].[VIEW_GET_YONETICI_KONTRATLI_LIST] AS
  
 
WITH YONETICILER AS (

  SELECT  P.* FROM  ROLE R  WITH(nolock)
	  INNER JOIN USERROLES UR ON UR.ROLEID=R.ID
	  INNER JOIN PDKSUSER U ON U.ID=UR.USERID AND U.DURUM=1
	  INNER JOIN PERSONEL P ON P.ID=U.PERSONEL_ID  
	  LEFT JOIN TANIM  T ON T.ID=P.GOREV_TIPI_ID AND T.DURUM=1 AND T.KODU NOT IN ('01','')
	  WHERE  R.DEPARTMAN_ID<>1 AND R.STATUS=1 AND T.ID IS NOT NULL 

  UNION ALL

  SELECT P.* FROM  ROLE R  WITH(nolock)
	   INNER JOIN USERROLES UR ON UR.ROLEID=R.ID
	   INNER JOIN PDKSUSER U ON U.ID=UR.USERID AND U.DURUM=1
	   INNER JOIN PERSONEL P ON P.ID=U.PERSONEL_ID 
   WHERE R.STATUS=1 AND  R.ROLENAME in ('yoneticiKontratli' ,'kontratliAdmin')   

  )

  SELECT DISTINCT P.* FROM YONETICILER P  WITH(nolock)
	 WHERE P.DURUM=1 AND P.SSK_CIKIS_TARIHI>=CAST(GETDATE() AS date)

		 
GO
/****** Object:  View [dbo].[VIEW_GET_YONETICI_LIST]    Script Date: 20.12.2023 17:26:31 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
 CREATE VIEW [dbo].[VIEW_GET_YONETICI_LIST] AS
 
 WITH GELEN AS (  
		 SELECT CAST(GETDATE()  AS date) AS P_TARIH
		 ) , VERILER AS (  
			  SELECT  P.* FROM PERSONEL P WITH(nolock)  
				  INNER JOIN SIRKET S ON S.ID=P.SIRKET_ID AND S.DURUM=1 AND S.FAZLA_MESAI=1 
				  INNER JOIN PDKSUSER U ON U.PERSONEL_ID=P.ID AND U.DURUM=1  
				  INNER JOIN USERROLES UR ON UR.USERID=U.ID  
				  INNER JOIN ROLE R ON R.ID=UR.ROLEID AND R.ROLENAME IN ('yonetici','yoneticiKontratli')  
				  AND R.STATUS=1  
			  UNION ALL 
			  SELECT  P.* FROM PERSONEL P WITH(nolock)  
				  INNER JOIN PARAMETRE P1 ON P1.ADI='personelERPOku' AND P1.DURUM=1 AND P1.DEGER='M'
				  INNER JOIN SIRKET S ON S.ID=P.SIRKET_ID AND S.DURUM=1 AND S.FAZLA_MESAI=1 
				  INNER JOIN TANIM G ON G.ID=P.GOREV_TIPI_ID AND  G.KODU LIKE 'Y%' AND G.DURUM=1
 		   ) 
		  SELECT DISTINCT  P.* FROM VERILER P ,GELEN G 
		  WHERE P.DURUM=1 AND    P.ISE_BASLAMA_TARIHI<=G.P_TARIH AND  P.SSK_CIKIS_TARIHI>=G.P_TARIH

GO
/****** Object:  View [dbo].[VIEW_KAPI_SIRKET]    Script Date: 20.12.2023 17:26:31 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO

CREATE  VIEW [dbo].[VIEW_KAPI_SIRKET]
AS
SELECT     K.ID, A.ID AS KAPI,K.KGS_SIRKET_ID,K.KGS_ID, K.ACIKLAMA AS ACIKLAMA_KGS, COALESCE (A.ACIKLAMA, '') AS ACIKLAMA, K.DURUM,K.TERMINAL_NO,K.KART_YONU
FROM         dbo.KAPI_SIRKET_KGS AS K WITH (nolock) 
	LEFT JOIN   KAPI AS A ON K.ID = A.KGS_ID
GO
/****** Object:  View [dbo].[VIEW_PERSONEL_SIRKET]    Script Date: 20.12.2023 17:26:31 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE  VIEW [dbo].[VIEW_PERSONEL_SIRKET]
AS
SELECT K.ID, K.ID AS KGS_PERSONEL, A.ID AS PERSONEL,K.KGS_SIRKET_ID,K.KGS_ID ,a.SIRKET_ID,U.ID AS KULLANICI, K.DURUM, K.AD + ' ' + K.SOYAD AS ACIKLAMA,
K.PERSONEL_NO,K.KART_NO, COALESCE(A.AD,K.AD) AD,COALESCE(A.SOYAD,K.SOYAD) SOYAD,a.DURUM AS PDURUM ,
A.ONAYSIZ_IZIN_KULLANIR,a.IZIN_HAKEDIS_TARIHI,a.SUA_OLABILIR FROM   PERSONEL_SIRKET_KGS K WITH (nolock)
LEFT OUTER JOIN   dbo.PERSONEL AS A ON K.ID = A.KGS_PERSONEL_ID
LEFT OUTER JOIN   dbo.PDKSUSER AS U ON A.ID = U.PERSONEL_ID
GO
/****** Object:  View [dbo].[VIEW_USER_MENUITEM_LIST]    Script Date: 20.12.2023 17:26:31 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
 

CREATE VIEW [dbo].[VIEW_USER_MENUITEM_LIST] AS 
  
    SELECT I.[ID],P.AD+' '+P.SOYAD AS 'ADI SOYADI',K.KULLANICI_ADI, V.ACIKLAMATR AS 'MENU ADI'
           ,[LAST_TIME]      ,LAST_PARAMETRE ,[USE_COUNT]   ,[FIRST_TIME],G.NAME,K.PER_NO
  FROM [dbo].[USER_MENUITEM_TIME] I  WITH(nolock)
  INNER JOIN PDKSUSER K ON K.ID=I.[USER_ID]
  INNER JOIN PERSONEL P ON P.ID=K.PERSONEL_ID

  INNER JOIN MENUITEM G ON G.ID=I.MENU_ID
  INNER JOIN TANIM V ON V.ID=G.DESCRIPTION_ID
GO
/****** Object:  View [dbo].[YILBASI_SENELIK_IZIN_VIEW]    Script Date: 20.12.2023 17:26:31 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
 
CREATE VIEW [dbo].[YILBASI_SENELIK_IZIN_VIEW] AS
SELECT YEAR(I.BASLANGIC_ZAMANI) AS DONEM,I.ID AS IZIN_ID, S.AD AS SIRKET,P.PDKS_SICIL_NO AS PER_NO,P.AD+' '+P.SOYAD AS AD_SOYAD,
B.ACIKLAMATR AS BOLUM, I.BASLANGIC_ZAMANI,I.BITIS_ZAMANI,I.IZIN_SURESI ,T.ACIKLAMATR  IZIN_TURU,I.IZIN_DURUMU   FROM PERSONELIZIN I   WITH(nolock)
INNER JOIN IZINTIPI IT ON IT.ID=I.IZIN_TIPI_ID AND IT.BAKIYE_IZIN_TIPI_ID IS NULL
INNER JOIN TANIM T ON T.ID=IT.IZIN_TIPI_ID AND T.kodu IN ('ŞUAx','90')
INNER JOIN PERSONEL P ON P.ID=I.PERSONEL_ID
INNER JOIN TANIM B ON B.ID=P.EK_SAHA3_ID
INNER JOIN SIRKET S ON S.ID=P.SIRKET_ID
  where   YEAR(I.BITIS_ZAMANI)> YEAR(I.BASLANGIC_ZAMANI) AND I.IZIN_SURESI>1.2
  AND ( MONTH(I.BITIS_ZAMANI)*100+ DAY (I.BITIS_ZAMANI)  )>102   AND [IZIN_DURUMU] NOT  IN (8,9) 

GO
/****** Object:  View [dbo].[YONETICI_KONTRATLI_VIEW]    Script Date: 20.12.2023 17:26:31 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
 
CREATE VIEW [dbo].[YONETICI_KONTRATLI_VIEW] AS
SELECT DISTINCT P.*   FROM  [dbo].[Role] R  WITH(nolock)
  INNER JOIN [dbo].[UserRoles] UR ON UR.roleId=R.ID
  INNER JOIN [dbo].[PDKSUSER] U ON U.ID=UR.userId AND U.DURUM=1
  INNER JOIN [dbo].[PERSONEL] P ON P.ID=U.PERSONEL_ID AND P.DURUM=1 AND P.ISTEN_AYRILIS_TARIHI>GETDATE()
  LEFT JOIN [dbo].[TANIM] T ON T.ID=P.GOREV_TIPI_ID AND T.DURUM=1 AND T.KODU NOT IN ('01','')
  WHERE (R.DEPARTMAN_ID<>1 OR R.rolename='yoneticiKontratli' ) and R.status=1 AND (U.DEPARTMAN_ID=1 OR T.ID IS NOT NULL)
GO
/****** Object:  Index [ARIFE_VARDIYA_IND]    Script Date: 20.12.2023 17:26:31 ******/
CREATE NONCLUSTERED INDEX [ARIFE_VARDIYA_IND] ON [dbo].[ARIFE_VARDIYA_DONEM]
(
	[BAS_TARIHI] ASC,
	[BIT_TARIHI] ASC,
	[VARDIYA_ID] ASC,
	[DURUM] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, SORT_IN_TEMPDB = OFF, DROP_EXISTING = OFF, ONLINE = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
GO
/****** Object:  Index [BOLUM_KAT_IND]    Script Date: 20.12.2023 17:26:31 ******/
CREATE NONCLUSTERED INDEX [BOLUM_KAT_IND] ON [dbo].[BOLUM_KAT]
(
	[KAT_ID] ASC,
	[DURUM] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, SORT_IN_TEMPDB = OFF, DROP_EXISTING = OFF, ONLINE = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
GO
/****** Object:  Index [FAZLA_MESAI_VARDIYA_IND]    Script Date: 20.12.2023 17:26:31 ******/
CREATE NONCLUSTERED INDEX [FAZLA_MESAI_VARDIYA_IND] ON [dbo].[FAZLA_MESAI_TALEP]
(
	[VARDIYA_GUN_ID] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, SORT_IN_TEMPDB = OFF, DROP_EXISTING = OFF, ONLINE = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
GO
/****** Object:  Index [I_FAZLA_MESAI_TALEP_TARIH]    Script Date: 20.12.2023 17:26:31 ******/
CREATE NONCLUSTERED INDEX [I_FAZLA_MESAI_TALEP_TARIH] ON [dbo].[FAZLA_MESAI_TALEP]
(
	[BASLANGIC_ZAMANI] ASC,
	[BITIS_ZAMANI] ASC,
	[ONAY_DURUMU] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, SORT_IN_TEMPDB = OFF, DROP_EXISTING = OFF, ONLINE = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
GO
/****** Object:  Index [IZINHAKEDISHAKKI_UI]    Script Date: 20.12.2023 17:26:31 ******/
CREATE UNIQUE NONCLUSTERED INDEX [IZINHAKEDISHAKKI_UI] ON [dbo].[IZINHAKEDISHAKKI]
(
	[DEPARTMAN] ASC,
	[SUA_DURUM] ASC,
	[YAS_TIPI] ASC,
	[KIDEMYILI] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, SORT_IN_TEMPDB = OFF, IGNORE_DUP_KEY = OFF, DROP_EXISTING = OFF, ONLINE = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
GO
/****** Object:  Index [BAKIYE_IZIN_TIPI]    Script Date: 20.12.2023 17:26:31 ******/
CREATE NONCLUSTERED INDEX [BAKIYE_IZIN_TIPI] ON [dbo].[IZINTIPI]
(
	[BAKIYE_IZIN_TIPI_ID] ASC,
	[DEPARTMAN_ID] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, SORT_IN_TEMPDB = OFF, DROP_EXISTING = OFF, ONLINE = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
GO
/****** Object:  Index [DEPARTMAN]    Script Date: 20.12.2023 17:26:31 ******/
CREATE NONCLUSTERED INDEX [DEPARTMAN] ON [dbo].[IZINTIPI]
(
	[DEPARTMAN_ID] ASC,
	[DURUM] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, SORT_IN_TEMPDB = OFF, DROP_EXISTING = OFF, ONLINE = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
GO
/****** Object:  Index [IZIN_TIPI]    Script Date: 20.12.2023 17:26:31 ******/
CREATE NONCLUSTERED INDEX [IZIN_TIPI] ON [dbo].[IZINTIPI]
(
	[IZIN_TIPI_ID] ASC,
	[DEPARTMAN_ID] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, SORT_IN_TEMPDB = OFF, DROP_EXISTING = OFF, ONLINE = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
GO
/****** Object:  Index [KARADAG]    Script Date: 20.12.2023 17:26:31 ******/
CREATE UNIQUE NONCLUSTERED INDEX [KARADAG] ON [dbo].[KAPI]
(
	[KGS_ID] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, SORT_IN_TEMPDB = OFF, IGNORE_DUP_KEY = OFF, DROP_EXISTING = OFF, ONLINE = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
GO
/****** Object:  Index [PKDS_DURUM]    Script Date: 20.12.2023 17:26:31 ******/
CREATE NONCLUSTERED INDEX [PKDS_DURUM] ON [dbo].[KAPI]
(
	[PDKS] ASC,
	[DURUM] ASC,
	[KAPI_TIPI_ID] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, SORT_IN_TEMPDB = OFF, DROP_EXISTING = OFF, ONLINE = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
GO
/****** Object:  Index [TIPI]    Script Date: 20.12.2023 17:26:31 ******/
CREATE NONCLUSTERED INDEX [TIPI] ON [dbo].[KAPI]
(
	[KAPI_TIPI_ID] ASC,
	[PDKS] ASC,
	[DURUM] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, SORT_IN_TEMPDB = OFF, DROP_EXISTING = OFF, ONLINE = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
GO
/****** Object:  Index [UI_KAPI_SIRKET_KGS]    Script Date: 20.12.2023 17:26:31 ******/
CREATE UNIQUE NONCLUSTERED INDEX [UI_KAPI_SIRKET_KGS] ON [dbo].[KAPI_SIRKET_KGS]
(
	[KGS_ID] ASC,
	[KGS_SIRKET_ID] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, SORT_IN_TEMPDB = OFF, IGNORE_DUP_KEY = OFF, DROP_EXISTING = OFF, ONLINE = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
GO
/****** Object:  Index [IND_KAT_SAYI]    Script Date: 20.12.2023 17:26:31 ******/
CREATE NONCLUSTERED INDEX [IND_KAT_SAYI] ON [dbo].[KAT_SAYI]
(
	[TIPI] ASC,
	[BAS_TARIH] ASC,
	[BIT_TARIH] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, SORT_IN_TEMPDB = OFF, DROP_EXISTING = OFF, ONLINE = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
GO
SET ANSI_PADDING ON
GO
/****** Object:  Index [NonClusteredIndex-20201013-180425]    Script Date: 20.12.2023 17:26:31 ******/
CREATE NONCLUSTERED INDEX [NonClusteredIndex-20201013-180425] ON [dbo].[NOTICE]
(
	[NAME] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, SORT_IN_TEMPDB = OFF, DROP_EXISTING = OFF, ONLINE = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
GO
SET ANSI_PADDING ON
GO
/****** Object:  Index [PARAMETER_NAME]    Script Date: 20.12.2023 17:26:31 ******/
CREATE UNIQUE NONCLUSTERED INDEX [PARAMETER_NAME] ON [dbo].[PARAMETRE]
(
	[ADI] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, SORT_IN_TEMPDB = OFF, IGNORE_DUP_KEY = OFF, DROP_EXISTING = OFF, ONLINE = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
GO
/****** Object:  Index [KARADAG_ID]    Script Date: 20.12.2023 17:26:31 ******/
CREATE NONCLUSTERED INDEX [KARADAG_ID] ON [dbo].[PDKS_HAREKET]
(
	[KGS_ID] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, SORT_IN_TEMPDB = OFF, DROP_EXISTING = OFF, ONLINE = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
GO
/****** Object:  Index [PERSONEL]    Script Date: 20.12.2023 17:26:31 ******/
CREATE NONCLUSTERED INDEX [PERSONEL] ON [dbo].[PDKS_HAREKET]
(
	[ZAMAN] ASC,
	[PERSONEL] ASC,
	[DURUM] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, SORT_IN_TEMPDB = OFF, DROP_EXISTING = OFF, ONLINE = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
GO
/****** Object:  Index [TARIH]    Script Date: 20.12.2023 17:26:31 ******/
CREATE NONCLUSTERED INDEX [TARIH] ON [dbo].[PDKS_HAREKET]
(
	[ZAMAN] ASC,
	[KAPI] ASC,
	[DURUM] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, SORT_IN_TEMPDB = OFF, DROP_EXISTING = OFF, ONLINE = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
GO
/****** Object:  Index [PK_ISLEM]    Script Date: 20.12.2023 17:26:31 ******/
CREATE UNIQUE NONCLUSTERED INDEX [PK_ISLEM] ON [dbo].[PDKS_ISLEM]
(
	[ID] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, SORT_IN_TEMPDB = OFF, IGNORE_DUP_KEY = OFF, DROP_EXISTING = OFF, ONLINE = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
GO
/****** Object:  Index [IND_PDKS_LOG_ISLEM]    Script Date: 20.12.2023 17:26:31 ******/
CREATE NONCLUSTERED INDEX [IND_PDKS_LOG_ISLEM] ON [dbo].[PDKS_LOG]
(
	[ISLEM_ID] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, SORT_IN_TEMPDB = OFF, DROP_EXISTING = OFF, ONLINE = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
GO
/****** Object:  Index [IND_PDKS_LOG_KGS]    Script Date: 20.12.2023 17:26:31 ******/
CREATE NONCLUSTERED INDEX [IND_PDKS_LOG_KGS] ON [dbo].[PDKS_LOG]
(
	[KGS_ID] ASC,
	[KGS_SIRKET_ID] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, SORT_IN_TEMPDB = OFF, DROP_EXISTING = OFF, ONLINE = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
GO
/****** Object:  Index [PDKS_LOG_KAPI]    Script Date: 20.12.2023 17:26:32 ******/
CREATE NONCLUSTERED INDEX [PDKS_LOG_KAPI] ON [dbo].[PDKS_LOG]
(
	[HAREKET_ZAMANI] ASC,
	[KGS_SIRKET_ID] ASC,
	[KAPIID] ASC,
	[USERID] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, SORT_IN_TEMPDB = OFF, DROP_EXISTING = OFF, ONLINE = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
GO
SET ANSI_PADDING ON
GO
/****** Object:  Index [KISA_KULLANICI]    Script Date: 20.12.2023 17:26:32 ******/
CREATE NONCLUSTERED INDEX [KISA_KULLANICI] ON [dbo].[PDKSUSER]
(
	[SHORT_USER_NAME] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, SORT_IN_TEMPDB = OFF, DROP_EXISTING = OFF, ONLINE = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
GO
SET ANSI_PADDING ON
GO
/****** Object:  Index [KULLANICI_EPOSTA]    Script Date: 20.12.2023 17:26:32 ******/
CREATE NONCLUSTERED INDEX [KULLANICI_EPOSTA] ON [dbo].[PDKSUSER]
(
	[EMAIL] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, SORT_IN_TEMPDB = OFF, DROP_EXISTING = OFF, ONLINE = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
GO
SET ANSI_PADDING ON
GO
/****** Object:  Index [KULLANICIADI]    Script Date: 20.12.2023 17:26:32 ******/
CREATE UNIQUE NONCLUSTERED INDEX [KULLANICIADI] ON [dbo].[PDKSUSER]
(
	[KULLANICI_ADI] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, SORT_IN_TEMPDB = OFF, IGNORE_DUP_KEY = OFF, DROP_EXISTING = OFF, ONLINE = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
GO
/****** Object:  Index [PERSONEL]    Script Date: 20.12.2023 17:26:32 ******/
CREATE NONCLUSTERED INDEX [PERSONEL] ON [dbo].[PDKSUSER]
(
	[PERSONEL_ID] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, SORT_IN_TEMPDB = OFF, DROP_EXISTING = OFF, ONLINE = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
GO
SET ANSI_PADDING ON
GO
/****** Object:  Index [UI_KULLANICI_ADI]    Script Date: 20.12.2023 17:26:32 ******/
CREATE UNIQUE NONCLUSTERED INDEX [UI_KULLANICI_ADI] ON [dbo].[PDKSUSER]
(
	[KULLANICI_ADI] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, SORT_IN_TEMPDB = OFF, IGNORE_DUP_KEY = OFF, DROP_EXISTING = OFF, ONLINE = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
GO
/****** Object:  Index [PERSONEL_DURUM]    Script Date: 20.12.2023 17:26:32 ******/
CREATE NONCLUSTERED INDEX [PERSONEL_DURUM] ON [dbo].[PERSONEL]
(
	[DURUM] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, SORT_IN_TEMPDB = OFF, DROP_EXISTING = OFF, ONLINE = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
GO
/****** Object:  Index [PERSONEL_KGS_UI]    Script Date: 20.12.2023 17:26:32 ******/
CREATE UNIQUE NONCLUSTERED INDEX [PERSONEL_KGS_UI] ON [dbo].[PERSONEL]
(
	[KGS_PERSONEL_ID] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, SORT_IN_TEMPDB = OFF, IGNORE_DUP_KEY = OFF, DROP_EXISTING = OFF, ONLINE = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
GO
SET ANSI_PADDING ON
GO
/****** Object:  Index [SICIL_NO]    Script Date: 20.12.2023 17:26:32 ******/
CREATE NONCLUSTERED INDEX [SICIL_NO] ON [dbo].[PERSONEL]
(
	[PDKS_SICIL_NO] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, SORT_IN_TEMPDB = OFF, DROP_EXISTING = OFF, ONLINE = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
GO
/****** Object:  Index [SIRKET]    Script Date: 20.12.2023 17:26:32 ******/
CREATE NONCLUSTERED INDEX [SIRKET] ON [dbo].[PERSONEL]
(
	[SIRKET_ID] ASC,
	[ISTEN_AYRILIS_TARIHI] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, SORT_IN_TEMPDB = OFF, DROP_EXISTING = OFF, ONLINE = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
GO
/****** Object:  Index [TARIH]    Script Date: 20.12.2023 17:26:32 ******/
CREATE NONCLUSTERED INDEX [TARIH] ON [dbo].[PERSONEL]
(
	[ISE_BASLAMA_TARIHI] ASC,
	[ISTEN_AYRILIS_TARIHI] ASC,
	[DURUM] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, SORT_IN_TEMPDB = OFF, DROP_EXISTING = OFF, ONLINE = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
GO
/****** Object:  Index [YONETICI]    Script Date: 20.12.2023 17:26:32 ******/
CREATE NONCLUSTERED INDEX [YONETICI] ON [dbo].[PERSONEL]
(
	[YONETICI_ID] ASC,
	[DURUM] ASC,
	[ISTEN_AYRILIS_TARIHI] ASC,
	[ISE_BASLAMA_TARIHI] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, SORT_IN_TEMPDB = OFF, DROP_EXISTING = OFF, ONLINE = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
GO
/****** Object:  Index [ROTASYON]    Script Date: 20.12.2023 17:26:32 ******/
CREATE NONCLUSTERED INDEX [ROTASYON] ON [dbo].[PERSONEL_GECICI_YONETICI]
(
	[BASLANGIC_TARIHI] ASC,
	[BITIS_TARIHI] ASC,
	[YENI_YONETICI] ASC,
	[DURUM] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, SORT_IN_TEMPDB = OFF, DROP_EXISTING = OFF, ONLINE = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
GO
/****** Object:  Index [VEKALET]    Script Date: 20.12.2023 17:26:32 ******/
CREATE NONCLUSTERED INDEX [VEKALET] ON [dbo].[PERSONEL_GECICI_YONETICI]
(
	[VEKALET_VEREN] ASC,
	[BASLANGIC_TARIHI] ASC,
	[BITIS_TARIHI] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, SORT_IN_TEMPDB = OFF, DROP_EXISTING = OFF, ONLINE = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
GO
/****** Object:  Index [UI_PERSONEL_SIRKET_KGS]    Script Date: 20.12.2023 17:26:32 ******/
CREATE UNIQUE NONCLUSTERED INDEX [UI_PERSONEL_SIRKET_KGS] ON [dbo].[PERSONEL_SIRKET_KGS]
(
	[KGS_ID] ASC,
	[KGS_SIRKET_ID] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, SORT_IN_TEMPDB = OFF, IGNORE_DUP_KEY = OFF, DROP_EXISTING = OFF, ONLINE = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
GO
SET ANSI_PADDING ON
GO
/****** Object:  Index [MESAI_HAREKET]    Script Date: 20.12.2023 17:26:32 ******/
CREATE NONCLUSTERED INDEX [MESAI_HAREKET] ON [dbo].[PERSONELFAZLAMESAI]
(
	[HAREKET_ID] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, SORT_IN_TEMPDB = OFF, DROP_EXISTING = OFF, ONLINE = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
GO
/****** Object:  Index [VARDIYA]    Script Date: 20.12.2023 17:26:32 ******/
CREATE NONCLUSTERED INDEX [VARDIYA] ON [dbo].[PERSONELFAZLAMESAI]
(
	[VARDIYA_GUN] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, SORT_IN_TEMPDB = OFF, DROP_EXISTING = OFF, ONLINE = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
GO
/****** Object:  Index [IZIN_PER_IND]    Script Date: 20.12.2023 17:26:32 ******/
CREATE NONCLUSTERED INDEX [IZIN_PER_IND] ON [dbo].[PERSONELIZIN]
(
	[PERSONEL_ID] ASC,
	[IZIN_TIPI_ID] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, SORT_IN_TEMPDB = OFF, DROP_EXISTING = OFF, ONLINE = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
GO
/****** Object:  Index [IZINTIPI]    Script Date: 20.12.2023 17:26:32 ******/
CREATE NONCLUSTERED INDEX [IZINTIPI] ON [dbo].[PERSONELIZIN]
(
	[BASLANGIC_ZAMANI] ASC,
	[BITIS_ZAMANI] ASC,
	[IZIN_TIPI_ID] ASC,
	[PERSONEL_ID] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, SORT_IN_TEMPDB = OFF, DROP_EXISTING = OFF, ONLINE = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
GO
/****** Object:  Index [PERSONEL]    Script Date: 20.12.2023 17:26:32 ******/
CREATE NONCLUSTERED INDEX [PERSONEL] ON [dbo].[PERSONELIZIN]
(
	[BASLANGIC_ZAMANI] ASC,
	[BITIS_ZAMANI] ASC,
	[PERSONEL_ID] ASC,
	[IZIN_TIPI_ID] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, SORT_IN_TEMPDB = OFF, DROP_EXISTING = OFF, ONLINE = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
GO
/****** Object:  Index [PERSONELIZIN]    Script Date: 20.12.2023 17:26:32 ******/
CREATE NONCLUSTERED INDEX [PERSONELIZIN] ON [dbo].[PERSONELIZIN]
(
	[PERSONEL_ID] ASC,
	[IZIN_TIPI_ID] ASC,
	[BASLANGIC_ZAMANI] ASC,
	[BITIS_ZAMANI] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, SORT_IN_TEMPDB = OFF, DROP_EXISTING = OFF, ONLINE = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
GO
/****** Object:  Index [TARIH]    Script Date: 20.12.2023 17:26:32 ******/
CREATE NONCLUSTERED INDEX [TARIH] ON [dbo].[PERSONELIZIN]
(
	[BASLANGIC_ZAMANI] ASC,
	[BITIS_ZAMANI] ASC,
	[PERSONEL_ID] ASC,
	[IZIN_DURUMU] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, SORT_IN_TEMPDB = OFF, DROP_EXISTING = OFF, ONLINE = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
GO
/****** Object:  Index [Hakedis]    Script Date: 20.12.2023 17:26:32 ******/
CREATE NONCLUSTERED INDEX [Hakedis] ON [dbo].[PERSONELIZINDETAY]
(
	[HAKEDIS_IZIN_ID] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, SORT_IN_TEMPDB = OFF, DROP_EXISTING = OFF, ONLINE = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
GO
/****** Object:  Index [IZIN_ONAY]    Script Date: 20.12.2023 17:26:32 ******/
CREATE NONCLUSTERED INDEX [IZIN_ONAY] ON [dbo].[PERSONELIZINONAY]
(
	[PERSONEL_IZIN_ID] ASC,
	[ONAY_DURUM] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, SORT_IN_TEMPDB = OFF, DROP_EXISTING = OFF, ONLINE = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
GO
/****** Object:  Index [YONETICI_ONAY]    Script Date: 20.12.2023 17:26:32 ******/
CREATE NONCLUSTERED INDEX [YONETICI_ONAY] ON [dbo].[PERSONELIZINONAY]
(
	[GUNCELLEYENUSER_ID] ASC,
	[ONAY_DURUM] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, SORT_IN_TEMPDB = OFF, DROP_EXISTING = OFF, ONLINE = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
GO
/****** Object:  Index [NonClusteredIndex-20151102-150103]    Script Date: 20.12.2023 17:26:32 ******/
CREATE NONCLUSTERED INDEX [NonClusteredIndex-20151102-150103] ON [dbo].[SAP_SERVER]
(
	[DURUM] ASC,
	[SUNUCUTIPI] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, SORT_IN_TEMPDB = OFF, DROP_EXISTING = OFF, ONLINE = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
GO
/****** Object:  Index [PdksDurum_Index]    Script Date: 20.12.2023 17:26:32 ******/
CREATE NONCLUSTERED INDEX [PdksDurum_Index] ON [dbo].[SIRKET]
(
	[PDKS_DURUM] ASC,
	[DURUM] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, SORT_IN_TEMPDB = OFF, DROP_EXISTING = OFF, ONLINE = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
GO
/****** Object:  Index [SapDurum_Index]    Script Date: 20.12.2023 17:26:32 ******/
CREATE NONCLUSTERED INDEX [SapDurum_Index] ON [dbo].[SIRKET]
(
	[ERP_DURUM] ASC,
	[DURUM] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, SORT_IN_TEMPDB = OFF, DROP_EXISTING = OFF, ONLINE = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
GO
/****** Object:  Index [SIRKET_DEPARTMAN]    Script Date: 20.12.2023 17:26:32 ******/
CREATE NONCLUSTERED INDEX [SIRKET_DEPARTMAN] ON [dbo].[SIRKET]
(
	[DEPARTMAN_ID] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, SORT_IN_TEMPDB = OFF, DROP_EXISTING = OFF, ONLINE = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
GO
SET ANSI_PADDING ON
GO
/****** Object:  Index [BAGLI_TANIM]    Script Date: 20.12.2023 17:26:32 ******/
CREATE NONCLUSTERED INDEX [BAGLI_TANIM] ON [dbo].[TANIM]
(
	[PARENTTANIM_ID] ASC,
	[TIPI] ASC,
	[DURUM] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, SORT_IN_TEMPDB = OFF, DROP_EXISTING = OFF, ONLINE = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
GO
SET ANSI_PADDING ON
GO
/****** Object:  Index [TANIM_TIPI]    Script Date: 20.12.2023 17:26:32 ******/
CREATE NONCLUSTERED INDEX [TANIM_TIPI] ON [dbo].[TANIM]
(
	[TIPI] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, SORT_IN_TEMPDB = OFF, DROP_EXISTING = OFF, ONLINE = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
GO
SET ANSI_PADDING ON
GO
/****** Object:  Index [TANIMKODU]    Script Date: 20.12.2023 17:26:32 ******/
CREATE NONCLUSTERED INDEX [TANIMKODU] ON [dbo].[TANIM]
(
	[KODU] ASC,
	[TIPI] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, SORT_IN_TEMPDB = OFF, DROP_EXISTING = OFF, ONLINE = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
GO
/****** Object:  Index [ROLE]    Script Date: 20.12.2023 17:26:32 ******/
CREATE NONCLUSTERED INDEX [ROLE] ON [dbo].[USERROLES]
(
	[ROLEID] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, SORT_IN_TEMPDB = OFF, DROP_EXISTING = OFF, ONLINE = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
GO
/****** Object:  Index [User]    Script Date: 20.12.2023 17:26:32 ******/
CREATE NONCLUSTERED INDEX [User] ON [dbo].[USERROLES]
(
	[USERID] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, SORT_IN_TEMPDB = OFF, DROP_EXISTING = OFF, ONLINE = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
GO
SET ANSI_PADDING ON
GO
/****** Object:  Index [VAR_TIPI]    Script Date: 20.12.2023 17:26:32 ******/
CREATE NONCLUSTERED INDEX [VAR_TIPI] ON [dbo].[VARDIYA]
(
	[VARDIYATIPI] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, SORT_IN_TEMPDB = OFF, DROP_EXISTING = OFF, ONLINE = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
GO
/****** Object:  Index [VARDIYA_CALISMA_GUN]    Script Date: 20.12.2023 17:26:32 ******/
CREATE NONCLUSTERED INDEX [VARDIYA_CALISMA_GUN] ON [dbo].[VARDIYA]
(
	[CALISMAGUN] ASC,
	[DURUM] ASC,
	[CALISMASAATI] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, SORT_IN_TEMPDB = OFF, DROP_EXISTING = OFF, ONLINE = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
GO
/****** Object:  Index [VARDIYA_CALISMA_SAAT]    Script Date: 20.12.2023 17:26:32 ******/
CREATE NONCLUSTERED INDEX [VARDIYA_CALISMA_SAAT] ON [dbo].[VARDIYA]
(
	[CALISMASAATI] ASC,
	[DURUM] ASC,
	[CALISMAGUN] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, SORT_IN_TEMPDB = OFF, DROP_EXISTING = OFF, ONLINE = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
GO
/****** Object:  Index [VARDIYA_DURUM]    Script Date: 20.12.2023 17:26:32 ******/
CREATE NONCLUSTERED INDEX [VARDIYA_DURUM] ON [dbo].[VARDIYA]
(
	[DURUM] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, SORT_IN_TEMPDB = OFF, DROP_EXISTING = OFF, ONLINE = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
GO
/****** Object:  Index [UI_PER_VARDIYA]    Script Date: 20.12.2023 17:26:32 ******/
CREATE UNIQUE NONCLUSTERED INDEX [UI_PER_VARDIYA] ON [dbo].[VARDIYA_GUN]
(
	[VARDIYA_TARIHI] ASC,
	[PERSONEL_ID] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, SORT_IN_TEMPDB = OFF, IGNORE_DUP_KEY = OFF, DROP_EXISTING = OFF, ONLINE = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
GO
/****** Object:  Index [VARDIYA_PER]    Script Date: 20.12.2023 17:26:32 ******/
CREATE UNIQUE NONCLUSTERED INDEX [VARDIYA_PER] ON [dbo].[VARDIYA_GUN]
(
	[VARDIYA_TARIHI] ASC,
	[PERSONEL_ID] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, SORT_IN_TEMPDB = OFF, IGNORE_DUP_KEY = OFF, DROP_EXISTING = OFF, ONLINE = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
GO
/****** Object:  Index [PERSONEL_VARDIYA]    Script Date: 20.12.2023 17:26:32 ******/
CREATE NONCLUSTERED INDEX [PERSONEL_VARDIYA] ON [dbo].[VARDIYAHAFTA]
(
	[BAS_TARIH] ASC,
	[BIT_TARIH] ASC,
	[PERSONEL_ID] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, SORT_IN_TEMPDB = OFF, DROP_EXISTING = OFF, ONLINE = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
GO
/****** Object:  Index [SABLON_DURUM]    Script Date: 20.12.2023 17:26:32 ******/
CREATE NONCLUSTERED INDEX [SABLON_DURUM] ON [dbo].[VARDIYASABLONU]
(
	[DURUM] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, SORT_IN_TEMPDB = OFF, DROP_EXISTING = OFF, ONLINE = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
GO
/****** Object:  Index [TARIH_VEKALET_VEREN]    Script Date: 20.12.2023 17:26:32 ******/
CREATE NONCLUSTERED INDEX [TARIH_VEKALET_VEREN] ON [dbo].[VELAKET_YONETICI]
(
	[BASLANGIC_TARIHI] ASC,
	[BITIS_TARIHI] ASC,
	[VEKALET_VEREN] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, SORT_IN_TEMPDB = OFF, DROP_EXISTING = OFF, ONLINE = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
GO
/****** Object:  Index [TARIH_YONETICI]    Script Date: 20.12.2023 17:26:32 ******/
CREATE NONCLUSTERED INDEX [TARIH_YONETICI] ON [dbo].[VELAKET_YONETICI]
(
	[BASLANGIC_TARIHI] ASC,
	[BITIS_TARIHI] ASC,
	[YENI_YONETICI] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, SORT_IN_TEMPDB = OFF, DROP_EXISTING = OFF, ONLINE = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
GO
ALTER TABLE [dbo].[ARIFE_VARDIYA_DONEM] ADD  DEFAULT ((0)) FOR [ARIFE_VARDIYA_HESAPLA]
GO
ALTER TABLE [dbo].[ARIFE_VARDIYA_DONEM] ADD  DEFAULT ((1)) FOR [DURUM]
GO
ALTER TABLE [dbo].[ARIFE_VARDIYA_DONEM] ADD  DEFAULT ((0)) FOR [VERSION]
GO
ALTER TABLE [dbo].[ARIFE_VARDIYA_DONEM] ADD  DEFAULT (getdate()) FOR [OLUSTURMATARIHI]
GO
ALTER TABLE [dbo].[ARIFE_VARDIYA_DONEM] ADD  DEFAULT ((0)) FOR [ARIFE_SONRA_CAL_VAR_DENK_YOK]
GO
ALTER TABLE [dbo].[CALISMA_MODELI] ADD  DEFAULT ((0)) FOR [HAFTA_ICI_SAAT]
GO
ALTER TABLE [dbo].[CALISMA_MODELI] ADD  DEFAULT ((0)) FOR [CUMARTESI_SAAT]
GO
ALTER TABLE [dbo].[CALISMA_MODELI] ADD  DEFAULT ((9)) FOR [IZIN_SAAT]
GO
ALTER TABLE [dbo].[CALISMA_MODELI] ADD  DEFAULT ((0)) FOR [TOPLAM_GUN_GUNCELLE]
GO
ALTER TABLE [dbo].[CALISMA_MODELI] ADD  DEFAULT ((0)) FOR [GECE_CALISMA_ODEME_VAR]
GO
ALTER TABLE [dbo].[CALISMA_MODELI] ADD  DEFAULT ((0)) FOR [NEGATIF_BAKIYE_SAAT]
GO
ALTER TABLE [dbo].[CALISMA_MODELI] ADD  DEFAULT ((0)) FOR [HAREKET_KAYDI_VARDIYA_BUL]
GO
ALTER TABLE [dbo].[CALISMA_MODELI] ADD  DEFAULT ((1)) FOR [MAAS_ODEME_TIPI]
GO
ALTER TABLE [dbo].[CALISMA_MODELI] ADD  DEFAULT ((1)) FOR [FAZLA_MESAI_VAR]
GO
ALTER TABLE [dbo].[CALISMA_MODELI] ADD  DEFAULT ((0)) FOR [ORTAK_VARDIYA]
GO
ALTER TABLE [dbo].[CALISMA_MODELI] ADD  DEFAULT ((0)) FOR [OTOMATIK_FAZLA_CALISMA_ONAYLANSIN]
GO
ALTER TABLE [dbo].[CALISMA_MODELI] ADD  DEFAULT ((1)) FOR [FAZLA_CALISMA_GORUNTULENSIN]
GO
ALTER TABLE [dbo].[CALISMA_MODELI] ADD  DEFAULT ((0)) FOR [ILK_PLAN_ONAYLI]
GO
ALTER TABLE [dbo].[CALISMA_MODELI_AY] ADD  DEFAULT ((0)) FOR [SUT_IZNI_SURE]
GO
ALTER TABLE [dbo].[CALISMA_MODELI_AY] ADD  DEFAULT ((0)) FOR [NEGATIF_BAKIYE_SAAT]
GO
ALTER TABLE [dbo].[CALISMA_MODELI_AY] ADD  DEFAULT ((0)) FOR [HAREKET_KAYDI_VARDIYA_BUL]
GO
ALTER TABLE [dbo].[CALISMA_MODELI_AY] ADD  DEFAULT ((0)) FOR [OTOMATIK_FAZLA_CALISMA_ONAYLANSIN]
GO
ALTER TABLE [dbo].[DENKLESTIRMEAY] ADD  CONSTRAINT [DF__Denkles__SURE__517594D8]  DEFAULT ((0)) FOR [SURE]
GO
ALTER TABLE [dbo].[DENKLESTIRMEAY] ADD  CONSTRAINT [DF__Denkle__SUT_I__67EEE5DC]  DEFAULT ((0)) FOR [SUT_IZNI_SURE]
GO
ALTER TABLE [dbo].[DENKLESTIRMEAY] ADD  DEFAULT ((1)) FOR [FAZLA_MESAI_ONAY_DURUM]
GO
ALTER TABLE [dbo].[DENKLESTIRMEAY] ADD  DEFAULT ((11.5)) FOR [GUN_MAX_CALISMA_SURESI]
GO
ALTER TABLE [dbo].[DENKLESTIRMEAY] ADD  DEFAULT ((0)) FOR [DENKLESTIRME_KESINTI_YAP]
GO
ALTER TABLE [dbo].[DEPARTMAN] ADD  DEFAULT ((1)) FOR [FAZLA_MESAI_TALEP_GIRILEBILIR]
GO
ALTER TABLE [dbo].[DEPARTMAN] ADD  DEFAULT ((0)) FOR [SIRKET_EKLENEBILIR]
GO
ALTER TABLE [dbo].[IZINHAKEDISHAKKI] ADD  DEFAULT ((0)) FOR [SUA_DURUM]
GO
ALTER TABLE [dbo].[IZINTIPI] ADD  DEFAULT ((0)) FOR [ARTIK_IZIN_GUN]
GO
ALTER TABLE [dbo].[IZINTIPI] ADD  DEFAULT ((1)) FOR [CGS_DURUMU]
GO
ALTER TABLE [dbo].[IZINTIPI] ADD  DEFAULT ((1)) FOR [GUN_SIGORTA_DAHIL]
GO
ALTER TABLE [dbo].[IZINTIPI] ADD  DEFAULT ((0)) FOR [HT_DAHIL]
GO
ALTER TABLE [dbo].[IZINTIPI] ADD  DEFAULT ((1)) FOR [UCRETLI]
GO
ALTER TABLE [dbo].[IZINTIPI] ADD  DEFAULT ((0)) FOR [CUMA_CUMARTESI_TEK_IZIN_SAY]
GO
ALTER TABLE [dbo].[KAPI_SIRKET] ADD  DEFAULT ('9999-12-31') FOR [BITIS_TARIHI]
GO
ALTER TABLE [dbo].[KAPI_SIRKET_KGS] ADD  DEFAULT (getdate()) FOR [ISLEM_ZAMAN]
GO
ALTER TABLE [dbo].[KAPI_SIRKET_KGS] ADD  DEFAULT ((0)) FOR [KAPI_DEGISTIR]
GO
ALTER TABLE [dbo].[KAT_SAYI] ADD  DEFAULT ((1)) FOR [DURUM]
GO
ALTER TABLE [dbo].[KGS_ISLEM] ADD  DEFAULT ((1)) FOR [VALID]
GO
ALTER TABLE [dbo].[KGS_ISLEM] ADD  DEFAULT (getdate()) FOR [OLUSTURMA_ZAMANI]
GO
ALTER TABLE [dbo].[PARAMETRE] ADD  DEFAULT ((0)) FOR [HDSK]
GO
ALTER TABLE [dbo].[PDKS_ISLEM] ADD  CONSTRAINT [DF_ABH_ISLEM_ONAY_DURUM]  DEFAULT ((0)) FOR [ONAY_DURUM]
GO
ALTER TABLE [dbo].[PDKS_LOG] ADD  CONSTRAINT [DF_ABH_LOG_DURUM]  DEFAULT ((1)) FOR [DURUM]
GO
ALTER TABLE [dbo].[PDKS_LOG] ADD  DEFAULT ((1)) FOR [KGS_SIRKET_ID]
GO
ALTER TABLE [dbo].[PDKS_SP_ISLEM] ADD  DEFAULT ((1)) FOR [KGS_SIRKET_ID]
GO
ALTER TABLE [dbo].[PDKS_SP_ISLEM] ADD  DEFAULT ((1)) FOR [VALID]
GO
ALTER TABLE [dbo].[PDKS_SP_ISLEM] ADD  DEFAULT (getdate()) FOR [OLUSTURMA_ZAMANI]
GO
ALTER TABLE [dbo].[PERS_DENK_BORDRO] ADD  DEFAULT ((0)) FOR [RESMI_TATIL_ADET]
GO
ALTER TABLE [dbo].[PERS_DENK_DINAMIK_ALAN] ADD  DEFAULT ((0)) FOR [VERSION]
GO
ALTER TABLE [dbo].[PERS_DENK_DINAMIK_ALAN] ADD  DEFAULT ((0)) FOR [ISLEM_DURUM]
GO
ALTER TABLE [dbo].[PERSONEL] ADD  CONSTRAINT [DF_PERSONEL_UST_YONETICIMI]  DEFAULT ((0)) FOR [UST_YONETICIMI]
GO
ALTER TABLE [dbo].[PERSONEL] ADD  CONSTRAINT [DF__PERSONEL__EGITIM__2CF2ADDF]  DEFAULT ((0)) FOR [EGITIM_DONEMI]
GO
ALTER TABLE [dbo].[PERSONEL] ADD  DEFAULT ((0)) FOR [SANAL_PERSONEL]
GO
ALTER TABLE [dbo].[PERSONEL] ADD  DEFAULT ((0)) FOR [FAZLA_MESAI_IZIN_KULLAN]
GO
ALTER TABLE [dbo].[PERSONEL_DINAMIK_ALAN] ADD  DEFAULT ((0)) FOR [VERSION]
GO
ALTER TABLE [dbo].[PERSONEL_ERP] ADD  DEFAULT ((1)) FOR [DURUM]
GO
ALTER TABLE [dbo].[PERSONEL_ERP] ADD  DEFAULT (getdate()) FOR [ISLEM_ZAMANI]
GO
ALTER TABLE [dbo].[PERSONEL_SIRKET_KGS] ADD  DEFAULT (getdate()) FOR [ISLEM_ZAMAN]
GO
ALTER TABLE [dbo].[PERSONELDENKLESTIRME] ADD  DEFAULT ((0)) FOR [ONAYLANDI]
GO
ALTER TABLE [dbo].[PERSONELDENKLESTIRME] ADD  DEFAULT ((0)) FOR [PLANLANAN_SURE]
GO
ALTER TABLE [dbo].[PERSONELDENKLESTIRME] ADD  DEFAULT ((0)) FOR [SUA_DURUM]
GO
ALTER TABLE [dbo].[PERSONELDENKLESTIRME] ADD  DEFAULT ((0)) FOR [DEVREDEN_SURE]
GO
ALTER TABLE [dbo].[PERSONELDENKLESTIRME] ADD  DEFAULT ((0)) FOR [AKSAM_VARDIYA_SAAT]
GO
ALTER TABLE [dbo].[PERSONELDENKLESTIRME] ADD  DEFAULT ((0)) FOR [SUT_IZNI_DURUM]
GO
ALTER TABLE [dbo].[PERSONELDENKLESTIRME] ADD  DEFAULT ((0)) FOR [SUT_IZNI_SAAT]
GO
ALTER TABLE [dbo].[PERSONELDENKLESTIRME] ADD  DEFAULT ((0)) FOR [EGITIM_SURESI_AKSAM_GUN]
GO
ALTER TABLE [dbo].[PERSONELDENKLESTIRME] ADD  DEFAULT ((0)) FOR [FAZLA_MESAI_IZIN_KULLAN]
GO
ALTER TABLE [dbo].[PERSONELDENKLESTIRME] ADD  DEFAULT ((0)) FOR [KESILEN_SURE]
GO
ALTER TABLE [dbo].[PERSONELDENKLESTIRME] ADD  DEFAULT ((0)) FOR [KISMI_ODEME_SAAT]
GO
ALTER TABLE [dbo].[PERSONELDENKLESTIRME] ADD  DEFAULT ((0)) FOR [EKSIK_CALISMA_SURE]
GO
ALTER TABLE [dbo].[ROLE] ADD  DEFAULT ((0)) FOR [ADMIN_ROLE]
GO
ALTER TABLE [dbo].[SAP_SERVER] ADD  DEFAULT ('TR') FOR [SYSTEM_DIL]
GO
ALTER TABLE [dbo].[SIRKET] ADD  DEFAULT ((0)) FOR [FAZLA_MESAI_ODE]
GO
ALTER TABLE [dbo].[SIRKET] ADD  DEFAULT ((0)) FOR [ISTEN_AYR_TAR_CALISIYOR]
GO
ALTER TABLE [dbo].[SIRKET] ADD  DEFAULT ((0)) FOR [DEPARTMAN_BOLUM_AYNI]
GO
ALTER TABLE [dbo].[SIRKET] ADD  DEFAULT ((0)) FOR [FAZLA_MESAI_IZIN_KULLAN]
GO
ALTER TABLE [dbo].[SIRKET] ADD  DEFAULT ((1)) FOR [FAZLA_MESAI_TALEP_GIRILEBILIR]
GO
ALTER TABLE [dbo].[SIRKET] ADD  DEFAULT ((1)) FOR [TESIS_DURUM]
GO
ALTER TABLE [dbo].[TANIM] ADD  DEFAULT ('') FOR [ERP_KODU]
GO
ALTER TABLE [dbo].[TATIL] ADD  DEFAULT ((0)) FOR [YARIM_GUN_VARDIYA_YARIM_HESAPLA]
GO
ALTER TABLE [dbo].[USER_MENUITEM_TIME] ADD  DEFAULT ('{}') FOR [LAST_PARAMETRE]
GO
ALTER TABLE [dbo].[VARDIYA] ADD  DEFAULT ((1)) FOR [MESAI_ODE]
GO
ALTER TABLE [dbo].[VARDIYA] ADD  DEFAULT ((0)) FOR [CIKIS_MOLA_DAKIKA]
GO
ALTER TABLE [dbo].[VARDIYA] ADD  DEFAULT ((0)) FOR [SUA]
GO
ALTER TABLE [dbo].[VARDIYA] ADD  DEFAULT ((0)) FOR [GENEL]
GO
ALTER TABLE [dbo].[VARDIYA] ADD  DEFAULT ((5000)) FOR [EKRAN_SIRA]
GO
ALTER TABLE [dbo].[VARDIYA_GOREV] ADD  DEFAULT ((0)) FOR [OZEL_ISTEK]
GO
ALTER TABLE [dbo].[VARDIYA_GOREV] ADD  DEFAULT ((0)) FOR [GOREVLI_DURUM]
GO
ALTER TABLE [dbo].[VARDIYASABLONU] ADD  DEFAULT ((0)) FOR [BEYAZ_YAKA]
GO
ALTER TABLE [dbo].[YEMEKIZIN] ADD  DEFAULT ((30)) FOR [MAX_SURE]
GO
ALTER TABLE [dbo].[ARIFE_VARDIYA_DONEM]  WITH CHECK ADD  CONSTRAINT [FK8E52D982EAC35D7] FOREIGN KEY([VARDIYA_ID])
REFERENCES [dbo].[VARDIYA] ([ID])
GO
ALTER TABLE [dbo].[ARIFE_VARDIYA_DONEM] CHECK CONSTRAINT [FK8E52D982EAC35D7]
GO
ALTER TABLE [dbo].[ARIFE_VARDIYA_DONEM]  WITH CHECK ADD  CONSTRAINT [FK8E52D98856B6B7E] FOREIGN KEY([GUNCELLEYENUSER_ID])
REFERENCES [dbo].[PDKSUSER] ([ID])
GO
ALTER TABLE [dbo].[ARIFE_VARDIYA_DONEM] CHECK CONSTRAINT [FK8E52D98856B6B7E]
GO
ALTER TABLE [dbo].[ARIFE_VARDIYA_DONEM]  WITH CHECK ADD  CONSTRAINT [FK8E52D98CB95DF5A] FOREIGN KEY([OLUSTURANUSER_ID])
REFERENCES [dbo].[PDKSUSER] ([ID])
GO
ALTER TABLE [dbo].[ARIFE_VARDIYA_DONEM] CHECK CONSTRAINT [FK8E52D98CB95DF5A]
GO
ALTER TABLE [dbo].[BOLUM_KAT]  WITH CHECK ADD  CONSTRAINT [FK91F05DF616DC2470] FOREIGN KEY([OLUSTURANUSER_ID])
REFERENCES [dbo].[PDKSUSER] ([ID])
GO
ALTER TABLE [dbo].[BOLUM_KAT] CHECK CONSTRAINT [FK91F05DF616DC2470]
GO
ALTER TABLE [dbo].[BOLUM_KAT]  WITH CHECK ADD  CONSTRAINT [FK91F05DF6856B6B7E] FOREIGN KEY([GUNCELLEYENUSER_ID])
REFERENCES [dbo].[PDKSUSER] ([ID])
GO
ALTER TABLE [dbo].[BOLUM_KAT] CHECK CONSTRAINT [FK91F05DF6856B6B7E]
GO
ALTER TABLE [dbo].[BOLUM_KAT]  WITH CHECK ADD  CONSTRAINT [FK91F05DF69D54037E] FOREIGN KEY([KAT_ID])
REFERENCES [dbo].[TANIM] ([ID])
GO
ALTER TABLE [dbo].[BOLUM_KAT] CHECK CONSTRAINT [FK91F05DF69D54037E]
GO
ALTER TABLE [dbo].[CALISMA_MODELI]  WITH CHECK ADD  CONSTRAINT [FKC0244D13856B6B7E] FOREIGN KEY([GUNCELLEYENUSER_ID])
REFERENCES [dbo].[PDKSUSER] ([ID])
GO
ALTER TABLE [dbo].[CALISMA_MODELI] CHECK CONSTRAINT [FKC0244D13856B6B7E]
GO
ALTER TABLE [dbo].[CALISMA_MODELI]  WITH CHECK ADD  CONSTRAINT [FKC0244D13CB95DF5A] FOREIGN KEY([OLUSTURANUSER_ID])
REFERENCES [dbo].[PDKSUSER] ([ID])
GO
ALTER TABLE [dbo].[CALISMA_MODELI] CHECK CONSTRAINT [FKC0244D13CB95DF5A]
GO
ALTER TABLE [dbo].[CALISMA_MODELI]  WITH CHECK ADD  CONSTRAINT [FKC0244D13CF75C557] FOREIGN KEY([DEPARTMAN_ID])
REFERENCES [dbo].[DEPARTMAN] ([ID])
GO
ALTER TABLE [dbo].[CALISMA_MODELI] CHECK CONSTRAINT [FKC0244D13CF75C557]
GO
ALTER TABLE [dbo].[CALISMA_MODELI]  WITH CHECK ADD  CONSTRAINT [FKC0244D13EE43092B] FOREIGN KEY([BAGLI_VARDIYA_SABLON_ID])
REFERENCES [dbo].[VARDIYASABLONU] ([ID])
GO
ALTER TABLE [dbo].[CALISMA_MODELI] CHECK CONSTRAINT [FKC0244D13EE43092B]
GO
ALTER TABLE [dbo].[CALISMA_MODELI_AY]  WITH CHECK ADD  CONSTRAINT [FKC066A2E476C8FE39] FOREIGN KEY([DONEM_ID])
REFERENCES [dbo].[DENKLESTIRMEAY] ([ID])
GO
ALTER TABLE [dbo].[CALISMA_MODELI_AY] CHECK CONSTRAINT [FKC066A2E476C8FE39]
GO
ALTER TABLE [dbo].[CALISMA_MODELI_AY]  WITH CHECK ADD  CONSTRAINT [FKC066A2E4B3C17550] FOREIGN KEY([CALISMA_MODELI_ID])
REFERENCES [dbo].[CALISMA_MODELI] ([ID])
GO
ALTER TABLE [dbo].[CALISMA_MODELI_AY] CHECK CONSTRAINT [FKC066A2E4B3C17550]
GO
ALTER TABLE [dbo].[CALISMA_MODELI_VARDIYA]  WITH CHECK ADD  CONSTRAINT [FKB811A6A82EAC35D7] FOREIGN KEY([VARDIYA_ID])
REFERENCES [dbo].[VARDIYA] ([ID])
GO
ALTER TABLE [dbo].[CALISMA_MODELI_VARDIYA] CHECK CONSTRAINT [FKB811A6A82EAC35D7]
GO
ALTER TABLE [dbo].[CALISMA_MODELI_VARDIYA]  WITH CHECK ADD  CONSTRAINT [FKB811A6A8B3C17550] FOREIGN KEY([CALISMA_MODELI_ID])
REFERENCES [dbo].[CALISMA_MODELI] ([ID])
GO
ALTER TABLE [dbo].[CALISMA_MODELI_VARDIYA] CHECK CONSTRAINT [FKB811A6A8B3C17550]
GO
ALTER TABLE [dbo].[CALISMA_SEKLI]  WITH CHECK ADD  CONSTRAINT [FKA36A0E63856B6B7E] FOREIGN KEY([GUNCELLEYENUSER_ID])
REFERENCES [dbo].[PDKSUSER] ([ID])
GO
ALTER TABLE [dbo].[CALISMA_SEKLI] CHECK CONSTRAINT [FKA36A0E63856B6B7E]
GO
ALTER TABLE [dbo].[CALISMA_SEKLI]  WITH CHECK ADD  CONSTRAINT [FKA36A0E63CB95DF5A] FOREIGN KEY([OLUSTURANUSER_ID])
REFERENCES [dbo].[PDKSUSER] ([ID])
GO
ALTER TABLE [dbo].[CALISMA_SEKLI] CHECK CONSTRAINT [FKA36A0E63CB95DF5A]
GO
ALTER TABLE [dbo].[DENKLESTIRMEAY]  WITH CHECK ADD  CONSTRAINT [FK4660E71116DC2470] FOREIGN KEY([OLUSTURANUSER_ID])
REFERENCES [dbo].[PDKSUSER] ([ID])
GO
ALTER TABLE [dbo].[DENKLESTIRMEAY] CHECK CONSTRAINT [FK4660E71116DC2470]
GO
ALTER TABLE [dbo].[DENKLESTIRMEAY]  WITH CHECK ADD  CONSTRAINT [FK4660E711856B6B7E] FOREIGN KEY([GUNCELLEYENUSER_ID])
REFERENCES [dbo].[PDKSUSER] ([ID])
GO
ALTER TABLE [dbo].[DENKLESTIRMEAY] CHECK CONSTRAINT [FK4660E711856B6B7E]
GO
ALTER TABLE [dbo].[DEPARTMAN]  WITH CHECK ADD  CONSTRAINT [FK5D66F8C616DC2470] FOREIGN KEY([OLUSTURANUSER_ID])
REFERENCES [dbo].[PDKSUSER] ([ID])
GO
ALTER TABLE [dbo].[DEPARTMAN] CHECK CONSTRAINT [FK5D66F8C616DC2470]
GO
ALTER TABLE [dbo].[DEPARTMAN]  WITH CHECK ADD  CONSTRAINT [FK5D66F8C62CEFD90B] FOREIGN KEY([DEPARTMAN_ID])
REFERENCES [dbo].[TANIM] ([ID])
GO
ALTER TABLE [dbo].[DEPARTMAN] CHECK CONSTRAINT [FK5D66F8C62CEFD90B]
GO
ALTER TABLE [dbo].[DEPARTMAN]  WITH CHECK ADD  CONSTRAINT [FK5D66F8C658E481E9] FOREIGN KEY([GIRIS_TIPI_ID])
REFERENCES [dbo].[TANIM] ([ID])
GO
ALTER TABLE [dbo].[DEPARTMAN] CHECK CONSTRAINT [FK5D66F8C658E481E9]
GO
ALTER TABLE [dbo].[DEPARTMAN]  WITH CHECK ADD  CONSTRAINT [FK5D66F8C6856B6B7E] FOREIGN KEY([GUNCELLEYENUSER_ID])
REFERENCES [dbo].[PDKSUSER] ([ID])
GO
ALTER TABLE [dbo].[DEPARTMAN] CHECK CONSTRAINT [FK5D66F8C6856B6B7E]
GO
ALTER TABLE [dbo].[DEPARTMANMAILGRUBU]  WITH CHECK ADD  CONSTRAINT [FKFFE5954016DC2470] FOREIGN KEY([OLUSTURANUSER_ID])
REFERENCES [dbo].[PDKSUSER] ([ID])
GO
ALTER TABLE [dbo].[DEPARTMANMAILGRUBU] CHECK CONSTRAINT [FKFFE5954016DC2470]
GO
ALTER TABLE [dbo].[DEPARTMANMAILGRUBU]  WITH CHECK ADD  CONSTRAINT [FKFFE59540856B6B7E] FOREIGN KEY([GUNCELLEYENUSER_ID])
REFERENCES [dbo].[PDKSUSER] ([ID])
GO
ALTER TABLE [dbo].[DEPARTMANMAILGRUBU] CHECK CONSTRAINT [FKFFE59540856B6B7E]
GO
ALTER TABLE [dbo].[DEPARTMANMAILGRUBU]  WITH CHECK ADD  CONSTRAINT [FKFFE59540A9027B76] FOREIGN KEY([DEPARTMAN_ID])
REFERENCES [dbo].[TANIM] ([ID])
GO
ALTER TABLE [dbo].[DEPARTMANMAILGRUBU] CHECK CONSTRAINT [FKFFE59540A9027B76]
GO
ALTER TABLE [dbo].[FAZLA_MESAI_TALEP]  WITH CHECK ADD  CONSTRAINT [FK331B994316DC2470] FOREIGN KEY([OLUSTURANUSER_ID])
REFERENCES [dbo].[PDKSUSER] ([ID])
GO
ALTER TABLE [dbo].[FAZLA_MESAI_TALEP] CHECK CONSTRAINT [FK331B994316DC2470]
GO
ALTER TABLE [dbo].[FAZLA_MESAI_TALEP]  WITH CHECK ADD  CONSTRAINT [FK331B99432982E057] FOREIGN KEY([IPTAL_NEDEN_ID])
REFERENCES [dbo].[TANIM] ([ID])
GO
ALTER TABLE [dbo].[FAZLA_MESAI_TALEP] CHECK CONSTRAINT [FK331B99432982E057]
GO
ALTER TABLE [dbo].[FAZLA_MESAI_TALEP]  WITH CHECK ADD  CONSTRAINT [FK331B994335377214] FOREIGN KEY([VARDIYA_GUN_ID])
REFERENCES [dbo].[VARDIYA_GUN] ([ID])
GO
ALTER TABLE [dbo].[FAZLA_MESAI_TALEP] CHECK CONSTRAINT [FK331B994335377214]
GO
ALTER TABLE [dbo].[FAZLA_MESAI_TALEP]  WITH CHECK ADD  CONSTRAINT [FK331B99436F4868E2] FOREIGN KEY([MESAI_NEDEN_ID])
REFERENCES [dbo].[TANIM] ([ID])
GO
ALTER TABLE [dbo].[FAZLA_MESAI_TALEP] CHECK CONSTRAINT [FK331B99436F4868E2]
GO
ALTER TABLE [dbo].[FAZLA_MESAI_TALEP]  WITH CHECK ADD  CONSTRAINT [FK331B9943856B6B7E] FOREIGN KEY([GUNCELLEYENUSER_ID])
REFERENCES [dbo].[PDKSUSER] ([ID])
GO
ALTER TABLE [dbo].[FAZLA_MESAI_TALEP] CHECK CONSTRAINT [FK331B9943856B6B7E]
GO
ALTER TABLE [dbo].[ISKUR_VARDIYA_GUN]  WITH CHECK ADD  CONSTRAINT [FK880774342EAC35D7] FOREIGN KEY([VARDIYA_ID])
REFERENCES [dbo].[VARDIYA] ([ID])
GO
ALTER TABLE [dbo].[ISKUR_VARDIYA_GUN] CHECK CONSTRAINT [FK880774342EAC35D7]
GO
ALTER TABLE [dbo].[ISKUR_VARDIYA_GUN]  WITH CHECK ADD  CONSTRAINT [FK8807743490D76E60] FOREIGN KEY([GUNCELLEYENUSER_ID])
REFERENCES [dbo].[PDKSUSER] ([ID])
GO
ALTER TABLE [dbo].[ISKUR_VARDIYA_GUN] CHECK CONSTRAINT [FK8807743490D76E60]
GO
ALTER TABLE [dbo].[ISKUR_VARDIYA_GUN]  WITH CHECK ADD  CONSTRAINT [FK88077434A0DBC33D] FOREIGN KEY([PERSONEL_ID])
REFERENCES [dbo].[PERSONEL] ([ID])
GO
ALTER TABLE [dbo].[ISKUR_VARDIYA_GUN] CHECK CONSTRAINT [FK88077434A0DBC33D]
GO
ALTER TABLE [dbo].[ISKUR_VARDIYA_GUN]  WITH CHECK ADD  CONSTRAINT [FK88077434D701E23C] FOREIGN KEY([OLUSTURANUSER_ID])
REFERENCES [dbo].[PDKSUSER] ([ID])
GO
ALTER TABLE [dbo].[ISKUR_VARDIYA_GUN] CHECK CONSTRAINT [FK88077434D701E23C]
GO
ALTER TABLE [dbo].[IZIN_REFERANS_ERP]  WITH CHECK ADD  CONSTRAINT [FKDAFBBA732D189824] FOREIGN KEY([IZIN_ID])
REFERENCES [dbo].[PERSONELIZIN] ([ID])
GO
ALTER TABLE [dbo].[IZIN_REFERANS_ERP] CHECK CONSTRAINT [FKDAFBBA732D189824]
GO
ALTER TABLE [dbo].[IZIN_TIPI_MAIL_ADRES]  WITH CHECK ADD  CONSTRAINT [FKAA15EE7D6CC0E40A] FOREIGN KEY([IZIN_TIPI_ID])
REFERENCES [dbo].[IZINTIPI] ([ID])
GO
ALTER TABLE [dbo].[IZIN_TIPI_MAIL_ADRES] CHECK CONSTRAINT [FKAA15EE7D6CC0E40A]
GO
ALTER TABLE [dbo].[IZINHAKEDISHAKKI]  WITH CHECK ADD  CONSTRAINT [FKBD1265CB16DC2470] FOREIGN KEY([OLUSTURANUSER_ID])
REFERENCES [dbo].[PDKSUSER] ([ID])
GO
ALTER TABLE [dbo].[IZINHAKEDISHAKKI] CHECK CONSTRAINT [FKBD1265CB16DC2470]
GO
ALTER TABLE [dbo].[IZINHAKEDISHAKKI]  WITH CHECK ADD  CONSTRAINT [FKBD1265CB735A0FD3] FOREIGN KEY([DEPARTMAN])
REFERENCES [dbo].[DEPARTMAN] ([ID])
GO
ALTER TABLE [dbo].[IZINHAKEDISHAKKI] CHECK CONSTRAINT [FKBD1265CB735A0FD3]
GO
ALTER TABLE [dbo].[IZINHAKEDISHAKKI]  WITH CHECK ADD  CONSTRAINT [FKBD1265CB856B6B7E] FOREIGN KEY([GUNCELLEYENUSER_ID])
REFERENCES [dbo].[PDKSUSER] ([ID])
GO
ALTER TABLE [dbo].[IZINHAKEDISHAKKI] CHECK CONSTRAINT [FKBD1265CB856B6B7E]
GO
ALTER TABLE [dbo].[IZINISTIRAHAT]  WITH CHECK ADD  CONSTRAINT [FK6DAD02D716DC2470] FOREIGN KEY([OLUSTURANUSER_ID])
REFERENCES [dbo].[PDKSUSER] ([ID])
GO
ALTER TABLE [dbo].[IZINISTIRAHAT] CHECK CONSTRAINT [FK6DAD02D716DC2470]
GO
ALTER TABLE [dbo].[IZINISTIRAHAT]  WITH CHECK ADD  CONSTRAINT [FK6DAD02D735A790EC] FOREIGN KEY([PERSONEL_IZIN_ID])
REFERENCES [dbo].[PERSONELIZIN] ([ID])
GO
ALTER TABLE [dbo].[IZINISTIRAHAT] CHECK CONSTRAINT [FK6DAD02D735A790EC]
GO
ALTER TABLE [dbo].[IZINISTIRAHAT]  WITH CHECK ADD  CONSTRAINT [FK6DAD02D7856B6B7E] FOREIGN KEY([GUNCELLEYENUSER_ID])
REFERENCES [dbo].[PDKSUSER] ([ID])
GO
ALTER TABLE [dbo].[IZINISTIRAHAT] CHECK CONSTRAINT [FK6DAD02D7856B6B7E]
GO
ALTER TABLE [dbo].[IZINTIPI]  WITH CHECK ADD  CONSTRAINT [FKB92ADA4416DC2470] FOREIGN KEY([OLUSTURANUSER_ID])
REFERENCES [dbo].[PDKSUSER] ([ID])
GO
ALTER TABLE [dbo].[IZINTIPI] CHECK CONSTRAINT [FKB92ADA4416DC2470]
GO
ALTER TABLE [dbo].[IZINTIPI]  WITH CHECK ADD  CONSTRAINT [FKB92ADA4423FC4F05] FOREIGN KEY([IZIN_TIPI_ID])
REFERENCES [dbo].[TANIM] ([ID])
GO
ALTER TABLE [dbo].[IZINTIPI] CHECK CONSTRAINT [FKB92ADA4423FC4F05]
GO
ALTER TABLE [dbo].[IZINTIPI]  WITH CHECK ADD  CONSTRAINT [FKB92ADA4466572C6C] FOREIGN KEY([DEPARTMAN_ID])
REFERENCES [dbo].[DEPARTMAN] ([ID])
GO
ALTER TABLE [dbo].[IZINTIPI] CHECK CONSTRAINT [FKB92ADA4466572C6C]
GO
ALTER TABLE [dbo].[IZINTIPI]  WITH CHECK ADD  CONSTRAINT [FKB92ADA44856B6B7E] FOREIGN KEY([GUNCELLEYENUSER_ID])
REFERENCES [dbo].[PDKSUSER] ([ID])
GO
ALTER TABLE [dbo].[IZINTIPI] CHECK CONSTRAINT [FKB92ADA44856B6B7E]
GO
ALTER TABLE [dbo].[IZINTIPI]  WITH CHECK ADD  CONSTRAINT [FKB92ADA44DB27FFB3] FOREIGN KEY([BAKIYE_IZIN_TIPI_ID])
REFERENCES [dbo].[IZINTIPI] ([ID])
GO
ALTER TABLE [dbo].[IZINTIPI] CHECK CONSTRAINT [FKB92ADA44DB27FFB3]
GO
ALTER TABLE [dbo].[IZINTIPIBIRLESIKHARIC]  WITH CHECK ADD  CONSTRAINT [FKFC5AD99E16DC2470] FOREIGN KEY([OLUSTURANUSER_ID])
REFERENCES [dbo].[PDKSUSER] ([ID])
GO
ALTER TABLE [dbo].[IZINTIPIBIRLESIKHARIC] CHECK CONSTRAINT [FKFC5AD99E16DC2470]
GO
ALTER TABLE [dbo].[IZINTIPIBIRLESIKHARIC]  WITH CHECK ADD  CONSTRAINT [FKFC5AD99E23FC4F05] FOREIGN KEY([IZIN_TIPI_ID])
REFERENCES [dbo].[TANIM] ([ID])
GO
ALTER TABLE [dbo].[IZINTIPIBIRLESIKHARIC] CHECK CONSTRAINT [FKFC5AD99E23FC4F05]
GO
ALTER TABLE [dbo].[IZINTIPIBIRLESIKHARIC]  WITH CHECK ADD  CONSTRAINT [FKFC5AD99E6832A9F3] FOREIGN KEY([BIRLESIK_IZIN_TIPI_ID])
REFERENCES [dbo].[TANIM] ([ID])
GO
ALTER TABLE [dbo].[IZINTIPIBIRLESIKHARIC] CHECK CONSTRAINT [FKFC5AD99E6832A9F3]
GO
ALTER TABLE [dbo].[IZINTIPIBIRLESIKHARIC]  WITH CHECK ADD  CONSTRAINT [FKFC5AD99E856B6B7E] FOREIGN KEY([GUNCELLEYENUSER_ID])
REFERENCES [dbo].[PDKSUSER] ([ID])
GO
ALTER TABLE [dbo].[IZINTIPIBIRLESIKHARIC] CHECK CONSTRAINT [FKFC5AD99E856B6B7E]
GO
ALTER TABLE [dbo].[KAPI]  WITH CHECK ADD  CONSTRAINT [FK2315CF16DC2470] FOREIGN KEY([OLUSTURANUSER_ID])
REFERENCES [dbo].[PDKSUSER] ([ID])
GO
ALTER TABLE [dbo].[KAPI] CHECK CONSTRAINT [FK2315CF16DC2470]
GO
ALTER TABLE [dbo].[KAPI]  WITH CHECK ADD  CONSTRAINT [FK2315CF71B611BE] FOREIGN KEY([KAPI_TIPI_ID])
REFERENCES [dbo].[TANIM] ([ID])
GO
ALTER TABLE [dbo].[KAPI] CHECK CONSTRAINT [FK2315CF71B611BE]
GO
ALTER TABLE [dbo].[KAPI]  WITH CHECK ADD  CONSTRAINT [FK2315CF856B6B7E] FOREIGN KEY([GUNCELLEYENUSER_ID])
REFERENCES [dbo].[PDKSUSER] ([ID])
GO
ALTER TABLE [dbo].[KAPI] CHECK CONSTRAINT [FK2315CF856B6B7E]
GO
ALTER TABLE [dbo].[MENUITEM]  WITH CHECK ADD  CONSTRAINT [FKAB2B8F2195E5E4A] FOREIGN KEY([DESCRIPTION_ID])
REFERENCES [dbo].[TANIM] ([ID])
GO
ALTER TABLE [dbo].[MENUITEM] CHECK CONSTRAINT [FKAB2B8F2195E5E4A]
GO
ALTER TABLE [dbo].[MENUITEM_MENUITEM]  WITH CHECK ADD  CONSTRAINT [FKA461219F47FBBEA3] FOREIGN KEY([CHILDMENUITEMLIST_ID])
REFERENCES [dbo].[MENUITEM] ([ID])
GO
ALTER TABLE [dbo].[MENUITEM_MENUITEM] CHECK CONSTRAINT [FKA461219F47FBBEA3]
GO
ALTER TABLE [dbo].[MENUITEM_MENUITEM]  WITH CHECK ADD  CONSTRAINT [FKA461219FEF4A839D] FOREIGN KEY([MENUITEM_ID])
REFERENCES [dbo].[MENUITEM] ([ID])
GO
ALTER TABLE [dbo].[MENUITEM_MENUITEM] CHECK CONSTRAINT [FKA461219FEF4A839D]
GO
ALTER TABLE [dbo].[NOTICE]  WITH CHECK ADD  CONSTRAINT [FK899A8AD840D719C3] FOREIGN KEY([CHANGEUSER_ID])
REFERENCES [dbo].[PDKSUSER] ([ID])
GO
ALTER TABLE [dbo].[NOTICE] CHECK CONSTRAINT [FK899A8AD840D719C3]
GO
ALTER TABLE [dbo].[PARAMETRE]  WITH CHECK ADD  CONSTRAINT [FK1A96C38940D719C3] FOREIGN KEY([CHANGEUSER_ID])
REFERENCES [dbo].[PDKSUSER] ([ID])
GO
ALTER TABLE [dbo].[PARAMETRE] CHECK CONSTRAINT [FK1A96C38940D719C3]
GO
ALTER TABLE [dbo].[PDKS_ISLEM]  WITH CHECK ADD  CONSTRAINT [FKF50628E7132E6366] FOREIGN KEY([NEDEN_ID])
REFERENCES [dbo].[TANIM] ([ID])
GO
ALTER TABLE [dbo].[PDKS_ISLEM] CHECK CONSTRAINT [FKF50628E7132E6366]
GO
ALTER TABLE [dbo].[PDKS_ISLEM]  WITH CHECK ADD  CONSTRAINT [FKF50628E724EE34A2] FOREIGN KEY([GUNCELLEYEN_PERSONEL_ID])
REFERENCES [dbo].[PDKSUSER] ([ID])
GO
ALTER TABLE [dbo].[PDKS_ISLEM] CHECK CONSTRAINT [FKF50628E724EE34A2]
GO
ALTER TABLE [dbo].[PDKS_ISLEM]  WITH CHECK ADD  CONSTRAINT [FKF50628E742A176EE] FOREIGN KEY([ONAYLAYAN_ID])
REFERENCES [dbo].[PDKSUSER] ([ID])
GO
ALTER TABLE [dbo].[PDKS_ISLEM] CHECK CONSTRAINT [FKF50628E742A176EE]
GO
ALTER TABLE [dbo].[PDKSUSER]  WITH CHECK ADD  CONSTRAINT [FK83ABC271956BCF8] FOREIGN KEY([PERSONEL_ID])
REFERENCES [dbo].[PERSONEL] ([ID])
GO
ALTER TABLE [dbo].[PDKSUSER] CHECK CONSTRAINT [FK83ABC271956BCF8]
GO
ALTER TABLE [dbo].[PDKSUSER]  WITH CHECK ADD  CONSTRAINT [FK83ABC2766572C6C] FOREIGN KEY([DEPARTMAN_ID])
REFERENCES [dbo].[DEPARTMAN] ([ID])
GO
ALTER TABLE [dbo].[PDKSUSER] CHECK CONSTRAINT [FK83ABC2766572C6C]
GO
ALTER TABLE [dbo].[PERS_DENK_BORDRO]  WITH CHECK ADD  CONSTRAINT [FKF26058217847D72B] FOREIGN KEY([PERS_DENK_ID])
REFERENCES [dbo].[PERSONELDENKLESTIRME] ([ID])
GO
ALTER TABLE [dbo].[PERS_DENK_BORDRO] CHECK CONSTRAINT [FKF26058217847D72B]
GO
ALTER TABLE [dbo].[PERS_DENK_BORDRO_DETAY]  WITH CHECK ADD  CONSTRAINT [FK595AD2C0467DC63A] FOREIGN KEY([PERS_DENK_BORDRO_ID])
REFERENCES [dbo].[PERS_DENK_BORDRO] ([ID])
GO
ALTER TABLE [dbo].[PERS_DENK_BORDRO_DETAY] CHECK CONSTRAINT [FK595AD2C0467DC63A]
GO
ALTER TABLE [dbo].[PERS_DENK_DINAMIK_ALAN]  WITH CHECK ADD  CONSTRAINT [FKF7FD36387847D72B] FOREIGN KEY([PERS_DENK_ID])
REFERENCES [dbo].[PERSONELDENKLESTIRME] ([ID])
GO
ALTER TABLE [dbo].[PERS_DENK_DINAMIK_ALAN] CHECK CONSTRAINT [FKF7FD36387847D72B]
GO
ALTER TABLE [dbo].[PERS_DENK_DINAMIK_ALAN]  WITH CHECK ADD  CONSTRAINT [FKF7FD3638AA429584] FOREIGN KEY([ALAN_ID])
REFERENCES [dbo].[TANIM] ([ID])
GO
ALTER TABLE [dbo].[PERS_DENK_DINAMIK_ALAN] CHECK CONSTRAINT [FKF7FD3638AA429584]
GO
ALTER TABLE [dbo].[PERSONEL]  WITH CHECK ADD  CONSTRAINT [FK491016BC12347212] FOREIGN KEY([MASRAF_YERI_ID])
REFERENCES [dbo].[TANIM] ([ID])
GO
ALTER TABLE [dbo].[PERSONEL] CHECK CONSTRAINT [FK491016BC12347212]
GO
ALTER TABLE [dbo].[PERSONEL]  WITH CHECK ADD  CONSTRAINT [FK491016BC16DC2470] FOREIGN KEY([OLUSTURANUSER_ID])
REFERENCES [dbo].[PDKSUSER] ([ID])
GO
ALTER TABLE [dbo].[PERSONEL] CHECK CONSTRAINT [FK491016BC16DC2470]
GO
ALTER TABLE [dbo].[PERSONEL]  WITH CHECK ADD  CONSTRAINT [FK491016BC196F94F5] FOREIGN KEY([BORDRO_ALT_BIRIMI])
REFERENCES [dbo].[TANIM] ([ID])
GO
ALTER TABLE [dbo].[PERSONEL] CHECK CONSTRAINT [FK491016BC196F94F5]
GO
ALTER TABLE [dbo].[PERSONEL]  WITH CHECK ADD  CONSTRAINT [FK491016BC20F6175] FOREIGN KEY([MAIL_CC_ID])
REFERENCES [dbo].[MAIL_GRUBU] ([ID])
GO
ALTER TABLE [dbo].[PERSONEL] CHECK CONSTRAINT [FK491016BC20F6175]
GO
ALTER TABLE [dbo].[PERSONEL]  WITH CHECK ADD  CONSTRAINT [FK491016BC2332B663] FOREIGN KEY([MAIL_BCC_ID])
REFERENCES [dbo].[MAIL_GRUBU] ([ID])
GO
ALTER TABLE [dbo].[PERSONEL] CHECK CONSTRAINT [FK491016BC2332B663]
GO
ALTER TABLE [dbo].[PERSONEL]  WITH CHECK ADD  CONSTRAINT [FK491016BC2B1BF76B] FOREIGN KEY([SABLON_ID])
REFERENCES [dbo].[VARDIYASABLONU] ([ID])
GO
ALTER TABLE [dbo].[PERSONEL] CHECK CONSTRAINT [FK491016BC2B1BF76B]
GO
ALTER TABLE [dbo].[PERSONEL]  WITH CHECK ADD  CONSTRAINT [FK491016BC2BCCA00B] FOREIGN KEY([EK_SAHA1_ID])
REFERENCES [dbo].[TANIM] ([ID])
GO
ALTER TABLE [dbo].[PERSONEL] CHECK CONSTRAINT [FK491016BC2BCCA00B]
GO
ALTER TABLE [dbo].[PERSONEL]  WITH CHECK ADD  CONSTRAINT [FK491016BC2BCD146A] FOREIGN KEY([EK_SAHA2_ID])
REFERENCES [dbo].[TANIM] ([ID])
GO
ALTER TABLE [dbo].[PERSONEL] CHECK CONSTRAINT [FK491016BC2BCD146A]
GO
ALTER TABLE [dbo].[PERSONEL]  WITH CHECK ADD  CONSTRAINT [FK491016BC2BCD88C9] FOREIGN KEY([EK_SAHA3_ID])
REFERENCES [dbo].[TANIM] ([ID])
GO
ALTER TABLE [dbo].[PERSONEL] CHECK CONSTRAINT [FK491016BC2BCD88C9]
GO
ALTER TABLE [dbo].[PERSONEL]  WITH CHECK ADD  CONSTRAINT [FK491016BC2BCDFD28] FOREIGN KEY([EK_SAHA4_ID])
REFERENCES [dbo].[TANIM] ([ID])
GO
ALTER TABLE [dbo].[PERSONEL] CHECK CONSTRAINT [FK491016BC2BCDFD28]
GO
ALTER TABLE [dbo].[PERSONEL]  WITH CHECK ADD  CONSTRAINT [FK491016BC365AC83C] FOREIGN KEY([YONETICI_ID])
REFERENCES [dbo].[PERSONEL] ([ID])
GO
ALTER TABLE [dbo].[PERSONEL] CHECK CONSTRAINT [FK491016BC365AC83C]
GO
ALTER TABLE [dbo].[PERSONEL]  WITH CHECK ADD  CONSTRAINT [FK491016BC3F29F167] FOREIGN KEY([CINSIYET_ID])
REFERENCES [dbo].[TANIM] ([ID])
GO
ALTER TABLE [dbo].[PERSONEL] CHECK CONSTRAINT [FK491016BC3F29F167]
GO
ALTER TABLE [dbo].[PERSONEL]  WITH CHECK ADD  CONSTRAINT [FK491016BC4C476EAF] FOREIGN KEY([GOREV_TIPI_ID])
REFERENCES [dbo].[TANIM] ([ID])
GO
ALTER TABLE [dbo].[PERSONEL] CHECK CONSTRAINT [FK491016BC4C476EAF]
GO
ALTER TABLE [dbo].[PERSONEL]  WITH CHECK ADD  CONSTRAINT [FK491016BC575EE053] FOREIGN KEY([SIRKET_ID])
REFERENCES [dbo].[SIRKET] ([ID])
GO
ALTER TABLE [dbo].[PERSONEL] CHECK CONSTRAINT [FK491016BC575EE053]
GO
ALTER TABLE [dbo].[PERSONEL]  WITH CHECK ADD  CONSTRAINT [FK491016BC61F06F3A] FOREIGN KEY([ASIL_YONETICI1_ID])
REFERENCES [dbo].[PERSONEL] ([ID])
GO
ALTER TABLE [dbo].[PERSONEL] CHECK CONSTRAINT [FK491016BC61F06F3A]
GO
ALTER TABLE [dbo].[PERSONEL]  WITH CHECK ADD  CONSTRAINT [FK491016BC61F0E399] FOREIGN KEY([ASIL_YONETICI2_ID])
REFERENCES [dbo].[PERSONEL] ([ID])
GO
ALTER TABLE [dbo].[PERSONEL] CHECK CONSTRAINT [FK491016BC61F0E399]
GO
ALTER TABLE [dbo].[PERSONEL]  WITH CHECK ADD  CONSTRAINT [FK491016BC654811E1] FOREIGN KEY([MAIL_HAREKET_ID])
REFERENCES [dbo].[MAIL_GRUBU] ([ID])
GO
ALTER TABLE [dbo].[PERSONEL] CHECK CONSTRAINT [FK491016BC654811E1]
GO
ALTER TABLE [dbo].[PERSONEL]  WITH CHECK ADD  CONSTRAINT [FK491016BC856B6B7E] FOREIGN KEY([GUNCELLEYENUSER_ID])
REFERENCES [dbo].[PDKSUSER] ([ID])
GO
ALTER TABLE [dbo].[PERSONEL] CHECK CONSTRAINT [FK491016BC856B6B7E]
GO
ALTER TABLE [dbo].[PERSONEL]  WITH CHECK ADD  CONSTRAINT [FK491016BC85EA73CF] FOREIGN KEY([ISKUR_SABLON_ID])
REFERENCES [dbo].[VARDIYASABLONU] ([ID])
GO
ALTER TABLE [dbo].[PERSONEL] CHECK CONSTRAINT [FK491016BC85EA73CF]
GO
ALTER TABLE [dbo].[PERSONEL]  WITH CHECK ADD  CONSTRAINT [FK491016BC96134A1B] FOREIGN KEY([VARDIYA_GIRIS_TIPI_ID])
REFERENCES [dbo].[TANIM] ([ID])
GO
ALTER TABLE [dbo].[PERSONEL] CHECK CONSTRAINT [FK491016BC96134A1B]
GO
ALTER TABLE [dbo].[PERSONEL]  WITH CHECK ADD  CONSTRAINT [FK491016BC9C48C5D0] FOREIGN KEY([TESIS_ID])
REFERENCES [dbo].[TANIM] ([ID])
GO
ALTER TABLE [dbo].[PERSONEL] CHECK CONSTRAINT [FK491016BC9C48C5D0]
GO
ALTER TABLE [dbo].[PERSONEL]  WITH CHECK ADD  CONSTRAINT [FK491016BCB3C17550] FOREIGN KEY([CALISMA_MODELI_ID])
REFERENCES [dbo].[CALISMA_MODELI] ([ID])
GO
ALTER TABLE [dbo].[PERSONEL] CHECK CONSTRAINT [FK491016BCB3C17550]
GO
ALTER TABLE [dbo].[PERSONEL_DINAMIK_ALAN]  WITH CHECK ADD  CONSTRAINT [FKCFA0F7432A748C83] FOREIGN KEY([TANIM_DEGER_ID])
REFERENCES [dbo].[TANIM] ([ID])
GO
ALTER TABLE [dbo].[PERSONEL_DINAMIK_ALAN] CHECK CONSTRAINT [FKCFA0F7432A748C83]
GO
ALTER TABLE [dbo].[PERSONEL_DINAMIK_ALAN]  WITH CHECK ADD  CONSTRAINT [FKCFA0F743A0DBC33D] FOREIGN KEY([PERSONEL_ID])
REFERENCES [dbo].[PERSONEL] ([ID])
GO
ALTER TABLE [dbo].[PERSONEL_DINAMIK_ALAN] CHECK CONSTRAINT [FKCFA0F743A0DBC33D]
GO
ALTER TABLE [dbo].[PERSONEL_DINAMIK_ALAN]  WITH CHECK ADD  CONSTRAINT [FKCFA0F743AA429584] FOREIGN KEY([ALAN_ID])
REFERENCES [dbo].[TANIM] ([ID])
GO
ALTER TABLE [dbo].[PERSONEL_DINAMIK_ALAN] CHECK CONSTRAINT [FKCFA0F743AA429584]
GO
ALTER TABLE [dbo].[PERSONEL_EXTRA]  WITH CHECK ADD  CONSTRAINT [FK854D18ADA0DBC33D] FOREIGN KEY([PERSONEL_ID])
REFERENCES [dbo].[PERSONEL] ([ID])
GO
ALTER TABLE [dbo].[PERSONEL_EXTRA] CHECK CONSTRAINT [FK854D18ADA0DBC33D]
GO
ALTER TABLE [dbo].[PERSONEL_GECICI_YONETICI]  WITH CHECK ADD  CONSTRAINT [FKBE2CDE5A135D1CC] FOREIGN KEY([PERSONEL_GECICI])
REFERENCES [dbo].[PERSONEL] ([ID])
GO
ALTER TABLE [dbo].[PERSONEL_GECICI_YONETICI] CHECK CONSTRAINT [FKBE2CDE5A135D1CC]
GO
ALTER TABLE [dbo].[PERSONEL_GECICI_YONETICI]  WITH CHECK ADD  CONSTRAINT [FKBE2CDE5A16DC2470] FOREIGN KEY([OLUSTURANUSER_ID])
REFERENCES [dbo].[PDKSUSER] ([ID])
GO
ALTER TABLE [dbo].[PERSONEL_GECICI_YONETICI] CHECK CONSTRAINT [FKBE2CDE5A16DC2470]
GO
ALTER TABLE [dbo].[PERSONEL_GECICI_YONETICI]  WITH CHECK ADD  CONSTRAINT [FKBE2CDE5A5D73CA2E] FOREIGN KEY([YENI_YONETICI])
REFERENCES [dbo].[PDKSUSER] ([ID])
GO
ALTER TABLE [dbo].[PERSONEL_GECICI_YONETICI] CHECK CONSTRAINT [FKBE2CDE5A5D73CA2E]
GO
ALTER TABLE [dbo].[PERSONEL_GECICI_YONETICI]  WITH CHECK ADD  CONSTRAINT [FKBE2CDE5A856B6B7E] FOREIGN KEY([GUNCELLEYENUSER_ID])
REFERENCES [dbo].[PDKSUSER] ([ID])
GO
ALTER TABLE [dbo].[PERSONEL_GECICI_YONETICI] CHECK CONSTRAINT [FKBE2CDE5A856B6B7E]
GO
ALTER TABLE [dbo].[PERSONEL_GECICI_YONETICI]  WITH CHECK ADD  CONSTRAINT [FKBE2CDE5A8AA28E11] FOREIGN KEY([VEKALET_VEREN])
REFERENCES [dbo].[PDKSUSER] ([ID])
GO
ALTER TABLE [dbo].[PERSONEL_GECICI_YONETICI] CHECK CONSTRAINT [FKBE2CDE5A8AA28E11]
GO
ALTER TABLE [dbo].[PERSONEL_IZIN_DOSYA]  WITH CHECK ADD  CONSTRAINT [FKC4D5E02A2F328B97] FOREIGN KEY([DOSYA_ID])
REFERENCES [dbo].[DOSYA] ([ID])
GO
ALTER TABLE [dbo].[PERSONEL_IZIN_DOSYA] CHECK CONSTRAINT [FKC4D5E02A2F328B97]
GO
ALTER TABLE [dbo].[PERSONEL_IZIN_DOSYA]  WITH CHECK ADD  CONSTRAINT [FKC4D5E02A35A790EC] FOREIGN KEY([PERSONEL_IZIN_ID])
REFERENCES [dbo].[PERSONELIZIN] ([ID])
GO
ALTER TABLE [dbo].[PERSONEL_IZIN_DOSYA] CHECK CONSTRAINT [FKC4D5E02A35A790EC]
GO
ALTER TABLE [dbo].[PERSONELDENKLESTIRME]  WITH CHECK ADD  CONSTRAINT [FK52649DD516DC2470] FOREIGN KEY([OLUSTURANUSER_ID])
REFERENCES [dbo].[PDKSUSER] ([ID])
GO
ALTER TABLE [dbo].[PERSONELDENKLESTIRME] CHECK CONSTRAINT [FK52649DD516DC2470]
GO
ALTER TABLE [dbo].[PERSONELDENKLESTIRME]  WITH CHECK ADD  CONSTRAINT [FK52649DD525A6EDA3] FOREIGN KEY([GECEN_AY_DENKLESTIRME_ID])
REFERENCES [dbo].[PERSONELDENKLESTIRME] ([ID])
GO
ALTER TABLE [dbo].[PERSONELDENKLESTIRME] CHECK CONSTRAINT [FK52649DD525A6EDA3]
GO
ALTER TABLE [dbo].[PERSONELDENKLESTIRME]  WITH CHECK ADD  CONSTRAINT [FK52649DD55509DBB7] FOREIGN KEY([CALISMA_MODELI_AY_ID])
REFERENCES [dbo].[CALISMA_MODELI_AY] ([ID])
GO
ALTER TABLE [dbo].[PERSONELDENKLESTIRME] CHECK CONSTRAINT [FK52649DD55509DBB7]
GO
ALTER TABLE [dbo].[PERSONELDENKLESTIRME]  WITH CHECK ADD  CONSTRAINT [FK52649DD576C8FE39] FOREIGN KEY([DONEM_ID])
REFERENCES [dbo].[DENKLESTIRMEAY] ([ID])
GO
ALTER TABLE [dbo].[PERSONELDENKLESTIRME] CHECK CONSTRAINT [FK52649DD576C8FE39]
GO
ALTER TABLE [dbo].[PERSONELDENKLESTIRME]  WITH CHECK ADD  CONSTRAINT [FK52649DD5856B6B7E] FOREIGN KEY([GUNCELLEYENUSER_ID])
REFERENCES [dbo].[PDKSUSER] ([ID])
GO
ALTER TABLE [dbo].[PERSONELDENKLESTIRME] CHECK CONSTRAINT [FK52649DD5856B6B7E]
GO
ALTER TABLE [dbo].[PERSONELDENKLESTIRME]  WITH CHECK ADD  CONSTRAINT [FK52649DD5A0DBC33D] FOREIGN KEY([PERSONEL_ID])
REFERENCES [dbo].[PERSONEL] ([ID])
GO
ALTER TABLE [dbo].[PERSONELDENKLESTIRME] CHECK CONSTRAINT [FK52649DD5A0DBC33D]
GO
ALTER TABLE [dbo].[PERSONELFAZLAMESAI]  WITH CHECK ADD  CONSTRAINT [FK52A106AB16DC2470] FOREIGN KEY([OLUSTURANUSER_ID])
REFERENCES [dbo].[PDKSUSER] ([ID])
GO
ALTER TABLE [dbo].[PERSONELFAZLAMESAI] CHECK CONSTRAINT [FK52A106AB16DC2470]
GO
ALTER TABLE [dbo].[PERSONELFAZLAMESAI]  WITH CHECK ADD  CONSTRAINT [FK52A106AB36DEC7CF] FOREIGN KEY([FAZLA_MESAI_TALEP_ID])
REFERENCES [dbo].[FAZLA_MESAI_TALEP] ([ID])
GO
ALTER TABLE [dbo].[PERSONELFAZLAMESAI] CHECK CONSTRAINT [FK52A106AB36DEC7CF]
GO
ALTER TABLE [dbo].[PERSONELFAZLAMESAI]  WITH CHECK ADD  CONSTRAINT [FK52A106AB52E58DFA] FOREIGN KEY([VARDIYA_GUN])
REFERENCES [dbo].[VARDIYA_GUN] ([ID])
GO
ALTER TABLE [dbo].[PERSONELFAZLAMESAI] CHECK CONSTRAINT [FK52A106AB52E58DFA]
GO
ALTER TABLE [dbo].[PERSONELFAZLAMESAI]  WITH CHECK ADD  CONSTRAINT [FK52A106AB856B6B7E] FOREIGN KEY([GUNCELLEYENUSER_ID])
REFERENCES [dbo].[PDKSUSER] ([ID])
GO
ALTER TABLE [dbo].[PERSONELFAZLAMESAI] CHECK CONSTRAINT [FK52A106AB856B6B7E]
GO
ALTER TABLE [dbo].[PERSONELFAZLAMESAI]  WITH CHECK ADD  CONSTRAINT [FK52A106AB92488465] FOREIGN KEY([ONAY_ID])
REFERENCES [dbo].[TANIM] ([ID])
GO
ALTER TABLE [dbo].[PERSONELFAZLAMESAI] CHECK CONSTRAINT [FK52A106AB92488465]
GO
ALTER TABLE [dbo].[PERSONELIZIN]  WITH CHECK ADD  CONSTRAINT [FK8190E2D216DC2470] FOREIGN KEY([OLUSTURANUSER_ID])
REFERENCES [dbo].[PDKSUSER] ([ID])
GO
ALTER TABLE [dbo].[PERSONELIZIN] CHECK CONSTRAINT [FK8190E2D216DC2470]
GO
ALTER TABLE [dbo].[PERSONELIZIN]  WITH CHECK ADD  CONSTRAINT [FK8190E2D2170996A5] FOREIGN KEY([IZIN_TIPI_ID])
REFERENCES [dbo].[IZINTIPI] ([ID])
GO
ALTER TABLE [dbo].[PERSONELIZIN] CHECK CONSTRAINT [FK8190E2D2170996A5]
GO
ALTER TABLE [dbo].[PERSONELIZIN]  WITH CHECK ADD  CONSTRAINT [FK8190E2D21956BCF8] FOREIGN KEY([PERSONEL_ID])
REFERENCES [dbo].[PERSONEL] ([ID])
GO
ALTER TABLE [dbo].[PERSONELIZIN] CHECK CONSTRAINT [FK8190E2D21956BCF8]
GO
ALTER TABLE [dbo].[PERSONELIZIN]  WITH CHECK ADD  CONSTRAINT [FK8190E2D24C476EAF] FOREIGN KEY([GOREV_TIPI_ID])
REFERENCES [dbo].[TANIM] ([ID])
GO
ALTER TABLE [dbo].[PERSONELIZIN] CHECK CONSTRAINT [FK8190E2D24C476EAF]
GO
ALTER TABLE [dbo].[PERSONELIZIN]  WITH CHECK ADD  CONSTRAINT [FK8190E2D2856B6B7E] FOREIGN KEY([GUNCELLEYENUSER_ID])
REFERENCES [dbo].[PDKSUSER] ([ID])
GO
ALTER TABLE [dbo].[PERSONELIZIN] CHECK CONSTRAINT [FK8190E2D2856B6B7E]
GO
ALTER TABLE [dbo].[PERSONELIZINDETAY]  WITH CHECK ADD  CONSTRAINT [FK9E4EFD98DF23F6F] FOREIGN KEY([IZIN_ID])
REFERENCES [dbo].[PERSONELIZIN] ([ID])
GO
ALTER TABLE [dbo].[PERSONELIZINDETAY] CHECK CONSTRAINT [FK9E4EFD98DF23F6F]
GO
ALTER TABLE [dbo].[PERSONELIZINDETAY]  WITH CHECK ADD  CONSTRAINT [FK9E4EFD9BA8B3B5] FOREIGN KEY([HAKEDIS_IZIN_ID])
REFERENCES [dbo].[PERSONELIZIN] ([ID])
GO
ALTER TABLE [dbo].[PERSONELIZINDETAY] CHECK CONSTRAINT [FK9E4EFD9BA8B3B5]
GO
ALTER TABLE [dbo].[PERSONELIZINONAY]  WITH CHECK ADD  CONSTRAINT [FKB604402916DC2470] FOREIGN KEY([OLUSTURANUSER_ID])
REFERENCES [dbo].[PDKSUSER] ([ID])
GO
ALTER TABLE [dbo].[PERSONELIZINONAY] CHECK CONSTRAINT [FKB604402916DC2470]
GO
ALTER TABLE [dbo].[PERSONELIZINONAY]  WITH CHECK ADD  CONSTRAINT [FKB604402935A790EC] FOREIGN KEY([PERSONEL_IZIN_ID])
REFERENCES [dbo].[PERSONELIZIN] ([ID])
GO
ALTER TABLE [dbo].[PERSONELIZINONAY] CHECK CONSTRAINT [FKB604402935A790EC]
GO
ALTER TABLE [dbo].[PERSONELIZINONAY]  WITH CHECK ADD  CONSTRAINT [FKB6044029856B6B7E] FOREIGN KEY([GUNCELLEYENUSER_ID])
REFERENCES [dbo].[PDKSUSER] ([ID])
GO
ALTER TABLE [dbo].[PERSONELIZINONAY] CHECK CONSTRAINT [FKB6044029856B6B7E]
GO
ALTER TABLE [dbo].[PERSONELIZINONAY]  WITH CHECK ADD  CONSTRAINT [FKB6044029D559BD11] FOREIGN KEY([ONAYLAMAMA_NEDEN_ID])
REFERENCES [dbo].[TANIM] ([ID])
GO
ALTER TABLE [dbo].[PERSONELIZINONAY] CHECK CONSTRAINT [FKB6044029D559BD11]
GO
ALTER TABLE [dbo].[ROLE]  WITH CHECK ADD  CONSTRAINT [FK26787666572C6C] FOREIGN KEY([DEPARTMAN_ID])
REFERENCES [dbo].[DEPARTMAN] ([ID])
GO
ALTER TABLE [dbo].[ROLE] CHECK CONSTRAINT [FK26787666572C6C]
GO
ALTER TABLE [dbo].[SIRKET]  WITH CHECK ADD  CONSTRAINT [FK91CD57FE16DC2470] FOREIGN KEY([OLUSTURANUSER_ID])
REFERENCES [dbo].[PDKSUSER] ([ID])
GO
ALTER TABLE [dbo].[SIRKET] CHECK CONSTRAINT [FK91CD57FE16DC2470]
GO
ALTER TABLE [dbo].[SIRKET]  WITH CHECK ADD  CONSTRAINT [FK91CD57FE29CF855] FOREIGN KEY([SIRKET_GRUP_ID])
REFERENCES [dbo].[TANIM] ([ID])
GO
ALTER TABLE [dbo].[SIRKET] CHECK CONSTRAINT [FK91CD57FE29CF855]
GO
ALTER TABLE [dbo].[SIRKET]  WITH CHECK ADD  CONSTRAINT [FK91CD57FE66572C6C] FOREIGN KEY([DEPARTMAN_ID])
REFERENCES [dbo].[DEPARTMAN] ([ID])
GO
ALTER TABLE [dbo].[SIRKET] CHECK CONSTRAINT [FK91CD57FE66572C6C]
GO
ALTER TABLE [dbo].[SIRKET]  WITH CHECK ADD  CONSTRAINT [FK91CD57FE856B6B7E] FOREIGN KEY([GUNCELLEYENUSER_ID])
REFERENCES [dbo].[PDKSUSER] ([ID])
GO
ALTER TABLE [dbo].[SIRKET] CHECK CONSTRAINT [FK91CD57FE856B6B7E]
GO
ALTER TABLE [dbo].[TANIM]  WITH CHECK ADD  CONSTRAINT [FK4BE70652264AD0E] FOREIGN KEY([ISLEM_YAPAN])
REFERENCES [dbo].[PDKSUSER] ([ID])
GO
ALTER TABLE [dbo].[TANIM] CHECK CONSTRAINT [FK4BE70652264AD0E]
GO
ALTER TABLE [dbo].[TANIM]  WITH CHECK ADD  CONSTRAINT [FK4BE706542B9A221] FOREIGN KEY([PARENTTANIM_ID])
REFERENCES [dbo].[TANIM] ([ID])
GO
ALTER TABLE [dbo].[TANIM] CHECK CONSTRAINT [FK4BE706542B9A221]
GO
ALTER TABLE [dbo].[TATIL]  WITH CHECK ADD  CONSTRAINT [FK4BE86EA16DC2470] FOREIGN KEY([OLUSTURANUSER_ID])
REFERENCES [dbo].[PDKSUSER] ([ID])
GO
ALTER TABLE [dbo].[TATIL] CHECK CONSTRAINT [FK4BE86EA16DC2470]
GO
ALTER TABLE [dbo].[TATIL]  WITH CHECK ADD  CONSTRAINT [FK4BE86EA53E907F9] FOREIGN KEY([TATIL_TIPI_ID])
REFERENCES [dbo].[TANIM] ([ID])
GO
ALTER TABLE [dbo].[TATIL] CHECK CONSTRAINT [FK4BE86EA53E907F9]
GO
ALTER TABLE [dbo].[TATIL]  WITH CHECK ADD  CONSTRAINT [FK4BE86EA856B6B7E] FOREIGN KEY([GUNCELLEYENUSER_ID])
REFERENCES [dbo].[PDKSUSER] ([ID])
GO
ALTER TABLE [dbo].[TATIL] CHECK CONSTRAINT [FK4BE86EA856B6B7E]
GO
ALTER TABLE [dbo].[USER_MENUITEM_TIME]  WITH CHECK ADD  CONSTRAINT [FK4400C88693246E5D] FOREIGN KEY([USER_ID])
REFERENCES [dbo].[PDKSUSER] ([ID])
GO
ALTER TABLE [dbo].[USER_MENUITEM_TIME] CHECK CONSTRAINT [FK4400C88693246E5D]
GO
ALTER TABLE [dbo].[USER_MENUITEM_TIME]  WITH CHECK ADD  CONSTRAINT [FK4400C886B4224410] FOREIGN KEY([MENU_ID])
REFERENCES [dbo].[MENUITEM] ([ID])
GO
ALTER TABLE [dbo].[USER_MENUITEM_TIME] CHECK CONSTRAINT [FK4400C886B4224410]
GO
ALTER TABLE [dbo].[USER_TESIS]  WITH CHECK ADD  CONSTRAINT [FKC6DF573893246E5D] FOREIGN KEY([USER_ID])
REFERENCES [dbo].[PDKSUSER] ([ID])
GO
ALTER TABLE [dbo].[USER_TESIS] CHECK CONSTRAINT [FKC6DF573893246E5D]
GO
ALTER TABLE [dbo].[USER_TESIS]  WITH CHECK ADD  CONSTRAINT [FKC6DF57389C48C5D0] FOREIGN KEY([TESIS_ID])
REFERENCES [dbo].[TANIM] ([ID])
GO
ALTER TABLE [dbo].[USER_TESIS] CHECK CONSTRAINT [FKC6DF57389C48C5D0]
GO
ALTER TABLE [dbo].[USERROLES]  WITH CHECK ADD  CONSTRAINT [FK8AF579926A14B274] FOREIGN KEY([USERID])
REFERENCES [dbo].[PDKSUSER] ([ID])
GO
ALTER TABLE [dbo].[USERROLES] CHECK CONSTRAINT [FK8AF579926A14B274]
GO
ALTER TABLE [dbo].[VARDIYA]  WITH CHECK ADD  CONSTRAINT [FK38E675D416DC2470] FOREIGN KEY([OLUSTURANUSER_ID])
REFERENCES [dbo].[PDKSUSER] ([ID])
GO
ALTER TABLE [dbo].[VARDIYA] CHECK CONSTRAINT [FK38E675D416DC2470]
GO
ALTER TABLE [dbo].[VARDIYA]  WITH CHECK ADD  CONSTRAINT [FK38E675D466572C6C] FOREIGN KEY([DEPARTMAN_ID])
REFERENCES [dbo].[DEPARTMAN] ([ID])
GO
ALTER TABLE [dbo].[VARDIYA] CHECK CONSTRAINT [FK38E675D466572C6C]
GO
ALTER TABLE [dbo].[VARDIYA]  WITH CHECK ADD  CONSTRAINT [FK38E675D4856B6B7E] FOREIGN KEY([GUNCELLEYENUSER_ID])
REFERENCES [dbo].[PDKSUSER] ([ID])
GO
ALTER TABLE [dbo].[VARDIYA] CHECK CONSTRAINT [FK38E675D4856B6B7E]
GO
ALTER TABLE [dbo].[VARDIYA]  WITH CHECK ADD  CONSTRAINT [FK38E675D49D1D210] FOREIGN KEY([CALISMA_SEKLI])
REFERENCES [dbo].[CALISMA_SEKLI] ([ID])
GO
ALTER TABLE [dbo].[VARDIYA] CHECK CONSTRAINT [FK38E675D49D1D210]
GO
ALTER TABLE [dbo].[VARDIYA_GOREV]  WITH CHECK ADD  CONSTRAINT [FK224DD47035377214] FOREIGN KEY([VARDIYA_GUN_ID])
REFERENCES [dbo].[VARDIYA_GUN] ([ID])
GO
ALTER TABLE [dbo].[VARDIYA_GOREV] CHECK CONSTRAINT [FK224DD47035377214]
GO
ALTER TABLE [dbo].[VARDIYA_GOREV]  WITH CHECK ADD  CONSTRAINT [FK224DD47042712A4] FOREIGN KEY([BOLUM_KAT_ID])
REFERENCES [dbo].[BOLUM_KAT] ([ID])
GO
ALTER TABLE [dbo].[VARDIYA_GOREV] CHECK CONSTRAINT [FK224DD47042712A4]
GO
ALTER TABLE [dbo].[VARDIYA_GOREV]  WITH CHECK ADD  CONSTRAINT [FK224DD470C97012FD] FOREIGN KEY([YENI_GOREV_YERI_ID])
REFERENCES [dbo].[TANIM] ([ID])
GO
ALTER TABLE [dbo].[VARDIYA_GOREV] CHECK CONSTRAINT [FK224DD470C97012FD]
GO
ALTER TABLE [dbo].[VARDIYA_GUN]  WITH CHECK ADD  CONSTRAINT [FK766F5C51A64E407B] FOREIGN KEY([VARDIYA_SAAT_ID])
REFERENCES [dbo].[VARDIYA_SAAT] ([ID])
GO
ALTER TABLE [dbo].[VARDIYA_GUN] CHECK CONSTRAINT [FK766F5C51A64E407B]
GO
ALTER TABLE [dbo].[VARDIYA_GUN]  WITH CHECK ADD  CONSTRAINT [FKD27BB03516DC2470] FOREIGN KEY([OLUSTURANUSER_ID])
REFERENCES [dbo].[PDKSUSER] ([ID])
GO
ALTER TABLE [dbo].[VARDIYA_GUN] CHECK CONSTRAINT [FKD27BB03516DC2470]
GO
ALTER TABLE [dbo].[VARDIYA_GUN]  WITH CHECK ADD  CONSTRAINT [FKD27BB0352EAC35D7] FOREIGN KEY([VARDIYA_ID])
REFERENCES [dbo].[VARDIYA] ([ID])
GO
ALTER TABLE [dbo].[VARDIYA_GUN] CHECK CONSTRAINT [FKD27BB0352EAC35D7]
GO
ALTER TABLE [dbo].[VARDIYA_GUN]  WITH CHECK ADD  CONSTRAINT [FKD27BB035856B6B7E] FOREIGN KEY([GUNCELLEYENUSER_ID])
REFERENCES [dbo].[PDKSUSER] ([ID])
GO
ALTER TABLE [dbo].[VARDIYA_GUN] CHECK CONSTRAINT [FKD27BB035856B6B7E]
GO
ALTER TABLE [dbo].[VARDIYA_GUN]  WITH CHECK ADD  CONSTRAINT [FKD27BB035A0DBC33D] FOREIGN KEY([PERSONEL_ID])
REFERENCES [dbo].[PERSONEL] ([ID])
GO
ALTER TABLE [dbo].[VARDIYA_GUN] CHECK CONSTRAINT [FKD27BB035A0DBC33D]
GO
ALTER TABLE [dbo].[VARDIYA_IZIN]  WITH CHECK ADD  CONSTRAINT [FK7CFB51A1104DEFA0] FOREIGN KEY([IZIN_VARDIYA_ID])
REFERENCES [dbo].[VARDIYA] ([ID])
GO
ALTER TABLE [dbo].[VARDIYA_IZIN] CHECK CONSTRAINT [FK7CFB51A1104DEFA0]
GO
ALTER TABLE [dbo].[VARDIYA_IZIN]  WITH CHECK ADD  CONSTRAINT [FK7CFB51A1F7954AEA] FOREIGN KEY([CALISMA_VARDIYA_ID])
REFERENCES [dbo].[VARDIYA] ([ID])
GO
ALTER TABLE [dbo].[VARDIYA_IZIN] CHECK CONSTRAINT [FK7CFB51A1F7954AEA]
GO
ALTER TABLE [dbo].[VARDIYA_YEMEK_IZIN]  WITH CHECK ADD  CONSTRAINT [FK160523792EAC35D7] FOREIGN KEY([VARDIYA_ID])
REFERENCES [dbo].[VARDIYA] ([ID])
GO
ALTER TABLE [dbo].[VARDIYA_YEMEK_IZIN] CHECK CONSTRAINT [FK160523792EAC35D7]
GO
ALTER TABLE [dbo].[VARDIYA_YEMEK_IZIN]  WITH CHECK ADD  CONSTRAINT [FK16052379320C3646] FOREIGN KEY([YEMEK_IZIN_ID])
REFERENCES [dbo].[YEMEKIZIN] ([ID])
GO
ALTER TABLE [dbo].[VARDIYA_YEMEK_IZIN] CHECK CONSTRAINT [FK16052379320C3646]
GO
ALTER TABLE [dbo].[VARDIYAHAFTA]  WITH CHECK ADD  CONSTRAINT [FK7BB3484616DC2470] FOREIGN KEY([OLUSTURANUSER_ID])
REFERENCES [dbo].[PDKSUSER] ([ID])
GO
ALTER TABLE [dbo].[VARDIYAHAFTA] CHECK CONSTRAINT [FK7BB3484616DC2470]
GO
ALTER TABLE [dbo].[VARDIYAHAFTA]  WITH CHECK ADD  CONSTRAINT [FK7BB34846856B6B7E] FOREIGN KEY([GUNCELLEYENUSER_ID])
REFERENCES [dbo].[PDKSUSER] ([ID])
GO
ALTER TABLE [dbo].[VARDIYAHAFTA] CHECK CONSTRAINT [FK7BB34846856B6B7E]
GO
ALTER TABLE [dbo].[VARDIYAHAFTA]  WITH CHECK ADD  CONSTRAINT [FK7BB34846A0DBC33D] FOREIGN KEY([PERSONEL_ID])
REFERENCES [dbo].[PERSONEL] ([ID])
GO
ALTER TABLE [dbo].[VARDIYAHAFTA] CHECK CONSTRAINT [FK7BB34846A0DBC33D]
GO
ALTER TABLE [dbo].[VARDIYAHAFTA]  WITH CHECK ADD  CONSTRAINT [FK7BB34846A3D6BF0] FOREIGN KEY([SABLON_ID])
REFERENCES [dbo].[VARDIYASABLONU] ([ID])
GO
ALTER TABLE [dbo].[VARDIYAHAFTA] CHECK CONSTRAINT [FK7BB34846A3D6BF0]
GO
ALTER TABLE [dbo].[VARDIYASABLONU]  WITH CHECK ADD  CONSTRAINT [FKA1AB17EA12AFEA6E] FOREIGN KEY([VARDIYA1_ID])
REFERENCES [dbo].[VARDIYA] ([ID])
GO
ALTER TABLE [dbo].[VARDIYASABLONU] CHECK CONSTRAINT [FKA1AB17EA12AFEA6E]
GO
ALTER TABLE [dbo].[VARDIYASABLONU]  WITH CHECK ADD  CONSTRAINT [FKA1AB17EA12B05ECD] FOREIGN KEY([VARDIYA2_ID])
REFERENCES [dbo].[VARDIYA] ([ID])
GO
ALTER TABLE [dbo].[VARDIYASABLONU] CHECK CONSTRAINT [FKA1AB17EA12B05ECD]
GO
ALTER TABLE [dbo].[VARDIYASABLONU]  WITH CHECK ADD  CONSTRAINT [FKA1AB17EA12B0D32C] FOREIGN KEY([VARDIYA3_ID])
REFERENCES [dbo].[VARDIYA] ([ID])
GO
ALTER TABLE [dbo].[VARDIYASABLONU] CHECK CONSTRAINT [FKA1AB17EA12B0D32C]
GO
ALTER TABLE [dbo].[VARDIYASABLONU]  WITH CHECK ADD  CONSTRAINT [FKA1AB17EA12B1478B] FOREIGN KEY([VARDIYA4_ID])
REFERENCES [dbo].[VARDIYA] ([ID])
GO
ALTER TABLE [dbo].[VARDIYASABLONU] CHECK CONSTRAINT [FKA1AB17EA12B1478B]
GO
ALTER TABLE [dbo].[VARDIYASABLONU]  WITH CHECK ADD  CONSTRAINT [FKA1AB17EA12B1BBEA] FOREIGN KEY([VARDIYA5_ID])
REFERENCES [dbo].[VARDIYA] ([ID])
GO
ALTER TABLE [dbo].[VARDIYASABLONU] CHECK CONSTRAINT [FKA1AB17EA12B1BBEA]
GO
ALTER TABLE [dbo].[VARDIYASABLONU]  WITH CHECK ADD  CONSTRAINT [FKA1AB17EA12B23049] FOREIGN KEY([VARDIYA6_ID])
REFERENCES [dbo].[VARDIYA] ([ID])
GO
ALTER TABLE [dbo].[VARDIYASABLONU] CHECK CONSTRAINT [FKA1AB17EA12B23049]
GO
ALTER TABLE [dbo].[VARDIYASABLONU]  WITH CHECK ADD  CONSTRAINT [FKA1AB17EA12B2A4A8] FOREIGN KEY([VARDIYA7_ID])
REFERENCES [dbo].[VARDIYA] ([ID])
GO
ALTER TABLE [dbo].[VARDIYASABLONU] CHECK CONSTRAINT [FKA1AB17EA12B2A4A8]
GO
ALTER TABLE [dbo].[VARDIYASABLONU]  WITH CHECK ADD  CONSTRAINT [FKA1AB17EA16DC2470] FOREIGN KEY([OLUSTURANUSER_ID])
REFERENCES [dbo].[PDKSUSER] ([ID])
GO
ALTER TABLE [dbo].[VARDIYASABLONU] CHECK CONSTRAINT [FKA1AB17EA16DC2470]
GO
ALTER TABLE [dbo].[VARDIYASABLONU]  WITH CHECK ADD  CONSTRAINT [FKA1AB17EA66572C6C] FOREIGN KEY([DEPARTMAN_ID])
REFERENCES [dbo].[DEPARTMAN] ([ID])
GO
ALTER TABLE [dbo].[VARDIYASABLONU] CHECK CONSTRAINT [FKA1AB17EA66572C6C]
GO
ALTER TABLE [dbo].[VARDIYASABLONU]  WITH CHECK ADD  CONSTRAINT [FKA1AB17EA856B6B7E] FOREIGN KEY([GUNCELLEYENUSER_ID])
REFERENCES [dbo].[PDKSUSER] ([ID])
GO
ALTER TABLE [dbo].[VARDIYASABLONU] CHECK CONSTRAINT [FKA1AB17EA856B6B7E]
GO
ALTER TABLE [dbo].[VARDIYASABLONU]  WITH CHECK ADD  CONSTRAINT [FKA1AB17EAB3C17550] FOREIGN KEY([CALISMA_MODELI_ID])
REFERENCES [dbo].[CALISMA_MODELI] ([ID])
GO
ALTER TABLE [dbo].[VARDIYASABLONU] CHECK CONSTRAINT [FKA1AB17EAB3C17550]
GO
ALTER TABLE [dbo].[VELAKET_YONETICI]  WITH CHECK ADD  CONSTRAINT [FK25D1213116DC2470] FOREIGN KEY([OLUSTURANUSER_ID])
REFERENCES [dbo].[PDKSUSER] ([ID])
GO
ALTER TABLE [dbo].[VELAKET_YONETICI] CHECK CONSTRAINT [FK25D1213116DC2470]
GO
ALTER TABLE [dbo].[VELAKET_YONETICI]  WITH CHECK ADD  CONSTRAINT [FK25D121315D73CA2E] FOREIGN KEY([YENI_YONETICI])
REFERENCES [dbo].[PDKSUSER] ([ID])
GO
ALTER TABLE [dbo].[VELAKET_YONETICI] CHECK CONSTRAINT [FK25D121315D73CA2E]
GO
ALTER TABLE [dbo].[VELAKET_YONETICI]  WITH CHECK ADD  CONSTRAINT [FK25D12131856B6B7E] FOREIGN KEY([GUNCELLEYENUSER_ID])
REFERENCES [dbo].[PDKSUSER] ([ID])
GO
ALTER TABLE [dbo].[VELAKET_YONETICI] CHECK CONSTRAINT [FK25D12131856B6B7E]
GO
ALTER TABLE [dbo].[VELAKET_YONETICI]  WITH CHECK ADD  CONSTRAINT [FK25D121318AA28E11] FOREIGN KEY([VEKALET_VEREN])
REFERENCES [dbo].[PDKSUSER] ([ID])
GO
ALTER TABLE [dbo].[VELAKET_YONETICI] CHECK CONSTRAINT [FK25D121318AA28E11]
GO
ALTER TABLE [dbo].[YEMEK_KARTSIZ]  WITH CHECK ADD  CONSTRAINT [FK8EA9969416DC2470] FOREIGN KEY([OLUSTURANUSER_ID])
REFERENCES [dbo].[PDKSUSER] ([ID])
GO
ALTER TABLE [dbo].[YEMEK_KARTSIZ] CHECK CONSTRAINT [FK8EA9969416DC2470]
GO
ALTER TABLE [dbo].[YEMEK_KARTSIZ]  WITH CHECK ADD  CONSTRAINT [FK8EA996943F28F95E] FOREIGN KEY([OGUN_ID])
REFERENCES [dbo].[YEMEKOGUN] ([ID])
GO
ALTER TABLE [dbo].[YEMEK_KARTSIZ] CHECK CONSTRAINT [FK8EA996943F28F95E]
GO
ALTER TABLE [dbo].[YEMEK_KARTSIZ]  WITH CHECK ADD  CONSTRAINT [FK8EA99694575EE053] FOREIGN KEY([SIRKET_ID])
REFERENCES [dbo].[SIRKET] ([ID])
GO
ALTER TABLE [dbo].[YEMEK_KARTSIZ] CHECK CONSTRAINT [FK8EA99694575EE053]
GO
ALTER TABLE [dbo].[YEMEK_KARTSIZ]  WITH CHECK ADD  CONSTRAINT [FK8EA996946400FFDD] FOREIGN KEY([KAPI_ID])
REFERENCES [dbo].[KAPI] ([ID])
GO
ALTER TABLE [dbo].[YEMEK_KARTSIZ] CHECK CONSTRAINT [FK8EA996946400FFDD]
GO
ALTER TABLE [dbo].[YEMEK_KARTSIZ]  WITH CHECK ADD  CONSTRAINT [FK8EA99694856B6B7E] FOREIGN KEY([GUNCELLEYENUSER_ID])
REFERENCES [dbo].[PDKSUSER] ([ID])
GO
ALTER TABLE [dbo].[YEMEK_KARTSIZ] CHECK CONSTRAINT [FK8EA99694856B6B7E]
GO
ALTER TABLE [dbo].[YEMEKIZIN]  WITH CHECK ADD  CONSTRAINT [FKEEBD51BD16DC2470] FOREIGN KEY([OLUSTURANUSER_ID])
REFERENCES [dbo].[PDKSUSER] ([ID])
GO
ALTER TABLE [dbo].[YEMEKIZIN] CHECK CONSTRAINT [FKEEBD51BD16DC2470]
GO
ALTER TABLE [dbo].[YEMEKIZIN]  WITH CHECK ADD  CONSTRAINT [FKEEBD51BD856B6B7E] FOREIGN KEY([GUNCELLEYENUSER_ID])
REFERENCES [dbo].[PDKSUSER] ([ID])
GO
ALTER TABLE [dbo].[YEMEKIZIN] CHECK CONSTRAINT [FKEEBD51BD856B6B7E]
GO
ALTER TABLE [dbo].[YEMEKOGUN]  WITH CHECK ADD  CONSTRAINT [FKEEBFC61816DC2470] FOREIGN KEY([OLUSTURANUSER_ID])
REFERENCES [dbo].[PDKSUSER] ([ID])
GO
ALTER TABLE [dbo].[YEMEKOGUN] CHECK CONSTRAINT [FKEEBFC61816DC2470]
GO
ALTER TABLE [dbo].[YEMEKOGUN]  WITH CHECK ADD  CONSTRAINT [FKEEBFC618856B6B7E] FOREIGN KEY([GUNCELLEYENUSER_ID])
REFERENCES [dbo].[PDKSUSER] ([ID])
GO
ALTER TABLE [dbo].[YEMEKOGUN] CHECK CONSTRAINT [FKEEBFC618856B6B7E]
GO
/****** Object:  StoredProcedure [dbo].[SP_ADD_KAPI_HAREKET_SIRKET]    Script Date: 20.12.2023 17:26:32 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
 
CREATE PROCEDURE [dbo].[SP_ADD_KAPI_HAREKET_SIRKET]
	@HAREKET_ZAMANI DATETIME,@USERID [numeric](19, 0), @DOORID [numeric](19, 0),@KGS_ID [numeric](19, 0),  
	@DURUM [numeric](19, 0), @KGS_SIRKET_ID [numeric](19, 0)
WITH EXECUTE AS CALLER
AS
BEGIN
	IF (dbo.FN_PDKS_TABLE_UPDATE_DURUM('PDKS_LOG')=1) BEGIN
		   
	  BEGIN TRY
		INSERT INTO PDKS_LOG ([HAREKET_ZAMANI]  ,[USERID]   ,[KAPIID]   ,[KGS_ID]     ,KGS_SIRKET_ID ,[OLUSTURMA_ZAMANI]  ,[DURUM])
			SELECT @HAREKET_ZAMANI,@USERID,@DOORID,@KGS_ID,@KGS_SIRKET_ID,GETDATE(),@DURUM FROM PERSONEL_SIRKET_KGS P  WITH(nolock)
				INNER JOIN KAPI_SIRKET_KGS K ON K.KGS_ID=@DOORID AND  P.KGS_SIRKET_ID= K.KGS_SIRKET_ID AND K.KAPI_ID IS NOT NULL
				LEFT JOIN  [dbo].[PDKS_LOG]   L ON L.KGS_ID=@KGS_ID AND L.KGS_SIRKET_ID=P.KGS_SIRKET_ID
			WHERE P.KGS_SIRKET_ID=@KGS_SIRKET_ID AND P.KGS_ID=@USERID AND    L.ID IS NULL
	  END TRY
	  BEGIN CATCH
	  END CATCH
   END
END
 
GO
/****** Object:  StoredProcedure [dbo].[SP_ANAVERI_SIRKET]    Script Date: 20.12.2023 17:26:32 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[SP_ANAVERI_SIRKET]
	@MASTER_ID [numeric](19, 0)  
WITH EXECUTE AS CALLER
AS
BEGIN
	-- SET NOCOUNT ON added to prevent extra result sets from
	-- interfering with SELECT statements.
	SET NOCOUNT ON;
	DECLARE @SP_ADI varchar(80) ,@SICIL_NO nvarchar(80) , @TABLE_ID [numeric](19, 0) , @VALID [numeric](19, 0)
	DECLARE @ID [numeric](19, 0) 
	DECLARE @KGS_SIRKET_ID [numeric](19, 0) 
	DECLARE  @PDKS_ID [numeric](19, 0) 
	DECLARE @ISLEM_ID [numeric](19, 0) 
	DECLARE @ISLEM_ZAMAN datetime 
	DECLARE  @KGS_ID [numeric](19, 0) 
	SET @PDKS_ID = NULL;
	SET @SP_ADI = '';
	SET @ISLEM_ID = 0;
	SET @KGS_SIRKET_ID = 1;
	SELECT  @SP_ADI = SP_ADI, @ISLEM_ID = case when SP_ADI IN ('SP_PERSONEL', 'SP_KAPI') THEN ID ELSE -1 END, @TABLE_ID = TABLE_ID, @VALID = VALID, 
	    @ISLEM_ZAMAN = OLUSTURMA_ZAMANI, @KGS_SIRKET_ID = KGS_SIRKET_ID FROM PDKS_SP_ISLEM WITH(nolock)
	   WHERE ID = @MASTER_ID
    
    SET @ID = 0;
	IF (@ISLEM_ID>=0) BEGIN
		if (@SP_ADI = 'SP_PERSONEL') BEGIN
 				DECLARE PERSONEL_cursor CURSOR FOR   
				SELECT D.PersonelId  FROM WebPDKS.dbo.Personel  D  WITH(nolock)
 					WHERE D.PersonelId = @TABLE_ID ; 
	 
				OPEN PERSONEL_cursor
	 
				FETCH NEXT FROM PERSONEL_cursor INTO @ID 
				WHILE @@FETCH_STATUS = 0  
				BEGIN  
					  SET @ID = 1;
			  
						FETCH NEXT FROM PERSONEL_cursor INTO @ID 	 
 				END
				CLOSE PERSONEL_cursor;  
				DEALLOCATE PERSONEL_cursor;
 			    
 					IF (@ID = 1) BEGIN
						 
 					   UPDATE D  SET  DURUM = (1-T.Ayrilmis)*T.Gecerli, 
							AD = T.Adi, 
							SOYAD = T.Soyadi, 
							PERSONEL_NO = T.SicilNo, 
							KART_NO = T.KartId, 
							TC_KIMLIK_NO = T.KimlikNo, 
							DOGUM_TARIHI=T.DogumTarihi,
							ISE_BASLAMA_TARIHI=T.IsGirisTarihi,
							ISLEM_ZAMAN = @ISLEM_ZAMAN 
 								 FROM  PERSONEL_SIRKET_KGS  D 
								 INNER JOIN WebPDKS.dbo.Personel   T ON T.PersonelId = @TABLE_ID   
   								  WHERE D.KGS_ID = @TABLE_ID AND D.KGS_SIRKET_ID = @KGS_SIRKET_ID

					END ELSE BEGIN	 
				    IF (@ID = 0 AND @VALID = 1)
						 
						 INSERT INTO  PERSONEL_SIRKET_KGS   
						 (KGS_ID, 	DURUM, AD, SOYAD, PERSONEL_NO, KART_NO, TC_KIMLIK_NO,DOGUM_TARIHI,ISE_BASLAMA_TARIHI, KGS_SIRKET_ID, ISLEM_ZAMAN)  
						SELECT D.PersonelId, (1-D.Ayrilmis)*D.Gecerli, D.Adi, D.Soyadi, 
							 D.SicilNo, D.KartId, D.KimlikNo,D.DogumTarihi,D.IsGirisTarihi, @KGS_SIRKET_ID, @ISLEM_ZAMAN  	FROM  WebPDKS.dbo.Personel  D WITH(nolock)
							LEFT JOIN  PERSONEL_SIRKET_KGS  P ON P.KGS_ID = D.PersonelId AND P.KGS_SIRKET_ID = @KGS_SIRKET_ID
							WHERE D.PersonelId = @TABLE_ID  AND P.ID IS NULL;
					END	
					 if (@TABLE_ID>0 AND @VALID = 0)  BEGIN
						  
						 UPDATE  PERSONEL_SIRKET_KGS SET DURUM = @VALID, ISLEM_ZAMAN = @ISLEM_ZAMAN  
						     WHERE KGS_ID = @TABLE_ID AND  KGS_SIRKET_ID = @KGS_SIRKET_ID ;
						END
					   
   						 INSERT INTO   PERSONEL_SIRKET_KGS  
						  (KGS_ID, 	DURUM, AD, SOYAD, PERSONEL_NO, KART_NO, TC_KIMLIK_NO,DOGUM_TARIHI,ISE_BASLAMA_TARIHI, KGS_SIRKET_ID, ISLEM_ZAMAN) 
							SELECT D.PersonelId, (1-D.Ayrilmis)*D.Gecerli, D.Adi, D.Soyadi, 
								 D.SicilNo, D.KartId, D.KimlikNo,D.DogumTarihi,D.IsGirisTarihi, @KGS_SIRKET_ID, @ISLEM_ZAMAN  	FROM  WebPDKS.dbo.Personel  D WITH(nolock)
							LEFT JOIN  PERSONEL_SIRKET_KGS  P ON P.KGS_ID = D.PersonelId AND P.KGS_SIRKET_ID = @KGS_SIRKET_ID
							WHERE D.PersonelId = @TABLE_ID  AND P.ID IS NULL;

						 
     END
	 ELSE
	if (@SP_ADI='SP_KAPI') BEGIN
	 
 				  DECLARE KAPI_cursor CURSOR FOR   
				  SELECT D.ID,P.ID AS PDKS_ID FROM TERMINAL_SIRKET_VIEW D WITH(nolock)
					LEFT JOIN  KAPI_SIRKET_KGS P ON P.KGS_ID=D.ID AND P.KGS_SIRKET_ID=D.KGS_SIRKET_ID
 					WHERE D.TERMINAL_ID = @TABLE_ID AND D.KGS_SIRKET_ID=@KGS_SIRKET_ID ; 
	 
				OPEN KAPI_cursor
 				FETCH NEXT FROM KAPI_cursor INTO @KGS_ID,@PDKS_ID
				WHILE @@FETCH_STATUS = 0  
				BEGIN  
					  SET @ID =  1;
 						FETCH NEXT FROM KAPI_cursor INTO @KGS_ID,@PDKS_ID	 
 				END
				CLOSE KAPI_cursor;  
				DEALLOCATE KAPI_cursor;
		 
  				 IF (@ID=1) BEGIN
					UPDATE  D SET 
					DURUM = T.DURUM, 
					ACIKLAMA = T.ACIKLAMA	, 
					ISLEM_ZAMAN = @ISLEM_ZAMAN, 
					KART_YONU = T.YON ,
					TERMINAL_NO=COALESCE(T.TERMINAL_NO,D.TERMINAL_NO)
							FROM  KAPI_SIRKET_KGS D 
						 INNER JOIN TERMINAL_SIRKET_VIEW  T ON  T.TERMINAL_ID = @TABLE_ID AND D.KGS_SIRKET_ID = T.KGS_SIRKET_ID
						 WHERE D.KGS_ID = T.ID AND D.KGS_SIRKET_ID = @KGS_SIRKET_ID;
					 IF (@TABLE_ID >0 AND @PDKS_ID IS NULL)
						INSERT INTO   KAPI_SIRKET_KGS  
							([KGS_ID], ACIKLAMA,KART_YONU, DURUM,KGS_SIRKET_ID,TERMINAL_NO,KAPI_DEGISTIR, ISLEM_ZAMAN)  
							SELECT D.ID, D.ACIKLAMA, D.yon, 1 Gecerli,@KGS_SIRKET_ID,D.TERMINAL_NO,D.KAPI_DEGISTIR, @ISLEM_ZAMAN 	FROM TERMINAL_SIRKET_VIEW D WITH(nolock)
 							  LEFT JOIN  KAPI_SIRKET_KGS P ON P.KGS_ID=D.ID AND P.KGS_SIRKET_ID=D.KGS_SIRKET_ID
							WHERE D.TERMINAL_ID = @TABLE_ID  AND D.KGS_SIRKET_ID = @KGS_SIRKET_ID  AND  P.ID IS NULL
							ORDER BY D.YON;			 

				END  
				 if (@TABLE_ID>0 AND @VALID=0) BEGIN
					UPDATE   KAPI_SIRKET_KGS SET DURUM=@VALID,ISLEM_ZAMAN=@ISLEM_ZAMAN  WHERE  KGS_SIRKET_ID=@KGS_SIRKET_ID 
						AND  KGS_ID IN (SELECT ID FROM TERMINAL_SIRKET_VIEW WHERE TERMINAL_ID= @TABLE_ID ) ;
				END
				UPDATE   KAPI_SIRKET_KGS SET DURUM=0,ISLEM_ZAMAN=getdate()  WHERE  KGS_SIRKET_ID=@KGS_SIRKET_ID 
						AND  KGS_ID NOT IN (SELECT ID FROM TERMINAL_SIRKET_VIEW ) AND DURUM=1 and COALESCE(MANUEL,0)=0;
		 end 
	 	  
		 
			 DELETE FROM  PDKS_SP_ISLEM   WHERE ID=@ISLEM_ID
			 PRINT CONVERT(varchar(100), @ISLEM_ID) +' '+@SP_ADI  + ' Table Id : ' + CONVERT(varchar(10), @TABLE_ID)  + ' Valid : ' + CONVERT(varchar(3), @VALID)   
		   
	END
 
END


GO
/****** Object:  StoredProcedure [dbo].[SP_ANAVERI_START]    Script Date: 20.12.2023 17:26:32 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
 
CREATE PROCEDURE [dbo].[SP_ANAVERI_START]
	@SP_ADI [nchar](80),@TABLE_ID [numeric](19, 0),   @DURUM [numeric](19, 0), @KGS_SIRKET_ID [numeric](19, 0)
WITH EXECUTE AS CALLER
AS
BEGIN
	IF (dbo.[FN_PDKS_UPDATE_DURUM]()=1) BEGIN
		 DECLARE @islemId [numeric](19, 0)
		  BEGIN TRY
			INSERT INTO PDKS_SP_ISLEM (SP_ADI,TABLE_ID,KGS_SIRKET_ID,VALID,OLUSTURMA_ZAMANI) VALUES (@SP_ADI,@TABLE_ID,@KGS_SIRKET_ID,@DURUM,GETDATE());
			SELECT @islemId=SCOPE_IDENTITY();
			EXEC  SP_ANAVERI_SIRKET @islemId;
			IF (@KGS_SIRKET_ID=1) BEGIN
			   EXEC  SP_ANAVERI_SIRKET @islemId;
            END
			if (@islemId> = 0) BEGIN
			   DELETE FROM  PDKS_SP_ISLEM   WHERE ID = @islemId
			   PRINT CONVERT(varchar(16), @islemId) + ' ' + RTRIM(@SP_ADI)  + ' Table Id : ' + CONVERT(varchar(16), @TABLE_ID)  + ' Valid : ' + CONVERT(varchar(3), @DURUM)   
            END
			EXEC SP_CHECKIDENT_VIEW
		  END TRY
		  BEGIN CATCH
		  END CATCH
	  END
END
GO
/****** Object:  StoredProcedure [dbo].[SP_CHECKIDENT_VIEW]    Script Date: 20.12.2023 17:26:32 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO



CREATE PROCEDURE [dbo].[SP_CHECKIDENT_VIEW]
	 
WITH EXECUTE AS CALLER
AS
BEGIN
	-- SET NOCOUNT ON added to prevent extra result sets from
	-- interfering with SELECT statements.
	SET NOCOUNT ON;
	 DECLARE @COLUMN_NAME VARCHAR(1024), @TABLE_NAME VARCHAR(1024),@TABLE_SCHEMA VARCHAR(1024) ;
	 DECLARE @sqlCommand nvarchar(max) 
	DECLARE CHECKIDENT_cursor CURSOR FOR   
	select   C.COLUMN_NAME, C.TABLE_NAME,C.TABLE_SCHEMA from INFORMATION_SCHEMA.COLUMNS  C
		INNER JOIN INFORMATION_SCHEMA.TABLES T ON T.TABLE_NAME=C.TABLE_NAME AND T.TABLE_TYPE='BASE TABLE'
		where COLUMNPROPERTY(object_id(C.TABLE_SCHEMA+'.'+C.TABLE_NAME), C.COLUMN_NAME, 'IsIdentity') = 1
		AND C.TABLE_NAME NOT IN ('sysdiagrams')
		order by C.TABLE_NAME ; 
	 set  @sqlCommand='WITH DATALAR AS (';
	OPEN CHECKIDENT_cursor
	 
	FETCH NEXT FROM CHECKIDENT_cursor INTO @COLUMN_NAME, @TABLE_NAME, @TABLE_SCHEMA
	WHILE @@FETCH_STATUS = 0  
		BEGIN   
		 set  @sqlCommand =@sqlCommand+' SELECT  MAX('+@COLUMN_NAME+') as ID,'''+@TABLE_SCHEMA+'.'+ @TABLE_NAME		 +''' AS TABLE_NAME,';
	 
		  set  @sqlCommand =@sqlCommand+'IDENT_CURRENT( '''+@TABLE_SCHEMA+'.'+ @TABLE_NAME+''' )  AS IDENT  FROM '+@TABLE_SCHEMA+'.'+ @TABLE_NAME;
		 FETCH NEXT FROM CHECKIDENT_cursor INTO @COLUMN_NAME, @TABLE_NAME, @TABLE_SCHEMA
		 IF @@FETCH_STATUS = 0 
			 set  @sqlCommand =@sqlCommand+' UNION ALL ';
		  
		END
		CLOSE CHECKIDENT_cursor;  
	 DEALLOCATE CHECKIDENT_cursor;
  	  set  @sqlCommand =@sqlCommand+' )  ';
 	  set  @sqlCommand =@sqlCommand+' SELECT ''DBCC CHECKIDENT (''''''+TABLE_NAME+'''''', RESEED,''+'+ 'CAST(COALESCE( ID ,0) AS VARCHAR(12))+''); '' AS  CHECKIDENT ,IDENT FROM DATALAR';
 	  set  @sqlCommand =@sqlCommand+' WHERE COALESCE( ID ,0)<>IDENT ';
	  
 --  EXECUTE sp_executesql @sqlCommand


    SET @sqlCommand =' DECLARE  @IDENT  [numeric](19, 0) DECLARE  @CHECKIDENT nvarchar(max)  DECLARE Update_Cursor CURSOR FOR ' +@sqlCommand + 'OPEN Update_Cursor '
	SET @sqlCommand = @sqlCommand +' FETCH NEXT FROM Update_Cursor INTO @CHECKIDENT,@IDENT
			WHILE @@FETCH_STATUS = 0  
			BEGIN PRINT @CHECKIDENT  EXECUTE sp_executesql  @CHECKIDENT 	FETCH NEXT FROM Update_Cursor INTO  @CHECKIDENT,@IDENT
 			END CLOSE Update_Cursor;  
			DEALLOCATE Update_Cursor;'
--	PRINT @sqlCommand
	EXECUTE sp_executesql    @sqlCommand 

END
GO
/****** Object:  StoredProcedure [dbo].[SP_DELETE_FAZLA_MESAI_TALEP_HAREKET_DATA]    Script Date: 20.12.2023 17:26:32 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO

CREATE PROCEDURE [dbo].[SP_DELETE_FAZLA_MESAI_TALEP_HAREKET_DATA]
	 @talepId bigint 
WITH EXECUTE AS CALLER
AS
BEGIN
 	SET NOCOUNT ON;
	DECLARE @ACIKLAMA varchar(max)  
	DECLARE @ID bigint 
	DECLARE @ISLEM_ID bigint 
		DECLARE @adet int 
	 SET @ACIKLAMA ='%:' +RTRIM ( CAST(@talepId as varchar(max))) +'%'  
	 SET @adet=0 
 	  DECLARE PERSONEL_cursor CURSOR FOR   
	  SELECT ID FROM PDKS_ISLEM  
			   WHERE  ACIKLAMA LIKE   @ACIKLAMA     
	 
		OPEN PERSONEL_cursor 
	 
		FETCH NEXT FROM PERSONEL_cursor INTO @ISLEM_ID
		WHILE @@FETCH_STATUS = 0  
		BEGIN  
		    SET @adet = @adet + 1 
		   DELETE FROM PDKS_HAREKET WHERE ISLEM_ID=@ISLEM_ID;
		   UPDATE PDKS_LOG SET DURUM=1,ISLEM_ID=NULL WHERE ISLEM_ID=@ISLEM_ID;
			DELETE FROM PDKS_ISLEM     WHERE ID=@ISLEM_ID; 
			PRINT   ' ISLEM_ID :  '+ CAST(@ISLEM_ID as varchar(max))    
				FETCH NEXT FROM PERSONEL_cursor INTO @ISLEM_ID	 
 		END
		CLOSE PERSONEL_cursor;  
		DEALLOCATE PERSONEL_cursor;
    	exec SP_CHECKIDENT_VIEW
		
		select @talepId
		   where @adet>0
				 
END
GO
/****** Object:  StoredProcedure [dbo].[SP_DELETE_HAREKET_NON_PDKS]    Script Date: 20.12.2023 17:26:32 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO

CREATE PROCEDURE [dbo].[SP_DELETE_HAREKET_NON_PDKS] 
--ALTER PROCEDURE [dbo].[SP_DELETE_HAREKET_NON_PDKS]
 
WITH EXECUTE AS CALLER
AS
BEGIN
 	   SET NOCOUNT ON;
 	   DECLARE @tarih date
	   DECLARE @gunAdet integer 
	   DECLARE @ID bigint
	   DECLARE @adet bigint
	   set @gunAdet=0
	   
	   WHILE @gunAdet< 30      BEGIN
		   SET @tarih=NULL
		   SELECT TOP 1  @tarih=CONVERT(date,L.HAREKET_ZAMANI) 	  FROM [dbo].PDKS_LOG L  WITH(nolock)
			   INNER JOIN KAPI_SIRKET_KGS K ON K.KGS_SIRKET_ID=L.KGS_SIRKET_ID AND K.KGS_ID=L.KAPIID
			  LEFT JOIN KAPI P ON P.KGS_ID=K.ID
			  WHERE P.ID IS NULL
			  ORDER BY L.HAREKET_ZAMANI DESC
  
			   IF @tarih IS NULL     BEGIN
				   BREAK
				END
				SET @gunAdet= @gunAdet + 1
				PRINT   CAST(@gunAdet AS varchar(18) ) +'. '+ Convert(CHAR(8),@tarih,112)+' '+convert(varchar, getdate(), 120)
				PRINT ' '
				DECLARE LOG_cursor CURSOR FOR   
					SELECT     L.ID	  FROM  [dbo].PDKS_LOG L  WITH(nolock)
					    INNER JOIN KAPI_SIRKET_KGS K ON K.KGS_SIRKET_ID=L.KGS_SIRKET_ID AND K.KGS_ID=L.KAPIID
			            LEFT JOIN KAPI P ON P.KGS_ID=K.ID
 					  WHERE L.HAREKET_ZAMANI>=@tarih AND  L.HAREKET_ZAMANI<DATEADD(DAY, 1, @tarih) AND P.ID IS NULL
				 
						 
	 
				OPEN LOG_cursor
				FETCH NEXT FROM LOG_cursor INTO @ID
				set @adet=0
				WHILE @@FETCH_STATUS = 0  BEGIN  
						  DELETE FROM  [dbo].PDKS_LOG WHERE ID=@ID
						SET @adet = @adet + 1
						FETCH NEXT FROM LOG_cursor INTO @ID
				END
				PRINT  CAST(@adet AS varchar(18) ) +' adet silindi '+  convert(varchar, getdate(), 120)
				PRINT ' '
				PRINT '---------------------'
 
				PRINT ' '
				CLOSE LOG_cursor;  
				DEALLOCATE LOG_cursor;
  			    
	   END
	   
		   
END
GO
/****** Object:  StoredProcedure [dbo].[SP_DELETE_KAPI_HAREKET]    Script Date: 20.12.2023 17:26:32 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
 
 
CREATE PROCEDURE [dbo].[SP_DELETE_KAPI_HAREKET]
	 @DELETE_ID [numeric](19, 0),   @KGS_SIRKET_ID [numeric](19, 0)
WITH EXECUTE AS CALLER
AS
BEGIN
     IF (dbo.FN_PDKS_TABLE_UPDATE_DURUM('PDKS_LOG')=1) BEGIN
		  BEGIN TRY
			 UPDATE  PDKS_LOG  SET DURUM=0,GUNCELLEME_ZAMANI =GETDATE(),ISLEM_ID=NULL  WHERE KGS_ID=@DELETE_ID AND KGS_SIRKET_ID=@KGS_SIRKET_ID;
		  END TRY
		  BEGIN CATCH
		  END CATCH
	  END
END
GO
/****** Object:  StoredProcedure [dbo].[SP_FAZLA_MESAI_TALEP_MAIL]    Script Date: 20.12.2023 17:26:32 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
 
CREATE PROCEDURE [dbo].[SP_FAZLA_MESAI_TALEP_MAIL]
	@YIL int,@AY int,@YONETICI_ID bigint,@BASTARIH nvarchar(10),@BITTARIH nvarchar(10)
WITH EXECUTE AS CALLER
AS
BEGIN
	-- SET NOCOUNT ON added to prevent extra result sets from
	-- interfering with SELECT statements.
	SET NOCOUNT ON;
	DECLARE @PER_ID nvarchar(max) 
	DECLARE @QRY nvarchar(max)  
	DECLARE @IDSTR nvarchar(20) 
	DECLARE @TARIH_SECILI int
	SET @TARIH_SECILI = 0;
	SET @PER_ID = '';
	SET @QRY = '';
	IF (@YONETICI_ID>0) BEGIN
		 DECLARE PERSONEL_cursor CURSOR FOR 
			SELECT CAST(P.ID AS NVARCHAR(20) ) AS ID  FROM PERSONEL M WITH(nolock)
			INNER JOIN PERSONEL P ON P.YONETICI_ID=M.ID
			WHERE M.YONETICI_ID=@YONETICI_ID;
			OPEN PERSONEL_cursor
		    FETCH NEXT FROM PERSONEL_cursor INTO @IDSTR
					WHILE @@FETCH_STATUS = 0 
					BEGIN
						IF @PER_ID<>'' BEGIN
						 SET @PER_ID= @PER_ID + ','
						END
						SET @PER_ID=@PER_ID + @IDSTR 
						FETCH NEXT FROM PERSONEL_cursor INTO @IDSTR
			END
			CLOSE PERSONEL_cursor; 
			DEALLOCATE PERSONEL_cursor;
     END
	 DECLARE @BAGLAC nvarchar(20)  
  	 SET @BAGLAC = ' WHERE ';
	 SET @QRY = 'SELECT F.*  FROM VARDIYA_GUN V WITH(nolock) ' 
	 SET @QRY = @QRY + ' INNER JOIN [FAZLA_MESAI_TALEP] F ON F.VARDIYA_GUN_ID=V.ID '
	 
	 IF @PER_ID<>'' BEGIN
		SET @QRY = @QRY + @BAGLAC+ ' V.PERSONEL_ID IN ('+ @PER_ID +')'
		SET @BAGLAC = ' AND ';
	 END
 	 IF @BASTARIH IS NOT NULL AND @BASTARIH<>'' BEGIN
		SET @QRY = @QRY + @BAGLAC+ ' V.VARDIYA_TARIHI >= convert(datetime, '''+@BASTARIH+''',120) '
		SET @BAGLAC = ' AND ';
		SET @TARIH_SECILI = @TARIH_SECILI + 1;
	 END 
 	 IF @BITTARIH IS NOT NULL AND @BITTARIH<>'' BEGIN
		SET @QRY = @QRY + @BAGLAC+ ' V.VARDIYA_TARIHI <= convert(datetime, '''+@BITTARIH+''',120) '
		SET @BAGLAC = ' AND ';
		SET @TARIH_SECILI = @TARIH_SECILI + 1;
	 END 	 
	 
	 IF (@TARIH_SECILI<2) BEGIN
		 SET @QRY = @QRY + @BAGLAC+ ' YEAR(V.VARDIYA_TARIHI)='+ CAST( @YIL AS VARCHAR(20))  +' AND MONTH(V.VARDIYA_TARIHI)='  +CAST( @AY AS VARCHAR(20)) 
		 SET @BAGLAC = ' AND ';
	 END
 
	 SET @QRY = @QRY + ' ORDER BY F.ONAY_DURUMU, V.VARDIYA_TARIHI, F.ID DESC '  
   PRINT @QRY
	 EXECUTE sp_executesql  @QRY 
END
GO
/****** Object:  StoredProcedure [dbo].[SP_FIND_OLD_USER]    Script Date: 20.12.2023 17:26:32 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
 


CREATE PROCEDURE [dbo].[SP_FIND_OLD_USER]
	 @PERSONEL_ID BIGINT 
WITH EXECUTE AS CALLER
AS
BEGIN
 
WITH KGS_PER AS (
SELECT ID, AD, SOYAD, PERSONEL_NO, COALESCE(KART_NO,'') KART_NO, DURUM, COALESCE(TC_KIMLIK_NO,'') TC_KIMLIK_NO FROM PERSONEL_SIRKET_KGS  WITH(nolock)
),
SECILI_PER AS (
SELECT  K.TC_KIMLIK_NO AS KIMLIK_NO,KART_NO,PERSONEL_NO,P.* FROM PERSONEL P  WITH(nolock)
INNER JOIN KGS_PER K ON K.ID=P.KGS_PERSONEL_ID
LEFT JOIN PDKSUSER U ON U.PERSONEL_ID=P.ID
WHERE P.ID=@PERSONEL_ID AND U.ID IS NULL AND ISTEN_AYRILIS_TARIHI>GETDATE()
), SONUC AS (
SELECT IP.* FROM SECILI_PER P
INNER JOIN PERSONEL_SIRKET_KGS K ON K.TC_KIMLIK_NO IN (P.TC_KIMLIK_NO,P.PERSONEL_NO) AND P.KGS_PERSONEL_ID<>K.ID
AND K.TC_KIMLIK_NO<>''
INNER JOIN PERSONEL IP ON IP.KGS_PERSONEL_ID=K.ID AND IP.ISTEN_AYRILIS_TARIHI<GETDATE()
UNION  
SELECT IP.* FROM SECILI_PER  P
INNER JOIN PERSONEL IP ON IP.KGS_PERSONEL_ID<>P.KGS_PERSONEL_ID   
AND P.AD=IP.AD AND P.SOYAD=IP.SOYAD AND IP.ISTEN_AYRILIS_TARIHI<GETDATE()
)
SELECT DISTINCT U.* FROM SONUC P  WITH(nolock)
INNER JOIN PDKSUSER U ON U.PERSONEL_ID=P.ID
  ORDER BY ID DESC
 

 

END
GO
/****** Object:  StoredProcedure [dbo].[SP_GET_AYLIK_VARDIYA_TOPLAM_ADET]    Script Date: 20.12.2023 17:26:32 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
 

CREATE PROCEDURE [dbo].[SP_GET_AYLIK_VARDIYA_TOPLAM_ADET]
-- Add the parameters for the stored procedure here
 
    @yil int, @ay int 

AS
BEGIN
-- SET NOCOUNT ON added to prevent extra result sets from
-- interfering with SELECT statements.
SET NOCOUNT ON;

    DECLARE @sqlCommand nvarchar(max)
	 
     
set  @sqlCommand =' WITH SONUC_DATA AS ( ';

set  @sqlCommand= @sqlCommand+ ' SELECT V.VARDIYA_ID,  COUNT(*) AS TOPLAM  FROM VARDIYA_GUN V  WITH(nolock) ';
set  @sqlCommand= @sqlCommand+'  INNER JOIN PERSONEL P ON P.ID=V.PERSONEL_ID AND V.VARDIYA_TARIHI>=P.ISE_BASLAMA_TARIHI ';
set  @sqlCommand= @sqlCommand+ ' INNER JOIN SIRKET S ON S.ID=P.SIRKET_ID ';
set  @sqlCommand= @sqlCommand+ ' INNER JOIN VARDIYA VA ON VA.ID=V.VARDIYA_ID AND VARDIYATIPI=''''';
set  @sqlCommand= @sqlCommand+ ' WHERE V.DURUM=1 AND  YEAR(VARDIYA_TARIHI)='+CAST(@yil as varchar(50)) +' AND MONTH(VARDIYA_TARIHI)='+CAST(@ay as varchar(50));
set  @sqlCommand= @sqlCommand+ ' AND  ((S.ISTEN_AYR_TAR_CALISIYOR=1 AND VARDIYA_TARIHI<=P.ISTEN_AYRILIS_TARIHI) ';
set  @sqlCommand= @sqlCommand+ ' OR  (S.ISTEN_AYR_TAR_CALISIYOR<>1 AND VARDIYA_TARIHI<P.ISTEN_AYRILIS_TARIHI)) ';
set  @sqlCommand= @sqlCommand+ '  GROUP BY  V.VARDIYA_ID)  ' ;
set  @sqlCommand= @sqlCommand+ ' SELECT V.VARDIYA_ID, VA.ADI,VA.KISA_ADI,V.TOPLAM FROM SONUC_DATA V  WITH(nolock) ';
set  @sqlCommand= @sqlCommand+ ' INNER JOIN VARDIYA VA ON VA.ID=V.VARDIYA_ID ';
 
set  @sqlCommand= @sqlCommand+ ' ORDER BY V.TOPLAM DESC,1';
 



  PRINT    @sqlCommand
EXECUTE sp_executesql    @sqlCommand  

 
END
GO
/****** Object:  StoredProcedure [dbo].[SP_GET_FAZLA_MESAI]    Script Date: 20.12.2023 17:26:32 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
 

CREATE PROCEDURE [dbo].[SP_GET_FAZLA_MESAI]
-- Add the parameters for the stored procedure here
 
  @sirketId int, @yil int, @ay int 

AS
BEGIN
-- SET NOCOUNT ON added to prevent extra result sets from
-- interfering with SELECT statements.
SET NOCOUNT ON;

    DECLARE @sqlCommand nvarchar(max)
	 DECLARE @donemId bigint
	 set @donemId=0;
     SELECT @donemId=ID from DENKLESTIRMEAY
	    where YIL=@yil and AY=@ay;
     
set  @sqlCommand =' WITH ERP_KOD_MESAI AS ( ';

set  @sqlCommand= @sqlCommand+ ' SELECT KODU as TIPI,ERP_KODU FROM TANIM  WITH(nolock) ';
set  @sqlCommand= @sqlCommand+ ' WHERE TIPI=''ERP_FAZLA_MESAI'' AND DURUM=1';
set  @sqlCommand= @sqlCommand+ ' ), ';
set  @sqlCommand= @sqlCommand+' AKSAM_MESAI AS ( ';

set  @sqlCommand= @sqlCommand+ ' SELECT CAST(DEGER as numeric(9,2)) DEGER  FROM PARAMETRE  WITH(nolock) ';
set  @sqlCommand= @sqlCommand+ ' WHERE ADI=''aksamVardiyaSayisiDurum''  AND DURUM=1 AND DEGER NOT IN (''0'','''')';
set  @sqlCommand= @sqlCommand+ ' ), ';
set  @sqlCommand= @sqlCommand+ ' MESAILER AS (';
set  @sqlCommand= @sqlCommand+ ' select D.PERSONEL_ID,D.ODENEN_SURE,D.AKSAM_VARDIYA_SAAT,D.AKSAM_VARDIYA_ADET,D.RESMI_TATIL_SURE,D.HAFTA_TATIL_SURE from PERSONELDENKLESTIRME D  WITH(nolock) ';
set  @sqlCommand= @sqlCommand+ ' INNER JOIN PERSONEL P ON P.ID=D.PERSONEL_ID AND (P.SANAL_PERSONEL IS NULL OR P.SANAL_PERSONEL<>1) ' ;
IF ( @sirketId <> 0  )  
	set  @sqlCommand= @sqlCommand+ '  AND P.SIRKET_ID= '+CAST(@sirketId as varchar(50)) ;
set @sqlCommand= @sqlCommand+ ' INNER JOIN SIRKET SS ON SS.ID=P.SIRKET_ID  AND SS.ERP_DURUM=1 ';
set @sqlCommand= @sqlCommand+ ' INNER JOIN DENKLESTIRMEAY A ON A.ID=D.DONEM_ID  ';
set  @sqlCommand= @sqlCommand+ ' WHERE DONEM_ID= '+CAST(@donemId as varchar(50)) ;
set  @sqlCommand= @sqlCommand+ ' AND ( ODENEN_SURE>0 OR AKSAM_VARDIYA_SAAT>0 OR AKSAM_VARDIYA_ADET>0 OR HAFTA_TATIL_SURE>0 OR RESMI_TATIL_SURE>0) ';
set  @sqlCommand= @sqlCommand+ ' AND (ERP_AKTARILDI IS  NULL OR ERP_AKTARILDI<>1) ';
set  @sqlCommand= @sqlCommand+ ' AND D.DURUM=1 AND D.ONAYLANDI=1 AND D.DENKLESTIRME_DURUM=1';
set  @sqlCommand= @sqlCommand+ ' ), ';
set  @sqlCommand= @sqlCommand+ ' DETAY AS ( ';
set  @sqlCommand= @sqlCommand+ ' SELECT PERSONEL_ID,''UO'' AS TIPI,ODENEN_SURE AS SURE FROM MESAILER ';
set  @sqlCommand= @sqlCommand+ ' WHERE ODENEN_SURE>0 ';
set  @sqlCommand= @sqlCommand+ ' UNION ALL ';
set  @sqlCommand= @sqlCommand+ ' SELECT PERSONEL_ID,''HT'' AS TIPI,HAFTA_TATIL_SURE AS SURE FROM MESAILER ';
set  @sqlCommand= @sqlCommand+ ' WHERE HAFTA_TATIL_SURE>0 ';
set  @sqlCommand= @sqlCommand+ ' UNION ALL ';
set  @sqlCommand= @sqlCommand+ ' SELECT M.PERSONEL_ID,CASE WHEN COALESCE(DEGER,11)=1 THEN  ''AX'' ELSE ''ASX'' END TIPI, ';
set  @sqlCommand= @sqlCommand+ ' COALESCE(DEGER,11) * AKSAM_VARDIYA_ADET AS SURE FROM MESAILER M ';
set  @sqlCommand= @sqlCommand+ ' LEFT JOIN AKSAM_MESAI A ON 1=1 ';
set  @sqlCommand= @sqlCommand+ ' WHERE AKSAM_VARDIYA_ADET>0  ';
set  @sqlCommand= @sqlCommand+ ' UNION ALL ';
set  @sqlCommand= @sqlCommand+ ' SELECT PERSONEL_ID,''ASX'' AS TIPI,AKSAM_VARDIYA_SAAT AS SURE FROM MESAILER ';
set  @sqlCommand= @sqlCommand+ ' WHERE AKSAM_VARDIYA_SAAT>0  ';
set  @sqlCommand= @sqlCommand+ ' UNION ALL ';
set  @sqlCommand= @sqlCommand+ ' SELECT PERSONEL_ID,''RT'' AS TIPI,RESMI_TATIL_SURE AS SURE FROM MESAILER ';
set  @sqlCommand= @sqlCommand+ ' WHERE RESMI_TATIL_SURE>0 ';
set  @sqlCommand= @sqlCommand+ ' ) ';
set  @sqlCommand= @sqlCommand+ '  SELECT  ROW_NUMBER() OVER(ORDER BY PERSONEL_ID ASC,E.ERP_KODU) AS ID, PERSONEL_ID,E.ERP_KODU,SUM(SURE) AS SURE FROM DETAY D ';
set  @sqlCommand= @sqlCommand+ 'INNER JOIN ERP_KOD_MESAI E ON E.TIPI=D.TIPI ';
set  @sqlCommand= @sqlCommand+ 'GROUP BY PERSONEL_ID,E.ERP_KODU ';



  PRINT    @sqlCommand
EXECUTE sp_executesql    @sqlCommand  

 
END
GO
/****** Object:  StoredProcedure [dbo].[SP_GET_FAZLA_MESAI_DATA_ALT]    Script Date: 20.12.2023 17:26:32 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
 
 

 
CREATE PROCEDURE [dbo].[SP_GET_FAZLA_MESAI_DATA_ALT]
	@denklestirme [bigint],
	@yoneticiId [bigint],
	@departmanId [bigint],
	@sirketId [bigint],
	@tesisId [nvarchar](max),
	@direktorId [bigint],
	@bolumId [bigint],
	@altBolumId [bigint],
	@tipi [nvarchar](2),
	@basTarih [nvarchar](20),
	@bitTarih [nvarchar](20),
	@format [nvarchar](20),
	@order [nvarchar](max)
WITH EXECUTE AS CALLER
AS
BEGIN
 	   SET NOCOUNT ON;
 	   DECLARE @sqlCommand nvarchar(max) 
	   DECLARE @yoneticiStr nvarchar(max) 
	   DECLARE @selectStr nvarchar(max) 
	   DECLARE @ekStr nvarchar(32) 
	   DECLARE @tarih1  nvarchar(32)
	   DECLARE @tarih2  nvarchar(32)
	   DECLARE @df  nvarchar(20)
	   DECLARE @denklestirmeStr nvarchar(max) 
	   DECLARE @uygulamaTipi  nvarchar(1)
	   DECLARE @yoneticiPerId nvarchar(100) 
	   DECLARE @iseGirisTarihiColumn nvarchar(100) 
	   DECLARE @sirketGrupId  [numeric](19, 0)
	   DECLARE @tesisDurum  integer
	   set @iseGirisTarihiColumn='ISE_BASLAMA_TARIHI'
	   select  @iseGirisTarihiColumn=DEGER  from PARAMETRE  WITH(nolock) 
	     WHERE ADI='grubaGirisTarihiAlanAdi' AND DURUM=1 AND  COALESCE(DEGER,'') IN ('ISE_BASLAMA_TARIHI','GRUBA_GIRIS_TARIHI')
	   set @denklestirmeStr = ''
	   set @uygulamaTipi=''
	   set @yoneticiPerId='';
	   set @tesisDurum=1
	    if (@sirketId IS NOT NULL AND @sirketId>0)  BEGIN
		   select  @sirketGrupId=SIRKET_GRUP_ID, @tesisDurum=TESIS_DURUM   from SIRKET  WITH(nolock) WHERE ID=@sirketId
		    if (@tesisDurum<>1)   
			   set @tesisId=''
            if (@sirketGrupId IS NOT NULL) 
		      set @sirketId=0
	     END
		
		 if (@bolumId IS NOT NULL AND @bolumId>0)  
		   select  @uygulamaTipi=RTRIM(DEGER) from PARAMETRE  WITH(nolock) WHERE ADI='uygulamaTipi' AND DURUM=1
	   
	   IF ( @format  IS NULL or @format='' )  
		     SET @df =  '112' ;
		else
			SET @df =  @format;
		set @yoneticiStr=''
 		if (@yoneticiId IS NOT NULL AND @yoneticiId>0) BEGIN

		    select  @yoneticiPerId =' OR P.ID = ' + convert(nvarchar(12), P.ID) from PARAMETRE PM,PERSONEL P  WITH(nolock) 
				WHERE PM.ADI='yoneticiKendiFazlaMesaiAc' AND PM.DEGER='1' AND PM.DURUM=1 AND P.ID=@yoneticiId
 			set @yoneticiStr=convert(nvarchar(12),@yoneticiId)
			DECLARE @ID bigint 
			DECLARE VEKALET_cursor CURSOR FOR 
				select DISTINCT V.PERSONEL_ID from VELAKET_YONETICI VY WITH(nolock) 
				INNER JOIN MENUITEM M ON M.NAME = 'vekilTanimlama' AND M.STATUS = 1
				INNER JOIN PDKSUSER Y ON Y.ID=VY.YENI_YONETICI AND Y.PERSONEL_ID=@yoneticiId
				INNER JOIN PDKSUSER V ON V.ID=VY.VEKALET_VEREN
				WHERE  VY.BASLANGIC_TARIHI<= CONVERT(DATE,GETDATE()) AND VY.BITIS_TARIHI>=CONVERT(DATE,GETDATE())
			OPEN VEKALET_cursor
	 
			FETCH NEXT FROM VEKALET_cursor INTO @ID
			WHILE @@FETCH_STATUS = 0  
			BEGIN  
				set @yoneticiStr=@yoneticiStr+','+convert(nvarchar(12),@ID);
 				FETCH NEXT FROM VEKALET_cursor INTO @ID	 
 			END
			CLOSE VEKALET_cursor;  
			DEALLOCATE VEKALET_cursor;
		END

	   IF ( @basTarih  IS NULL )  
		     SET @tarih1 =  '' ;
		else
			SET @tarih1 =  @basTarih; 	
       IF ( @bitTarih  IS NULL )  
		     SET @tarih2 =  '' ;
		else
			SET @tarih2 =    @bitTarih ; 	
	    IF ( @tarih1 <> '' and  @tarih2 <> ''  )  BEGIN
			 if (@denklestirme is not null and @denklestirme<>0) begin
			    if (@denklestirme>0)
				     set @denklestirmeStr = convert(nvarchar(12),@denklestirme)
					else begin
						DECLARE @DID bigint 
						DECLARE DONEM_cursor CURSOR FOR 
							WITH VERI AS (
								select D.ID,(YIL*100) + AY  AS DONEM from DENKLESTIRMEAY D WITH(nolock)
							)
							SELECT ID FROM VERI 
							WHERE DONEM >=CONVERT(BIGINT,LEFT(@tarih1,6)) AND DONEM <=CONVERT(BIGINT,LEFT(@tarih2,6))
						set @denklestirmeStr = @denklestirmeStr + '0';
						OPEN DONEM_cursor
						FETCH NEXT FROM DONEM_cursor INTO @DID
						WHILE @@FETCH_STATUS = 0  
						BEGIN  
							if (@denklestirmeStr<>'') set @denklestirmeStr = @denklestirmeStr + ','
							set @denklestirmeStr = @denklestirmeStr + convert(nvarchar(12),@DID);
 							FETCH NEXT FROM DONEM_cursor INTO @DID	 
 						END
						CLOSE DONEM_cursor;  
						DEALLOCATE DONEM_cursor;
					 
					END
 			    END
		     END
 			 set @sqlCommand = ' WITH VERILER AS (   SELECT  P.ID  AS PERSONEL_ID, P.YONETICI_ID FROM  PERSONEL P WITH(nolock) ';
			 set @sqlCommand = @sqlCommand + ' INNER JOIN SIRKET S ON S.ID=P.SIRKET_ID ';
			 if (@departmanId IS NOT NULL AND @departmanId>0) BEGIN 
				set @sqlCommand = @sqlCommand + ' AND S.DEPARTMAN_ID=' + convert(nvarchar(12),@departmanId);
 			 END;
			 set @sqlCommand = @sqlCommand + ' WHERE P.ISE_BASLAMA_TARIHI<=P.SSK_CIKIS_TARIHI ';
			 set @ekStr=' AND '
			 if (@sirketId IS NOT NULL AND @sirketId>0) BEGIN 
				set @sqlCommand = @sqlCommand + @ekStr + ' P.SIRKET_ID=' + convert(nvarchar(12),@sirketId);
				set @ekStr =' AND '
 			 END;
			if (@tesisId IS NOT NULL AND @tesisId<>'') BEGIN 
				set @sqlCommand = @sqlCommand + @ekStr + ' P.TESIS_ID IN ('+ @tesisId+' )' ;
				set @ekStr = ' AND '
 			 END;
			
			 
		    if (@yoneticiStr<>'') BEGIN 
				if (@direktorId IS NULL or @direktorId=0) BEGIN
					set @sqlCommand = @sqlCommand + @ekStr + ' ( P.YONETICI_ID IN ( ' + @yoneticiStr + ' ) ' + @yoneticiPerId;
						if (@departmanId IS NOT NULL AND @departmanId<0 ) 	set @sqlCommand = @sqlCommand +  ' OR S.DEPARTMAN_ID<>1 ';
					set @sqlCommand = @sqlCommand + ' ) ';
					set @ekStr = ' AND '
				END
 			 END  ELSE BEGIN
				 if (@departmanId IS NOT NULL AND @departmanId<0 ) 	set @sqlCommand = @sqlCommand +  @ekStr +  '  S.DEPARTMAN_ID<>1 ';
				  set @ekStr = ' AND '
			 
			 END
			if (@direktorId IS NOT NULL AND @direktorId>0) BEGIN
				set  @sqlCommand = @sqlCommand + @ekStr + ' ( P.EK_SAHA1_ID='+convert(nvarchar(12),@direktorId);
				 if (@yoneticiStr<>'')
					 set  @sqlCommand = @sqlCommand +  ' OR P.YONETICI_ID IN ( ' + @yoneticiStr + ' ) ' + @yoneticiPerId
				  set  @sqlCommand = @sqlCommand +  ' ) ';
				  set @ekStr = ' AND '
			 END ELSE
			 if (@bolumId IS NOT NULL AND @bolumId>0) BEGIN 
				set @sqlCommand = @sqlCommand + @ekStr + ' P.EK_SAHA3_ID=' + convert(nvarchar(12),@bolumId);
			    IF (@uygulamaTipi IS NOT NULL AND @uygulamaTipi='H' AND @tarih1 <> '' and  @tarih2 <> ''  )  BEGIN   
					set @sqlCommand = @sqlCommand + ' UNION ALL ' ;
					set @sqlCommand = @sqlCommand + ' SELECT DISTINCT P.ID  AS PERSONEL_ID, convert(BIGINT, 0' + @yoneticiStr + ') YONETICI_ID FROM VARDIYA_GUN V WITH(nolock) ' ;
					set @sqlCommand = @sqlCommand + ' INNER JOIN VARDIYA_GOREV G ON G.VARDIYA_GUN_ID=V.ID AND G.YENI_GOREV_YERI_ID='+convert(nvarchar(12),@bolumId); ;
					set @sqlCommand = @sqlCommand + ' INNER JOIN PERSONEL P ON P.ID=V.PERSONEL_ID ' ;
					if (@sirketId IS NOT NULL AND @sirketId>0) BEGIN 
						set @sqlCommand = @sqlCommand + ' AND P.SIRKET_ID=' + convert(nvarchar(12),@sirketId);
					END;
				    set @sqlCommand = @sqlCommand + ' INNER JOIN SIRKET S ON S.ID=P.SIRKET_ID ';
					if (@departmanId IS NOT NULL AND @departmanId>0) BEGIN 
							set @sqlCommand = @sqlCommand + ' AND S.DEPARTMAN_ID='+convert(nvarchar(12),@departmanId);
 				    END;
					set @sqlCommand = @sqlCommand + ' WHERE  V.VARDIYA_TARIHI<= convert(datetime, '''+@tarih2+''','+@df+') ';
				    set @sqlCommand = @sqlCommand + ' AND  V.VARDIYA_TARIHI>= convert(datetime, '''+@tarih1+''','+@df+') ';
				END; 
 			 END; 
 

			set @sqlCommand = @sqlCommand + ' ) ' ;
			set @sqlCommand = @sqlCommand + ' SELECT DISTINCT '+@tipi+'.* from VERILER V  WITH(nolock) '
			set @sqlCommand = @sqlCommand + ' INNER JOIN PERSONEL  P  ON V.PERSONEL_ID=P.ID  AND P.DURUM=1 ';
			if (@denklestirmeStr<>'') BEGIN
			 	set @sqlCommand = @sqlCommand + ' INNER JOIN PERSONELDENKLESTIRME PD ON PD.PERSONEL_ID=P.ID AND PD.DONEM_ID IN (' + @denklestirmeStr + ')';
			 	set @sqlCommand = @sqlCommand + ' INNER JOIN CALISMA_MODELI_AY CMA ON CMA.ID=PD.CALISMA_MODELI_AY_ID';
			 	set @sqlCommand = @sqlCommand + ' INNER JOIN CALISMA_MODELI CM  ON CM.ID=CMA.CALISMA_MODELI_ID';
				set @sqlCommand = @sqlCommand + ' AND (PD.DENKLESTIRME_DURUM=1  OR CM.FAZLA_CALISMA_GORUNTULENSIN=1)' ;
			END ELSE  BEGIN
 			 	set @sqlCommand = @sqlCommand + ' INNER JOIN CALISMA_MODELI CM  ON CM.ID=P.CALISMA_MODELI_ID';
			 	set @sqlCommand = @sqlCommand + ' AND (P.MAIL_TAKIP=1 OR P.PDKS=1 OR CM.FAZLA_CALISMA_GORUNTULENSIN=1)';
		     END
		     
			 set @sqlCommand = @sqlCommand + '  INNER JOIN SIRKET S ON S.ID=SIRKET_ID AND S.FAZLA_MESAI=1 '
			 if (@sirketGrupId IS NOT NULL AND @sirketGrupId>0) BEGIN 
				set @sqlCommand = @sqlCommand + ' AND  S.SIRKET_GRUP_ID=' + convert(nvarchar(12),@sirketGrupId);
 			 END;
			 if (@sirketId IS NOT NULL AND @sirketId>0) BEGIN 
				set @sqlCommand = @sqlCommand + ' AND  S.ID=' + convert(nvarchar(12),@sirketId);
 			 END;
			 if (@departmanId IS NOT NULL AND @departmanId>0) BEGIN 
				set @sqlCommand = @sqlCommand + ' AND S.DEPARTMAN_ID='+convert(nvarchar(12),@departmanId);
 			 END;
			 set @sqlCommand = @sqlCommand + '  INNER JOIN DEPARTMAN D ON D.ID=S.DEPARTMAN_ID '
			 set @sqlCommand = @sqlCommand + '  INNER JOIN TANIM B ON B.ID=P.EK_SAHA3_ID '
			 if (@bolumId IS NOT NULL AND @bolumId>0 ) BEGIN 
			    if ( @tipi='AB') 
			       set @sqlCommand = @sqlCommand + '  INNER JOIN TANIM AB ON AB.ID=P.EK_SAHA4_ID '
             END;

		    set @sqlCommand = @sqlCommand + '  LEFT JOIN TANIM T ON T.ID=P.TESIS_ID '
			if (@tesisId IS NOT NULL AND @tesisId<>'') BEGIN 
 				set @sqlCommand = @sqlCommand + ' AND T.ID IN ('+ @tesisId+' )';
  			 END;
			set @sqlCommand = @sqlCommand + ' WHERE P.DURUM=1 '
			IF ( @tarih1 <> '' )  BEGIN  
				  set @sqlCommand = @sqlCommand + ' AND P.SSK_CIKIS_TARIHI>=convert(date, ''' + @tarih1 + ''',' + @df + ') ';
		    END
		    IF ( @tarih2 <> '' )  BEGIN  
				  set @sqlCommand = @sqlCommand + ' AND P.' + @iseGirisTarihiColumn + '<= convert(date, ''' + @tarih2 + ''',' + @df + ') ';
 		    END			
			 
	 		 if (@altBolumId IS NOT NULL AND @altBolumId>0) BEGIN 
			    set  @sqlCommand = @sqlCommand + @ekStr + '  P.EK_SAHA4_ID='+convert(nvarchar(12),@altBolumId);
 				set @ekStr = ' AND '
 			 END;		
			if (@direktorId IS NOT NULL AND @direktorId>0) BEGIN
 				set  @sqlCommand = @sqlCommand +' AND ( P.EK_SAHA1_ID='+convert(nvarchar(12),@direktorId);
				 if (@yoneticiStr<>'')
					 set  @sqlCommand = @sqlCommand +  ' OR V.YONETICI_ID IN ( ' + @yoneticiStr + ' ) ' + @yoneticiPerId
				  set  @sqlCommand = @sqlCommand +  ' ) ';
				   if (@bolumId IS NOT NULL AND @bolumId>0) BEGIN 
					set @sqlCommand = @sqlCommand + ' AND  P.EK_SAHA3_ID ='+convert(nvarchar(12),@bolumId);
 				   END;
			  END ELSE BEGIN
				  if (@bolumId IS NOT NULL AND @bolumId>0) BEGIN 
					set @sqlCommand = @sqlCommand + ' AND  P.EK_SAHA3_ID ='+convert(nvarchar(12),@bolumId);
 				   END;
			  END;
			 
			  if (@yoneticiStr<>'') BEGIN 
				if (@direktorId IS NULL or @direktorId=0) BEGIN
					set @sqlCommand = @sqlCommand +  ' AND ( V.YONETICI_ID IN ( ' + @yoneticiStr + ' ) ' + @yoneticiPerId;
					  
					if (@departmanId IS NOT NULL AND @departmanId<0 ) 	set @sqlCommand = @sqlCommand +  ' OR S.DEPARTMAN_ID<>1 ';
					set @sqlCommand = @sqlCommand + ' ) ';
				END
 			 END ELSE BEGIN
				 if (@departmanId IS NOT NULL AND @departmanId<0 ) 	set @sqlCommand = @sqlCommand +  ' AND S.DEPARTMAN_ID<>1 ';

			 END
			 set @sqlCommand = @sqlCommand + ' AND '+@tipi+'.ID IS NOT NULL';
			  if (@order IS NOT NULL AND @order<>'')
				 set  @sqlCommand = @sqlCommand + ' ORDER BY '+@tipi+'.'+@order;
    	    
			 EXECUTE sp_executesql    @sqlCommand  
		   
		   
END

GO
/****** Object:  StoredProcedure [dbo].[SP_GET_FAZLA_MESAI_KONTROL]    Script Date: 20.12.2023 17:26:32 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
 

CREATE PROCEDURE [dbo].[SP_GET_FAZLA_MESAI_KONTROL]
 
	@perList [nvarchar](max),
	@yil [nvarchar](4),
	@ay [nvarchar](2),
	@ardisik [nvarchar](4),
	@ardisikDurum int,
	@maxCalismaSaatStr [nvarchar](200) 
WITH EXECUTE AS CALLER
AS
BEGIN
	-- SET NOCOUNT ON added to prevent extra result sets from
	-- interfering with SELECT statements.
	    SET NOCOUNT ON;
 	    DECLARE @sqlCommand nvarchar(max) 
		set  @sqlCommand= ' WITH MAX_GUN_SAYI AS ( SELECT ' + @ardisik +' ADET  ),   '
		set  @sqlCommand= @sqlCommand+ ' DATA AS (   '
		set  @sqlCommand= @sqlCommand+ ' select YEAR(V.VARDIYA_TARIHI) YIL, MONTH(V.VARDIYA_TARIHI) AY, DAY(V.VARDIYA_TARIHI) GUN, V.PERSONEL_ID,    '
		set  @sqlCommand= @sqlCommand+ ' V.VARDIYA_TARIHI,V.VARDIYA_ID,S.CALISMA_SURESI,S.NORMAL_SURE from VARDIYA_GUN V   '
		set  @sqlCommand= @sqlCommand+ ' INNER JOIN VARDIYA_SAAT S ON S.ID =V.VARDIYA_SAAT_ID  '
		set  @sqlCommand= @sqlCommand+ ' where YEAR(V.VARDIYA_TARIHI)='+@yil+' AND MONTH(V.VARDIYA_TARIHI)<='+@ay+' AND  V.DURUM=1  AND V.PERSONEL_ID IN ('+@perList+')  ),   '
		set  @sqlCommand= @sqlCommand+ ' VERI_1 AS (   '
		set  @sqlCommand= @sqlCommand+ ' SELECT CASE WHEN '+ @maxCalismaSaatStr +' <=V.CALISMA_SURESI THEN 1 ELSE 0 END LIMIT_ASTI,   '
		set  @sqlCommand= @sqlCommand+ ' CASE WHEN V.CALISMA_SURESI>V.NORMAL_SURE THEN V.CALISMA_SURESI-V.NORMAL_SURE ELSE 0 END FAZLA_MESAJI,  V.* FROM DATA V   '
		set  @sqlCommand= @sqlCommand+ ' INNER JOIN DENKLESTIRMEAY D ON D.YIL=V.YIL AND D.AY=V.AY ),   '
		set  @sqlCommand= @sqlCommand+ ' SONUC1 AS (   '
		set  @sqlCommand= @sqlCommand+ ' SELECT V.PERSONEL_ID,V.YIL, V.AY,SUM(LIMIT_ASTI) LIMIT,SUM(FAZLA_MESAJI) FAZLA_MESAJI FROM VERI_1 V    '
		set  @sqlCommand= @sqlCommand+ ' WHERE LIMIT_ASTI>0 OR FAZLA_MESAJI>0   '
		set  @sqlCommand= @sqlCommand+ ' GROUP BY V.YIL,V.AY,V.PERSONEL_ID  '
		set  @sqlCommand= @sqlCommand+ ' ),    '
		if (@ardisikDurum>0) BEGIN
			set  @sqlCommand= @sqlCommand+ ' VERI_2 AS (   '
			set  @sqlCommand= @sqlCommand+ ' SELECT D.YIL,D.AY,D.PERSONEL_ID,D.CALISMA_SURESI,D.VARDIYA_TARIHI  FROM DATA D,MAX_GUN_SAYI M   '
			set  @sqlCommand= @sqlCommand+ ' WHERE D.GUN<=31-M.ADET  AND (D.CALISMA_SURESI>=D.NORMAL_SURE )   '
			set  @sqlCommand= @sqlCommand+ ' ),    '
			set  @sqlCommand= @sqlCommand+ ' TOPLAM_2 AS (   '
			set  @sqlCommand= @sqlCommand+ ' SELECT V1.*,V2.VARDIYA_TARIHI AS T2 FROM VERI_2 V1   '
			set  @sqlCommand= @sqlCommand+ ' INNER JOIN MAX_GUN_SAYI M ON M.ADET>0   '
			set  @sqlCommand= @sqlCommand+ ' INNER JOIN VERI_2 V2 ON V1.YIL=V2.YIL AND V1.AY=V2.AY AND V1.PERSONEL_ID=V2.PERSONEL_ID  '
			set  @sqlCommand= @sqlCommand+ ' AND V1.VARDIYA_TARIHI<=V2.VARDIYA_TARIHI   AND V2.VARDIYA_TARIHI<=DATEADD(Day, M.ADET-1, v1.VARDIYA_TARIHI)   '
			set  @sqlCommand= @sqlCommand+ ' ),   '
			set  @sqlCommand= @sqlCommand+ ' SONUC2 AS (   '
			set  @sqlCommand= @sqlCommand+ ' SELECT  D.YIL, D.AY,D.PERSONEL_ID,D.VARDIYA_TARIHI,COUNT(*) AS ADET  FROM TOPLAM_2 D   '
			set  @sqlCommand= @sqlCommand+ ' GROUP BY D.YIL, D.AY,D.PERSONEL_ID, D.VARDIYA_TARIHI  '
			set  @sqlCommand= @sqlCommand+ ' ),  '
		END
		set  @sqlCommand= @sqlCommand+ ' SONUC AS (   '
		set  @sqlCommand= @sqlCommand+ ' SELECT D.YIL, D.AY,D.PERSONEL_ID, 0 AS GUN15,  LIMIT,  FAZLA_MESAJI FROM SONUC1 D   '
		if (@ardisikDurum>0) BEGIN
			set  @sqlCommand= @sqlCommand+ ' UNION ALL   '
			set  @sqlCommand= @sqlCommand+ ' SELECT  D.YIL,  D.AY,D.PERSONEL_ID, COUNT(*) AS GUN15,0 AS LIMIT,0 AS FAZLA_MESAJI FROM SONUC2 D   '
			set  @sqlCommand= @sqlCommand+ ' INNER JOIN MAX_GUN_SAYI M ON M.ADET>0   '
			set  @sqlCommand= @sqlCommand+ ' WHERE D.ADET>=M.ADET  GROUP BY D.YIL,  D.AY,D.PERSONEL_ID  '
		END
		set  @sqlCommand= @sqlCommand+ ' ), '
		set  @sqlCommand= @sqlCommand+ ' VERI AS (   '
		set  @sqlCommand= @sqlCommand+ ' SELECT D.YIL, D.AY,D.PERSONEL_ID,SUM(GUN15) ARDISIK,SUM(LIMIT) LIMIT,SUM(FAZLA_MESAJI) FAZLA_MESAJI FROM SONUC  D   '
		set  @sqlCommand= @sqlCommand+ ' GROUP BY D.YIL, D.AY,D.PERSONEL_ID  '
		set  @sqlCommand= @sqlCommand+ ' )   '
		set  @sqlCommand= @sqlCommand+ ' SELECT PD.ID, V.AY, PD.PERSONEL_NO,V.PERSONEL_ID, V.ARDISIK,V.LIMIT,V.FAZLA_MESAJI FROM VERI  V   '
		set  @sqlCommand= @sqlCommand+ ' INNER JOIN DENKLESTIRMEAY D ON D.YIL=V.YIL AND D.AY=V.AY  '
		set  @sqlCommand= @sqlCommand+ ' INNER JOIN PERSONELDENKLESTIRME PD ON PD.DONEM_ID=D.ID AND PD.PERSONEL_ID=V.PERSONEL_ID AND PD.DENKLESTIRME_DURUM=1  '
		set  @sqlCommand= @sqlCommand+ ' AND ( PD.DURUM=1  OR (D.DURUM=1 AND PD.ONAYLANDI=1))   '
		set  @sqlCommand= @sqlCommand+ ' ORDER BY AY DESC,PD.PERSONEL_NO  '
-- 		   PRINT    @sqlCommand
			EXECUTE sp_executesql    @sqlCommand  
		   
		   
END
GO
/****** Object:  StoredProcedure [dbo].[SP_GET_FAZLA_MESAI_MUDUR_DATA]    Script Date: 20.12.2023 17:26:32 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
 
 



CREATE PROCEDURE [dbo].[SP_GET_FAZLA_MESAI_MUDUR_DATA]
	@denklestirme [bigint],
	@mudurId [bigint],
	@departmanId [bigint],
	@sirketId [bigint],
	@tesisId [nvarchar](max),
	@bolumId [bigint],
	@tipi [nvarchar](1),
	@basTarih [nvarchar](20),
	@bitTarih [nvarchar](20),
	@format [nvarchar](20),
	@mesaiTalep int,
	@order [nvarchar](max)
WITH EXECUTE AS CALLER
AS
BEGIN
 	   SET NOCOUNT ON;
 	   DECLARE @sqlCommand nvarchar(max) 
	   DECLARE @yoneticiStr nvarchar(max) 
	   DECLARE @selectStr nvarchar(max) 
	   DECLARE @ekStr nvarchar(32) 
	   DECLARE @tarih1  nvarchar(32)
	   DECLARE @tarih2  nvarchar(32)
	   DECLARE @df  nvarchar(20)
	   DECLARE @denklestirmeStr nvarchar(max) 
	   DECLARE @uygulamaTipi  nvarchar(1)
	   DECLARE @iseGirisTarihiColumn nvarchar(100) 
	   set @iseGirisTarihiColumn='ISE_BASLAMA_TARIHI'
	   select  @iseGirisTarihiColumn=DEGER  from PARAMETRE  WITH(nolock) 
	     WHERE ADI='grubaGirisTarihiAlanAdi' AND DURUM=1 AND  COALESCE(DEGER,'') IN ('ISE_BASLAMA_TARIHI','GRUBA_GIRIS_TARIHI')
	   set @denklestirmeStr = ''
	   set @uygulamaTipi=''

	    if (@bolumId IS NOT NULL AND @bolumId>0)  
		   select  @uygulamaTipi=RTRIM(DEGER) from PARAMETRE  WITH(nolock) WHERE ADI='uygulamaTipi' AND DURUM=1
	   
	   IF ( @format  IS NULL or @format='' )  
		     SET @df =  '112' ;
		else
			SET @df =  @format;
		set @yoneticiStr=''
 

	   IF ( @basTarih  IS NULL )  
		     SET @tarih1 =  '' ;
		else
			SET @tarih1 =  @basTarih; 	
       IF ( @bitTarih  IS NULL )  
		     SET @tarih2 =  '' ;
		else
			SET @tarih2 =    @bitTarih ; 	
	       IF ( @tarih1 <> '' and  @tarih2 <> ''  )  BEGIN
			 if (@denklestirme is not null and @denklestirme<>0) begin
			    if (@denklestirme>0)
				     set @denklestirmeStr = convert(nvarchar(12),@denklestirme)
					else begin
						DECLARE @DID bigint 
						DECLARE DONEM_cursor CURSOR FOR 
							WITH VERI AS (
								select D.ID,(YIL*100) + AY  AS DONEM from DENKLESTIRMEAY D WITH(nolock)
							)
							SELECT ID FROM VERI 
							WHERE DONEM >=CONVERT(BIGINT,LEFT(@tarih1,6)) AND DONEM <=CONVERT(BIGINT,LEFT(@tarih2,6))
						set @denklestirmeStr = @denklestirmeStr + '0';
						OPEN DONEM_cursor
						FETCH NEXT FROM DONEM_cursor INTO @DID
						WHILE @@FETCH_STATUS = 0  
						BEGIN  
							if (@denklestirmeStr<>'') set @denklestirmeStr = @denklestirmeStr + ','
							set @denklestirmeStr = @denklestirmeStr + convert(nvarchar(12),@DID);
 							FETCH NEXT FROM DONEM_cursor INTO @DID	 
 						END
						CLOSE DONEM_cursor;  
						DEALLOCATE DONEM_cursor;
					 
					END
 			    END
		     END
 			 set @sqlCommand = ' WITH VERILER AS (   SELECT  P.ID  AS PERSONEL_ID ,COALESCE(P.ASIL_YONETICI2_ID,Y.YONETICI_ID) AS MUDUR_ID FROM  PERSONEL P WITH(nolock) ';
			 set @sqlCommand = @sqlCommand + ' INNER JOIN PERSONEL Y ON Y.ID=P.YONETICI_ID ';
			 set @sqlCommand = @sqlCommand + ' INNER JOIN SIRKET S ON S.ID=P.SIRKET_ID ';
			 if (@departmanId IS NOT NULL AND @departmanId>0) BEGIN 
				set @sqlCommand = @sqlCommand + ' AND S.DEPARTMAN_ID='+convert(nvarchar(12),@departmanId);
 			 END;
			 set @sqlCommand = @sqlCommand + ' WHERE P.ISE_BASLAMA_TARIHI<=P.SSK_CIKIS_TARIHI ';
			 set @ekStr = ' AND '
			 if (@sirketId IS NOT NULL AND @sirketId>0) BEGIN 
				set @sqlCommand = @sqlCommand + @ekStr + ' P.SIRKET_ID='+convert(nvarchar(12),@sirketId);
				set @ekStr =' AND '
 			 END;
			if (@tesisId IS NOT NULL AND @tesisId<>'') BEGIN 
				set @sqlCommand = @sqlCommand + @ekStr + ' P.TESIS_ID IN ('+ @tesisId+' )' ;
				set @ekStr = ' AND '
 			 END;
		    
	 
			 if (@bolumId IS NOT NULL AND @bolumId>0) BEGIN 
				set @sqlCommand = @sqlCommand + @ekStr + ' P.EK_SAHA3_ID='+convert(nvarchar(12),@bolumId);
 
 			 END; 
 

			set @sqlCommand = @sqlCommand + ' ) ' ;
			set @sqlCommand = @sqlCommand + ' SELECT DISTINCT '+@tipi+'.* from VERILER V  WITH(nolock) '
			set @sqlCommand = @sqlCommand + ' INNER JOIN PERSONEL  P  ON V.PERSONEL_ID=P.ID  AND P.DURUM=1 ';
			if (@denklestirmeStr<>'') begin
			 	set @sqlCommand = @sqlCommand + ' INNER JOIN PERSONELDENKLESTIRME PD ON PD.PERSONEL_ID=P.ID AND PD.DONEM_ID IN (' + @denklestirmeStr + ')';
			 	set @sqlCommand = @sqlCommand + ' AND PD.DENKLESTIRME_DURUM=1 ' ;

			 end
			 if (@mesaiTalep IS NOT NULL AND @mesaiTalep=1) BEGIN
			 	 	set @sqlCommand = @sqlCommand + ' INNER JOIN VARDIYA_GUN G ON G.PERSONEL_ID=V.PERSONEL_ID'  ;
					set @sqlCommand = @sqlCommand + ' AND  G.VARDIYA_TARIHI<= convert(datetime, '''+@tarih2+''','+@df+') ';
				    set @sqlCommand = @sqlCommand + ' AND  G.VARDIYA_TARIHI>= convert(datetime, '''+@tarih1+''','+@df+') ';

				    set @sqlCommand = @sqlCommand + ' INNER JOIN FAZLA_MESAI_TALEP FT ON G.ID=FT.VARDIYA_GUN_ID AND FT.DURUM=1' ;


			 END
			 set @sqlCommand = @sqlCommand + '  INNER JOIN SIRKET S ON S.ID=SIRKET_ID AND S.FAZLA_MESAI=1 '
			 if (@sirketId IS NOT NULL AND @sirketId>0) BEGIN 
				set @sqlCommand = @sqlCommand + ' AND  S.ID='+convert(nvarchar(12),@sirketId);
 			 END;
			 if (@departmanId IS NOT NULL AND @departmanId>0) BEGIN 
				set @sqlCommand = @sqlCommand + ' AND S.DEPARTMAN_ID='+convert(nvarchar(12),@departmanId);
 			 END;
			 set @sqlCommand = @sqlCommand + '  INNER JOIN DEPARTMAN D ON D.ID=S.DEPARTMAN_ID '
			 set @sqlCommand = @sqlCommand + '  INNER JOIN TANIM B ON B.ID=P.EK_SAHA3_ID '

		    set @sqlCommand = @sqlCommand + '  LEFT JOIN TANIM T ON T.ID=P.TESIS_ID '
			if (@tesisId IS NOT NULL AND @tesisId<>'') BEGIN 
 				set @sqlCommand = @sqlCommand + ' AND T.ID IN ('+ @tesisId+' )';
  			 END;
			set @sqlCommand = @sqlCommand + ' WHERE P.DURUM=1 '
			 if (@mudurId IS NOT NULL AND @mudurId>0) BEGIN 
				set @sqlCommand = @sqlCommand + ' AND  V.MUDUR_ID='+convert(nvarchar(12),@mudurId);
 			 END;
			IF ( @tarih1 <> '' )  BEGIN  
				  set @sqlCommand = @sqlCommand + ' AND P.SSK_CIKIS_TARIHI>=convert(date, ''' + @tarih1 + ''',' + @df + ') ';
		    END
		    IF ( @tarih2 <> '' )  BEGIN  
				  set @sqlCommand = @sqlCommand + ' AND P.' + @iseGirisTarihiColumn + '<= convert(date, ''' + @tarih2 + ''',' + @df + ') ';
 		    END			
		 		
		 
 
			 
			 set @sqlCommand = @sqlCommand + ' AND '+@tipi+'.ID IS NOT NULL';
			  if (@order IS NOT NULL AND @order<>'')
				 set  @sqlCommand = @sqlCommand + ' ORDER BY '+@tipi+'.'+@order;
--		     PRINT    @sqlCommand
			 EXECUTE sp_executesql    @sqlCommand  
		   
		   
END

GO
/****** Object:  StoredProcedure [dbo].[SP_GET_FAZLA_MESAI_VARDIYA]    Script Date: 20.12.2023 17:26:32 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
 
 

CREATE PROCEDURE [dbo].[SP_GET_FAZLA_MESAI_VARDIYA]
 
	@perList [nvarchar](max),
	@basTarih [nvarchar](8),
	@bitTarih [nvarchar](8),
	@calSure [numeric](19, 2),
	@format [nvarchar](20)
WITH EXECUTE AS CALLER
AS
BEGIN
	-- SET NOCOUNT ON added to prevent extra result sets from
	-- interfering with SELECT statements.
	   SET NOCOUNT ON;
	   DECLARE @tarih1  nvarchar(32)
	   DECLARE @tarih2  nvarchar(32)
	   DECLARE @df  nvarchar(20)
 	    DECLARE @sqlCommand nvarchar(max) 
			   IF ( @basTarih  IS NULL )  
		     SET @tarih1 =  '' ;
		else
			SET @tarih1 =  @basTarih; 	
       IF ( @bitTarih  IS NULL )  
		     SET @tarih2 =  '' ;
		else
			SET @tarih2 =    @bitTarih ; 
			
	 IF ( @format  IS NULL or @format='' )  
				 SET @df =  '112' ;
			else
				SET @df =  @format;
	    IF ( @tarih1 <> '' OR  @tarih2 <> ''  )  BEGIN
  
			set  @sqlCommand= ' WITH  DATA AS (   '
			set  @sqlCommand= @sqlCommand+ ' select  V.* from VARDIYA_GUN V   WITH(nolock)  '
			if (@calSure IS  NULL   ) BEGIN
				set  @sqlCommand= @sqlCommand+ ' INNER JOIN VARDIYA_SAAT S ON S.ID =V.VARDIYA_SAAT_ID '
	
				set  @sqlCommand= @sqlCommand+ ' AND S.CALISMA_SURESI>S.NORMAL_SURE '
			END  
			set  @sqlCommand= @sqlCommand+ ' where V.DURUM=1      '
			IF ( @tarih1 <> ''  )  
				set  @sqlCommand= @sqlCommand+ ' and  V.VARDIYA_TARIHI>=convert(datetime, '''+@tarih1+''','+@df+') '
			 IF ( @tarih2 <> ''  )  
				set  @sqlCommand= @sqlCommand+ '   AND  V.VARDIYA_TARIHI<=convert(datetime, '''+@tarih2+''','+@df+')  '
			 IF (@perList IS NOT NULL AND  @perList  <> ''  )  
				set  @sqlCommand= @sqlCommand+ '  AND   V.PERSONEL_ID IN ('+@perList+')     '
			set  @sqlCommand= @sqlCommand+ '   AND  V.VARDIYA_TARIHI <= CAST(GETDATE() AS DATE) '
			set  @sqlCommand= @sqlCommand+ '    )    '
		    if (COALESCE(@calSure,0)>0) BEGIN
				set  @sqlCommand= @sqlCommand+ ',  ISLEM_PER AS ( SELECT DISTINCT  V.PERSONEL_ID FROM DATA V   '
				set  @sqlCommand= @sqlCommand+ ' INNER JOIN VARDIYA_SAAT S ON S.ID =V.VARDIYA_SAAT_ID AND S.CALISMA_SURESI>=' + CAST(@calSure as varchar(100))
				set  @sqlCommand= @sqlCommand+ '   '
				set  @sqlCommand= @sqlCommand+ ')  '
				set  @sqlCommand= @sqlCommand+ ' SELECT   V.* FROM DATA V   '
				set  @sqlCommand= @sqlCommand+ ' INNER JOIN PERSONEL P ON P.ID=V.PERSONEL_ID  AND V.VARDIYA_TARIHI>=P.GRUBA_GIRIS_TARIHI   AND V.VARDIYA_TARIHI<=P.SSK_CIKIS_TARIHI '
 				set  @sqlCommand= @sqlCommand+ ' WHERE V.PERSONEL_ID IN (SELECT PERSONEL_ID FROM ISLEM_PER) '
 			END ELSE if (COALESCE(@calSure,0)<0) BEGIN
				set  @sqlCommand= @sqlCommand+ ',  ISLEM_PER AS ( SELECT DISTINCT  V.PERSONEL_ID FROM DATA V   '
				set  @sqlCommand= @sqlCommand+ ' INNER JOIN VARDIYA_SAAT S ON S.ID =V.VARDIYA_SAAT_ID AND S.CALISMA_SURESI>0'   
				set  @sqlCommand= @sqlCommand+ ' INNER JOIN VARDIYA VV ON VV.ID =V.VARDIYA_ID AND VV.VARDIYATIPI=''H'' '   
		 		set  @sqlCommand= @sqlCommand+ ')  '
				set  @sqlCommand= @sqlCommand+ ' SELECT   V.* FROM DATA V  WITH(nolock)   '
				set  @sqlCommand= @sqlCommand+ ' INNER JOIN PERSONEL P ON P.ID=V.PERSONEL_ID  AND V.VARDIYA_TARIHI>=P.GRUBA_GIRIS_TARIHI   AND V.VARDIYA_TARIHI<=P.SSK_CIKIS_TARIHI '
 				set  @sqlCommand= @sqlCommand+ ' WHERE V.PERSONEL_ID IN (SELECT PERSONEL_ID FROM ISLEM_PER) '
 			END ELSE BEGIN
 				set  @sqlCommand= @sqlCommand+ ' SELECT   V.* FROM DATA V   '
				set  @sqlCommand= @sqlCommand+ ' INNER JOIN PERSONEL P ON P.ID=V.PERSONEL_ID  AND V.VARDIYA_TARIHI>=P.GRUBA_GIRIS_TARIHI   AND V.VARDIYA_TARIHI<=P.SSK_CIKIS_TARIHI '
				 
			END
			set  @sqlCommand= @sqlCommand+ ' ORDER BY P.PDKS_SICIL_NO,V.VARDIYA_TARIHI  '
			 
		   
		END ELSE BEGIN
			set  @sqlCommand= '  SELECT * FROM VARDIYA_GUN  WHERE 1=2 '
		    
		END
--		  PRINT    @sqlCommand
		EXECUTE sp_executesql    @sqlCommand  
END
GO
/****** Object:  StoredProcedure [dbo].[SP_GET_HAREKET_BY_ID_SIRKET]    Script Date: 20.12.2023 17:26:32 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
 

CREATE PROCEDURE [dbo].[SP_GET_HAREKET_BY_ID_SIRKET]
	@idKList [nvarchar](max),
	@idAList [nvarchar](max)
WITH EXECUTE AS CALLER
AS
BEGIN
-- SET NOCOUNT ON added to prevent extra result sets from
	-- interfering with SELECT statements.
	SET NOCOUNT ON;
 	   DECLARE @sqlCommand nvarchar(max) 
	   DECLARE @KSTRING nvarchar(max)
	   DECLARE @ASTRING nvarchar(max)
 	   IF ( @idKList  IS NULL )  
		     SET @KSTRING =  '' ;
		else
			SET @KSTRING =  @idKList; 
	   	IF ( @idAList  IS NULL )  
		     SET @ASTRING =  '' ;
		else
			SET @ASTRING =  @idAList; 
 		 set  @sqlCommand =' WITH HAREKETLER AS ( '+
		   ' SELECT  ''K'' + CAST(Z.KGS_ID AS VARCHAR(12)) AS ID, ''K'' AS SIRKET, Z.ID AS TABLE_ID, P.ID AS PERSONEL, Z.KGS_SIRKET_ID,'+
			 'K.ID AS KAPI, Z.HAREKET_ZAMANI AS ZAMAN, Z.DURUM, Z.ISLEM_ID, NULL AS ORJ_ZAMAN,Z.OLUSTURMA_ZAMANI        FROM          dbo.PDKS_LOG AS Z WITH (nolock)'+
			 ' INNER JOIN   dbo.KAPI_SIRKET_KGS AS K ON K.KGS_ID = Z.KAPIID AND K.KGS_SIRKET_ID=Z.KGS_SIRKET_ID '+
			 ' INNER JOIN   dbo.PERSONEL_SIRKET_KGS AS P ON P.KGS_ID = Z.USERID AND P.KGS_SIRKET_ID=Z.KGS_SIRKET_ID '
			IF ( @KSTRING <> ''  )  
			   set  @sqlCommand= @sqlCommand+ ' WHERE  Z.DURUM=1 AND Z.ID IN ( '+@KSTRING+')';
			 ELSE
			  set  @sqlCommand= @sqlCommand+' WHERE 1=2 ';
		 
		     set  @sqlCommand= @sqlCommand+' UNION ALL '+
	      
			   ' SELECT ''A'' + CAST(Z.ID AS VARCHAR(12)) AS ID, ''A'' AS SIRKET, Z.ID AS TABLE_ID, Z.PERSONEL, 0 KGS_SIRKET_ID, Z.KAPI,'+ 
				'Z.ZAMAN, Z.DURUM, Z.ISLEM_ID, A.HAREKET_ZAMANI AS ORJ_ZAMAN, I.OLUSTURMA_ZAMANI FROM dbo.PDKS_HAREKET AS Z WITH (nolock)'+
				 ' LEFT OUTER JOIN dbo.PDKS_LOG AS A ON Z.KGS_ID = A.KGS_ID'+
				' INNER JOIN PDKS_ISLEM I ON I.ID=Z.ISLEM_ID '
		  IF ( @ASTRING <> ''  )
		     set  @sqlCommand= @sqlCommand+ ' WHERE Z.ID IN ( '+@ASTRING+')  AND  (Z.DURUM <> 0) ';
		  ELSE
			  set  @sqlCommand= @sqlCommand+' WHERE 1=2 ';

		 set @sqlCommand= @sqlCommand +  ' ) '+
			 'SELECT DISTINCT H.ID, H.SIRKET, H.TABLE_ID, H.PERSONEL AS USERID, H.KAPI AS KAPIID, H.ZAMAN AS HAREKET_ZAMANI, A.ID AS ISLEM_ID, '+
			' CASE WHEN SIRKET = ''K'' AND A.ONAYLAYAN_ID IS NULL THEN 1 WHEN A.ID IS NOT NULL AND A.ONAYLAYAN_ID IS NULL THEN 0 ELSE H.DURUM END AS DURUM, '+
			 ' H.ORJ_ZAMAN, H.OLUSTURMA_ZAMANI,H.KGS_SIRKET_ID FROM HAREKETLER H'+
			' LEFT OUTER JOIN dbo.PDKS_ISLEM AS A ON A.ID = H.ISLEM_ID'+
			' WHERE (A.ID IS NULL) OR (H.SIRKET = ''A'') OR (A.ISLEM_TIPI <> ''U'') order by 6 ,  H.TABLE_ID' 
		   
			EXECUTE sp_executesql    @sqlCommand  
		   
END
GO
/****** Object:  StoredProcedure [dbo].[SP_GET_HAREKET_SIRKET]    Script Date: 20.12.2023 17:26:32 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
 

CREATE PROCEDURE [dbo].[SP_GET_HAREKET_SIRKET]
	@kapiList [nvarchar](max),
	@PERSONELList [nvarchar](max),
	@basTarih [nvarchar](20),
	@bitTarih [nvarchar](20),
	@format [nvarchar](20)
WITH EXECUTE AS CALLER
AS
BEGIN
	-- SET NOCOUNT ON added to prevent extra result sets from
	-- interfering with SELECT statements.
	SET NOCOUNT ON;
 	   DECLARE @sqlCommand nvarchar(max) 
	   DECLARE @kapi nvarchar(max)
	   DECLARE @PERSONEL nvarchar(max)
	   DECLARE @tarih1 nvarchar(20)
	   DECLARE @tarih2 nvarchar(20)
	   DECLARE @df  nvarchar(20)
	    IF ( @format  IS NULL or @format='' )  
		     SET @df =  '120' ;
		else
			SET @df =  @format;

	   IF ( @basTarih  IS NULL )  
		     SET @tarih1 =  '' ;
		else
			SET @tarih1 =  @basTarih; 	
       IF ( @bitTarih  IS NULL )  
		     SET @tarih2 =  '' ;
		else
			SET @tarih2 =  @bitTarih; 	
 	   IF ( @kapiList  IS NULL )  
		     SET @kapi =  '' ;
		else
			SET @kapi =  @kapiList; 
	   	IF ( @PERSONELList  IS NULL )  
		     SET @PERSONEL =  '' ;
		else
			SET @PERSONEL =  @PERSONELList; 
 		 set  @sqlCommand =' WITH HAREKETLER AS ( '+
		   ' SELECT  ''K'' + CAST(Z.KGS_ID AS VARCHAR(12)) AS ID, ''K'' AS SIRKET, Z.ID AS TABLE_ID, P.ID AS PERSONEL, Z.KGS_SIRKET_ID,'+
			 'K.ID AS KAPI, Z.HAREKET_ZAMANI AS ZAMAN, Z.DURUM, Z.ISLEM_ID, NULL AS ORJ_ZAMAN,Z.OLUSTURMA_ZAMANI        FROM          dbo.PDKS_LOG AS Z WITH (nolock)'+
			 ' INNER JOIN   dbo.KAPI_SIRKET_KGS AS K ON K.KGS_ID = Z.KAPIID AND K.KGS_SIRKET_ID=Z.KGS_SIRKET_ID '+
			 ' INNER JOIN   dbo.PERSONEL_SIRKET_KGS AS P ON P.KGS_ID = Z.USERID AND P.KGS_SIRKET_ID=Z.KGS_SIRKET_ID '+
			 ' WHERE (Z.DURUM=1 OR Z.ISLEM_ID IS NOT NULL) '
			 IF ( @tarih1 <> ''  )   
				  set  @sqlCommand= @sqlCommand+ ' AND (Z.HAREKET_ZAMANI>= convert(datetime, '''+@tarih1+''','+@df+') ) ';
			 IF ( @tarih2 <> ''  )   
				  set  @sqlCommand= @sqlCommand+ ' AND (Z.HAREKET_ZAMANI< convert(datetime, '''+@tarih2+''','+@df+') ) ';
			IF ( @kapi <> ''  )  
			 set  @sqlCommand= @sqlCommand+ ' AND ( K.ID IN ( '+@kapi+') )';
			IF ( @PERSONEL <> ''  )  
			  set  @sqlCommand= @sqlCommand+ ' AND (P.ID IN ( '+@PERSONEL+') ) ';
			 
		     set  @sqlCommand= @sqlCommand+' UNION ALL '+
	      
			   ' SELECT ''A'' + CAST(Z.ID AS VARCHAR(12)) AS ID, ''A'' AS SIRKET, Z.ID AS TABLE_ID, Z.PERSONEL,0 KGS_SIRKET_ID, Z.KAPI,'+ 
				'Z.ZAMAN, Z.DURUM, Z.ISLEM_ID, A.HAREKET_ZAMANI AS ORJ_ZAMAN, I.OLUSTURMA_ZAMANI  FROM dbo.PDKS_HAREKET AS Z WITH (nolock)'+
				' INNER JOIN   dbo.PERSONEL_SIRKET_KGS AS P ON P.ID=Z.PERSONEL '+
				 ' LEFT OUTER JOIN dbo.PDKS_LOG AS A ON Z.KGS_ID = A.KGS_ID AND P.KGS_ID = A.USERID '+
				' INNER JOIN PDKS_ISLEM I ON I.ID=Z.ISLEM_ID '+
				' WHERE  (Z.DURUM <> 0) '
				 IF ( @tarih1 <> ''  )    
				  set  @sqlCommand= @sqlCommand+ ' AND (Z.ZAMAN>= convert(datetime, '''+@tarih1+''','+@df+') ) ';
				 IF ( @tarih2<> ''  )    
				  set  @sqlCommand= @sqlCommand+ ' AND (Z.ZAMAN< convert(datetime, '''+@tarih2+''','+@df+') ) ';
				IF ( @kapi <> ''  )  
				 set  @sqlCommand= @sqlCommand+ ' AND ( Z.KAPI IN ( '+@kapi+') )';
				IF ( @PERSONEL <> ''  )  
				  set  @sqlCommand= @sqlCommand+ ' AND (Z.PERSONEL IN ( '+@PERSONEL+') ) ';

		 set @sqlCommand= @sqlCommand +  ' ) '+
			 'SELECT DISTINCT H.ID, H.SIRKET, H.TABLE_ID, H.PERSONEL AS USERID, H.KAPI AS KAPIID, H.ZAMAN AS HAREKET_ZAMANI, A.ID AS ISLEM_ID, '+
			' CASE WHEN SIRKET = ''K'' AND A.ONAYLAYAN_ID IS NULL THEN 1 WHEN A.ID IS NOT NULL AND A.ONAYLAYAN_ID IS NULL THEN 0 ELSE H.DURUM END AS DURUM, '+
			 ' H.ORJ_ZAMAN, H.OLUSTURMA_ZAMANI,KGS_SIRKET_ID FROM HAREKETLER H'+
			' LEFT OUTER JOIN dbo.PDKS_ISLEM AS A ON A.ID = H.ISLEM_ID   '+
			' WHERE H.ZAMAN<=GETDATE() AND ( (A.ID IS NULL) OR (H.SIRKET = ''A'') OR (A.ISLEM_TIPI <> ''U'')) order by 6 ,  H.TABLE_ID ' 
 	     -- PRINT    @sqlCommand
			EXECUTE sp_executesql    @sqlCommand  
		   
		   
END
GO
/****** Object:  StoredProcedure [dbo].[SP_GET_IKINCI_BIRINCI_YONETICI_UPDATE]    Script Date: 20.12.2023 17:26:32 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
 

CREATE PROCEDURE [dbo].[SP_GET_IKINCI_BIRINCI_YONETICI_UPDATE]
	 
WITH EXECUTE AS CALLER
AS
BEGIN
	    
	    DECLARE @tarih  datetime
 	    DECLARE  @ID numeric(19, 0) 
		DECLARE  @YONETICI_ID numeric(19, 0) 
		DECLARE  @ADMINID  numeric(19, 0)   

	   	    SET @tarih =  convert(datetime,Convert(CHAR(8),GETDATE(), 112),112); 
 			SET  @ADMINID=NULL	
			SELECT  @ADMINID=U.ID FROM PARAMETRE PA  WITH(nolock) 
			  INNER JOIN PDKSUSER U ON U.KULLANICI_ADI=PA.DEGER AND U.DURUM=1
			  INNER JOIN PERSONEL P ON P.ID=U.PERSONEL_ID AND P.DURUM=1 AND
			  P.SSK_CIKIS_TARIHI>=@tarih AND P.ISE_BASLAMA_TARIHI<=@tarih
			WHERE PA.ADI='sistemAdminUserName' AND PA.DURUM=1

			DECLARE PERSONEL_cursor CURSOR FOR 
			 WITH BUGUN AS (
		      SELECT   convert(datetime,Convert(CHAR(8),GETDATE(), 112),112) AS TARIH, T.ID AS ALAN_ID FROM TANIM T  WITH(nolock) 
	       	   WHERE T.TIPI='PERSONEL_DINAMIK_DURUM' AND    T.KODU='ikinciYoneticiOlmaz' AND T.DURUM=1
		  
			  ) ,
			  VERI AS (
				SELECT  P.ID AS PERSONEL_ID,B.TARIH FROM BUGUN B 
					INNER JOIN PERSONEL P ON P.DURUM=1 	and P.IKINCI_YONETICI_IZIN_ONAYLA=0  
				   	AND P.SSK_CIKIS_TARIHI>=B.TARIH
 					INNER JOIN SIRKET S ON S.ID=P.SIRKET_ID
					INNER JOIN IZINTIPI I ON I.DEPARTMAN_ID=S.DEPARTMAN_ID AND I.BAKIYE_IZIN_TIPI_ID=NULL
					   AND I.ONAYLAYAN_TIPI='2' AND I.GIRIS_TIPI<>'0' AND I.DURUM=1 
 				UNION  
				  SELECT PERSONEL_ID , B.TARIH FROM PERSONEL_DINAMIK_ALAN D ,  BUGUN B   WITH(nolock) 
				   WHERE D.ALAN_ID=B.ALAN_ID  AND D.DURUM_SECIM=1
             )
			 SELECT  P.ID ,P.YONETICI_ID  FROM VERI D   WITH(nolock) 
 			   INNER JOIN PERSONEL Y ON Y.ID<>D.PERSONEL_ID AND Y.YONETICI_ID=D.PERSONEL_ID AND Y.DURUM=1 AND Y.SSK_CIKIS_TARIHI>=D.TARIH
			   INNER JOIN PERSONEL P ON P.ID<>Y.ID AND P.YONETICI_ID=Y.ID AND P.DURUM=1 AND P.SSK_CIKIS_TARIHI>=D.TARIH
			   AND COALESCE( P.ASIL_YONETICI2_ID ,0)<> P.YONETICI_ID
		 
			   order by P.AD_SOYAD  
 
	 
		  
		    OPEN PERSONEL_cursor
			FETCH NEXT FROM PERSONEL_cursor INTO @ID,@YONETICI_ID
			WHILE @@FETCH_STATUS = 0  
			BEGIN  
--		    PRINT CAST(@ID as varchar(50))+' '+CAST(@YONETICI_ID as varchar(50))
	    		UPDATE PERSONEL SET ASIL_YONETICI2_ID=@YONETICI_ID,GUNCELLEMETARIHI=GETDATE(),GUNCELLEYENUSER_ID=@ADMINID WHERE ID=@ID;
		   		FETCH NEXT FROM PERSONEL_cursor INTO @ID,@YONETICI_ID
 			END
 
			CLOSE PERSONEL_cursor;  
			DEALLOCATE PERSONEL_cursor;
		  
END

GO
/****** Object:  StoredProcedure [dbo].[SP_GET_IKINCI_YONETICI_SIFIRLA]    Script Date: 20.12.2023 17:26:32 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
 

CREATE PROCEDURE [dbo].[SP_GET_IKINCI_YONETICI_SIFIRLA]
	@islemTarih [varchar](20),
	@format [varchar](20)
WITH EXECUTE AS CALLER
AS
BEGIN
	   DECLARE @df   varchar(20)
	    DECLARE @tarih  datetime
 	     IF ( @format  IS NULL or @format='' )  
		     SET @df =  '112' ;
		else
			SET @df =  @format;

 	    if (@islemTarih IS NULL  OR @islemTarih='') BEGIN
 			   SET @islemTarih=Convert(CHAR(8),GETDATE(), convert(int,@df))
		END
--		PRINT @islemTarih+' - '+@df
			
		
		set @tarih =  convert(datetime,@islemTarih,convert(int,@df)); 
		EXEC SP_ISTEN_AYRILAN_VARDIYA_DELETE ;
		WITH VERILER AS (
			 SELECT   P.*   FROM  PERSONEL  P  WITH(nolock)   
			 INNER JOIN SIRKET A ON A.ID=P.SIRKET_ID AND A.DURUM=1 and A.FAZLA_MESAI=1 AND A.ERP_DURUM=1  
			 INNER JOIN  PERSONEL  Y ON Y.ID=P.YONETICI_ID   AND   Y.YONETICI_ID=P.ASIL_YONETICI2_ID  

			 WHERE P.DURUM=1 AND P.SSK_CIKIS_TARIHI>=@tarih AND P.ASIL_YONETICI2_ID IS NOT NULL   
			 UNION ALL
			  SELECT   P.*   FROM  PERSONEL  P     WITH(nolock) 
			  INNER JOIN SIRKET A ON A.ID=P.SIRKET_ID AND A.DURUM=1 and A.FAZLA_MESAI=1 AND A.ERP_DURUM=1  
			  INNER JOIN  PERSONEL  Y ON Y.ID= P.ASIL_YONETICI2_ID  AND  Y.SSK_CIKIS_TARIHI<GETDATE() 

			 WHERE  P.DURUM=1 AND P.SSK_CIKIS_TARIHI>=GETDATE() AND P.ASIL_YONETICI2_ID IS NOT NULL   			   
		)
		SELECT DISTINCT * FROM VERILER V  WITH(nolock) 
		ORDER BY V.AD_SOYAD
		   
		   
END
GO
/****** Object:  StoredProcedure [dbo].[SP_GET_IKINCI_YONETICI_UPDATE]    Script Date: 20.12.2023 17:26:32 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
 

CREATE PROCEDURE [dbo].[SP_GET_IKINCI_YONETICI_UPDATE]
	 
WITH EXECUTE AS CALLER
AS
BEGIN
	    
	    DECLARE @tarih  datetime
 	    DECLARE  @GID numeric(19, 0)   
		DECLARE  @ADMINID  numeric(19, 0)   

		set @tarih =  convert(datetime,Convert(CHAR(8),GETDATE(), 112),112); 
		SET  @ADMINID=NULL	
		SELECT  @ADMINID=U.ID FROM PARAMETRE PA WITH(nolock)
		  INNER JOIN PDKSUSER U ON U.KULLANICI_ADI=PA.DEGER AND U.DURUM=1
		  INNER JOIN PERSONEL P ON P.ID=U.PERSONEL_ID AND P.DURUM=1 AND
		  P.SSK_CIKIS_TARIHI>=@tarih AND P.ISE_BASLAMA_TARIHI<=@tarih
		WHERE PA.ADI='sistemAdminUserName' AND PA.DURUM=1

		DECLARE PERSONEL_cursor CURSOR FOR 
		WITH VERILER AS (
			 SELECT   P.*  FROM  PERSONEL  P   WITH(nolock)
			 INNER JOIN SIRKET A ON A.ID=P.SIRKET_ID AND A.DURUM=1 and A.FAZLA_MESAI=1 AND A.ERP_DURUM=1  
			 INNER JOIN  PERSONEL  Y ON Y.ID=P.YONETICI_ID   AND   Y.YONETICI_ID=P.ASIL_YONETICI2_ID  

			 WHERE P.DURUM=1 AND P.SSK_CIKIS_TARIHI>=@tarih AND P.ASIL_YONETICI2_ID IS NOT NULL   
			 UNION ALL
			  SELECT   P.*   FROM  PERSONEL  P   WITH(nolock)
			  INNER JOIN SIRKET A ON A.ID=P.SIRKET_ID AND A.DURUM=1 and A.FAZLA_MESAI=1 AND A.ERP_DURUM=1  
			  INNER JOIN  PERSONEL  Y ON Y.ID= P.ASIL_YONETICI2_ID  AND  Y.SSK_CIKIS_TARIHI<@tarih

			 WHERE  P.DURUM=1 AND P.SSK_CIKIS_TARIHI>=@tarih AND P.ASIL_YONETICI2_ID IS NOT NULL   			   
		)
		SELECT   V.ID,V.GUNCELLEYENUSER_ID FROM VERILER V  WITH(nolock) 
		ORDER BY V.AD_SOYAD
		DECLARE  @ID  numeric(19, 0)  
		OPEN PERSONEL_cursor
			FETCH NEXT FROM PERSONEL_cursor INTO @ID,@GID
			WHILE @@FETCH_STATUS = 0  
			BEGIN  
			   if (@ADMINID IS NOT NULL)
			      SET @GID=@ADMINID
				UPDATE PERSONEL SET ASIL_YONETICI2_ID=NULL,GUNCELLEMETARIHI=GETDATE(),GUNCELLEYENUSER_ID=@GID WHERE ID=@ID;
		   		FETCH NEXT FROM PERSONEL_cursor INTO @ID,@GID
 			END
 
			CLOSE PERSONEL_cursor;  
			DEALLOCATE PERSONEL_cursor;
		   
END

GO
/****** Object:  StoredProcedure [dbo].[SP_GET_KGS_ERP_ESLESMEYEN_PERSONELLER]    Script Date: 20.12.2023 17:26:32 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
 
 
CREATE PROCEDURE [dbo].[SP_GET_KGS_ERP_ESLESMEYEN_PERSONELLER]
	 
WITH EXECUTE AS CALLER
AS
BEGIN
	-- SET NOCOUNT ON added to prevent extra result sets from
	-- interfering with SELECT statements.
	SET NOCOUNT ON;
	SELECT SicilNo,Adi+' '+Soyadi AdSoyad,C.Unvan AS Sirket FROM WebPDKS.dbo.Personel P
	INNER JOIN WebPDKS.dbo.Company C ON C.CompanyId=P.CompanyId
	WHERE PersonelId IN (

	SELECT K.KGS_ID FROM PERSONEL_SIRKET_KGS K
	INNER JOIN  KAPI_SIRKET S ON S.ID=K.KGS_SIRKET_ID AND S.DURUM=1
	WHERE K.DURUM=1 AND  K.PERSONEL_ID IS NULL)
	order by 3,2


 

END
GO
/****** Object:  StoredProcedure [dbo].[SP_GET_PDKS_ISLEM]    Script Date: 20.12.2023 17:26:32 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
 




 
CREATE PROCEDURE [dbo].[SP_GET_PDKS_ISLEM]
	-- Add the parameters for the stored procedure here
	  
	   
AS
BEGIN
	-- SET NOCOUNT ON added to prevent extra result sets from
	-- interfering with SELECT statements.
	SET NOCOUNT ON;
 	 
	 DECLARE @ID bigint
	 
	  
	 DECLARE Data_cursor CURSOR FOR   
	 
	 WITH VERILER AS (
	 SELECT MAX( [ID] )  [ID]      ,[SP_ADI]   ,KGS_SIRKET_ID   ,[TABLE_ID]      ,[VALID]      ,MAX([OLUSTURMA_ZAMANI]) [OLUSTURMA_ZAMANI]
		  FROM PDKS_SP_ISLEM
		  GROUP BY [SP_ADI],[TABLE_ID],[VALID] ,KGS_SIRKET_ID
	 )
	 SELECT   K.[ID]    FROM VERILER K 
	   INNER JOIN PARAMETRE P ON P.ADI='kgsMasterUpdate' AND P.DURUM=1
		ORDER BY K.ID; 
	PRINT 'Ana veri güncelleme başladı' 
	OPEN Data_cursor

	FETCH NEXT FROM Data_cursor INTO @ID
	WHILE @@FETCH_STATUS = 0  
		BEGIN  

          EXEC  SP_ANAVERI_SIRKET @ID;
		   
	   FETCH NEXT FROM Data_cursor INTO @ID
     END
	 CLOSE Data_cursor;  
	


	 DEALLOCATE Data_cursor;
	 PRINT 'Ana veri güncelleme bitti' 
	   
	  EXEC SP_CHECKIDENT_VIEW
 
  END
GO
/****** Object:  StoredProcedure [dbo].[SP_GET_PDKS_SIRKET_ISLEM]    Script Date: 20.12.2023 17:26:32 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
 




 
CREATE PROCEDURE [dbo].[SP_GET_PDKS_SIRKET_ISLEM]
	-- Add the parameters for the stored procedure here
	  
	   
AS
BEGIN
	-- SET NOCOUNT ON added to prevent extra result sets from
	-- interfering with SELECT statements.
	SET NOCOUNT ON;
 	 
	 DECLARE @ID bigint
	 
	  
	 DECLARE Data_cursor CURSOR FOR   
	 
	 WITH VERILER AS (
	 SELECT MAX( [ID] )  [ID]      ,[SP_ADI]   ,KGS_SIRKET_ID   ,[TABLE_ID]      ,[VALID]      ,MAX([OLUSTURMA_ZAMANI]) [OLUSTURMA_ZAMANI]
		  FROM PDKS_SP_ISLEM
		  GROUP BY [SP_ADI],[TABLE_ID],[VALID] ,KGS_SIRKET_ID
	 )
	 SELECT   K.[ID]    FROM VERILER K 
	   INNER JOIN PARAMETRE P ON P.ADI='kgsMasterUpdate' AND P.DURUM=1
		ORDER BY K.ID; 
	PRINT 'Ana veri güncelleme başladı' 
	OPEN Data_cursor

	FETCH NEXT FROM Data_cursor INTO @ID
	WHILE @@FETCH_STATUS = 0  
		BEGIN  

          EXEC  SP_ANAVERI_SIRKET @ID;
		   
	   FETCH NEXT FROM Data_cursor INTO @ID
     END
	 CLOSE Data_cursor;  
	


	 DEALLOCATE Data_cursor;
	 PRINT 'Ana veri güncelleme bitti' 
	   
	  EXEC SP_CHECKIDENT_VIEW
 
  END
GO
/****** Object:  StoredProcedure [dbo].[SP_GET_PERS_DENK_DINAMIK_ALAN]    Script Date: 20.12.2023 17:26:32 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
 
CREATE PROCEDURE [dbo].[SP_GET_PERS_DENK_DINAMIK_ALAN]
	 @PERS_DENK_ID_STR  nvarchar(max) ,@DURUM int
WITH EXECUTE AS CALLER
AS
BEGIN
 DECLARE @sqlCommand nvarchar(max) 
   set  @sqlCommand ='SELECT   PDDA.ID  , PTD.ID  [ALAN_ID], PD.ID PERS_DENK_ID  from PERSONELDENKLESTIRME PD  WITH(nolock)';
   set  @sqlCommand =@sqlCommand+' INNER JOIN TANIM PTD ON PTD.TIPI=''DENKLESTIRME_DINAMIK_DURUM'' AND PTD.DURUM=1';
   set  @sqlCommand =@sqlCommand+' INNER JOIN PERSONEL_DINAMIK_ALAN PDA ON PDA.PERSONEL_ID=PD.PERSONEL_ID';
   set  @sqlCommand =@sqlCommand+' INNER JOIN TANIM TD ON TD.TIPI=''PERSONEL_DINAMIK_DURUM'' AND TD.DURUM=1 AND TD.KODU=PTD.KODU';
   set  @sqlCommand =@sqlCommand+' LEFT JOIN PERS_DENK_DINAMIK_ALAN PDDA ON PDDA.PERS_DENK_ID=PD.ID AND PDDA.ALAN_ID=PTD.ID';
   set  @sqlCommand =@sqlCommand+' WHERE PD.ID IN ('+@PERS_DENK_ID_STR+  ') AND (PDA.DURUM_SECIM=1 OR PDDA.ALAN_DURUM=1)';
   if (@DURUM=1)  
	 set  @sqlCommand =@sqlCommand+' AND PDDA.ID IS NULL';
	else
	 set  @sqlCommand =@sqlCommand+' AND PDDA.ID IS NOT NULL';
   

 PRINT    @sqlCommand
 EXECUTE sp_executesql    @sqlCommand  

END
GO
/****** Object:  StoredProcedure [dbo].[SP_GET_PERSONEL_VARDIYA]    Script Date: 20.12.2023 17:26:32 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
 

CREATE PROCEDURE [dbo].[SP_GET_PERSONEL_VARDIYA]
	@basYil [int],
	@bitDonem [bigint],
 
	@perId [nvarchar](max) 
WITH EXECUTE AS CALLER
AS
BEGIN
 	        SET NOCOUNT ON;
 	        DECLARE @sqlCommand nvarchar(max) 
 
 			 set @sqlCommand = ' WITH BILGILER AS ( ';
			 set @sqlCommand = @sqlCommand + ' select PD.PERSONEL_ID,PD.ID,D.YIL,D.AY,D.YIL*100+D.AY AS DONEM from PERSONELDENKLESTIRME PD  WITH(nolock) ';
			 set @sqlCommand = @sqlCommand + ' INNER JOIN DENKLESTIRMEAY D ON D.ID=PD.DONEM_ID AND D.YIL>= ' + convert(nvarchar(4), @basYil);
			 set @sqlCommand = @sqlCommand + ' INNER JOIN CALISMA_MODELI_AY C ON C.ID=PD.CALISMA_MODELI_AY_ID   ';
		     set @sqlCommand = @sqlCommand + ' WHERE PD.PERSONEL_ID IN (' + @perId + ') ';
			 set @sqlCommand = @sqlCommand + ' AND ((PD.ONAYLANDI=1 AND COALESCE(C.HAREKET_KAYDI_VARDIYA_BUL,0)=0) OR D.DURUM=0 )  ),   ';
		     set @sqlCommand = @sqlCommand + ' SON_DONEM AS (  SELECT PERSONEL_ID,MAX(DONEM) AS DONEM FROM BILGILER     ';
		     set @sqlCommand = @sqlCommand + ' WHERE DONEM<=' + convert(nvarchar(6), @bitDonem) + ' GROUP BY PERSONEL_ID  ),  ';
	         set @sqlCommand = @sqlCommand + ' VARDIYA_OZET AS (  SELECT V.VARDIYA_ID,COUNT(*) AS ADET FROM SON_DONEM D      ';
	         set @sqlCommand = @sqlCommand + ' INNER JOIN BILGILER B ON B.DONEM=D.DONEM AND B.PERSONEL_ID=D.PERSONEL_ID      ';
	         set @sqlCommand = @sqlCommand + ' INNER JOIN VARDIYA_GUN V ON V.PERSONEL_ID=D.PERSONEL_ID    ';
	         set @sqlCommand = @sqlCommand + ' AND YEAR(V.VARDIYA_TARIHI)=B.YIL AND MONTH(V.VARDIYA_TARIHI)=B.AY GROUP BY  V.VARDIYA_ID  ),    ';
	         set @sqlCommand = @sqlCommand + ' VARDIYA_SONUC as (  SELECT 1 AS TIP,O.* FROM VARDIYA_OZET O    ';
	         set @sqlCommand = @sqlCommand + ' INNER JOIN VARDIYA V ON V.ID=O.VARDIYA_ID  WHERE COALESCE(V.VARDIYATIPI,'''')<>''''  ';
	         set @sqlCommand = @sqlCommand + ' UNION ALL  ';
	         set @sqlCommand = @sqlCommand + ' SELECT 2 AS TIP,O.* FROM VARDIYA_OZET O  ';
	         set @sqlCommand = @sqlCommand + ' INNER JOIN VARDIYA V ON V.ID=O.VARDIYA_ID  ';
	         set @sqlCommand = @sqlCommand + ' WHERE COALESCE(V.VARDIYATIPI,''x'')=''''  )  ';
	         set @sqlCommand = @sqlCommand + ' SELECT V.* FROM VARDIYA_SONUC O  WITH(nolock)  ';
	         set @sqlCommand = @sqlCommand + ' INNER JOIN VARDIYA V ON V.ID=O.VARDIYA_ID ';
	         set @sqlCommand = @sqlCommand + ' ORDER BY TIP,ADET DESC';


		  
--		     PRINT    @sqlCommand
			 EXECUTE sp_executesql    @sqlCommand  
		   
		   
END
GO
/****** Object:  StoredProcedure [dbo].[SP_GET_PUANTAJ_OZET]    Script Date: 20.12.2023 17:26:32 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
 

CREATE PROCEDURE [dbo].[SP_GET_PUANTAJ_OZET]
-- Add the parameters for the stored procedure here
 
  @sirketId int, @yil int, @ay int 

AS
BEGIN
-- SET NOCOUNT ON added to prevent extra result sets from
-- interfering with SELECT statements.
SET NOCOUNT ON;

    DECLARE @sqlCommand nvarchar(max)
     
set  @sqlCommand =' WITH DATA AS ( ';

set  @sqlCommand= @sqlCommand+ ' SELECT V.PERSONEL_ID,SUM(CASE WHEN VARDIYATIPI=''O'' THEN 1 ELSE 0 END) AS OFF_GUN,  ';
set  @sqlCommand= @sqlCommand+ ' SUM(CASE WHEN VARDIYATIPI=''H'' THEN 1 ELSE 0 END) AS HAFTA_TATILI,';
set  @sqlCommand= @sqlCommand+ ' SUM(CASE WHEN VARDIYATIPI='''' THEN 1 ELSE 0 END) AS CALISMA,';
set  @sqlCommand= @sqlCommand+ ' COUNT(*) AS TOPLAM  FROM VARDIYA_GUN V  WITH(nolock)  ';
set  @sqlCommand= @sqlCommand+'  INNER JOIN PERSONEL P ON P.ID=V.PERSONEL_ID AND V.VARDIYA_TARIHI>=P.ISE_BASLAMA_TARIHI ';
IF ( @sirketId <> 0  )  
	set  @sqlCommand= @sqlCommand+ '  AND P.SIRKET_ID= '+CAST(@sirketId as varchar(50)) ;
set  @sqlCommand= @sqlCommand+ ' INNER JOIN SIRKET S ON S.ID=P.SIRKET_ID AND S.ERP_DURUM=1 ';
set  @sqlCommand= @sqlCommand+ ' INNER JOIN VARDIYA VA ON VA.ID=V.VARDIYA_ID ';
set  @sqlCommand= @sqlCommand+ ' WHERE V.DURUM=1 AND YEAR(VARDIYA_TARIHI)='+CAST(@yil as varchar(50)) +' AND MONTH(VARDIYA_TARIHI)='+CAST(@ay as varchar(50));
set  @sqlCommand= @sqlCommand+ ' AND  ((S.ISTEN_AYR_TAR_CALISIYOR=1 AND VARDIYA_TARIHI<=P.ISTEN_AYRILIS_TARIHI) ';
set  @sqlCommand= @sqlCommand+ ' OR  (S.ISTEN_AYR_TAR_CALISIYOR<>1 AND VARDIYA_TARIHI<P.ISTEN_AYRILIS_TARIHI)) ';
set  @sqlCommand= @sqlCommand+ '  GROUP BY  V.PERSONEL_ID) ,' ;
set  @sqlCommand= @sqlCommand+ ' SONUC AS ( SELECT D.*,CASE WHEN TOPLAM>30 THEN TOPLAM-30 ELSE 0 END FARK FROM DATA D ),' ;
set  @sqlCommand= @sqlCommand+ ' SONUC_DATA AS (' ;
set  @sqlCommand= @sqlCommand+ ' SELECT  S.ERP_KODU AS SIRKET_KODU,COALESCE(TE.ERP_KODU,'''') AS TESIS_KODU, PDKS_SICIL_NO AS SICIL_NO,CASE WHEN OFF_GUN>=FARK THEN OFF_GUN-FARK ELSE OFF_GUN END OFF_GUN,HAFTA_TATILI,' ;
set  @sqlCommand= @sqlCommand+ 'CALISMA,TOPLAM-FARK AS TOPLAM,CASE WHEN OFF_GUN>FARK  THEN FARK ELSE 0 END EK_OFF_GUN FROM SONUC V' ;
set  @sqlCommand= @sqlCommand+'  INNER JOIN PERSONEL P ON P.ID=V.PERSONEL_ID  ';
set  @sqlCommand= @sqlCommand+ ' INNER JOIN SIRKET S ON S.ID=P.SIRKET_ID';
set  @sqlCommand= @sqlCommand+ ' LEFT JOIN TANIM TE ON TE.ID=P.TESIS_ID)';
set  @sqlCommand= @sqlCommand+ ' SELECT S.* FROM SONUC_DATA S  WITH(nolock)  ORDER BY 1,2,3';
 



  PRINT    @sqlCommand
EXECUTE sp_executesql    @sqlCommand  

 
END
GO
/****** Object:  StoredProcedure [dbo].[SP_GET_TATIL]    Script Date: 20.12.2023 17:26:32 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
 
CREATE PROCEDURE [dbo].[SP_GET_TATIL]
	 
	@basTarih [nvarchar](20),
	@bitTarih [nvarchar](20),
	@format [nvarchar](20)
WITH EXECUTE AS CALLER
AS
BEGIN
	 
	   SET NOCOUNT ON;
 	   DECLARE @sqlCommand nvarchar(max) 
  
	   DECLARE @tarih1 nvarchar(20), @tarih2 nvarchar(20) 
	   DECLARE @dTarih1 datetime, @dTarih2 datetime
	   DECLARE @yil1 int, @yil2 int,@df int
	    
	    IF ( @format  IS NULL or @format='' )  
		     SET @df =  120;
		else
			SET @df = CONVERT(int, @format);

	   IF ( @basTarih  IS NULL )  
		     SET @tarih1 =  '' ;
		else
			SET @tarih1 =  @basTarih; 	
       IF ( @bitTarih  IS NULL )  
		     SET @tarih2 =  '' ;
		else
			SET @tarih2 =  @bitTarih; 
	     SET @format=CONVERT([nvarchar](20),@df)
 	     set @dTarih1= convert(datetime,@tarih1,@df)
		 set @dTarih2= convert(datetime,@tarih2,@df)
		 set @yil1=year(@dTarih1)
		 set @yil2=year(@dTarih2)
 		 set  @sqlCommand =' WITH TATIL_VERI AS ( '
		 set  @sqlCommand = @sqlCommand + ' SELECT T.KODU, TT.ID,CONVERT(date, TT.BAS_TARIH) BAS_TARIH,TT.BIT_TARIH  ,'
		 set  @sqlCommand = @sqlCommand + 'MONTH(BAS_TARIH) AY1, DAY(BAS_TARIH) GUN1, MONTH(BIT_TARIH) AY2, DAY(BIT_TARIH) GUN2  FROM  TATIL TT  WITH(nolock) '
		 set  @sqlCommand = @sqlCommand + ' INNER JOIN TANIM T ON T.ID=TT.TATIL_TIPI_ID'
		 set  @sqlCommand = @sqlCommand + ' WHERE TT.DURUM=1'
		 if (@dTarih1 >@dTarih2)  
			 set  @sqlCommand = @sqlCommand + 'AND 1=2'
		    ELSE  BEGIN
			set  @sqlCommand = @sqlCommand + ' AND CONVERT(date, TT.BAS_TARIH)<= convert(datetime, '''+@bitTarih+''','+@format+')'
			set  @sqlCommand = @sqlCommand + ' AND CONVERT(date, TT.BIT_TARIH)>= convert(datetime, '''+@basTarih+''','+@format+')'
		 END
		 set  @sqlCommand = @sqlCommand + ' ), '
		  set  @sqlCommand =  @sqlCommand + ' TATIL_SON AS ( '
		 set  @sqlCommand = @sqlCommand + ' SELECT ID,KODU, CONVERT(date, BAS_TARIH) BAS_TARIH, DATETIMEFROMPARTS('+convert(nvarchar(4),@yil1)+',AY2,GUN2, 23,59,59,997) BIT_TARIH FROM TATIL_VERI'
		 set  @sqlCommand = @sqlCommand + ' WHERE KODU<>''P'''
		WHILE ( @yil1 <=@yil2) BEGIN 
		 set  @sqlCommand = @sqlCommand + ' UNION ALL '
		 set  @sqlCommand = @sqlCommand + 'SELECT ID, KODU, DATETIMEFROMPARTS('+convert(nvarchar(4),@yil1)+',AY1,GUN1, 0,0,0,0) AS  BAS_TARIH,'
		 set  @sqlCommand = @sqlCommand +' DATETIMEFROMPARTS('+convert(nvarchar(4),@yil1)+',AY2,GUN2, 23,59,59,997) BIT_TARIH FROM TATIL_VERI'
		 set  @sqlCommand = @sqlCommand +' WHERE KODU=''P'''
		 set @yil1=@yil1+1
		 
		END	 
		set  @sqlCommand = @sqlCommand + ' ) '
		set  @sqlCommand = @sqlCommand + ' SELECT TT.ID,TT.BAS_TARIH,TT.BIT_TARIH,KODU,T.AD,T.YARIM_GUN FROM TATIL_SON TT  WITH(nolock) '
		set  @sqlCommand = @sqlCommand + ' INNER JOIN TATIL T ON T.ID=TT.ID '
		set  @sqlCommand = @sqlCommand + ' WHERE CONVERT(date, TT.BAS_TARIH)<= convert(datetime, '''+@bitTarih+''','+@format+')'
		set  @sqlCommand = @sqlCommand + ' AND CONVERT(date, TT.BIT_TARIH)>= convert(datetime, '''+@basTarih+''','+@format+')'
		set  @sqlCommand = @sqlCommand + ' ORDER BY KODU,TT.BAS_TARIH'

--		PRINT    @sqlCommand

		EXECUTE sp_executesql    @sqlCommand  
		   
		   
END
 
GO
/****** Object:  StoredProcedure [dbo].[SP_GET_VARDIYA_OZET]    Script Date: 20.12.2023 17:26:32 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO



 

CREATE PROCEDURE [dbo].[SP_GET_VARDIYA_OZET]
	 
	@PersonelIdList [nvarchar](max),
	@basTarih [nvarchar](20),
	@bitTarih [nvarchar](20),
	@format [nvarchar](20)
WITH EXECUTE AS CALLER
AS
BEGIN
	-- SET NOCOUNT ON added to prevent extra result sets from
	-- interfering with SELECT statements.
	SET NOCOUNT ON;
 	   DECLARE @sqlCommand nvarchar(max) 
 	   DECLARE @personelId nvarchar(max)
	   DECLARE @tarih1 nvarchar(20)
	   DECLARE @tarih2 nvarchar(20)
	   DECLARE @df  nvarchar(20)
	    set  @sqlCommand =' WITH TARIHLER AS ( SELECT '
	    IF ( @format  IS NULL or @format='' )  
		     SET @df =  '120' ;
		else
			SET @df =  @format;

	   IF ( @basTarih  IS NULL )  
		     SET @tarih1 =  '' ;
		else
			SET @tarih1 =  @basTarih; 	
       IF ( @bitTarih  IS NULL )  
		     SET @tarih2 =  '' ;
		else
			SET @tarih2 =  @bitTarih; 	
 	   
	   	IF ( @PersonelIdList  IS NULL )  
		     SET @personelId =  '' ;
		else
			SET @personelId =  @PersonelIdList; 

			IF ( @tarih1 <> ''  )   
				  set  @sqlCommand= @sqlCommand+ ' convert(datetime, '''+@tarih1+''','+@df+') AS BAS_TARIH,';
			ELSE
				  set  @sqlCommand= @sqlCommand+ ' GETDATE() AS BAS_TARIH,';
			IF ( @tarih2 <> ''  )   
				  set  @sqlCommand= @sqlCommand+ ' convert(datetime, '''+@tarih2+''','+@df+') AS BIT_TARIH ';
			ELSE
				  set  @sqlCommand= @sqlCommand+ ' GETDATE() AS BIT_TARIH ';
 
			 
		     set  @sqlCommand= @sqlCommand+'), ' 
			 set  @sqlCommand= @sqlCommand+' DONEMLER AS ( ' +
			      ' SELECT D.*,BAS_TARIH,BIT_TARIH  FROM DENKLESTIRMEAY D ,TARIHLER T  ' +
			      ' WHERE  (D.YIL*100+AY)>=(YEAR(T.BAS_TARIH)*100+MONTH(T.BAS_TARIH)) AND (D.YIL*100+AY)<=(YEAR(T.BIT_TARIH)*100+MONTH(T.BIT_TARIH))   ' +
				  '),'
			set  @sqlCommand= @sqlCommand+' PERSONELDENK AS ( ' +
	      	   ' SELECT C.HAFTA_ICI_SAAT,CA.CALISMA_MODELI_ID,BAS_TARIH,BIT_TARIH,D.YIL,D.AY,'+ 
			    ' CASE WHEN S.ISTEN_AYR_TAR_CALISIYOR<>1 AND BIT_TARIH>=P.ISTEN_AYRILIS_TARIHI THEN ISTEN_AYRILIS_TARIHI+1 ELSE ISTEN_AYRILIS_TARIHI END ISTEN_AYRILIS_TARIHI, '+ 
				'  PD.* FROM DONEMLER D ' +
				' INNER JOIN PERSONELDENKLESTIRME PD ON PD.DONEM_ID=D.ID '
				 
				IF ( @personelId <> ''  )  
				  set  @sqlCommand= @sqlCommand+ ' AND  PD.PERSONEL_ID IN ('+@personelId+') ';
			set  @sqlCommand= @sqlCommand+' INNER JOIN PERSONEL P ON P.ID=PD.PERSONEL_ID ' +
				' INNER JOIN SIRKET S ON S.ID=P.SIRKET_ID '+
				' INNER JOIN CALISMA_MODELI_AY CA ON CA.ID=PD.CALISMA_MODELI_AY_ID'+
				' INNER JOIN CALISMA_MODELI C ON C.ID=CA.CALISMA_MODELI_ID )'  
		 set @sqlCommand= @sqlCommand +  ' SELECT V.ID, V.VARDIYA_TARIHI,V.PERSONEL_ID,S.NORMAL_SURE,S.CALISMA_SURESI,D.CALISMA_MODELI_ID,D.HAFTA_ICI_SAAT  FROM PERSONELDENK D '+
			 ' INNER JOIN VARDIYA_GUN V ON V.PERSONEL_ID=D.PERSONEL_ID '+
			' INNER JOIN VARDIYA_SAAT S ON S.ID=V.VARDIYA_SAAT_ID '+
			 ' AND V.VARDIYA_TARIHI>=D.BAS_TARIH AND  V.VARDIYA_TARIHI<=D.BIT_TARIH AND  V.VARDIYA_TARIHI<=D.ISTEN_AYRILIS_TARIHI '+
			 ' AND (S.CALISMA_SURESI>0 OR S.NORMAL_SURE>0 ) '+
			' AND YEAR( V.VARDIYA_TARIHI)=D.YIL AND  MONTH( V.VARDIYA_TARIHI)=D.AY ' 
		set @sqlCommand= @sqlCommand +  ' ORDER BY  V.PERSONEL_ID,V.VARDIYA_TARIHI ' 
	
		   PRINT    @sqlCommand
			EXECUTE sp_executesql    @sqlCommand  
		   
		   
END
GO
/****** Object:  StoredProcedure [dbo].[SP_GET_YONETICI]    Script Date: 20.12.2023 17:26:32 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
 
 

CREATE PROCEDURE [dbo].[SP_GET_YONETICI]

	@tarih [nvarchar](20),
 
	@df [nvarchar](20)
WITH EXECUTE AS CALLER
AS
BEGIN
 	   SET NOCOUNT ON;
 	   DECLARE @sqlCommand nvarchar(max) 
	    DECLARE @personelERPOku  nvarchar(1)
		 
		select  @personelERPOku=RTRIM(DEGER) from PARAMETRE  WITH(nolock) WHERE ADI='personelERPOku' AND DURUM=1
	    if (@df IS NULL OR @df='')
			 SET @df='112'
		 if (@tarih IS NULL OR @tarih='')
			 SET @tarih=Convert(CHAR(8),GETDATE(), convert(int,@df))
		set @sqlCommand =  ' WITH VERILER AS ( ' ;
		set @sqlCommand = @sqlCommand + ' SELECT DISTINCT P.* FROM PERSONEL P WITH(nolock) ' ;
		set @sqlCommand = @sqlCommand + ' INNER JOIN SIRKET S ON S.ID=P.SIRKET_ID AND S.DURUM=1 AND S.FAZLA_MESAI=1' ;
		set @sqlCommand = @sqlCommand + ' INNER JOIN PDKSUSER U ON U.PERSONEL_ID=P.ID AND U.DURUM=1 ' ;
		set @sqlCommand = @sqlCommand + ' INNER JOIN USERROLES UR ON UR.USERID=U.ID ' ;
		set @sqlCommand = @sqlCommand + ' INNER JOIN ROLE R ON R.ID=UR.ROLEID AND R.ROLENAME IN (''yonetici'',''yoneticiKontratli'',''genelMudur'') ' ;
		set @sqlCommand = @sqlCommand + ' AND R.STATUS=1 ' ;
		if (@personelERPOku='M') BEGIN
			set @sqlCommand = @sqlCommand + ' UNION ALL ';
			set @sqlCommand = @sqlCommand +  ' SELECT DISTINCT P.* FROM PERSONEL P WITH(nolock) ' ;
			set @sqlCommand = @sqlCommand + ' INNER JOIN SIRKET S ON S.ID=P.SIRKET_ID AND S.DURUM=1 AND S.FAZLA_MESAI=1' ;
			set @sqlCommand = @sqlCommand + ' INNER JOIN TANIM G ON G.ID=P.GOREV_TIPI_ID AND  G.KODU LIKE ''Y%'' AND G.DURUM=1';
 		END
		set @sqlCommand = @sqlCommand + '  ) ';
		set @sqlCommand = @sqlCommand + ' SELECT DISTINCT P.* FROM VERILER P ';
		set @sqlCommand = @sqlCommand + ' WHERE P.DURUM=1 AND    P.ISE_BASLAMA_TARIHI<= convert(datetime, '''+@tarih+''','+@df+') ';
		set @sqlCommand = @sqlCommand + ' AND  P.SSK_CIKIS_TARIHI>= convert(datetime, '''+@tarih+''','+@df+') ';
		set @sqlCommand = @sqlCommand + ' ORDER BY P.AD_SOYAD,P.PDKS_SICIL_NO ';
			 
  
 	   --  PRINT    @sqlCommand
			 EXECUTE sp_executesql    @sqlCommand  
		   
		   
END

 
GO
/****** Object:  StoredProcedure [dbo].[SP_HAREKET_EKLE]    Script Date: 20.12.2023 17:26:32 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[SP_HAREKET_EKLE]
	@KAPIID numeric(19,0),
	@PERSONELID numeric(19,0),
	@ZAMAN [datetime],
	@GUNCELLEYENID numeric(19,0),
	@NEDEN_ID numeric(19,0),
	@ACIKLAMA [varchar](80)
WITH EXECUTE AS CALLER
AS
begin
	insert INTO PDKS_ISLEM (GUNCELLEYEN_PERSONEL_ID,ACIKLAMA,ISLEM_TIPI,NEDEN_ID,OLUSTURMA_ZAMANI) VALUES (@GUNCELLEYENID,@ACIKLAMA ,'I',@NEDEN_ID,GETDATE())
	DECLARE @islemId numeric(19,0), @HAREKET_ID numeric(19,0)	 
	SELECT @islemId=SCOPE_IDENTITY()
	UPDATE PDKS_ISLEM  SET ONAYLAYAN_ID=@GUNCELLEYENID,ONAY_DURUM=1,ZAMAN=GETDATE() WHERE ID= @islemId
	insert PDKS_HAREKET (KAPI,PERSONEL,ZAMAN,ISLEM_ID,DURUM) VALUES (@KAPIID,@PERSONELID,@ZAMAN,@islemId,1)
	SELECT @HAREKET_ID=SCOPE_IDENTITY()
    SELECT @HAREKET_ID
END 
GO
/****** Object:  StoredProcedure [dbo].[SP_HAREKET_EKLE_RETURN]    Script Date: 20.12.2023 17:26:32 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
 
CREATE PROCEDURE [dbo].[SP_HAREKET_EKLE_RETURN]
	@KAPIID numeric(19,0),
	@PERSONELID numeric(19,0),
	@ZAMAN [datetime],
	@GUNCELLEYENID numeric(19,0),
	@NEDEN_ID numeric(19,0),
	@ACIKLAMA [varchar](80)
WITH EXECUTE AS CALLER
AS
begin
	DECLARE @HAREKET_ID numeric(19,0) 
	IF EXISTS (SELECT 1 FROM PDKS_HAREKET WHERE  KAPI=@KAPIID AND PERSONEL=@PERSONELID AND ZAMAN=@ZAMAN AND DURUM=1) BEGIN
		
		SELECT @HAREKET_ID=ID FROM PDKS_HAREKET WHERE  KAPI=@KAPIID AND PERSONEL=@PERSONELID AND ZAMAN=@ZAMAN AND DURUM=1
		 
	END  
	ELSE BEGIN

   insert INTO PDKS_ISLEM (GUNCELLEYEN_PERSONEL_ID,ACIKLAMA,ISLEM_TIPI,NEDEN_ID,OLUSTURMA_ZAMANI) VALUES (@GUNCELLEYENID,@ACIKLAMA ,'I',@NEDEN_ID,GETDATE())
	DECLARE @islemId int 	 
	SELECT @islemId=SCOPE_IDENTITY()
	UPDATE PDKS_ISLEM  SET ONAYLAYAN_ID=@GUNCELLEYENID,ONAY_DURUM=1,ZAMAN=GETDATE() WHERE ID= @islemId
	insert PDKS_HAREKET (KAPI,PERSONEL,ZAMAN,ISLEM_ID,DURUM) VALUES (@KAPIID,@PERSONELID,@ZAMAN,@islemId,1)
	  SELECT @HAREKET_ID=SCOPE_IDENTITY()
	
    
	 END  
	 select TOP 1 @HAREKET_ID
   END 
GO
/****** Object:  StoredProcedure [dbo].[SP_HAREKET_GUNCELLE_SIRKET]    Script Date: 20.12.2023 17:26:32 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[SP_HAREKET_GUNCELLE_SIRKET]
	@KGSID numeric(19,0),
	@PDKSID numeric(19,0),
	@ZAMAN [datetime],
	@GUNCELLEYENID numeric(19,0),
	@NEDEN_ID numeric(19,0),
	@ACIKLAMA [varchar](80),
	@KGS_SIRKET_ID [bigint]
WITH EXECUTE AS CALLER
AS
begin
 	 
    DECLARE @islemId numeric(19,0)	 
	 if (@PDKSID<>0) begin
        set @islemId=(select ISLEM_ID FROM PDKS_HAREKET WHERE ID=@PDKSID)
        	   
	   UPDATE PDKS_ISLEM SET ACIKLAMA=@ACIKLAMA,ISLEM_TIPI='U',NEDEN_ID=@NEDEN_ID,GUNCELLEYEN_PERSONEL_ID=@GUNCELLEYENID,ZAMAN=getDate() WHERE ID=@islemId
       UPDATE PDKS_HAREKET SET ZAMAN=@ZAMAN WHERE ID=@PDKSID
     end 
	 else
	 if (@KGSID<>0) begin
 	   INSERT INTO PDKS_ISLEM (GUNCELLEYEN_PERSONEL_ID,ACIKLAMA,ISLEM_TIPI,NEDEN_ID,OLUSTURMA_ZAMANI,ZAMAN) VALUES (@GUNCELLEYENID,@ACIKLAMA ,'U',@NEDEN_ID,GETDATE(),@ZAMAN )
	   SELECT @islemId=SCOPE_IDENTITY()
	   UPDATE PDKS_ISLEM  SET ONAYLAYAN_ID=@GUNCELLEYENID,ONAY_DURUM=1,ZAMAN=GETDATE() WHERE ID= @islemId  
       UPDATE PDKS_LOG SET ISLEM_ID=@islemId,DURUM=0,GUNCELLEME_ZAMANI=GETDATE() WHERE KGS_ID=@KGSID AND KGS_SIRKET_ID=@KGS_SIRKET_ID
	   INSERT PDKS_HAREKET (PERSONEL,KAPI,ZAMAN,ISLEM_ID,KGS_ID,DURUM)
	   SELECT DISTINCT USERID,KAPIID,@ZAMAN,@islemId,@KGSID,@KGS_SIRKET_ID FROM PDKS_LOG 
		   WHERE KGS_ID=@KGSID AND KGS_SIRKET_ID=@KGS_SIRKET_ID
	 end 	 
END
GO
/****** Object:  StoredProcedure [dbo].[SP_HAREKET_ID_REORG]    Script Date: 20.12.2023 17:26:32 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
 


 
CREATE PROCEDURE [dbo].[SP_HAREKET_ID_REORG]
@ID bigint
WITH EXECUTE AS CALLER
AS
BEGIN
 	 SET NOCOUNT ON;
	 IF ([dbo].[FN_PDKS_HELP_DESK_DURUM]()=1) BEGIN
		 IF (@ID IS NULL OR @ID<0)
			 SET @ID=1;
 	 
		 CREATE TABLE #temp_table (
		ID bigint
	 
			  );
			INSERT INTO #temp_table (ID)
			select TOP 300000 ID from PDKS_LOG 
			WHERE ID>=@ID  
 				   ORDER BY ID ;


		   DECLARE @adet bigint
	
		   DECLARE LOG_cursor CURSOR FOR 
		   select  ID from #temp_table 
	  
		   ORDER BY ID 
			set @adet=@ID-1
		   OPEN LOG_cursor
					FETCH NEXT FROM LOG_cursor INTO @ID
					WHILE @@FETCH_STATUS = 0  BEGIN  
							SET @adet = @adet + 1
							IF (@adet<@ID) BEGIN
								 BEGIN TRY
										BEGIN TRANSACTION;
										SET IDENTITY_INSERT PDKS_LOG ON ;
										INSERT INTO PDKS_LOG (ID , HAREKET_ZAMANI , USERID , KAPIID , KGS_ID , OLUSTURMA_ZAMANI , DURUM , ISLEM_ID , GUNCELLEME_ZAMANI , KGS_SIRKET_ID )
											SELECT @adet ID , HAREKET_ZAMANI , USERID , KAPIID , KGS_ID , OLUSTURMA_ZAMANI , DURUM , ISLEM_ID , GUNCELLEME_ZAMANI ,
											KGS_SIRKET_ID FROM PDKS_LOG 
										WHERE ID=@ID;
										SET IDENTITY_INSERT PDKS_LOG OFF;
										DELETE FROM PDKS_LOG WHERE ID=@ID;
										COMMIT;
										PRINT   CAST(@ID AS varchar(18) ) + ' --> ' + CAST(@adet AS varchar(18) );
								  END TRY
								  BEGIN CATCH
									 ROLLBACK TRANSACTION
								  END CATCH
							
							END
							FETCH NEXT FROM LOG_cursor INTO @ID
					END
			CLOSE LOG_cursor;  
			DEALLOCATE LOG_cursor;
			DROP TABLE #temp_table;
			PRINT     'SON : ' + CAST(@adet AS varchar(18) )	 
			EXEC SP_CHECKIDENT_VIEW;
	END
	    
END
GO
/****** Object:  StoredProcedure [dbo].[SP_HAREKET_ONAYLA]    Script Date: 20.12.2023 17:26:32 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[SP_HAREKET_ONAYLA]
	@ISLEMID numeric(19,0),
	@ONAYLAYANID  numeric(19,0)
WITH EXECUTE AS CALLER
AS
begin
	UPDATE PDKS_ISLEM  SET ONAYLAYAN_ID=@ONAYLAYANID,ONAY_DURUM=1,ZAMAN=GETDATE() WHERE ID= @ISLEMID AND ONAY_DURUM=0


END

GO
/****** Object:  StoredProcedure [dbo].[SP_HAREKET_ONAYLAMA]    Script Date: 20.12.2023 17:26:32 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
 
CREATE PROCEDURE [dbo].[SP_HAREKET_ONAYLAMA]
	@KGSID [numeric](19, 0),
	@PDKSID [numeric](19, 0),
	@ONAYLAYANID [numeric](19, 0)
WITH EXECUTE AS CALLER
AS
begin
      DECLARE @ISLEMID [numeric](19, 0)
      DECLARE @HAREKET_ID  varchar(80)   
	 if (@KGSID>0) BEGIN 
	   select @ISLEMID=ISLEM_ID FROM PDKS_LOG WHERE ID=@KGSID 
       update PDKS_LOG SET DURUM=1,ISLEM_ID=NULL WHERE ID=@KGSID
	 
	 END 
	 else
	 if (@PDKSID>0) begin
 	   SET @HAREKET_ID = 'A' + Convert(varchar(60), @PDKSID)
	   select @KGSID=KGS_ID,@ISLEMID=ISLEM_ID FROM PDKS_HAREKET WHERE ID=@PDKSID 
	   if  (@KGSID IS NOT NULL ) AND (@KGSID>0) 
		  update PDKS_LOG SET DURUM=1,ISLEM_ID=NULL WHERE ID=@KGSID
	   DELETE FROM PDKS_HAREKET WHERE ID=@PDKSID
	   DELETE FROM PERSONELFAZLAMESAI WHERE HAREKET_ID=@HAREKET_ID
 	 end
	 UPDATE PDKS_ISLEM  SET ONAYLAYAN_ID=@ONAYLAYANID,ONAY_DURUM=2,ZAMAN=GETDATE() WHERE ID= @ISLEMID AND ONAY_DURUM=0
	   SELECT @ISLEMID
END
GO
/****** Object:  StoredProcedure [dbo].[SP_HAREKET_SIL_SIRKET]    Script Date: 20.12.2023 17:26:32 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
 
CREATE PROCEDURE [dbo].[SP_HAREKET_SIL_SIRKET]
	@KGSID  numeric(19,0),	
	@PDKSID  numeric(19,0)	,
	@GUNCELLEYENID  numeric(19,0)	,
	@NEDEN_ID  numeric(19,0)	,
	@ACIKLAMA [varchar](80),
	@KGS_SIRKET_ID  numeric(19,0)	
WITH EXECUTE AS CALLER
AS
begin
  DECLARE @islemId  numeric(19,0)	 	 
	 DECLARE @ZAMAN datetime	 
	 DECLARE @KDID  numeric(19,0)	 
	 DECLARE @HAREKET_ID  varchar(80)
	 if (@KGSID<>0) begin
	   SET @HAREKET_ID='K' +  Convert(varchar(60), @KGSID)
       SELECT @ZAMAN=HAREKET_ZAMANI FROM dbo.PDKS_LOG WHERE ID=@KGSID

   	   INSERT INTO PDKS_ISLEM (GUNCELLEYEN_PERSONEL_ID,ACIKLAMA,ISLEM_TIPI,NEDEN_ID,OLUSTURMA_ZAMANI,ZAMAN) VALUES (@GUNCELLEYENID,@ACIKLAMA ,'D',@NEDEN_ID,GETDATE(),@ZAMAN)
	   SELECT @islemId=SCOPE_IDENTITY()
	   UPDATE PDKS_ISLEM  SET ONAYLAYAN_ID=@GUNCELLEYENID,ONAY_DURUM=1,ZAMAN=GETDATE() WHERE ID= @islemId AND ONAY_DURUM=0
       UPDATE dbo.PDKS_LOG SET ISLEM_ID=@islemId,DURUM=0,GUNCELLEME_ZAMANI=GETDATE()  WHERE KGS_ID=@KGSID AND KGS_SIRKET_ID=@KGS_SIRKET_ID
 	 end 
	 else

	 if  (@PDKSID<>0)  begin
	    SET @HAREKET_ID = 'A' + Convert(varchar(60), @PDKSID)
	    select @KDID=KGS_ID,@islemId=ISLEM_ID FROM PDKS_HAREKET WHERE ID=@PDKSID 

	   if (@KDID IS NOT NULL) AND (@KDID>0)  begin
		    DELETE FROM dbo.PDKS_HAREKET  WHERE ID=@PDKSID
			UPDATE dbo.PDKS_LOG SET ISLEM_ID=@islemId,DURUM=1,GUNCELLEME_ZAMANI=GETDATE()  WHERE KGS_ID=@KDID AND KGS_SIRKET_ID=@KGS_SIRKET_ID
		end
        else BEGIN

		   UPDATE dbo.PDKS_HAREKET SET DURUM=0 WHERE ID=@PDKSID
		 END
		 UPDATE dbo.PDKS_ISLEM SET ACIKLAMA=@ACIKLAMA,ISLEM_TIPI='D',NEDEN_ID=@NEDEN_ID,
			GUNCELLEYEN_PERSONEL_ID=@GUNCELLEYENID,ONAYLAYAN_ID=@GUNCELLEYENID,ONAY_DURUM=1,ZAMAN=GETDATE() WHERE ID= @islemId  	

     end 
     DELETE FROM PERSONELFAZLAMESAI WHERE HAREKET_ID=@HAREKET_ID
	 SELECT @HAREKET_ID

END
GO
/****** Object:  StoredProcedure [dbo].[SP_HOLDING_IZIN_RAPOR_ALL]    Script Date: 20.12.2023 17:26:32 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[SP_HOLDING_IZIN_RAPOR_ALL]
	@personelList [nvarchar](max),
	@sirketId [nvarchar](max),
	@tarih [nvarchar](20),
	@format [nvarchar](20)
WITH EXECUTE AS CALLER
AS
BEGIN
	-- SET NOCOUNT ON added to prevent extra result sets from
	-- interfering with SELECT statements.
	SET NOCOUNT ON;
 	   DECLARE @sqlCommand nvarchar(max) 
	 
	   DECLARE @personel nvarchar(max)
	   DECLARE @tarih1 nvarchar(20)
	  
	   DECLARE @df  nvarchar(20)
	   DECLARE @borcStr nvarchar(max)
	    SET @borcStr=' SUM (CAST(CASE WHEN Z.TARIH>I.BITIS_ZAMANI THEN COALESCE(HI.IZIN_SURESI ,I.IZIN_SURESI) ELSE 0 END  AS DECIMAL(19,2))) '
	   if (@sirketId IS NULL or @sirketId=0)
	    SET @sirketId =  '2' ;
	    IF ( @format  IS NULL or @format='' )  
		     SET @df =  '120' ;
		else
			SET @df =  @format;

	   IF ( @tarih  IS NULL )  
		     SET @tarih1 =  '' ;
		else
			SET @tarih1 =  @tarih; 	
         	
 	    
	   	IF ( @personelList  IS NULL )  
		     SET @personel =  '' ;
		else
			SET @personel =  @personelList; 
 		 set  @sqlCommand ='WITH ZAMAN AS (' ;
		 if (@tarih1<>'')
			set  @sqlCommand =@sqlCommand+ 'SELECT  CAST(CAST( convert(datetime, '''+@tarih1+''','+@df+') AS date) AS datetime) AS TARIH' ;
		else
			set  @sqlCommand =@sqlCommand+ 'SELECT  CAST(CAST(GETDATE() AS date) AS datetime) AS TARIH' ;
			set  @sqlCommand =@sqlCommand+  ',CAST(P.DEGER AS DECIMAL(19,2)) SUA_IZIN_MAX_BAKIYE  FROM PARAMETRE P '+
			' where ADI=''suaIzinMaxBakiye''), ' +
 			' PERSONELLER AS (' +
			' SELECT P.* FROM PERSONEL P,ZAMAN Z ' +
	 
			' WHERE P.SIRKET_ID='+@sirketId+' AND P.DURUM=1 and P.ISTEN_AYRILIS_TARIHI>Z.TARIH AND P.ISE_BASLAMA_TARIHI<= Z.TARIH ' +
			' AND P.PDKS_SICIL_NO<>'''' AND YEAR(P.IZIN_HAKEDIS_TARIHI)<YEAR(Z.TARIH) ' ;
			if (@personel<>'')   
			  set  @sqlCommand =@sqlCommand+' AND P.ID in ('+@personel+')';
			set  @sqlCommand =@sqlCommand+	'), ' +
			' IZIN_TIPI AS ( ' +
			' select  IT.ID IZIN_TIPI_ID,IT.BAKIYE_IZIN_TIPI_ID,T.KODU AS IZIN_KODU,IT.DEPARTMAN_ID from IZINTIPI  IT ' +
			' INNER JOIN TANIM T ON T.ID=IT.IZIN_TIPI_ID and T.KODU in (''90'',''ŞUA'') ' +
 			' WHERE IT.DURUM=1 ' +
 
			'), ' +

			'IZINLER AS (' +
			' SELECT P.DOGUM_TARIHI,P.IZIN_HAKEDIS_TARIHI,T.BAKIYE_IZIN_TIPI_ID,T.IZIN_KODU,T.DEPARTMAN_ID,I.*  FROM PERSONELIZIN I' +
			' INNER JOIN IZIN_TIPI T ON T.IZIN_TIPI_ID=I.IZIN_TIPI_ID ' +
			' INNER JOIN ZAMAN Z ON 1=1' +
			' INNER JOIN PERSONELLER P ON P.ID=I.PERSONEL_ID' +
			' WHERE I.IZIN_DURUMU NOT IN (8,9) ' +
			' AND YEAR(I.BASLANGIC_ZAMANI)<=YEAR(Z.TARIH )  ' +
			'), ' +
			'SUA_IZINLER AS (' +
				' SELECT I.PERSONEL_ID,I.BASLANGIC_ZAMANI FROM IZINLER I' +
				' INNER JOIN PERSONELLER P ON P.ID=I.PERSONEL_ID '+
				' WHERE IZIN_KODU=''ŞUA'' AND BAKIYE_IZIN_TIPI_ID IS NOT NULL AND YEAR(BASLANGIC_ZAMANI)>2019 AND I.IZIN_SURESI>0 ' +
				') ,' +


			' HAKETMEYEN_IZINLER AS (' +
			' SELECT I.ID AS IZIN_ID,DATEDIFF(year,I.DOGUM_TARIHI,I.BITIS_ZAMANI) AS YAS,CASE WHEN SI.PERSONEL_ID  IS NOT NULL AND I.IZIN_KODU=''90'' THEN 1 ELSE 0 END SUA_DURUM,I.IZIN_KODU,I.IZIN_TIPI_ID,I.DEPARTMAN_ID,I.BITIS_ZAMANI,' +
			' CASE WHEN DATEDIFF(year,I.DOGUM_TARIHI,I.BITIS_ZAMANI)<18 THEN 0' +
			'   WHEN DATEDIFF(year,I.DOGUM_TARIHI,I.BITIS_ZAMANI)>49 THEN 2 ELSE 1 END YAS_TIPI,Z.SUA_IZIN_MAX_BAKIYE,' +
			'  DATEDIFF(year,I.IZIN_HAKEDIS_TARIHI,I.BITIS_ZAMANI) AS KIDEM   FROM IZINLER I' +
			'  INNER JOIN ZAMAN Z ON 1=1 ' +
			' LEFT JOIN SUA_IZINLER SI ON SI.PERSONEL_ID =I.PERSONEL_ID AND SI.BASLANGIC_ZAMANI=I.BASLANGIC_ZAMANI'+
			' WHERE I.BAKIYE_IZIN_TIPI_ID IS NOT NULL AND I.BITIS_ZAMANI>GETDATE() ' +
 			' ), ' +
			' HAKEDIS_IZIN AS ( ' +
		'   SELECT H.IZIN_ID,CASE WHEN H.IZIN_KODU<>''ŞUA'' THEN S.IZIN_SURESI ELSE H.SUA_IZIN_MAX_BAKIYE END AS IZIN_SURESI FROM HAKETMEYEN_IZINLER H  ' +
		'  INNER JOIN IZINHAKEDISHAKKI S ON S.DEPARTMAN=H.DEPARTMAN_ID AND S.KIDEMYILI=h.KIDEM  AND S.SUA_DURUM=H.SUA_DURUM AND S.YAS_TIPI=H.YAS_TIPI AND S.DURUM=1  ' +
 		 ' ) , ' +
		' IZIN_KART_IZIN AS ( '+
		' SELECT DISTINCT I.* FROM IZINLER I'+
		' INNER JOIN PERSONELIZINDETAY D ON D.IZIN_ID=I.ID'+
		' INNER JOIN IZINLER H ON D.HAKEDIS_IZIN_ID=H.ID'+
		'  WHERE I.BAKIYE_IZIN_TIPI_ID IS NULL '+
		'  ),'+
 

			'  HARCANAN_IZINLER AS ( ' +
			' 	SELECT I.PERSONEL_ID,CAST(SUM(CASE WHEN YEAR(I.BASLANGIC_ZAMANI)<YEAR(Z.TARIH) THEN I.IZIN_SURESI ELSE 0 END ) AS DECIMAL(19,2)) GECEN_DONEM, ' + 
			'    CAST(SUM( CASE WHEN YEAR(I.BASLANGIC_ZAMANI)=YEAR(Z.TARIH) THEN I.IZIN_SURESI ELSE 0 END) AS DECIMAL(19,2)) BU_YIL  FROM IZIN_KART_IZIN I ' +
			' 	 INNER JOIN ZAMAN Z ON 1=1  ' +
			' 	 WHERE   CONVERT(date,I.BASLANGIC_ZAMANI)<=Z.TARIH ' +
			' 	 GROUP BY I.PERSONEL_ID ' +
			'  ) ,  ' +
			'  YILLIK__DETAY_OZET AS ( ' +
			'   SELECT I.PERSONEL_ID,I.BASLANGIC_ZAMANI,I.IZIN_KODU,'+@borcStr+' AS IZIN_SURESI,0 AS HARCANAN_SURE  FROM IZINLER I  ' + 
		  ' 	 INNER JOIN ZAMAN Z ON 1=1  ' + 
			' 	 LEFT JOIN HAKEDIS_IZIN HI ON HI.IZIN_ID=I.ID  ' +
			' 	 WHERE I.BAKIYE_IZIN_TIPI_ID IS NOT NULL   AND YEAR(I.BASLANGIC_ZAMANI)<=YEAR(Z.TARIH) AND  I.IZIN_SURESI>0  ' +
			'   AND I.IZIN_KAGIDI_GELDI IS NULL '+
 			' 	  GROUP BY I.PERSONEL_ID ,I.BASLANGIC_ZAMANI,HI.IZIN_SURESI,I.IZIN_SURESI,I.IZIN_KODU ' +
			 ' ) ,   ' +
		 ' YILLIK_OZET AS ( ' +
		 ' SELECT PERSONEL_ID,BASLANGIC_ZAMANI,SUM(IZIN_SURESI) IZIN_SURESI ,SUM(CASE WHEN IZIN_KODU<>''ŞUA'' THEN IZIN_SURESI ELSE  0 END ) SENELIK_IZIN, ' +
		 ' SUM(CASE WHEN IZIN_KODU=''ŞUA'' THEN IZIN_SURESI ELSE  0 END ) SUA, 0 HARCANAN_SURE FROM YILLIK__DETAY_OZET I ' +
		 ' GROUP BY I.PERSONEL_ID ,I.BASLANGIC_ZAMANI ' +
		'  ) ,   ' +
	 

		 '   SONUC_DATA AS (  ' +
		'    SELECT I.PERSONEL_ID,SUM(CASE WHEN YEAR(BASLANGIC_ZAMANI)<YEAR(Z.TARIH)  THEN  IZIN_SURESI - HARCANAN_SURE ELSE 0 END)  AS GECEN_YIL_BAKIYE,  ' +
		'    CAST( SUM(CASE WHEN YEAR(BASLANGIC_ZAMANI)<YEAR(Z.TARIH)  THEN  0 ELSE IZIN_SURESI END) as int) BU_YIL_HAKKEDILEN,  ' +
		'    CAST( SUM(CASE WHEN YEAR(BASLANGIC_ZAMANI)<YEAR(Z.TARIH)  THEN  0 ELSE SUA END) as int) BU_YIL_HAKKEDILEN_SUA,  ' +
		'    SUM(CASE WHEN YEAR(BASLANGIC_ZAMANI)<YEAR(Z.TARIH) THEN  0 ELSE HARCANAN_SURE END)  HARCANAN_SURE  FROM YILLIK_OZET I  ' +
		'     INNER JOIN ZAMAN Z ON 1=1  ' +
	
		' 	GROUP BY I.PERSONEL_ID,Z.TARIH  ' +
		' )    ' +
		' 	SELECT  S.PERSONEL_ID,P.SIRKET_ID, P.PDKS_SICIL_NO,P.AD,P.SOYAD  ,P.DOGUM_TARIHI,P.IZIN_HAKEDIS_TARIHI, ' + 
		' 	S.GECEN_YIL_BAKIYE -COALESCE(HI.GECEN_DONEM,0) GECEN_YIL_BAKIYE , S.BU_YIL_HAKKEDILEN,S.BU_YIL_HAKKEDILEN_SUA,	COALESCE(HI.BU_YIL,0) HARCANAN_SURE, ' +
		' 	S.GECEN_YIL_BAKIYE+S.BU_YIL_HAKKEDILEN-S.HARCANAN_SURE -COALESCE(HI.GECEN_DONEM,0) - COALESCE(HI.BU_YIL,0) AS BAKIYE FROM SONUC_DATA S  ' +
		' 	LEFT JOIN   HARCANAN_IZINLER HI ON HI.PERSONEL_ID=S.PERSONEL_ID ' +
		' 	INNER JOIN PERSONELLER P ON P.ID=S.PERSONEL_ID    ' +
		' 	ORDER BY P.IZIN_HAKEDIS_TARIHI, P.PDKS_SICIL_NO  ' ;

 
 
	       PRINT    @sqlCommand;
		   EXECUTE sp_executesql    @sqlCommand  ;
		   
		   
END
GO
/****** Object:  StoredProcedure [dbo].[SP_HOLDING_IZIN_RAPOR_AYRILANLARLA]    Script Date: 20.12.2023 17:26:32 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[SP_HOLDING_IZIN_RAPOR_AYRILANLARLA]
	@personelList [nvarchar](max),
	@sirketId [nvarchar](max),
	@tarih [nvarchar](20),
	@format [nvarchar](20)
WITH EXECUTE AS CALLER
AS
BEGIN
	-- SET NOCOUNT ON added to prevent extra result sets from
	-- interfering with SELECT statements.
	SET NOCOUNT ON;
 	   DECLARE @sqlCommand nvarchar(max) 
	 
	   DECLARE @personel nvarchar(max)
	   DECLARE @tarih1 nvarchar(20)
	  
	   DECLARE @df  nvarchar(20)
	   DECLARE @borcStr nvarchar(max)
	    SET @borcStr=' SUM (CAST(CASE WHEN Z.TARIH>I.BITIS_ZAMANI THEN COALESCE(HI.IZIN_SURESI ,I.IZIN_SURESI) ELSE 0 END  AS DECIMAL(19,2))) '

	   if (@sirketId IS NULL or @sirketId=0)
	    SET @sirketId =  '2' ;
	    IF ( @format  IS NULL or @format='' )  
		     SET @df =  '120' ;
		else
			SET @df =  @format;

	   IF ( @tarih  IS NULL )  
		     SET @tarih1 =  '' ;
		else
			SET @tarih1 =  @tarih; 	
         	
 	    
	   	IF ( @personelList  IS NULL )  
		     SET @personel =  '' ;
		else
			SET @personel =  @personelList; 
 		 set  @sqlCommand ='WITH ZAMAN AS (' ;
		 if (@tarih1<>'')
			set  @sqlCommand =@sqlCommand+ 'SELECT  CAST(CAST( convert(datetime, '''+@tarih1+''','+@df+') AS date) AS datetime) AS TARIH' ;
		else
			set  @sqlCommand =@sqlCommand+ 'SELECT  CAST(CAST(GETDATE() AS date) AS datetime) AS TARIH' ;
			set  @sqlCommand =@sqlCommand+  ',CAST(P.DEGER AS DECIMAL(19,2)) SUA_IZIN_MAX_BAKIYE  FROM PARAMETRE P '+
			' where ADI=''suaIzinMaxBakiye''), ' +
 			' PERSONELLER AS (' +
			' SELECT P.* FROM PERSONEL P,ZAMAN Z ' +
	 
			' WHERE P.SIRKET_ID='+@sirketId+' AND    P.ISE_BASLAMA_TARIHI<= Z.TARIH AND P.PDKS_SICIL_NO<>'''' ' +
			' AND YEAR(P.IZIN_HAKEDIS_TARIHI)<YEAR(Z.TARIH) ' ;
			if (@personel<>'')   
			  set  @sqlCommand =@sqlCommand+' AND P.ID in ('+@personel+')';
			set  @sqlCommand =@sqlCommand+	'), ' +
			' IZIN_TIPI AS ( ' +
			' select  IT.ID IZIN_TIPI_ID,IT.BAKIYE_IZIN_TIPI_ID,T.KODU AS IZIN_KODU,IT.DEPARTMAN_ID from IZINTIPI IT ' +
			' INNER JOIN TANIM T ON T.ID=IT.IZIN_TIPI_ID and T.KODU in (''90'',''ŞUA'') ' +
 			' WHERE IT.DURUM=1 ' +
 
			'), ' +

			'IZINLER AS (' +
			' SELECT P.DOGUM_TARIHI,P.IZIN_HAKEDIS_TARIHI,P.ISTEN_AYRILIS_TARIHI,T.BAKIYE_IZIN_TIPI_ID,T.IZIN_KODU,T.DEPARTMAN_ID,I.*  FROM PERSONELIZIN I' +
			' INNER JOIN IZIN_TIPI T ON T.IZIN_TIPI_ID=I.IZIN_TIPI_ID ' +
			' INNER JOIN ZAMAN Z ON 1=1' +
			' INNER JOIN PERSONELLER P ON P.ID=I.PERSONEL_ID' +
			' WHERE I.IZIN_DURUMU NOT IN (8,9) AND YEAR(I.BASLANGIC_ZAMANI)<=YEAR(Z.TARIH ) ' +
				') ,' +
			' SUA_IZINLER AS ( ' +
				' SELECT I.PERSONEL_ID,I.BASLANGIC_ZAMANI FROM IZINLER I ' +
				' INNER JOIN PERSONELLER P ON P.ID=I.PERSONEL_ID '+
				' WHERE IZIN_KODU=''ŞUA'' AND BAKIYE_IZIN_TIPI_ID IS NOT NULL AND YEAR(BASLANGIC_ZAMANI)>2019 AND I.IZIN_SURESI>0' +
				') ,' +
			 
			' HAKETMEYEN_IZINLER AS (' +
			' SELECT I.ID AS IZIN_ID,DATEDIFF(year,I.DOGUM_TARIHI,I.BITIS_ZAMANI) AS YAS,CASE WHEN SI.PERSONEL_ID  IS NOT NULL AND I.IZIN_KODU=''90'' THEN 1 ELSE 0 END SUA_DURUM,  I.IZIN_KODU,I.IZIN_TIPI_ID,I.DEPARTMAN_ID,I.BITIS_ZAMANI,' +
			' CASE WHEN DATEDIFF(year,I.DOGUM_TARIHI,I.BITIS_ZAMANI)<18 THEN 0' +
			'   WHEN DATEDIFF(year,I.DOGUM_TARIHI,I.BITIS_ZAMANI)>49 THEN 2 ELSE 1 END YAS_TIPI,Z.SUA_IZIN_MAX_BAKIYE,' +
			'  DATEDIFF(year,I.IZIN_HAKEDIS_TARIHI,I.BITIS_ZAMANI) AS KIDEM   FROM IZINLER I' +
			'  INNER JOIN ZAMAN Z ON 1=1 ' +
			' LEFT JOIN SUA_IZINLER SI ON SI.PERSONEL_ID =I.PERSONEL_ID AND SI.BASLANGIC_ZAMANI=I.BASLANGIC_ZAMANI'+
			' WHERE I.BAKIYE_IZIN_TIPI_ID IS NOT NULL AND I.BITIS_ZAMANI>GETDATE() ' +
 			' ), ' +
			' HAKEDIS_IZIN AS ( ' +
			'   SELECT H.IZIN_ID,CASE WHEN H.IZIN_KODU<>''ŞUA'' THEN S.IZIN_SURESI ELSE H.SUA_IZIN_MAX_BAKIYE END AS IZIN_SURESI FROM HAKETMEYEN_IZINLER H  ' +
		'  INNER JOIN IZINHAKEDISHAKKI S ON S.DEPARTMAN=H.DEPARTMAN_ID AND S.KIDEMYILI=h.KIDEM  AND S.SUA_DURUM=H.SUA_DURUM AND S.YAS_TIPI=H.YAS_TIPI AND S.DURUM=1  ' +
  		 ' ) , ' +
		' IZIN_KART_IZIN AS ( '+
			' SELECT DISTINCT I.* FROM IZINLER I'+
			' INNER JOIN PERSONELIZINDETAY D ON D.IZIN_ID=I.ID'+
			' INNER JOIN IZINLER H ON D.HAKEDIS_IZIN_ID=H.ID'+
			'  WHERE I.BAKIYE_IZIN_TIPI_ID IS NULL '+
		'  ),'+
 

			'  HARCANAN_IZINLER AS ( ' +
			' 	SELECT I.PERSONEL_ID,CAST(SUM(CASE WHEN YEAR(I.BASLANGIC_ZAMANI)<YEAR(Z.TARIH) THEN I.IZIN_SURESI ELSE 0 END ) AS DECIMAL(19,2)) GECEN_DONEM, ' + 
			'    CAST(SUM( CASE WHEN YEAR(I.BASLANGIC_ZAMANI)=YEAR(Z.TARIH) THEN I.IZIN_SURESI ELSE 0 END) AS DECIMAL(19,2)) BU_YIL  FROM IZIN_KART_IZIN I ' +
			' 	 INNER JOIN ZAMAN Z ON 1=1  ' +
			' 	 WHERE   CONVERT(date,I.BASLANGIC_ZAMANI)<=Z.TARIH ' +
			' 	 GROUP BY I.PERSONEL_ID ' +
			'  ) ,  ' +
			'  YILLIK__DETAY_OZET AS ( ' +
			'   SELECT I.PERSONEL_ID,I.BASLANGIC_ZAMANI,I.IZIN_KODU,'+@borcStr+' AS IZIN_SURESI,0 AS HARCANAN_SURE  FROM IZINLER I  ' + 
			' 	 INNER JOIN ZAMAN Z ON 1=1  ' + 
			' 	 LEFT JOIN HAKEDIS_IZIN HI ON HI.IZIN_ID=I.ID  ' +
			' 	 WHERE I.BAKIYE_IZIN_TIPI_ID IS NOT NULL   AND YEAR(I.BASLANGIC_ZAMANI)<=YEAR(Z.TARIH)   AND I.BITIS_ZAMANI<I.ISTEN_AYRILIS_TARIHI ' +
			' AND  I.IZIN_SURESI>0 '+
			' 	  GROUP BY I.PERSONEL_ID ,I.BASLANGIC_ZAMANI,HI.IZIN_SURESI,I.IZIN_SURESI,I.IZIN_KODU ' +
			 ' ) ,   ' +
		 ' YILLIK_OZET AS ( ' +
			 ' SELECT PERSONEL_ID,BASLANGIC_ZAMANI,SUM(IZIN_SURESI) IZIN_SURESI ,SUM(CASE WHEN IZIN_KODU<>''ŞUA'' THEN IZIN_SURESI ELSE  0 END ) SENELIK_IZIN, ' +
			 ' SUM(CASE WHEN IZIN_KODU=''ŞUA'' THEN IZIN_SURESI ELSE  0 END ) SUA, 0 HARCANAN_SURE FROM YILLIK__DETAY_OZET I ' +
			 ' GROUP BY I.PERSONEL_ID ,I.BASLANGIC_ZAMANI ' +
			'  ) ,   ' +
	
		 '   SONUC_DATA AS (  ' +
		'    SELECT I.PERSONEL_ID,SUM(CASE WHEN YEAR(BASLANGIC_ZAMANI)<YEAR(Z.TARIH)  THEN  IZIN_SURESI - HARCANAN_SURE ELSE 0 END)  AS GECEN_YIL_BAKIYE,  ' +
		'    CAST( SUM(CASE WHEN YEAR(BASLANGIC_ZAMANI)<YEAR(Z.TARIH)  THEN  0 ELSE IZIN_SURESI END) as int) BU_YIL_HAKKEDILEN,  ' +
		'    CAST( SUM(CASE WHEN YEAR(BASLANGIC_ZAMANI)<YEAR(Z.TARIH)  THEN  0 ELSE SUA END) as int) BU_YIL_HAKKEDILEN_SUA,  ' +
		'    SUM(CASE WHEN YEAR(BASLANGIC_ZAMANI)<YEAR(Z.TARIH) THEN  0 ELSE HARCANAN_SURE END)  HARCANAN_SURE  FROM YILLIK_OZET I  ' +
		'     INNER JOIN ZAMAN Z ON 1=1  ' +
	
		' 	GROUP BY I.PERSONEL_ID,Z.TARIH  ' +
		' )    ' +
		' 	SELECT  S.PERSONEL_ID,P.SIRKET_ID, P.PDKS_SICIL_NO,P.AD,P.SOYAD  ,P.DOGUM_TARIHI,P.IZIN_HAKEDIS_TARIHI, ' + 
		' 	S.GECEN_YIL_BAKIYE -COALESCE(HI.GECEN_DONEM,0) GECEN_YIL_BAKIYE , S.BU_YIL_HAKKEDILEN,S.BU_YIL_HAKKEDILEN_SUA,	COALESCE(HI.BU_YIL,0) HARCANAN_SURE, ' +
		' 	S.GECEN_YIL_BAKIYE+S.BU_YIL_HAKKEDILEN-S.HARCANAN_SURE -COALESCE(HI.GECEN_DONEM,0) - COALESCE(HI.BU_YIL,0) AS BAKIYE FROM SONUC_DATA S  ' +
		' 	LEFT JOIN   HARCANAN_IZINLER HI ON HI.PERSONEL_ID=S.PERSONEL_ID ' +
		' 	INNER JOIN PERSONELLER P ON P.ID=S.PERSONEL_ID    ' +
		' 	ORDER BY P.IZIN_HAKEDIS_TARIHI, P.PDKS_SICIL_NO  ' ;

 
 
	       PRINT    @sqlCommand;
		   EXECUTE sp_executesql    @sqlCommand  ;
		   
		   
END
GO
/****** Object:  StoredProcedure [dbo].[SP_IKINCI_YONETICI_OLAMAZ]    Script Date: 20.12.2023 17:26:32 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
 

CREATE PROCEDURE [dbo].[SP_IKINCI_YONETICI_OLAMAZ]
 
	@yoneticiId [bigint] ,
	@tipi nvarchar(128)
	 
WITH EXECUTE AS CALLER
AS
BEGIN
 	   SET NOCOUNT ON;
 	   DECLARE @sqlCommand nvarchar(max) 
	   DECLARE @yoneticiStr nvarchar(max) 
	   if (@tipi IS NULL OR @tipi='') BEGIN
	      set @tipi='ikinciYoneticiOlmaz'
	   END
	   set @sqlCommand = ' WITH YONETICILER AS ( '
 
	   set @sqlCommand = @sqlCommand + ' select P.* from PERSONEL P  WITH(nolock) '
	   set @sqlCommand = @sqlCommand + ' INNER JOIN PERSONEL_DINAMIK_ALAN PDA ON PDA.PERSONEL_ID=P.ID AND PDA.DURUM_SECIM=1 '
	   set @sqlCommand = @sqlCommand + ' INNER JOIN TANIM T ON T.ID=PDA.ALAN_ID AND T.TIPI=''PERSONEL_DINAMIK_DURUM'' AND T.KODU='''+@tipi+''''
	    if (@yoneticiId IS NOT NULL AND @yoneticiId>0) BEGIN 
		  set @sqlCommand = @sqlCommand + ' WHERE P.ID=' + convert(nvarchar(12) , @yoneticiId);
		END
		set @sqlCommand = @sqlCommand + ' AND P.SSK_CIKIS_TARIHI>GETDATE() AND P.DURUM=1 '
		set @sqlCommand = @sqlCommand + ' ) '
		set @sqlCommand = @sqlCommand + ' SELECT P.* FROM PERSONEL Y1  WITH(nolock) '
		set @sqlCommand = @sqlCommand + ' INNER JOIN YONETICILER Y2 ON Y2.ID=Y1.YONETICI_ID '
		set @sqlCommand = @sqlCommand + ' INNER JOIN PERSONEL P ON P.YONETICI_ID=Y1.ID AND COALESCE( P.ASIL_YONETICI2_ID,0)<>Y1.ID'
		set @sqlCommand = @sqlCommand + ' AND P.SSK_CIKIS_TARIHI>GETDATE() AND P.DURUM=1 '
		set @sqlCommand = @sqlCommand + ' WHERE Y1.SSK_CIKIS_TARIHI>GETDATE() AND Y1.DURUM=1 AND Y1.ID<>Y2.ID'
		set @sqlCommand = @sqlCommand + ' ORDER BY Y2.AD_SOYAD,P.AD_SOYAD'
--         PRINT    @sqlCommand
	     EXECUTE sp_executesql    @sqlCommand  
		   
		   
END
GO
/****** Object:  StoredProcedure [dbo].[SP_INDEX_REORGANIZE_REBUILD]    Script Date: 20.12.2023 17:26:32 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
 

CREATE PROCEDURE [dbo].[SP_INDEX_REORGANIZE_REBUILD]
	 
WITH EXECUTE AS CALLER
AS
BEGIN
  SET NOCOUNT ON;
  IF ([dbo].[FN_PDKS_HELP_DESK_DURUM]()=1) BEGIN   
	    DECLARE @TABLE_NAME  nvarchar(256)
		DECLARE @sqlCommand  nvarchar(max)
		DECLARE TABLE_cursor CURSOR FOR 
		 	SELECT TABLE_NAME FROM INFORMATION_SCHEMA.TABLES
			WHERE TABLE_TYPE='BASE TABLE' 
			AND TABLE_NAME IN (SELECT   OBJECT_NAME(object_id) As Table_Name FROM sys.indexes)
			order by TABLE_NAME
			OPEN TABLE_cursor
			FETCH NEXT FROM TABLE_cursor INTO @TABLE_NAME
			WHILE @@FETCH_STATUS = 0  
			BEGIN  
				set @sqlCommand='ALTER INDEX ALL ON ' + @TABLE_NAME + ' REBUILD; '
				PRINT @sqlCommand + convert(varchar, getdate(), 20)
				EXECUTE sp_executesql    @sqlCommand  
 				set @sqlCommand='ALTER INDEX ALL ON ' + @TABLE_NAME + ' REORGANIZE; '
			    PRINT @sqlCommand + convert(varchar, getdate(), 20)
				EXECUTE sp_executesql    @sqlCommand 
 				FETCH NEXT FROM TABLE_cursor INTO  @TABLE_NAME	 
 			END
			CLOSE TABLE_cursor;  
			DEALLOCATE TABLE_cursor;
			EXEC SP_CHECKIDENT_VIEW		 
	END	   
		   
END
GO
/****** Object:  StoredProcedure [dbo].[SP_ISTEN_AYRILAN_VARDIYA_DELETE]    Script Date: 20.12.2023 17:26:32 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
 

CREATE PROCEDURE [dbo].[SP_ISTEN_AYRILAN_VARDIYA_DELETE]
	 
WITH EXECUTE AS CALLER
AS
BEGIN
 	   SET NOCOUNT ON;
 	   DECLARE  @ID  [numeric](19, 0)  
 	   DECLARE  @FMID  [numeric](19, 0)  
	   DECLARE  @FMTID  [numeric](19, 0)
	   DECLARE  @GID  [numeric](19, 0)
	   DECLARE  @ADET  [numeric](19, 0) 
	   SET  @ADET  = 0
	   
	       DECLARE VARDIYA_cursor CURSOR FOR 
  			 WITH SONUC AS (
		 		select V.PERSONEL_ID,V.VARDIYA_TARIHI,  V.ID ,YEAR( V.VARDIYA_TARIHI)*100+MONTH(V.VARDIYA_TARIHI) AS V1,
				YEAR( P.SSK_CIKIS_TARIHI)*100+MONTH(P.SSK_CIKIS_TARIHI) P1 from PERSONEL P WITH(nolock)
					INNER JOIN VARDIYA_GUN V ON V.PERSONEL_ID=P.ID
				WHERE SSK_CIKIS_TARIHI<DATEADD(MONTH, -2, getdate()) 
			)
			SELECT   V.ID,SUM(CASE WHEN FM.ID IS NOT NULL THEN 1 ELSE 0 END) AS FMID,
			  SUM(CASE WHEN FMT.ID  IS NOT NULL THEN 1 ELSE 0 END) AS FMTID,
			  SUM(CASE WHEN G.ID  IS NOT NULL THEN 1 ELSE 0 END) AS GID FROM SONUC V
			   LEFT JOIN VARDIYA_GOREV G ON G.VARDIYA_GUN_ID=V.ID
			   LEFT JOIN FAZLA_MESAI_TALEP FMT ON FMT.VARDIYA_GUN_ID=V.ID
			   LEFT JOIN PERSONELFAZLAMESAI FM ON FM.VARDIYA_GUN=V.ID
		    WHERE V.V1>V.P1
			GROUP BY V.ID
			
			OPEN VARDIYA_cursor
			FETCH NEXT FROM VARDIYA_cursor INTO @ID,@FMID,@FMTID,@GID
			WHILE @@FETCH_STATUS = 0  
			BEGIN  
			     IF (@GID >0)
					 DELETE VARDIYA_GOREV WHERE VARDIYA_GUN_ID=@ID;
			     IF (@FMID >0)
					 DELETE PERSONELFAZLAMESAI WHERE VARDIYA_GUN=@ID;
			     IF (@FMTID >0)
					 DELETE FAZLA_MESAI_TALEP WHERE VARDIYA_GUN_ID=@ID;
				 DELETE VARDIYA_GUN WHERE ID=@ID;
	
				SET   @ADET  =@ADET + 1;
				PRINT CAST( @ADET AS VARCHAR(20))+ ' VARDIYA_GUN '+ CAST( @ID AS VARCHAR(20));

 				FETCH NEXT FROM VARDIYA_cursor INTO @ID,@FMID,@FMTID,@GID
 			END
 
			CLOSE VARDIYA_cursor;  
			DEALLOCATE VARDIYA_cursor;
			
			SET   @ADET  =0;
			DECLARE HAFTA_cursor CURSOR FOR 
			 WITH  DATALAR AS (
					   select BAS_TARIH,V.ID, SUM(CASE WHEN G.ID IS NOT NULL THEN 1 ELSE 0 END) AS ADET from VARDIYAHAFTA V WITH(nolock)
							LEFT JOIN VARDIYA_GUN G ON V.PERSONEL_ID=G.PERSONEL_ID 
							AND (G.VARDIYA_TARIHI BETWEEN V.BAS_TARIH AND V.BIT_TARIH)
						WHERE BIT_TARIH<DATEADD(MONTH, -3, getdate()) 
						GROUP BY  BAS_TARIH,V.ID
				),
	 
			 AYRILAN AS (
		 				select V.PERSONEL_ID,V.BAS_TARIH,  V.ID ,YEAR( V.BAS_TARIH)*100+MONTH(V.BAS_TARIH) AS V1,
						YEAR( P.SSK_CIKIS_TARIHI)*100+MONTH(P.SSK_CIKIS_TARIHI) P1 from PERSONEL P WITH(nolock)
							INNER JOIN VARDIYAHAFTA V ON V.PERSONEL_ID=P.ID
						WHERE SSK_CIKIS_TARIHI<DATEADD(MONTH, -2, getdate()  )
						) ,
			 SONUC AS (
					SELECT  V.ID,BAS_TARIH 	 FROM AYRILAN V
					WHERE V.V1>V.P1
					UNION ALL
					SELECT  V.ID,BAS_TARIH 	 FROM DATALAR V
					WHERE V.ADET>0
			  ) 
		    SELECT   V.ID FROM SONUC V
			   ORDER BY V.BAS_TARIH
			 
			OPEN HAFTA_cursor
			FETCH NEXT FROM HAFTA_cursor INTO @ID 
			WHILE @@FETCH_STATUS = 0  
			BEGIN  
			     
				 DELETE VARDIYAHAFTA WHERE ID=@ID;
				SET   @ADET = @ADET + 1;

				PRINT CAST( @ADET AS VARCHAR(20))+ ' VARDIYAHAFTA '+CAST( @ID AS VARCHAR(20));

 				FETCH NEXT FROM HAFTA_cursor INTO @ID 
 			END

			CLOSE HAFTA_cursor;  
			DEALLOCATE HAFTA_cursor; 
		   
END

GO
/****** Object:  StoredProcedure [dbo].[SP_IZIN_KOPYALA]    Script Date: 20.12.2023 17:26:32 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[SP_IZIN_KOPYALA]
	@PERSONEL_ID [bigint],
	@PERSONELID_NEW [bigint],
	@ADMINID [bigint]
WITH EXECUTE AS CALLER
AS
BEGIN
	-- SET NOCOUNT ON added to prevent extra result sets from
	-- interfering with SELECT statements.
	SET NOCOUNT ON;
	exec dbo.SP_IZINLERI_SIL @PERSONELID_NEW;
	DECLARE @HAKEDIS_IZIN_ID bigint, @HAKEDIS_IZIN_ID_NEW bigint,@IZIN_MIKTARI float,@IZIN_ID bigint,@IZIN_ID_NEW bigint;

	DECLARE PERSONELIZIN_cursor CURSOR FOR   
	 SELECT D.ID FROM PERSONELIZIN D 
		 INNER JOIN IZINTIPI I ON I.ID=D.IZIN_TIPI_ID and I.BAKIYE_IZIN_TIPI_ID IS NOT NULL
		 INNER JOIN TANIM T ON T.ID=I.IZIN_TIPI_ID AND T.KODU IN ('90','ŞUA') 
		WHERE D.PERSONEL_ID = @PERSONEL_ID AND D.IZIN_DURUMU NOT IN (8,9)
		ORDER BY D.ID; 
	 
	OPEN PERSONELIZIN_cursor

	FETCH NEXT FROM PERSONELIZIN_cursor INTO @HAKEDIS_IZIN_ID
	WHILE @@FETCH_STATUS = 0  
		BEGIN  
				BEGIN TRANSACTION
				INSERT INTO  PERSONELIZIN (DURUM,   OLUSTURMATARIHI, ACIKLAMA, BASLANGIC_ZAMANI, BITIS_ZAMANI, IZIN_DURUMU, IZIN_KAGIDI_GELDI,
					IZIN_SURESI, VERSION,     OLUSTURANUSER_ID, PERSONEL_ID, IZIN_TIPI_ID, KULLANILAN_IZIN_SURESI, GOREV_TIPI_ID, HESAP_TIPI)
				   SELECT P.DURUM,  P.OLUSTURMATARIHI, P.ACIKLAMA, P.BASLANGIC_ZAMANI, P.BITIS_ZAMANI, P.IZIN_DURUMU,
					P.IZIN_KAGIDI_GELDI, P.IZIN_SURESI, -P.ID VERSION, @ADMINID OLUSTURANUSER_ID, @PERSONELID_NEW  PERSONEL_ID, P.IZIN_TIPI_ID,
					 P.KULLANILAN_IZIN_SURESI, P.GOREV_TIPI_ID, P.HESAP_TIPI  FROM PERSONELIZIN P
					WHERE P.ID = @HAKEDIS_IZIN_ID;  
				SELECT @HAKEDIS_IZIN_ID_NEW=SCOPE_IDENTITY()
 						 
				DECLARE PERSONELIZINDETAY_cursor CURSOR FOR   
				 SELECT D.IZIN_MIKTARI,D.IZIN_ID FROM PERSONELIZINDETAY D 
					INNER JOIN PERSONELIZIN P ON P.ID=D.IZIN_ID AND P.IZIN_DURUMU NOT IN (8,9)
					WHERE D.HAKEDIS_IZIN_ID = @HAKEDIS_IZIN_ID  
					ORDER BY D.ID; 
	 
				OPEN PERSONELIZINDETAY_cursor

				FETCH NEXT FROM PERSONELIZINDETAY_cursor INTO @IZIN_MIKTARI, @IZIN_ID
				WHILE @@FETCH_STATUS = 0  
					BEGIN  
						 INSERT INTO  PERSONELIZIN (DURUM, GUNCELLEMETARIHI, OLUSTURMATARIHI, ACIKLAMA, BASLANGIC_ZAMANI, BITIS_ZAMANI, IZIN_DURUMU, IZIN_KAGIDI_GELDI,
						  IZIN_SURESI, VERSION,    GUNCELLEYENUSER_ID, OLUSTURANUSER_ID, PERSONEL_ID, IZIN_TIPI_ID, KULLANILAN_IZIN_SURESI, GOREV_TIPI_ID, HESAP_TIPI)
						  SELECT P.DURUM, P.GUNCELLEMETARIHI, P.OLUSTURMATARIHI, P.ACIKLAMA, P.BASLANGIC_ZAMANI, P.BITIS_ZAMANI, P.IZIN_DURUMU,
							  P.IZIN_KAGIDI_GELDI, P.IZIN_SURESI, -P.ID VERSION, P.GUNCELLEYENUSER_ID, P.OLUSTURANUSER_ID, @PERSONELID_NEW  PERSONEL_ID, P.IZIN_TIPI_ID,
								 P.KULLANILAN_IZIN_SURESI, P.GOREV_TIPI_ID, P.HESAP_TIPI  FROM PERSONELIZIN P
						  WHERE P.ID = @IZIN_ID;  
		
						SELECT @IZIN_ID_NEW = SCOPE_IDENTITY()
 
						INSERT INTO PERSONELIZINDETAY (IZIN_MIKTARI,HAKEDIS_IZIN_ID,IZIN_ID) VALUES ( @IZIN_MIKTARI,@HAKEDIS_IZIN_ID_NEW,@IZIN_ID_NEW)

						INSERT PERSONELIZINONAY (DURUM ,GUNCELLEMETARIHI ,OLUSTURMATARIHI ,ONAY_DURUM ,ONAYLAYAN_NEDEN_ACIKLAMA ,ONAYLAYAN_TIPI ,VERSION ,GUNCELLEYENUSER_ID ,OLUSTURANUSER_ID ,ONAYLAMAMA_NEDEN_ID ,PERSONEL_IZIN_ID)
							SELECT O.DURUM , O.GUNCELLEMETARIHI , O.OLUSTURMATARIHI , O.ONAY_DURUM , O.ONAYLAYAN_NEDEN_ACIKLAMA , O.ONAYLAYAN_TIPI , 
							-@IZIN_ID VERSION , O.GUNCELLEYENUSER_ID , O.OLUSTURANUSER_ID , O.ONAYLAMAMA_NEDEN_ID ,@IZIN_ID_NEW PERSONEL_IZIN_ID FROM PERSONELIZINONAY O
						WHERE O.PERSONEL_IZIN_ID=@IZIN_ID;
						FETCH NEXT FROM PERSONELIZINDETAY_cursor INTO @IZIN_MIKTARI, @IZIN_ID
					END
				COMMIT
				CLOSE PERSONELIZINDETAY_cursor;  
				DEALLOCATE PERSONELIZINDETAY_cursor;
				FETCH NEXT FROM PERSONELIZIN_cursor INTO @HAKEDIS_IZIN_ID
		END

		CLOSE PERSONELIZIN_cursor;  
		DEALLOCATE PERSONELIZIN_cursor;

		DECLARE PERSONELIZINKalan_cursor CURSOR FOR  
		SELECT D.ID FROM PERSONELIZIN D 
		 INNER JOIN IZINTIPI I ON I.ID=D.IZIN_TIPI_ID  and I.BAKIYE_IZIN_TIPI_ID IS  NULL
		 INNER JOIN TANIM T ON T.ID=I.IZIN_TIPI_ID AND T.KODU IN ('90','ŞUA') 
				WHERE D.PERSONEL_ID= @PERSONEL_ID  AND  D.ID NOT IN (SELECT IZIN_ID FROM PERSONELIZINDETAY); 
	 
	OPEN PERSONELIZINKalan_cursor

	FETCH NEXT FROM PERSONELIZINKalan_cursor INTO @IZIN_ID 
	WHILE @@FETCH_STATUS = 0  BEGIN 
				INSERT INTO  PERSONELIZIN (DURUM, GUNCELLEMETARIHI, OLUSTURMATARIHI, ACIKLAMA, BASLANGIC_ZAMANI, BITIS_ZAMANI, IZIN_DURUMU, IZIN_KAGIDI_GELDI,
				IZIN_SURESI, VERSION,    GUNCELLEYENUSER_ID, OLUSTURANUSER_ID, PERSONEL_ID, IZIN_TIPI_ID, KULLANILAN_IZIN_SURESI, GOREV_TIPI_ID, HESAP_TIPI)
				SELECT P.DURUM, P.GUNCELLEMETARIHI, P.OLUSTURMATARIHI, P.ACIKLAMA, P.BASLANGIC_ZAMANI, P.BITIS_ZAMANI, P.IZIN_DURUMU,
					P.IZIN_KAGIDI_GELDI, P.IZIN_SURESI,-@IZIN_ID VERSION, P.GUNCELLEYENUSER_ID, P.OLUSTURANUSER_ID, @PERSONELID_NEW  PERSONEL_ID, P.IZIN_TIPI_ID,
						P.KULLANILAN_IZIN_SURESI, P.GOREV_TIPI_ID, P.HESAP_TIPI  FROM PERSONELIZIN P
				WHERE P.ID = @IZIN_ID;  
		FETCH NEXT FROM PERSONELIZINKalan_cursor INTO @IZIN_ID
	END
	CLOSE PERSONELIZINKalan_cursor;
	DEALLOCATE PERSONELIZINKalan_cursor;
	

END
GO
/****** Object:  StoredProcedure [dbo].[SP_IZINLERI_SIL]    Script Date: 20.12.2023 17:26:32 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[SP_IZINLERI_SIL]
	@PERSONEL_ID [bigint]
WITH EXECUTE AS CALLER
AS
BEGIN
	-- SET NOCOUNT ON added to prevent extra result sets from
	-- interfering with SELECT statements.
	SET NOCOUNT ON;
	
	DECLARE @HAKEDIS_IZIN_ID bigint,@IZIN_ID bigint ,@DETAY_ID bigint   ;
    -- Insert statements for procedure here
	DECLARE PERSONELIZIN_cursor CURSOR FOR   
	 SELECT D.ID FROM PERSONELIZIN D 
		 INNER JOIN IZINTIPI I ON I.ID=D.IZIN_TIPI_ID and I.BAKIYE_IZIN_TIPI_ID IS NOT NULL
		 INNER JOIN TANIM T ON T.ID=I.IZIN_TIPI_ID AND T.KODU IN ('90','ŞUA') 
		WHERE D.PERSONEL_ID= @PERSONEL_ID ; 
	 
	OPEN PERSONELIZIN_cursor

	FETCH NEXT FROM PERSONELIZIN_cursor INTO @HAKEDIS_IZIN_ID 
	WHILE @@FETCH_STATUS = 0  
		BEGIN 
		  --    PRINT '@HAKEDIS_IZIN_ID=' +  CONVERT(VARCHAR, @HAKEDIS_IZIN_ID   ) 
			 DECLARE PERSONELIZINDETAY_cursor CURSOR FOR 
				SELECT  IZIN_ID,ID FROM PERSONELIZINDETAY 
					WHERE HAKEDIS_IZIN_ID= @HAKEDIS_IZIN_ID;
				OPEN PERSONELIZINDETAY_cursor
				FETCH NEXT FROM PERSONELIZINDETAY_cursor INTO @IZIN_ID ,@DETAY_ID
				WHILE @@FETCH_STATUS = 0  
					BEGIN 
					-- 	 PRINT '@IZIN_ID=' +  CONVERT(VARCHAR,@IZIN_ID ) 
					-- 	 PRINT '@DETAY_ID=' +   CONVERT(VARCHAR,@DETAY_ID ) 
	 					DELETE FROM PERSONELIZINONAY	WHERE PERSONEL_IZIN_ID = @IZIN_ID ;
						DELETE FROM PERSONELIZINDETAY  		WHERE ID= @DETAY_ID;
						DELETE FROM PERSONELIZIN 		WHERE ID = @IZIN_ID  ;
						FETCH NEXT FROM PERSONELIZINDETAY_cursor INTO @IZIN_ID ,@DETAY_ID	
					
					END
				CLOSE PERSONELIZINDETAY_cursor;
				DEALLOCATE PERSONELIZINDETAY_cursor;
				DELETE FROM PERSONELIZIN  		WHERE ID = @HAKEDIS_IZIN_ID;
				 FETCH NEXT FROM PERSONELIZIN_cursor INTO @HAKEDIS_IZIN_ID 
		END



	CLOSE PERSONELIZIN_cursor;
	DEALLOCATE PERSONELIZIN_cursor;
	DECLARE PERSONELIZINKalan_cursor CURSOR FOR  
	SELECT D.ID FROM PERSONELIZIN D 
		 INNER JOIN IZINTIPI I ON I.ID=D.IZIN_TIPI_ID  and I.BAKIYE_IZIN_TIPI_ID IS  NULL
		 INNER JOIN TANIM T ON T.ID=I.IZIN_TIPI_ID AND T.KODU IN ('90','ŞUA') 
		WHERE D.PERSONEL_ID= @PERSONEL_ID ; 
	 
	OPEN PERSONELIZINKalan_cursor

	FETCH NEXT FROM PERSONELIZINKalan_cursor INTO @IZIN_ID 
	WHILE @@FETCH_STATUS = 0  BEGIN 
		DELETE FROM PERSONELIZINONAY	WHERE PERSONEL_IZIN_ID = @IZIN_ID ;
		DELETE FROM PERSONELIZIN  		WHERE ID = @IZIN_ID 
	 
		FETCH NEXT FROM PERSONELIZINKalan_cursor INTO @IZIN_ID
	END
	CLOSE PERSONELIZINKalan_cursor;
	DEALLOCATE PERSONELIZINKalan_cursor;
	

END
GO
/****** Object:  StoredProcedure [dbo].[SP_MANUEL_KAPI_HAREKET_UPDATE]    Script Date: 20.12.2023 17:26:32 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[SP_MANUEL_KAPI_HAREKET_UPDATE]
	 
WITH EXECUTE AS CALLER
AS
BEGIN
 	   SET NOCOUNT ON;
 	   DECLARE  @ID  [numeric](19, 0)  
	    DECLARE @KAPI  [numeric](19, 0)  
		DECLARE DONEM_cursor CURSOR FOR 
		 	SELECT S.ID,MO.ID AS KAPI  FROM  PDKS_HAREKET  S
				INNER JOIN KAPI_SIRKET_KGS KO ON KO.ID=S.KAPI AND KO.KGS_SIRKET_ID<>0
				INNER JOIN KAPI O ON O.KGS_ID=KO.ID
				INNER JOIN PARAMETRE P ON P.ADI = 'manuelKapiEkleme' AND P.DURUM=1 and P.CHANGEDATE<S.ZAMAN
				INNER JOIN KAPI_SIRKET_KGS MO ON MO.KART_YONU=KO.KART_YONU AND MO.KGS_SIRKET_ID=0 AND MO.MANUEL=1
	 		OPEN DONEM_cursor
			FETCH NEXT FROM DONEM_cursor INTO @ID,@KAPI
			WHILE @@FETCH_STATUS = 0  
			BEGIN  
 				 UPDATE PDKS_HAREKET SET KAPI=@KAPI WHERE ID=@ID;
				  
 				FETCH NEXT FROM DONEM_cursor INTO  @ID,@KAPI	 
 			END
			CLOSE DONEM_cursor;  
			DEALLOCATE DONEM_cursor;
					 
		   
		   
END

GO
/****** Object:  StoredProcedure [dbo].[SP_PDKS_VIEW_REFRESH]    Script Date: 20.12.2023 17:26:32 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
 
 
 
CREATE  PROCEDURE [dbo].[SP_PDKS_VIEW_REFRESH]
@ekranYaz int
	 
WITH EXECUTE AS CALLER
AS
BEGIN
	-- SET NOCOUNT ON added to prevent extra result sets from
	-- interfering with SELECT statements.
	SET NOCOUNT ON;
	DECLARE   @SCHEMA_ADI varchar(80)  	 ,  @ADI varchar(80)  	 , @sql_command nvarchar(MAX)  	, @sql_error nvarchar(MAX)  
 				 
	SET @sql_error='';
 	SET @ADI =  '';
	IF ([dbo].[FN_PDKS_HELP_DESK_DURUM]()=1) BEGIN  
				DECLARE VIEW_cursor CURSOR FOR    
				SELECT  	OBJECT_SCHEMA_NAME(v.object_id) schema_name,
					v.name FROM 	sys.views as v
	 
				OPEN VIEW_cursor
	 
				FETCH NEXT FROM VIEW_cursor INTO @SCHEMA_ADI,@ADI
				WHILE @@FETCH_STATUS = 0  
				BEGIN  
				  BEGIN TRY
					   set @sql_command = ' exec sp_refreshview ' +     @ADI  
					   EXEC sp_executesql  @sql_command
					
				  END TRY
				  BEGIN CATCH
				    if (@ekranYaz<>1)
						set @sql_error = @sql_error+ @sql_command+ ' '+  ERROR_MESSAGE() + ' |'
					else
					PRINT @sql_command+ ' '+  ERROR_MESSAGE()
 				  END CATCH

 						FETCH NEXT FROM VIEW_cursor INTO @SCHEMA_ADI,@ADI 
 				END
				CLOSE VIEW_cursor;  

			DECLARE FUNCTBL_cursor CURSOR FOR    
				SELECT   ROUTINE_SCHEMA,  ROUTINE_NAME FROM INFORMATION_SCHEMA.ROUTINES
				WHERE ROUTINE_TYPE = 'FUNCTION'AND DATA_TYPE = 'TABLE' 

				OPEN FUNCTBL_cursor
	 
				FETCH NEXT FROM FUNCTBL_cursor INTO @SCHEMA_ADI,@ADI
				WHILE @@FETCH_STATUS = 0  
				BEGIN  
				  BEGIN TRY
					   set @sql_command = ' sys.sp_refreshsqlmodule ' +     @ADI  
					   EXEC sp_executesql  @sql_command
					
				  END TRY
				  BEGIN CATCH
				    if (@ekranYaz<>1)
						set @sql_error = @sql_error+ @sql_command+ ' '+  ERROR_MESSAGE() + ' |'
					else
					PRINT @sql_command+ ' '+  ERROR_MESSAGE()
 			  END CATCH
 					FETCH NEXT FROM FUNCTBL_cursor INTO @SCHEMA_ADI,@ADI 
 				END
				CLOSE FUNCTBL_cursor;  
				DEALLOCATE FUNCTBL_cursor;


				DEALLOCATE VIEW_cursor;
			 
				 
 		END	 
		if (@ekranYaz<>1 AND @sql_error='') BEGIN  
				 
			 select @sql_error  AS HATA where @sql_error<>''
		END
END
 
GO
/****** Object:  StoredProcedure [dbo].[SP_PERSONEL_NO_UPDATE]    Script Date: 20.12.2023 17:26:32 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
 
CREATE PROCEDURE [dbo].[SP_PERSONEL_NO_UPDATE]
	 
WITH EXECUTE AS CALLER
AS
BEGIN
  SET NOCOUNT ON;
  IF ([dbo].[FN_PDKS_HELP_DESK_DURUM]()=1) BEGIN   
	 DECLARE @PERSONEL_ID bigint
	 
	 DECLARE @KGS_SIRKET_ID [numeric](19, 0) 
		DECLARE TABLE_cursor CURSOR FOR 
			select W.PersonelId,K.KGS_SIRKET_ID  FROM PERSONEL_SIRKET_KGS K
				INNER JOIN KAPI_SIRKET KA ON KA.ID=K.KGS_SIRKET_ID
						AND (CONVERT(DATE, GETDATE()) BETWEEN KA.BASLANGIC_TARIHI AND KA.BITIS_TARIHI)
				INNER JOIN PERSONEL P ON P.KGS_PERSONEL_ID=K.ID
				INNER JOIN [WebPDKS].[dbo].[Personel] W ON W.PersonelId=K.KGS_ID
			WHERE COALESCE(W.SicilNo,'')<>'' AND P.PDKS_SICIL_NO<>W.SicilNo COLLATE Turkish_CI_AS  
			order by 1
 
			OPEN TABLE_cursor
			FETCH NEXT FROM TABLE_cursor INTO @PERSONEL_ID,@KGS_SIRKET_ID

			WHILE @@FETCH_STATUS = 0  
			BEGIN  
				PRINT 'PERSONEL_ID = ' + CAST (@PERSONEL_ID AS VARCHAR(12)) +  ' KAPI_SIRKET_ID = ' + CAST (@KGS_SIRKET_ID AS VARCHAR(12))
				EXEC   [dbo].[SP_ANAVERI_START] 'SP_PERSONEL',@PERSONEL_ID,1,@KGS_SIRKET_ID;
 				FETCH NEXT FROM TABLE_cursor INTO  @PERSONEL_ID,@KGS_SIRKET_ID	 
 			END
			CLOSE TABLE_cursor;  
			DEALLOCATE TABLE_cursor;
 
	END	   
		   
END
GO
/****** Object:  StoredProcedure [dbo].[SP_POOL_TERMINAL_UPDATE]    Script Date: 20.12.2023 17:26:32 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
 

CREATE PROCEDURE [dbo].[SP_POOL_TERMINAL_UPDATE]
	@eklenenId bigint,
	@pdks integer
	AS
BEGIN
	SET NOCOUNT ON;
  

END
GO
/****** Object:  StoredProcedure [dbo].[SP_SIRKET_IZIN_ONAY_BILGI]    Script Date: 20.12.2023 17:26:32 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
 
 
CREATE PROCEDURE [dbo].[SP_SIRKET_IZIN_ONAY_BILGI]
	@sirketId bigint 
WITH EXECUTE AS CALLER
AS
BEGIN
 WITH SONUC AS (
  SELECT COUNT( I.ID) AS IZIN_TIPI_ADET,COALESCE(SUM(CASE WHEN I.ONAYLAYAN_TIPI='0' THEN 1 ELSE 0 END),0) ONAYSIZ_ADET,
  COALESCE(SUM(CASE WHEN I.ONAYLAYAN_TIPI='2' THEN 1 ELSE 0 END),0) IKINCI_YONETICI_ADET  FROM  SIRKET  S WITH(nolock)  
	INNER JOIN IZINTIPI I ON I.DEPARTMAN_ID=S.DEPARTMAN_ID  AND I.GIRIS_TIPI<>'0' AND I.DURUM=1 
			AND I.BAKIYE_IZIN_TIPI_ID IS NULL
   WHERE S.ID=@sirketId
   )
   SELECT S.*, CASE WHEN ONAYSIZ_ADET>0 AND IZIN_TIPI_ADET=ONAYSIZ_ADET THEN 1 ELSE 0 END ONAYSIZ_DURUM FROM SONUC S WITH(nolock)  
    
END
GO
/****** Object:  StoredProcedure [dbo].[SP_SISTEM_ALL_UPDATE]    Script Date: 20.12.2023 17:26:32 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
 
 
CREATE PROCEDURE [dbo].[SP_SISTEM_ALL_UPDATE]
	 
WITH EXECUTE AS CALLER
AS
BEGIN
	 IF ([dbo].[FN_PDKS_HELP_DESK_DURUM]()=1) BEGIN
			UPDATE T SET T.PARENTTANIM_ID=G.ID from TANIM T
			 INNER JOIN TANIM G ON G.TIPI='GENEL_TANIM' AND G.KODU=T.TIPI --AND (G.KODU='TESIS' OR COALESCE(G.ERP_KODU,'')='')
			  WHERE T.TIPI NOT IN ('GENEL_TANIM','MENU_BILESENI') AND T.PARENTTANIM_ID IS NULL;

			  update PARAMETRE set HDSK=0 WHERE ADI NOT IN ('sistemAdminUserName') AND HDSK=1 AND DURUM=1 AND CHANGEDATE<DATEADD(MONTH,-13,getdate());

			  UPDATE SIRKET SET TESIS_DURUM=1 WHERE TESIS_DURUM=0 AND ID IN (
				SELECT P.SIRKET_ID FROM PERSONEL P,PARAMETRE PA
				WHERE P.TESIS_ID IS NOT  NULL AND PA.ADI='tesisDurumu' AND PA.DURUM=1 AND PA.DEGER='1'
				GROUP BY P.SIRKET_ID
				HAVING COUNT(DISTINCT P.TESIS_ID) >1
				);

 
				 PRINT 'SP_PDKS_VIEW_REFRESH IN ' + convert(varchar, getdate(), 120)
 
				 EXEC SP_PDKS_VIEW_REFRESH  1

				 PRINT 'SP_GET_IKINCI_YONETICI_UPDATE IN ' + convert(varchar, getdate(), 120)
 
				 EXEC SP_GET_IKINCI_YONETICI_UPDATE 
 
				 PRINT 'SP_MANUEL_KAPI_HAREKET_UPDATE IN ' + convert(varchar, getdate(), 120)
 
				 EXEC SP_MANUEL_KAPI_HAREKET_UPDATE
 
				 PRINT 'SP_ISTEN_AYRILAN_VARDIYA_DELETE IN ' + convert(varchar, getdate(), 120)
 
				 EXEC SP_ISTEN_AYRILAN_VARDIYA_DELETE
 
				 PRINT 'SP_ISTEN_AYRILAN_VARDIYA_DELETE IN ' + convert(varchar, getdate(), 120)
				 
				 EXEC SP_PERSONEL_NO_UPDATE 
 
				 PRINT 'SP_PERSONEL_NO_UPDATE IN ' + convert(varchar, getdate(), 120)

				 
				  EXEC SP_CHECKIDENT_VIEW
 
				 PRINT 'SP_CHECKIDENT_VIEW OUT ' + convert(varchar, getdate(), 120)
		END 
END

 
GO
/****** Object:  StoredProcedure [dbo].[SP_SISTEM_HAREKET_EKLE_RETURN]    Script Date: 20.12.2023 17:26:32 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[SP_SISTEM_HAREKET_EKLE_RETURN]
	@KAPIID [int],
	@PERSONELID [int],
	@ZAMAN [datetime]
WITH EXECUTE AS CALLER
AS
begin
	DECLARE @HAREKET_ID numeric(19,0) 
	
	IF EXISTS (SELECT 1 FROM PDKS_LOG WHERE  KAPIID=@KAPIID AND USERID=@PERSONELID AND HAREKET_ZAMANI=@ZAMAN AND DURUM=1) BEGIN
 		SELECT @HAREKET_ID=ID FROM PDKS_LOG WHERE  KAPIID=@KAPIID AND USERID=@PERSONELID AND HAREKET_ZAMANI=@ZAMAN AND DURUM=1
		 
	END  
	ELSE BEGIN
  		insert INTO PDKS_LOG (KAPIID, USERID, HAREKET_ZAMANI, OLUSTURMA_ZAMANI, KGS_ID) 	VALUES (@KAPIID ,@PERSONELID ,@ZAMAN, getdate(),0);
 		SELECT @HAREKET_ID=SCOPE_IDENTITY();
  		UPDATE   PDKS_LOG SET  KGS_ID=ID 	WHERE ID=@HAREKET_ID;
    
	 END  
	  
	select TOP 1 @HAREKET_ID
   END 
    	
GO
/****** Object:  StoredProcedure [dbo].[SP_UPDATE_KAPI_HAREKET_SIRKET]    Script Date: 20.12.2023 17:26:32 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
 

CREATE PROCEDURE [dbo].[SP_UPDATE_KAPI_HAREKET_SIRKET]
	@HAREKET_ZAMANI DATETIME,@USERID [numeric](19, 0), @DOORID [numeric](19, 0),@ZAMAN_ID [numeric](19, 0),    
	@MSGCODE [numeric](19, 0), @KGS_SIRKET_ID [numeric](19, 0)
WITH EXECUTE AS CALLER
AS
BEGIN
	 IF (dbo.FN_PDKS_TABLE_UPDATE_DURUM('PDKS_LOG')=1) BEGIN
		  BEGIN TRY
		
  				 UPDATE PDKS_LOG SET [HAREKET_ZAMANI]=@HAREKET_ZAMANI,
					 [USERID]=@USERID,
					 [KAPIID]=@DOORID,
					 ISLEM_ID=NULL,GUNCELLEME_ZAMANI =GETDATE(),DURUM=@MSGCODE 
				  WHERE KGS_ID=@ZAMAN_ID AND KGS_SIRKET_ID=@KGS_SIRKET_ID;
			 
		  END TRY
		  BEGIN CATCH
		  END CATCH
	  END
END
GO
/****** Object:  StoredProcedure [dbo].[SP_USER_MENUITEM]    Script Date: 20.12.2023 17:26:32 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO




CREATE PROCEDURE [dbo].[SP_USER_MENUITEM]
	 @SESSION_ID VARCHAR(1024),
	 @USER_NAME VARCHAR(1024) ,
	 @MENU_ITEM_NAME VARCHAR(1024)
WITH EXECUTE AS CALLER
AS
BEGIN
	-- SET NOCOUNT ON added to prevent extra result sets from
	-- interfering with SELECT statements.
	SET NOCOUNT ON;
	DECLARE  @sqlCommand nvarchar(max), @ID [numeric](19, 0)   
	set  @sqlCommand ='SELECT * FROM USER_MENUITEM_TIME WHERE 1=2'
	SET @ID=-1
	IF @SESSION_ID IS NOT NULL BEGIN
		DECLARE @USER_ID [numeric](19, 0), @MENU_ID [numeric](19, 0)	, @LAST_SESSION_ID VARCHAR(1024)
		SELECT @ID=I.ID,@USER_ID=U.ID,@MENU_ID=M.ID,@LAST_SESSION_ID=I.SESSION_ID FROM PDKSUSER U
			INNER JOIN MENUITEM M ON M.NAME=@MENU_ITEM_NAME 
			LEFT JOIN USER_MENUITEM_TIME I ON I.[USER_ID]=U.ID AND I.MENU_ID=M.ID
		WHERE U.KULLANICI_ADI=@USER_NAME;
		IF @USER_ID IS NOT NULL BEGIN
			IF @ID IS  NULL BEGIN
				 INSERT INTO USER_MENUITEM_TIME ([USER_ID] ,[MENU_ID] ,[FIRST_TIME] ,LAST_TIME,[USE_COUNT] ,[SESSION_ID])
					 VALUES (@USER_ID,@MENU_ID,GETDATE(),GETDATE(),1,@SESSION_ID);
				 SELECT @ID=SCOPE_IDENTITY()
			END ELSE BEGIN
					UPDATE USER_MENUITEM_TIME SET 
					[USE_COUNT]=[USE_COUNT] + CASE WHEN @LAST_SESSION_ID<>@SESSION_ID THEN 1 ELSE 0 END ,[SESSION_ID]=@SESSION_ID,LAST_TIME=GETDATE()
				 WHERE ID=@ID;
			END
			set  @sqlCommand = ' SELECT * FROM USER_MENUITEM_TIME WHERE ID='+ CAST(@ID AS VARCHAR(1024)  )
		END
	END
 	--  PRINT @sqlCommand
	EXECUTE sp_executesql    @sqlCommand 


 

END
GO
/****** Object:  StoredProcedure [dbo].[SP_USER_MENUITEM_LIST]    Script Date: 20.12.2023 17:26:32 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
 
 

CREATE PROCEDURE [dbo].[SP_USER_MENUITEM_LIST]
 
WITH EXECUTE AS CALLER
AS
BEGIN
 
SELECT * FROM [dbo].[FN_USER_MENUITEM_LIST]()   I  
   
  ORDER BY [LAST_TIME] DESC


 

END
GO
/****** Object:  StoredProcedure [dbo].[SP_YONETICI_KONTRATLI_VIEW]    Script Date: 20.12.2023 17:26:32 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
 
CREATE PROCEDURE [dbo].[SP_YONETICI_KONTRATLI_VIEW]
 
WITH EXECUTE AS CALLER
AS
BEGIN
WITH YONETICILER AS (

  SELECT  P.* FROM  ROLE R WITH(nolock)
	  INNER JOIN USERROLES UR ON UR.ROLEID=R.ID
	  INNER JOIN PDKSUSER U ON U.ID=UR.USERID AND U.DURUM=1
	  INNER JOIN PERSONEL P ON P.ID=U.PERSONEL_ID  
	  LEFT JOIN TANIM  T ON T.ID=P.GOREV_TIPI_ID AND T.DURUM=1 AND T.KODU NOT IN ('01','')
	  WHERE  R.DEPARTMAN_ID<>1 AND R.STATUS=1 AND T.ID IS NOT NULL 

  UNION ALL

  SELECT P.* FROM  ROLE R WITH(nolock)
	   INNER JOIN USERROLES UR ON UR.ROLEID=R.ID
	   INNER JOIN PDKSUSER U ON U.ID=UR.USERID AND U.DURUM=1
	   INNER JOIN PERSONEL P ON P.ID=U.PERSONEL_ID 
   WHERE R.STATUS=1 AND  R.ROLENAME in ('yoneticiKontratli' ,'kontratliAdmin')   

  )

  SELECT DISTINCT P.* FROM YONETICILER P WITH(nolock)
	 WHERE P.DURUM=1 AND P.SSK_CIKIS_TARIHI>=CAST(GETDATE() AS date)
	 ORDER BY P.AD_SOYAD
END
GO
/****** Object:  StoredProcedure [dbo].[SP_YONETICI_VARDIYA_BILGI_TIPI]    Script Date: 20.12.2023 17:26:32 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
 
CREATE PROCEDURE [dbo].[SP_YONETICI_VARDIYA_BILGI_TIPI]
	@yonetici_id bigint,
	@donem_id bigint,
	@tip nvarchar(2),
	@sqlWhere nvarchar(max) 
 
WITH EXECUTE AS CALLER
AS
BEGIN
	-- SET NOCOUNT ON added to prevent extra result sets from
	-- interfering with SELECT statements.
	 SET NOCOUNT ON;
 	 DECLARE @sqlCommand nvarchar(max) 
	 DECLARE @YONETICI_STR nvarchar(200) 
     SET @YONETICI_STR=CAST(@yonetici_id AS nvarchar(200))
	 SET @sqlCommand='WITH HARICI_YONETICI2 AS (' +
	 
		' SELECT P.* FROM PERSONEL P WITH(nolock) WHERE P.ASIL_YONETICI2_ID='+@YONETICI_STR
		if (@yonetici_id<0) BEGIN
			SET @sqlCommand=@sqlCommand+' OR 1=1 '
		END
		
		SET @sqlCommand=@sqlCommand+' ),'+
		' YONETICI1 AS ('+
		' SELECT P.* FROM PERSONEL P WITH(nolock) WHERE P.YONETICI_ID='+@YONETICI_STR+' AND P.ID<> P.YONETICI_ID'+
		') ,'+
		'OZET AS ('+
		' SELECT   P.* FROM  PERSONEL Y2 WITH(nolock)'+
		 ' INNER JOIN PERSONEL P ON P.YONETICI_ID=Y2.ID'+
		 ' LEFT  JOIN HARICI_YONETICI2 H ON H.ID=P.ID'+
		' WHERE Y2.YONETICI_ID='+@YONETICI_STR+' AND Y2.YONETICI_ID<>Y2.ID '+
		 ' AND H.ID IS NULL'+
		 ' UNION '+
		' SELECT P.* FROM HARICI_YONETICI2 P '
		IF (@tip<>'P') BEGIN
		  SET @sqlCommand=@sqlCommand+' UNION SELECT P.* FROM YONETICI1 P  '
		END
		 SET @sqlCommand=@sqlCommand+' ), SONUC AS ('+
		' SELECT DISTINCT D.* FROM OZET D WITH(nolock) '+
		' INNER JOIN DENKLESTIRMEAY A ON A.ID='+CAST(@donem_id AS nvarchar(2))+
		' INNER JOIN VARDIYA_GUN V ON V.PERSONEL_ID=D.ID  '+
		 ' AND YEAR(V.VARDIYA_TARIHI)=A.YIL AND  MONTH(V.VARDIYA_TARIHI)=A.AY'
	
	  IF (@sqlWhere IS NOT NULL) BEGIN
 		IF (@sqlWhere<>'') BEGIN
			SET @sqlCommand=@sqlCommand+' ' +@sqlWhere
		 END
	 END

	 SET @sqlCommand=@sqlCommand+ ')'
 IF (@tip='S') BEGIN
  SET @sqlCommand=@sqlCommand+
  ' SELECT DISTINCT S.* FROM SONUC D WITH(nolock) '+
  ' INNER JOIN SIRKET S ON S.ID=D.SIRKET_ID'+
   ' ORDER BY S.AD'
 END ELSE 
 IF (@tip='T') BEGIN
  SET @sqlCommand=@sqlCommand+
  ' SELECT DISTINCT S.* FROM SONUC D WITH(nolock) '+
  ' INNER JOIN TANIM S ON S.ID=D.TESIS_ID'+
   ' ORDER BY S.ACIKLAMATR'
 END ELSE 
 IF (@tip='B') BEGIN
  SET @sqlCommand=@sqlCommand+
  ' SELECT DISTINCT S.* FROM SONUC D WITH(nolock) '+
  ' INNER JOIN TANIM S ON S.ID=D.EK_SAHA3_ID AND S.DURUM=1 '+
  ' ORDER BY S.ACIKLAMATR'
 END ELSE BEGIN
	 SET @sqlCommand=@sqlCommand+ ' SELECT DISTINCT D.* FROM SONUC D WITH(nolock)  ORDER BY D.AD,D.SOYAD '
 END
 
	 if (@sqlCommand is not null and @sqlCommand<>'') BEGIN
 
 
	       PRINT    @sqlCommand;
		   EXECUTE sp_executesql    @sqlCommand  ;
	END	   
		   
END
GO
/****** Object:  Trigger [dbo].[PDKS_LOG_DURUM_UPDATE]    Script Date: 20.12.2023 17:26:32 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO

 
CREATE TRIGGER [dbo].[PDKS_LOG_DURUM_UPDATE]
   ON   [dbo].[PDKS_LOG]  AFTER UPDATE AS 
IF    UPDATE (DURUM) 
BEGIN
 
		 SET NOCOUNT ON;
	     DECLARE @INSERT_DURUM int
		 DECLARE @DELETE_DURUM int
         DECLARE @PDKSID bigint
 		 

		 SELECT @PDKSID=I.KGS_ID ,@INSERT_DURUM=I.DURUM  FROM INSERTED I	 
		 if (@PDKSID IS NOT NULL) BEGIN
			 SELECT  @DELETE_DURUM=D.DURUM  FROM DELETED D
			 if ( @INSERT_DURUM=0 AND @DELETE_DURUM=1 ) BEGIN
				 DECLARE @HAREKET_ID  varchar(80)
				 SET @HAREKET_ID = 'K' + Convert(varchar(60), @PDKSID)
				  DECLARE @PERSONELFAZLAMESAI_ID bigint
			     SET @PERSONELFAZLAMESAI_ID=0
				 SELECT TOP 1 @PERSONELFAZLAMESAI_ID = F.ID   from PERSONELFAZLAMESAI F 
					 INNER JOIN VARDIYA_GUN V ON V.ID=F.VARDIYA_GUN
					 INNER JOIN DENKLESTIRMEAY D ON   D.YIL = YEAR(V.VARDIYA_TARIHI) AND  D.AY = MONTH(V.VARDIYA_TARIHI)
							AND D.DURUM=1
				  WHERE F.HAREKET_ID=@HAREKET_ID AND F.DURUM=1;
				  if ( @PERSONELFAZLAMESAI_ID IS NOT NULL AND @PERSONELFAZLAMESAI_ID>0) 	BEGIN
						UPDATE PERSONELFAZLAMESAI SET DURUM=0,GUNCELLEMETARIHI=GETDATE()   
						 WHERE ID=@PERSONELFAZLAMESAI_ID
				END
 			 END
		 END

END
GO
ALTER TABLE [dbo].[PDKS_LOG] ENABLE TRIGGER [PDKS_LOG_DURUM_UPDATE]
GO
/****** Object:  Trigger [dbo].[UPDATE_PERSONEL]    Script Date: 20.12.2023 17:26:32 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO



CREATE TRIGGER [dbo].[UPDATE_PERSONEL]    ON  [dbo].[PERSONEL]      AFTER UPDATE
AS 
BEGIN
  SET NOCOUNT ON;
 
  DECLARE @ID BIGINT 
  DECLARE @USER_ID BIGINT 
   DECLARE @I_TARIH DATE 
   IF UPDATE (ISTEN_AYRILIS_TARIHI) BEGIN
		   SELECT  @ID=ID,   @I_TARIH=ISTEN_AYRILIS_TARIHI    FROM INSERTED
		  IF ( @ID IS NOT NULL AND  @I_TARIH<DATEADD(DAY,-15,GETDATE()))
		  BEGIN
  
				SELECT  TOP 1 @USER_ID=ID     FROM PDKSUSER WHERE PERSONEL_ID=@ID  AND DURUM=1
	 			IF (@USER_ID IS NOT NULL) BEGIN
					 DELETE FROM USERROLES WHERE USERID=@USER_ID;
					 UPDATE PDKSUSER SET DURUM=0 WHERE ID=@USER_ID;
					 PRINT   CAST(@ID AS varchar(18) ) + ' '+    CAST(@USER_ID AS varchar(18) )
				END
  
		  END
    END
END
GO
ALTER TABLE [dbo].[PERSONEL] ENABLE TRIGGER [UPDATE_PERSONEL]
GO
/****** Object:  Trigger [dbo].[PERSONEL_SIRKET_KGS_UPDATE]    Script Date: 20.12.2023 17:26:32 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
 
CREATE TRIGGER [dbo].[PERSONEL_SIRKET_KGS_UPDATE]
   ON  [dbo].[PERSONEL_SIRKET_KGS] 
  AFTER UPDATE
AS 
IF UPDATE (PERSONEL_NO) 
BEGIN
 
	 SET NOCOUNT ON;
	 DECLARE @KGS_PERSONEL_ID [numeric](19, 0)
	 DECLARE @I_PERSONEL_NO varchar(32)
	 DECLARE @D_PERSONEL_NO varchar(32)
     SELECT @KGS_PERSONEL_ID = I.ID,@I_PERSONEL_NO=I.PERSONEL_NO   FROM INSERTED I
     SELECT  @D_PERSONEL_NO=D.PERSONEL_NO   FROM DELETED D
     IF (@I_PERSONEL_NO<>@D_PERSONEL_NO) BEGIN
	    UPDATE PERSONEL SET PDKS_SICIL_NO= @I_PERSONEL_NO WHERE KGS_PERSONEL_ID= @KGS_PERSONEL_ID
     END
	  SELECT  @D_PERSONEL_NO=D.PDKS_SICIL_NO   FROM PERSONEL D WHERE KGS_PERSONEL_ID=@KGS_PERSONEL_ID

	  IF (@D_PERSONEL_NO IS NOT NULL AND @I_PERSONEL_NO<>@D_PERSONEL_NO) BEGIN
	    UPDATE PERSONEL SET PDKS_SICIL_NO= @I_PERSONEL_NO WHERE KGS_PERSONEL_ID= @KGS_PERSONEL_ID
     END
END

GO
ALTER TABLE [dbo].[PERSONEL_SIRKET_KGS] ENABLE TRIGGER [PERSONEL_SIRKET_KGS_UPDATE]
GO
/****** Object:  Trigger [dbo].[PERSONELDENKLESTIRME_DEVREDEN_SURE_UPDATE]    Script Date: 20.12.2023 17:26:32 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
 
CREATE TRIGGER [dbo].[PERSONELDENKLESTIRME_DEVREDEN_SURE_UPDATE]
   ON  [dbo].[PERSONELDENKLESTIRME]   AFTER UPDATE AS 
IF UPDATE (DEVREDEN_SURE) OR UPDATE (DURUM) 
BEGIN
 
		 SET NOCOUNT ON;
	     DECLARE @INSERT_DURUM int
		 DECLARE @DELETE_DURUM int
         DECLARE @INSERT_PERSONELDENKLESTIRME_ID bigint
 		 DECLARE @INSERT_DEVREDEN_SURE float
 		 DECLARE @DELETE_DEVREDEN_SURE float

		 SELECT @INSERT_PERSONELDENKLESTIRME_ID=I.ID, @INSERT_DEVREDEN_SURE =COALESCE(  I.DEVREDEN_SURE,0),@INSERT_DURUM=I.DURUM  FROM INSERTED I	 
		 if (@INSERT_PERSONELDENKLESTIRME_ID IS NOT NULL) BEGIN
			 SELECT @DELETE_DEVREDEN_SURE =COALESCE(  D.DEVREDEN_SURE,0),@DELETE_DURUM=D.DURUM  FROM DELETED D
			 if ( (@INSERT_DURUM=0 AND @DELETE_DURUM=1) OR @INSERT_DEVREDEN_SURE<>@DELETE_DEVREDEN_SURE) BEGIN
				UPDATE PERSONELDENKLESTIRME SET DURUM=0,GUNCELLEMETARIHI=GETDATE() WHERE GECEN_AY_DENKLESTIRME_ID=@INSERT_PERSONELDENKLESTIRME_ID
			 END
		 END

END
GO
ALTER TABLE [dbo].[PERSONELDENKLESTIRME] ENABLE TRIGGER [PERSONELDENKLESTIRME_DEVREDEN_SURE_UPDATE]
GO
/****** Object:  Trigger [dbo].[VARDIYA_GUN_VARDIYA_UPDATE]    Script Date: 20.12.2023 17:26:32 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO

-- =============================================
CREATE TRIGGER [dbo].[VARDIYA_GUN_VARDIYA_UPDATE]
   ON  [dbo].[VARDIYA_GUN] 
  AFTER UPDATE
AS 
IF UPDATE (VARDIYA_ID) 
BEGIN
	     SET NOCOUNT ON;
		 DECLARE @INSERT_VARDIYA_ID bigint
 		 DECLARE @INSERT_VARDIYA_GUN_ID bigint
		 DECLARE @INSERT_VARDIYA_SAAT_ID bigint
		 DECLARE @INSERT_GUNCELLEYEN_ID bigint
 		 DECLARE @DELETE_VARDIYA_ID bigint
		 DECLARE @INSERT_VARDIYA_TARIHI DATETIME
 		 
		 DECLARE @denklestirmeDurum  int	;
		 	 
		SELECT @INSERT_VARDIYA_TARIHI = I.VARDIYA_TARIHI,@INSERT_GUNCELLEYEN_ID=I.GUNCELLEYENUSER_ID,@INSERT_VARDIYA_SAAT_ID=I.VARDIYA_SAAT_ID,
		@INSERT_VARDIYA_GUN_ID = I.ID,	@INSERT_VARDIYA_ID =COALESCE( I.VARDIYA_ID,0)  FROM INSERTED I
		 
 		SELECT @DELETE_VARDIYA_ID =COALESCE(  D.VARDIYA_ID,0)  FROM DELETED D
	 
		
		SELECT @denklestirmeDurum = 0 ;	
	    if (@INSERT_VARDIYA_ID<> @DELETE_VARDIYA_ID ) 	BEGIN

			 DECLARE @PERSONELDENKLESTIRME_ID bigint
			 DECLARE @PERSONELFAZLAMESAI_ID bigint
			 SET @PERSONELFAZLAMESAI_ID=0
			 SET @PERSONELDENKLESTIRME_ID=0
			 SELECT @PERSONELDENKLESTIRME_ID = PD.ID  FROM INSERTED I
				INNER JOIN DENKLESTIRMEAY D ON D.YIL=YEAR( I.VARDIYA_TARIHI) AND D.AY=MONTH(I.VARDIYA_TARIHI)
				INNER JOIN PERSONELDENKLESTIRME PD ON PD.DONEM_ID=D.ID AND PD.PERSONEL_ID=I.PERSONEL_ID AND PD.DURUM=1
         		 WHERE I.VARDIYA_TARIHI<GETDATE()
			  IF (@PERSONELDENKLESTIRME_ID IS NOT NULL AND @PERSONELDENKLESTIRME_ID>0) BEGIN
					UPDATE PERSONELDENKLESTIRME SET DURUM=0,GUNCELLEMETARIHI=GETDATE() WHERE ID=@PERSONELDENKLESTIRME_ID
			  END

 	 		 SELECT TOP 1 @PERSONELFAZLAMESAI_ID = F.ID ,@denklestirmeDurum=D.DURUM  from DENKLESTIRMEAY D  
				 LEFT JOIN PERSONELFAZLAMESAI F ON F.VARDIYA_GUN=@INSERT_VARDIYA_GUN_ID and F.DURUM=1 AND D.DURUM=1
			 where  D.YIL = YEAR(@INSERT_VARDIYA_TARIHI) AND  D.AY = MONTH(@INSERT_VARDIYA_TARIHI)  ;
			 if ( @PERSONELFAZLAMESAI_ID IS NOT NULL AND @PERSONELFAZLAMESAI_ID>0) 	BEGIN
				  UPDATE PERSONELFAZLAMESAI SET DURUM=0,GUNCELLEYENUSER_ID=@INSERT_GUNCELLEYEN_ID,GUNCELLEMETARIHI=GETDATE()   
				  WHERE ID=@PERSONELFAZLAMESAI_ID
				 
			 END
			 if (@INSERT_VARDIYA_SAAT_ID IS NOT NULL AND @denklestirmeDurum=1 ) 	BEGIN
 	 			UPDATE VARDIYA_SAAT SET CALISMA_SURESI=0,NORMAL_SURE=0,RESMI_TATIL_SURESI=0,GUNCELLEME_TARIHI=GETDATE() WHERE ID=@INSERT_VARDIYA_SAAT_ID;

			 END 
			 
		 END 
		 

END



GO
ALTER TABLE [dbo].[VARDIYA_GUN] ENABLE TRIGGER [VARDIYA_GUN_VARDIYA_UPDATE]
GO
USE [master]
GO
ALTER DATABASE [KARPDKS] SET  READ_WRITE 
GO
