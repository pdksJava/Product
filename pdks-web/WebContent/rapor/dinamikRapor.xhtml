<!DOCTYPE composition PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
    "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<ui:composition xmlns="http://www.w3.org/1999/xhtml" xmlns:s="http://jboss.com/products/seam/taglib" xmlns:ui="http://java.sun.com/jsf/facelets"
	xmlns:f="http://java.sun.com/jsf/core" xmlns:h="http://java.sun.com/jsf/html" xmlns:rich="http://richfaces.org/rich"
	xmlns:a4j="http://richfaces.org/a4j" xmlns:c="http://java.sun.com/jstl/core" template="/layout/template.xhtml">
	<ui:define name="title">
		<h:outputText value="#{ortakIslemler.getMenuAdi('dinamikRapor')}" />
	</ui:define>
	<ui:define name="body">

		<h:form id="formOrganizasyon">
			<rich:panel header="#{dinamikRaporHome.seciliPdksDinamikRapor.aciklama}">

				<h:panelGrid columns="1" rendered="#{dinamikRaporHome.dinamikRaporList.size()>1}">
					<s:decorate template="/layout/edit.xhtml" rendered="#{authenticatedUser.admin==false}">
						<ui:define name="label">Rapor Adı</ui:define>
						<h:selectOneMenu value="#{dinamikRaporHome.seciliPdksDinamikRapor}">
							<s:selectItems var="comp" value="#{dinamikRaporHome.dinamikRaporList}" label="#{comp.aciklama}" noSelectionLabel="Lütfen seçiniz" />
							<s:convertEntity />
							<a4j:support event="onchange" action="#{dinamikRaporHome.dinamikRaporGuncelle(dinamikRaporHome.seciliPdksDinamikRapor)}"
								reRender="raporParametreTable" status="ajaxStatus" ajaxSingle="true" />

						</h:selectOneMenu>
					</s:decorate>
					<rich:dataTable rowClasses="acik,koyu" value="#{dinamikRaporHome.dinamikRaporList}" var="rapor" rows="20" rowKeyVar="row"
						rendered="#{authenticatedUser.admin}">
						<f:facet name="header">
							<h:outputText value="Dinamik Raporlar" />
						</f:facet>
						<rich:column style="text-align:center">
							<f:facet name="header">
                        İşlemler
              		  </f:facet>
							<a4j:commandLink status="ajaxStatus" ajaxSingle="true" id="editlink" action="#{dinamikRaporHome.dinamikRaporGuncelle(rapor)}"
								reRender="raporParametreTable">
								<h:graphicImage value="/img/edit.gif" style="border:0" />

							</a4j:commandLink>
							<rich:toolTip for="editlink" value="Güncelle" />


						</rich:column>
						<c:if test="#{authenticatedUser.admin}">
							<rich:column>
								<f:facet name="header">
                     	   Rapor Başlık
              		 	 </f:facet>
								<h:outputText value="#{rapor.aciklama}" />
							</rich:column>
							<rich:column>
								<f:facet name="header">
                      		 Database Tanımı
              		 	 </f:facet>
								<h:outputText value="#{rapor.dbTanim}" />
							</rich:column>
							<rich:column>
								<f:facet name="header">
                      		 Database Rapor Tipi
              		 	 </f:facet>
								<h:outputText value="#{rapor.pdksDinamikRaporTipiAciklama}" />
							</rich:column>
							<rich:column style="text-align:center">
								<f:facet name="header">
                      		Görüntülensin
              		 	 </f:facet>
								<h:outputText value="#{authenticatedUser.getYesNo(rapor.goruntulemeDurum)}" />
							</rich:column>
						</c:if>

						<f:facet name="footer">
							<rich:datascroller renderIfSinglePage="false" maxPages="5" />
						</f:facet>
					</rich:dataTable>
				</h:panelGrid>

				<a4j:outputPanel id="raporParametreTable">
					<c:if test="#{dinamikRaporHome.seciliPdksDinamikRapor!=null}">
						<rich:panel>

							<h:panelGrid columns="2" id="girisler">
								<c:forEach items="#{dinamikRaporHome.dinamikRaporParametreList}" var="parametre">
									<s:decorate template="/layout/edit.xhtml">
										<ui:define name="label">#{ortakIslemler.getDinamikRaporAlanAciklama(parametre.aciklama)}</ui:define>
										<ui:fragment rendered="#{parametre.secimList!=null}">
											<h:selectOneMenu value="#{parametre.value}" required="#{parametre.zorunlu}" disabled="#{parametre.secimList.size() lt 2}"
												requiredMessage="#{ortakIslemler.getDinamikRaporAlanAciklama(parametre.aciklama)} seçiniz!">
												<f:selectItem itemLabel="Lütfen seçiniz" />
												<f:selectItems value="#{parametre.secimList}" />

												<a4j:support event="onchange" status="ajaxStatus" action="#{dinamikRaporHome.yilAyDoldur(parametre)}" ajaxSingle="true"
													reRender="girisler,raporTable" />


											</h:selectOneMenu>
										</ui:fragment>
										<ui:fragment rendered="#{parametre.secimList==null}">
											<ui:fragment rendered="#{parametre.karakter or parametre.sayisal}">
												<ui:fragment rendered="#{parametre.yilSpinner}">
													<rich:inputNumberSpinner styleClass="size10" inputStyle="width:20px" minValue="#{ortakIslemler.getParameterKey('sistemBaslangicYili')}"
														maxValue="#{dinamikRaporHome.maxYil}" inputSize="1" value="#{parametre.value}">
														<a4j:support event="onchange" status="ajaxStatus" action="#{dinamikRaporHome.yilAyDoldur(parametre)}" ajaxSingle="true"
															reRender="raporTable" />
													</rich:inputNumberSpinner>
												</ui:fragment>
												<h:inputText value="#{parametre.karakterDeger}" rendered="#{parametre.yilSpinner==false}" size="2" maxlength="255"
													required="#{parametre.zorunlu}" requiredMessage="#{ortakIslemler.getDinamikRaporAlanAciklama(parametre.aciklama)} giriniz" />
											</ui:fragment>

											<ui:fragment rendered="#{parametre.tarih}">
												<rich:calendar datePattern="#{authenticatedUser.dateFormat}" value="#{parametre.tarihDeger}" showWeekDaysBar="false" showWeeksBar="false"
													required="#{parametre.zorunlu}" requiredMessage="#{parametre.aciklama} seçiniz">
													<a4j:support event="onchanged" action="#{dinamikRaporHome.tesisDoldur(parametre)}" status="ajaxStatus" reRender="raporTable,girisler" />
												</rich:calendar>
											</ui:fragment>
										</ui:fragment>
									</s:decorate>

								</c:forEach>
							</h:panelGrid>

							<a4j:outputPanel id="raporTable">
								<ui:fragment rendered="#{not empty dinamikRaporHome.dinamikRaporAlanList}">
									<a4j:commandButton status="ajaxStatus" value="Rapor Getir" action="#{dinamikRaporHome.fillDinamikRaporList()}" reRender="raporTable" />

									<h:commandLink value="#{messages['ortak.etiket.excelAktar']}" action="#{dinamikRaporHome.excelDinamikRaporList()}" target="blank"
										rendered="#{not empty dinamikRaporHome.dinamikRaporDataList}" />

									<rich:dataTable rowClasses="acik,koyu" value="#{dinamikRaporHome.dinamikRaporDataList}" style="width: 98%;" var="dinamikVeri" rows="50"
										rowKeyVar="row">
										<f:facet name="header">
											<h:outputText value="#{dinamikRaporHome.seciliPdksDinamikRapor.aciklama}" rendered="#{not empty dinamikRaporHome.dinamikRaporDataList}" />
										</f:facet>
										<c:forEach items="#{dinamikRaporHome.dinamikRaporAlanList}" var="dinamikAlan">

											<c:if test="#{dinamikRaporHome.getFilterAlan(dinamikAlan)}">
												<rich:column style="text-align :#{dinamikAlan.pdksDinamikRaporAlanHizala}"
													filterBy="#{dinamikRaporHome.getDinamikRaporAlan(dinamikVeri.value,dinamikAlan)}" filterEvent="onkeyup"
													rendered="#{authenticatedUser.admin or dinamikAlan.goster}">
													<f:facet name="header">
														<h:outputText value="#{ortakIslemler.getDinamikRaporAlanAciklama(dinamikAlan.aciklama)}" />
													</f:facet>
													<ui:fragment rendered="#{dinamikRaporHome.isClob(dinamikVeri.value,dinamikAlan.sira)==false}">
														<h:outputText value="#{dinamikRaporHome.getDinamikRaporAlan(dinamikVeri.value,dinamikAlan)}" />
													</ui:fragment>
													<ui:fragment rendered="#{dinamikRaporHome.isClob(dinamikVeri.value,dinamikAlan.sira)}">
														<DIV id="denkf#{dinamikVeri.id}">
															<h:graphicImage value="/img/msginfo.png" style="border:0" height="20" width="20" />
															<rich:toolTip for="denkf#{dinamikVeri.id}">
																<DIV id="dataf#{dinamikVeri.id}" style="text-align: left;">
																	<h:outputText value="#{dinamikRaporHome.getDinamikRaporAlan(dinamikVeri.value,dinamikAlan)}" />
																</DIV>
															</rich:toolTip>
														</DIV>

													</ui:fragment>
												</rich:column>
											</c:if>

											<rich:column style="text-align :#{dinamikAlan.pdksDinamikRaporAlanHizala}"
												rendered="#{dinamikRaporHome.getFilterAlan(dinamikAlan)==false and (authenticatedUser.admin or dinamikAlan.goster)}">
												<f:facet name="header">
													<h:outputText value="#{ortakIslemler.getDinamikRaporAlanAciklama(dinamikAlan.aciklama)}" />
												</f:facet>
												<ui:fragment rendered="#{dinamikRaporHome.isClob(dinamikVeri.value,dinamikAlan.sira)==false}">
													<h:outputText value="#{dinamikRaporHome.getDinamikRaporAlan(dinamikVeri.value,dinamikAlan)}" />
												</ui:fragment>
												<ui:fragment rendered="#{dinamikRaporHome.isClob(dinamikVeri.value,dinamikAlan.sira)}">
													<DIV id="denk#{dinamikVeri.id}">
														<h:graphicImage value="/img/msginfo.png" style="border:0" height="20" width="20" />
														<rich:toolTip for="denk#{dinamikVeri.id}">
															<DIV id="data#{dinamikVeri.id}" style="text-align: left;">
																<h:outputText value="#{dinamikRaporHome.getDinamikRaporAlan(dinamikVeri.value,dinamikAlan)}" />
															</DIV>
														</rich:toolTip>
													</DIV>

												</ui:fragment>


											</rich:column>

										</c:forEach>
										<f:facet name="footer">
											<rich:datascroller renderIfSinglePage="false" maxPages="5" />
										</f:facet>
									</rich:dataTable>
									<h:commandLink value="#{messages['ortak.etiket.excelAktar']}" action="#{dinamikRaporHome.excelDinamikRaporList()}" target="blank"
										rendered="#{not empty dinamikRaporHome.dinamikRaporDataList}" />


								</ui:fragment>
							</a4j:outputPanel>
						</rich:panel>
					</c:if>

				</a4j:outputPanel>


			</rich:panel>

		</h:form>


	</ui:define>
</ui:composition>
